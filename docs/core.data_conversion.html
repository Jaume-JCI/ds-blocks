---

title: Data Conversion


keywords: fastai
sidebar: home_sidebar

summary: "Convert data format to fit the needs of a given component. Contrary to Transforms, the DataConverter classes only change the format of the data, not the data iself."
description: "Convert data format to fit the needs of a given component. Contrary to Transforms, the DataConverter classes only change the format of the data, not the data iself."
nb_path: "nbs/core.data_conversion.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: nbs/core.data_conversion.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="DataConverter">DataConverter<a class="anchor-link" href="#DataConverter"> </a></h2>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="DataConverter" class="doc_header"><code>class</code> <code>DataConverter</code><a href="https://github.com/Jaume-JCI/block_types/blob/main/block_types/core/data_conversion.py#L14" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>DataConverter</code>(<strong><code>logger</code></strong>=<em><code>None</code></em>, <strong><code>verbose</code></strong>:<code>int</code>=<em><code>1</code></em>, <strong>**<code>kwargs</code></strong>)</p>
</blockquote>

<pre><code>Convert input and output data format.

This class allows to convert the format of the data before fitting
and before transforming, and revert the changes back after performing
these operations. This allows to decouple the implementation of a
particular component from the remaining components in the pipeline,
making it more reusable across different pipelines.</code></pre>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="NoConverter">NoConverter<a class="anchor-link" href="#NoConverter"> </a></h2>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="NoConverter" class="doc_header"><code>class</code> <code>NoConverter</code><a href="https://github.com/Jaume-JCI/block_types/blob/main/block_types/core/data_conversion.py#L115" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>NoConverter</code>(<strong><code>logger</code></strong>=<em><code>None</code></em>, <strong><code>verbose</code></strong>:<code>int</code>=<em><code>1</code></em>, <strong>**<code>kwargs</code></strong>) :: <a href="/core.data_conversion.html#DataConverter"><code>DataConverter</code></a></p>
</blockquote>

<pre><code>Performs no conversion.</code></pre>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">dc</span> <span class="o">=</span> <span class="n">NoConverter</span><span class="p">()</span>
<span class="n">X</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
<span class="n">Xr</span><span class="p">,</span> <span class="n">yr</span> <span class="o">=</span> <span class="n">dc</span><span class="o">.</span><span class="n">convert_before_fitting</span> <span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
<span class="k">assert</span> <span class="n">X</span><span class="o">==</span><span class="n">Xr</span>
<span class="k">assert</span> <span class="n">y</span><span class="o">==</span><span class="n">yr</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="PandasConverter">PandasConverter<a class="anchor-link" href="#PandasConverter"> </a></h2>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="PandasConverter" class="doc_header"><code>class</code> <code>PandasConverter</code><a href="https://github.com/Jaume-JCI/block_types/blob/main/block_types/core/data_conversion.py#L120" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>PandasConverter</code>(<strong><code>transform_uses_labels</code></strong>=<em><code>False</code></em>, <strong><code>transformed_index</code></strong>=<em><code>None</code></em>, <strong><code>transformed_columns</code></strong>=<em><code>None</code></em>, <strong><code>separate_labels</code></strong>=<em><code>True</code></em>, <strong>**<code>kwargs</code></strong>) :: <a href="/core.data_conversion.html#DataConverter"><code>DataConverter</code></a></p>
</blockquote>

<pre><code>Convert DataFrame to numpy array and back, if needed.

By default, this class assumes the following:

    - When calling the fit method, the data is received
      as a DataFrame. This DataFrame contains not only the
      data to be used for fitting our model, but also the
      ground-truth labels. The `PandasConverter` takes only
      the data needed for fitting the model, and puts it
      into a matrix `X`, and then takes the labels and puts
      them into a separate vector `y`. While all this is done
      by default, the `PandasConverter` also allows other
      possibilities: receiving the data and the labels separately
      in `X` and `y`, in which case no action is needed, or avoiding
      to separate the data and the labels (if the flag `separate_labels` is False),
      in which case the matrix `X` will contain both data and labels.
      It also allows to receive numpy arrays instead of DataFrames,
      in which case the data format is preserved.

    - When calling the `transform` method, the `PandasConverter`
      removes by default the labels from the incoming DataFrame,
      and then puts them back after performing the transformation.
      This behaviour can change if we set `transform_needs_labels=True`.
      In this case, the labels are kept in the matrix `X` so that
      they can be used during the transformation. This is done in
      particular by one type of component called `SamplingComponent`,
      defined in `core.component_types`. This is useful for
      components that do some sort of under-sampling or over-sampling,
      changing the number of observations. When this occurs, the
      labels need to be adjusted accordingly, so that the `transform`
      method modifies both the data and the labels, both of whom are
      contained in the output matrix `X`.

    The  default `DataConverter` used in the current implementation is the
    `PandasConverter`.

    #### Note on generic use of metadata (to be implemented)

    In general, our DataFrames behave like a single-table in-memory DataBases
    from which we can take the necessary data and metadata to perform any
    operation needed in our pipeline. Although currently we only consider
    groundtruth labels as metadata, in the future we plan to allow any other
    metadata indicated by configuration. This includes the `chiller_id`, which
    might be needed by some of the components, to differentiate between the data of
    different chillers, for data-sets with more than one chiller. Currently
    our dataset contains a single chiller, and this type of metadata is not needed.
    Regardless of the metadata being used, the `PandasConverter` takes only the data
    needed for fitting the model, puts it into a matrix `X`, and then takes the
    labels and puts them into a separate vector `y`. The rest of the metadata is
    discarded unless the component needs it for some purpose, in which case this
    will be indicated by a parameter called something like `metadata`, which contains
    the list of columns in the DataFrame which contain the rest of metadata.</code></pre>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Window2Dto3Dconverter">Window2Dto3Dconverter<a class="anchor-link" href="#Window2Dto3Dconverter"> </a></h2>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="Window2Dto3Dconverter" class="doc_header"><code>class</code> <code>Window2Dto3Dconverter</code><a href="https://github.com/Jaume-JCI/block_types/blob/main/block_types/core/data_conversion.py#L359" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>Window2Dto3Dconverter</code>(<strong><code>sequence_length</code></strong>:<code>int</code>, <strong><code>data_converter</code></strong>:<a href="/core.data_conversion.html#DataConverter"><code>DataConverter</code></a>=<em><code>None</code></em>, <strong>**<code>kwargs</code></strong>) :: <a href="/core.data_conversion.html#DataConverter"><code>DataConverter</code></a></p>
</blockquote>

<pre><code>Convert sequence of windows from WindowGenerator's 2D format to 3D.

Given a 2D Dataframe of size N x (W*D), where N=number of windows,
D=number of variables (dimensions), and W=size of windows, converts this
to a numpy array of N x D x W. Note that the order of the elements is
transposed: for each window, the has first the elements of a window in
one dimension, then the elements in the second dimension, etc. This
is transposed in the output to have the second and third axis be D and W
respectively.</code></pre>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Factory">Factory<a class="anchor-link" href="#Factory"> </a></h2>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="data_converter_factory" class="doc_header"><code>data_converter_factory</code><a href="https://github.com/Jaume-JCI/block_types/blob/main/block_types/core/data_conversion.py#L500" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>data_converter_factory</code>(<strong><code>converter</code></strong>, <strong>*<code>args</code></strong>, <strong>**<code>kwargs</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">converter</span> <span class="o">=</span> <span class="n">data_converter_factory</span> <span class="p">(</span><span class="s1">&#39;PandasConverter&#39;</span><span class="p">,</span> <span class="n">separate_labels</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="k">assert</span> <span class="nb">type</span><span class="p">(</span><span class="n">converter</span><span class="p">)</span> <span class="ow">is</span> <span class="n">PandasConverter</span>
<span class="k">assert</span> <span class="n">converter</span><span class="o">.</span><span class="n">separate_labels</span> <span class="ow">is</span> <span class="kc">False</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

</div>
 

