---

title: Compose components


keywords: fastai
sidebar: home_sidebar

summary: "Classes and utilities for composed components"
description: "Classes and utilities for composed components"
nb_path: "nbs/core/compose.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: nbs/core/compose.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>
<span class="kn">import</span> <span class="nn">pytest</span> 
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">joblib</span>

<span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">FunctionTransformer</span>
<span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">StandardScaler</span>
<span class="kn">from</span> <span class="nn">sklearn.utils</span> <span class="kn">import</span> <span class="n">Bunch</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">KFold</span>

<span class="kn">from</span> <span class="nn">dsblocks.core.components</span> <span class="kn">import</span> <span class="n">PickleSaverComponent</span>
<span class="kn">from</span> <span class="nn">dsblocks.utils.utils</span> <span class="kn">import</span> <span class="n">remove_previous_results</span><span class="p">,</span> <span class="n">set_empty_logger</span>
<span class="kn">from</span> <span class="nn">dsblocks.core.utils</span> <span class="kn">import</span> <span class="n">PickleIO</span>
<span class="kn">from</span> <span class="nn">dsblocks.utils.utils</span> <span class="kn">import</span> <span class="n">check_last_part</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="MultiComponent">MultiComponent<a class="anchor-link" href="#MultiComponent"> </a></h2>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="MultiComponent" class="doc_header"><code>class</code> <code>MultiComponent</code><a href="https://github.com/Jaume-JCI/ds-blocks/tree/main/dsblocks/core/compose.py#L38" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>MultiComponent</code>(<strong>*<code>components</code></strong>, <strong><code>separate_labels</code></strong>=<em><code>False</code></em>, <strong><code>warning_if_nick_name_exists</code></strong>=<em><code>False</code></em>, <strong><code>propagate</code></strong>=<em><code>False</code></em>, <strong><code>path_results</code></strong>=<em><code>None</code></em>, <strong><code>path_models</code></strong>=<em><code>None</code></em>, <strong><code>root</code></strong>=<em><code>None</code></em>, <strong><code>automatic_root</code></strong>=<em><code>False</code></em>, <strong>**<code>kwargs</code></strong>) :: <a href="/components.html#SamplingComponent"><code>SamplingComponent</code></a></p>
</blockquote>

<pre><code>Component containing a list of components inside.

The list must contain at least one component.

See `Pipeline` class.</code></pre>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="MultiComponent-example">MultiComponent example<a class="anchor-link" href="#MultiComponent-example"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="SimpleMultiComponent" class="doc_header"><code>class</code> <code>SimpleMultiComponent</code><a href="https://github.com/Jaume-JCI/ds-blocks/tree/main/dsblocks/tests/core/test_compose.py#L404" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>SimpleMultiComponent</code>(<strong>**<code>kwargs</code></strong>) :: <a href="/compose.html#MultiComponent"><code>MultiComponent</code></a></p>
</blockquote>

<pre><code>Component containing a list of components inside.

The list must contain at least one component.

See `Pipeline` class.</code></pre>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">class</span> <span class="nc">SimpleMultiComponent</span> <span class="p">(</span><span class="n">MultiComponent</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">data_io</span> <span class="o">=</span> <span class="n">PickleIO</span> <span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">data_io</span><span class="o">=</span><span class="n">data_io</span><span class="p">,</span>
                         <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">tr1</span> <span class="o">=</span> <span class="n">Component</span><span class="p">(</span><span class="n">FunctionTransformer</span> <span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">*</span><span class="mi">3</span><span class="p">),</span>
                             <span class="n">data_io</span><span class="o">=</span><span class="n">data_io</span><span class="p">,</span>
                             <span class="n">name</span><span class="o">=</span><span class="s1">&#39;tr1&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tr2</span> <span class="o">=</span> <span class="n">Component</span><span class="p">(</span><span class="n">FunctionTransformer</span> <span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">*</span><span class="mi">2</span><span class="p">),</span>
                             <span class="n">data_io</span><span class="o">=</span><span class="n">data_io</span><span class="p">,</span>
                             <span class="n">name</span><span class="o">=</span><span class="s1">&#39;tr2&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_apply</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">tr1</span> <span class="p">(</span><span class="n">X</span><span class="p">)</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">tr2</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Loading-/-saving-all-results">Loading / saving all results<a class="anchor-link" href="#Loading-/-saving-all-results"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="test_multi_comp_io" class="doc_header"><code>test_multi_comp_io</code><a href="https://github.com/Jaume-JCI/ds-blocks/tree/main/dsblocks/tests/core/test_compose.py#L422" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>test_multi_comp_io</code>()</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1">#@pytest.mark.reference_fails</span>
<span class="k">def</span> <span class="nf">test_multi_comp_io</span> <span class="p">():</span>
    <span class="n">path_results</span> <span class="o">=</span> <span class="s1">&#39;multi_component_loading_saving&#39;</span>
    <span class="n">remove_previous_results</span> <span class="p">(</span><span class="n">path_results</span><span class="o">=</span><span class="n">path_results</span><span class="p">)</span>

    <span class="n">X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">])</span>
    <span class="n">composition1</span> <span class="o">=</span> <span class="n">SimpleMultiComponent</span> <span class="p">(</span><span class="n">path_results</span><span class="o">=</span><span class="n">path_results</span><span class="p">)</span>
    <span class="n">result1</span> <span class="o">=</span> <span class="n">composition1</span> <span class="p">(</span><span class="n">X</span><span class="p">)</span>

    <span class="n">composition2</span> <span class="o">=</span> <span class="n">SimpleMultiComponent</span> <span class="p">(</span><span class="n">path_results</span><span class="o">=</span><span class="n">path_results</span><span class="p">)</span>
    <span class="n">result2</span> <span class="o">=</span> <span class="n">composition2</span><span class="o">.</span><span class="n">data_io</span><span class="o">.</span><span class="n">load_result</span><span class="p">()</span>
    <span class="k">assert</span> <span class="p">(</span><span class="n">result1</span><span class="o">==</span><span class="n">result2</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>

    <span class="n">resut_tr1_2</span> <span class="o">=</span> <span class="n">composition2</span><span class="o">.</span><span class="n">tr1</span><span class="o">.</span><span class="n">data_io</span><span class="o">.</span><span class="n">load_result</span><span class="p">()</span>
    <span class="n">resut_tr2_2</span> <span class="o">=</span> <span class="n">composition2</span><span class="o">.</span><span class="n">tr2</span><span class="o">.</span><span class="n">data_io</span><span class="o">.</span><span class="n">load_result</span><span class="p">()</span>
    <span class="k">assert</span> <span class="p">(</span><span class="n">resut_tr1_2</span><span class="o">==</span><span class="n">composition1</span><span class="o">.</span><span class="n">tr1</span><span class="p">(</span><span class="n">X</span><span class="p">))</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
    <span class="k">assert</span> <span class="p">(</span><span class="n">resut_tr2_2</span><span class="o">==</span><span class="n">composition1</span><span class="o">.</span><span class="n">tr2</span><span class="p">(</span><span class="n">X</span><span class="p">))</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>

    <span class="k">assert</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">listdir</span> <span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">path_results</span><span class="si">}</span><span class="s1">/whole&#39;</span><span class="p">))</span><span class="o">==</span><span class="p">[</span><span class="s1">&#39;simple_multi_component_result.pk&#39;</span><span class="p">,</span> <span class="s1">&#39;tr1_result.pk&#39;</span><span class="p">,</span> <span class="s1">&#39;tr2_result.pk&#39;</span><span class="p">]</span>

    <span class="n">composition1</span><span class="o">.</span><span class="n">set_split</span> <span class="p">(</span><span class="s1">&#39;validation&#39;</span><span class="p">)</span>
    <span class="n">result1b</span> <span class="o">=</span> <span class="n">composition1</span> <span class="p">(</span><span class="n">X</span><span class="p">)</span>
    <span class="k">assert</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">listdir</span> <span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">path_results</span><span class="si">}</span><span class="s1">/validation&#39;</span><span class="p">))</span><span class="o">==</span><span class="p">[</span><span class="s1">&#39;simple_multi_component_result.pk&#39;</span><span class="p">,</span> <span class="s1">&#39;tr1_result.pk&#39;</span><span class="p">,</span> <span class="s1">&#39;tr2_result.pk&#39;</span><span class="p">]</span>

    <span class="n">remove_previous_results</span> <span class="p">(</span><span class="n">path_results</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">path_results</span><span class="si">}</span><span class="s1">/whole&#39;</span><span class="p">)</span>

    <span class="n">resut_tr1_2</span> <span class="o">=</span> <span class="n">composition2</span><span class="o">.</span><span class="n">tr1</span><span class="o">.</span><span class="n">data_io</span><span class="o">.</span><span class="n">load_result</span><span class="p">(</span><span class="n">split</span><span class="o">=</span><span class="s1">&#39;validation&#39;</span><span class="p">)</span>
    <span class="n">resut_tr2_2</span> <span class="o">=</span> <span class="n">composition2</span><span class="o">.</span><span class="n">tr2</span><span class="o">.</span><span class="n">data_io</span><span class="o">.</span><span class="n">load_result</span><span class="p">()</span>

    <span class="k">assert</span> <span class="p">(</span><span class="n">resut_tr1_2</span><span class="o">==</span><span class="n">composition1</span><span class="o">.</span><span class="n">tr1</span><span class="p">(</span><span class="n">X</span><span class="p">))</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
    <span class="k">assert</span> <span class="n">resut_tr2_2</span> <span class="ow">is</span> <span class="kc">None</span>

    <span class="n">composition2</span><span class="o">.</span><span class="n">set_split</span><span class="p">(</span><span class="s1">&#39;validation&#39;</span><span class="p">)</span>
    <span class="n">resut_tr1_2</span> <span class="o">=</span> <span class="n">composition2</span><span class="o">.</span><span class="n">tr1</span><span class="o">.</span><span class="n">data_io</span><span class="o">.</span><span class="n">load_result</span><span class="p">()</span>
    <span class="n">resut_tr2_2</span> <span class="o">=</span> <span class="n">composition2</span><span class="o">.</span><span class="n">tr2</span><span class="o">.</span><span class="n">data_io</span><span class="o">.</span><span class="n">load_result</span><span class="p">()</span>

    <span class="k">assert</span> <span class="p">(</span><span class="n">resut_tr1_2</span><span class="o">==</span><span class="n">composition1</span><span class="o">.</span><span class="n">tr1</span><span class="p">(</span><span class="n">X</span><span class="p">))</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
    <span class="k">assert</span> <span class="p">(</span><span class="n">resut_tr2_2</span><span class="o">==</span><span class="n">composition1</span><span class="o">.</span><span class="n">tr2</span><span class="p">(</span><span class="n">X</span><span class="p">))</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>

    <span class="n">remove_previous_results</span> <span class="p">(</span><span class="n">path_results</span><span class="o">=</span><span class="n">path_results</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">tst</span><span class="o">.</span><span class="n">run</span> <span class="p">(</span><span class="n">test_multi_comp_io</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="s1">&#39;dummy&#39;</span><span class="p">,</span> <span class="n">debug</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>running test_multi_comp_io
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Getting-descendants">Getting descendants<a class="anchor-link" href="#Getting-descendants"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="test_multi_comp_desc" class="doc_header"><code>test_multi_comp_desc</code><a href="https://github.com/Jaume-JCI/ds-blocks/tree/main/dsblocks/tests/core/test_compose.py#L463" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>test_multi_comp_desc</code>()</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">test_multi_comp_desc</span> <span class="p">():</span>
    <span class="k">class</span> <span class="nc">Intermediate</span> <span class="p">(</span><span class="n">MultiComponent</span><span class="p">):</span>
        <span class="k">def</span> <span class="fm">__init__</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
            <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span> <span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">first</span> <span class="o">=</span> <span class="n">Component</span> <span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;first_component&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">second</span> <span class="o">=</span> <span class="n">Component</span> <span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;second_component&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">class</span> <span class="nc">Higher</span> <span class="p">(</span><span class="n">MultiComponent</span><span class="p">):</span>
        <span class="k">def</span> <span class="fm">__init__</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
            <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span> <span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">first</span> <span class="o">=</span> <span class="n">Intermediate</span> <span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;first_intermediate&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">second</span> <span class="o">=</span> <span class="n">Intermediate</span> <span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;second_intermediate&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">gather_descendants</span><span class="p">(</span><span class="n">nick_name</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            
    <span class="n">higher</span> <span class="o">=</span> <span class="n">Higher</span><span class="p">()</span>

    <span class="k">assert</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">higher</span><span class="o">.</span><span class="n">obj</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span><span class="o">==</span><span class="p">[</span><span class="s1">&#39;first_component&#39;</span><span class="p">,</span> <span class="s1">&#39;first_intermediate&#39;</span><span class="p">,</span> <span class="s1">&#39;second_component&#39;</span><span class="p">,</span> <span class="s1">&#39;second_intermediate&#39;</span><span class="p">]</span>

    <span class="c1"># check types</span>
    <span class="n">types</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">type</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">higher</span><span class="o">.</span><span class="n">obj</span><span class="o">.</span><span class="n">items</span><span class="p">()))</span>
    <span class="k">assert</span> <span class="nb">list</span><span class="p">(</span><span class="n">types</span><span class="p">)</span><span class="o">==</span><span class="p">[</span><span class="nb">list</span><span class="p">,</span> <span class="n">Intermediate</span><span class="p">,</span> <span class="nb">list</span><span class="p">,</span> <span class="n">Intermediate</span><span class="p">]</span>

    <span class="n">sorted_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">higher</span><span class="o">.</span><span class="n">obj</span><span class="o">.</span><span class="n">items</span><span class="p">()))</span>
    <span class="n">types</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="nb">type</span><span class="p">,</span> <span class="n">sorted_list</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
    <span class="k">assert</span> <span class="nb">list</span><span class="p">(</span><span class="n">types</span><span class="p">)</span><span class="o">==</span><span class="p">[</span><span class="n">Component</span><span class="p">,</span><span class="n">Component</span><span class="p">]</span>

    <span class="n">sorted_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">higher</span><span class="o">.</span><span class="n">obj</span><span class="o">.</span><span class="n">items</span><span class="p">()))</span>
    <span class="n">types</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="nb">type</span><span class="p">,</span> <span class="n">sorted_list</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
    <span class="k">assert</span> <span class="nb">list</span><span class="p">(</span><span class="n">types</span><span class="p">)</span><span class="o">==</span><span class="p">[</span><span class="n">Component</span><span class="p">,</span><span class="n">Component</span><span class="p">]</span>

    <span class="n">sorted_keys</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">higher</span><span class="o">.</span><span class="n">cls</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>
    <span class="k">assert</span> <span class="n">sorted_keys</span> <span class="o">==</span> <span class="p">[</span><span class="s1">&#39;Component&#39;</span><span class="p">,</span> <span class="s1">&#39;Intermediate&#39;</span><span class="p">]</span>

    <span class="k">assert</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">type</span><span class="p">,</span><span class="n">higher</span><span class="o">.</span><span class="n">cls</span><span class="p">[</span><span class="n">sorted_keys</span><span class="p">[</span><span class="mi">0</span><span class="p">]]))</span><span class="o">==</span><span class="p">[</span><span class="n">Component</span><span class="p">,</span> <span class="n">Component</span><span class="p">,</span> <span class="n">Component</span><span class="p">,</span> <span class="n">Component</span><span class="p">]</span>

    <span class="k">assert</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">type</span><span class="p">,</span><span class="n">higher</span><span class="o">.</span><span class="n">cls</span><span class="p">[</span><span class="n">sorted_keys</span><span class="p">[</span><span class="mi">1</span><span class="p">]]))</span><span class="o">==</span><span class="p">[</span><span class="n">Intermediate</span><span class="p">,</span> <span class="n">Intermediate</span><span class="p">]</span>


    <span class="c1"># ***********************</span>
    <span class="c1"># recursive behaviour: higher.first</span>
    <span class="n">intermediate</span> <span class="o">=</span> <span class="n">higher</span><span class="o">.</span><span class="n">first</span>
    <span class="k">assert</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">intermediate</span><span class="o">.</span><span class="n">obj</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span><span class="o">==</span><span class="p">[</span><span class="s1">&#39;first_component&#39;</span><span class="p">,</span> <span class="s1">&#39;second_component&#39;</span><span class="p">]</span>

    <span class="c1"># check types</span>
    <span class="n">types</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">type</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">intermediate</span><span class="o">.</span><span class="n">obj</span><span class="o">.</span><span class="n">items</span><span class="p">()))</span>
    <span class="k">assert</span> <span class="nb">list</span><span class="p">(</span><span class="n">types</span><span class="p">)</span><span class="o">==</span><span class="p">[</span><span class="n">Component</span><span class="p">,</span> <span class="n">Component</span><span class="p">]</span>

    <span class="n">sorted_keys</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">intermediate</span><span class="o">.</span><span class="n">cls</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>
    <span class="k">assert</span> <span class="n">sorted_keys</span><span class="o">==</span><span class="p">[</span><span class="s1">&#39;Component&#39;</span><span class="p">]</span>

    <span class="k">assert</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">type</span><span class="p">,</span><span class="n">intermediate</span><span class="o">.</span><span class="n">cls</span><span class="p">[</span><span class="n">sorted_keys</span><span class="p">[</span><span class="mi">0</span><span class="p">]]))</span><span class="o">==</span><span class="p">[</span><span class="n">Component</span><span class="p">,</span><span class="n">Component</span><span class="p">]</span>

    <span class="c1"># **********************************************</span>
    <span class="c1"># recursive behaviour: higher.second</span>
    <span class="c1"># **********************************************</span>
    <span class="n">intermediate</span> <span class="o">=</span> <span class="n">higher</span><span class="o">.</span><span class="n">second</span>
    <span class="k">assert</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">intermediate</span><span class="o">.</span><span class="n">obj</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span><span class="o">==</span><span class="p">[</span><span class="s1">&#39;first_component&#39;</span><span class="p">,</span> <span class="s1">&#39;second_component&#39;</span><span class="p">]</span>

    <span class="c1"># check types</span>
    <span class="n">types</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">type</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">intermediate</span><span class="o">.</span><span class="n">obj</span><span class="o">.</span><span class="n">items</span><span class="p">()))</span>
    <span class="k">assert</span> <span class="nb">list</span><span class="p">(</span><span class="n">types</span><span class="p">)</span><span class="o">==</span><span class="p">[</span><span class="n">Component</span><span class="p">,</span> <span class="n">Component</span><span class="p">]</span>

    <span class="n">sorted_keys</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">intermediate</span><span class="o">.</span><span class="n">cls</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>
    <span class="k">assert</span> <span class="n">sorted_keys</span><span class="o">==</span><span class="p">[</span><span class="s1">&#39;Component&#39;</span><span class="p">]</span>

    <span class="k">assert</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">type</span><span class="p">,</span><span class="n">intermediate</span><span class="o">.</span><span class="n">cls</span><span class="p">[</span><span class="n">sorted_keys</span><span class="p">[</span><span class="mi">0</span><span class="p">]]))</span><span class="o">==</span><span class="p">[</span><span class="n">Component</span><span class="p">,</span><span class="n">Component</span><span class="p">]</span>

    <span class="c1"># **********************************************</span>
    <span class="c1"># full hierarchical paths</span>
    <span class="c1"># **********************************************</span>
    <span class="k">assert</span> <span class="nb">list</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">higher</span><span class="o">.</span><span class="n">full_cls</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span><span class="o">==</span><span class="p">[</span><span class="s1">&#39;Component&#39;</span><span class="p">,</span> <span class="s1">&#39;Intermediate&#39;</span><span class="p">]</span>
    <span class="k">assert</span> <span class="n">higher</span><span class="o">.</span><span class="n">full_cls</span><span class="p">[</span><span class="s1">&#39;Intermediate&#39;</span><span class="p">]</span><span class="o">==</span><span class="p">[</span><span class="s1">&#39;higher.first_intermediate&#39;</span><span class="p">,</span> <span class="s1">&#39;higher.second_intermediate&#39;</span><span class="p">]</span>
    <span class="k">assert</span> <span class="n">higher</span><span class="o">.</span><span class="n">full_cls</span><span class="p">[</span><span class="s1">&#39;Component&#39;</span><span class="p">]</span><span class="o">==</span><span class="p">[</span><span class="s1">&#39;higher.first_intermediate.first_component&#39;</span><span class="p">,</span>
      <span class="s1">&#39;higher.first_intermediate.second_component&#39;</span><span class="p">,</span>
      <span class="s1">&#39;higher.second_intermediate.first_component&#39;</span><span class="p">,</span>
      <span class="s1">&#39;higher.second_intermediate.second_component&#39;</span><span class="p">]</span>

    <span class="k">assert</span> <span class="n">higher</span><span class="o">.</span><span class="n">first</span><span class="o">.</span><span class="n">full_cls</span><span class="p">[</span><span class="s1">&#39;Component&#39;</span><span class="p">]</span><span class="o">==</span><span class="p">[</span><span class="s1">&#39;higher.first_intermediate.first_component&#39;</span><span class="p">,</span>
      <span class="s1">&#39;higher.first_intermediate.second_component&#39;</span><span class="p">]</span>

    <span class="k">assert</span> <span class="nb">list</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">higher</span><span class="o">.</span><span class="n">full_obj</span><span class="p">))</span><span class="o">==</span><span class="p">[</span><span class="s1">&#39;first_component&#39;</span><span class="p">,</span> <span class="s1">&#39;first_intermediate&#39;</span><span class="p">,</span> <span class="s1">&#39;second_component&#39;</span><span class="p">,</span> <span class="s1">&#39;second_intermediate&#39;</span><span class="p">]</span>

    <span class="k">assert</span> <span class="n">higher</span><span class="o">.</span><span class="n">full_obj</span><span class="p">[</span><span class="s1">&#39;first_intermediate&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;higher.first_intermediate&#39;</span>

    <span class="k">assert</span> <span class="n">higher</span><span class="o">.</span><span class="n">full_obj</span><span class="p">[</span><span class="s1">&#39;first_component&#39;</span><span class="p">]</span><span class="o">==</span><span class="p">[</span><span class="s1">&#39;higher.first_intermediate.first_component&#39;</span><span class="p">,</span>
      <span class="s1">&#39;higher.second_intermediate.first_component&#39;</span><span class="p">]</span>

    <span class="k">assert</span> <span class="n">higher</span><span class="o">.</span><span class="n">full_obj</span><span class="p">[</span><span class="s1">&#39;second_component&#39;</span><span class="p">]</span><span class="o">==</span><span class="p">[</span><span class="s1">&#39;higher.first_intermediate.second_component&#39;</span><span class="p">,</span>
      <span class="s1">&#39;higher.second_intermediate.second_component&#39;</span><span class="p">]</span>

    <span class="k">assert</span> <span class="n">higher</span><span class="o">.</span><span class="n">full_obj</span><span class="p">[</span><span class="s1">&#39;second_intermediate&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;higher.second_intermediate&#39;</span>

    <span class="k">assert</span> <span class="nb">list</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">higher</span><span class="o">.</span><span class="n">second</span><span class="o">.</span><span class="n">full_obj</span><span class="p">))</span><span class="o">==</span><span class="p">[</span><span class="s1">&#39;first_component&#39;</span><span class="p">,</span> <span class="s1">&#39;second_component&#39;</span><span class="p">]</span>

    <span class="k">assert</span> <span class="n">higher</span><span class="o">.</span><span class="n">second</span><span class="o">.</span><span class="n">full_obj</span><span class="p">[</span><span class="s1">&#39;first_component&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;higher.second_intermediate.first_component&#39;</span>

    <span class="k">assert</span> <span class="n">higher</span><span class="o">.</span><span class="n">second</span><span class="o">.</span><span class="n">full_obj</span><span class="p">[</span><span class="s1">&#39;second_component&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;higher.second_intermediate.second_component&#39;</span>

    <span class="k">assert</span> <span class="n">higher</span><span class="o">.</span><span class="n">hierarchy_path</span><span class="o">==</span><span class="s1">&#39;higher&#39;</span>

    <span class="k">assert</span> <span class="n">higher</span><span class="o">.</span><span class="n">first</span><span class="o">.</span><span class="n">hierarchy_path</span><span class="o">==</span><span class="s1">&#39;higher.first_intermediate&#39;</span>

    <span class="c1"># with nick_names</span>
    <span class="n">higher</span><span class="o">.</span><span class="n">clear_descendants</span><span class="p">()</span>
    <span class="n">higher</span><span class="o">.</span><span class="n">gather_descendants</span><span class="p">(</span><span class="n">nick_name</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">assert</span> <span class="n">higher</span><span class="o">.</span><span class="n">full_cls</span><span class="p">[</span><span class="s1">&#39;Component&#39;</span><span class="p">]</span><span class="o">==</span><span class="p">[</span><span class="s1">&#39;higher.first.first&#39;</span><span class="p">,</span>
     <span class="s1">&#39;higher.first.second&#39;</span><span class="p">,</span>
     <span class="s1">&#39;higher.second.first&#39;</span><span class="p">,</span>
     <span class="s1">&#39;higher.second.second&#39;</span><span class="p">]</span>

    <span class="k">assert</span> <span class="n">higher</span><span class="o">.</span><span class="n">full_obj</span><span class="p">[</span><span class="s1">&#39;first_intermediate&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;higher.first&#39;</span>
    <span class="k">assert</span> <span class="n">higher</span><span class="o">.</span><span class="n">full_obj</span><span class="p">[</span><span class="s1">&#39;first_component&#39;</span><span class="p">]</span><span class="o">==</span><span class="p">[</span><span class="s1">&#39;higher.first.first&#39;</span><span class="p">,</span> <span class="s1">&#39;higher.second.first&#39;</span><span class="p">]</span>
    <span class="k">assert</span> <span class="n">higher</span><span class="o">.</span><span class="n">full_obj</span><span class="p">[</span><span class="s1">&#39;second_component&#39;</span><span class="p">]</span><span class="o">==</span><span class="p">[</span><span class="s1">&#39;higher.first.second&#39;</span><span class="p">,</span> <span class="s1">&#39;higher.second.second&#39;</span><span class="p">]</span>
    <span class="k">assert</span> <span class="n">higher</span><span class="o">.</span><span class="n">full_obj</span><span class="p">[</span><span class="s1">&#39;second_intermediate&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;higher.second&#39;</span>
    
    <span class="c1">#Check that we always have attributes for each component name</span>
    <span class="k">assert</span> <span class="n">higher</span><span class="o">.</span><span class="n">first_intermediate</span> <span class="ow">is</span> <span class="n">higher</span><span class="o">.</span><span class="n">first</span>
    <span class="k">assert</span> <span class="n">higher</span><span class="o">.</span><span class="n">second_intermediate</span> <span class="ow">is</span> <span class="n">higher</span><span class="o">.</span><span class="n">second</span>
    <span class="k">assert</span> <span class="n">higher</span><span class="o">.</span><span class="n">components</span><span class="o">==</span><span class="p">[</span><span class="n">higher</span><span class="o">.</span><span class="n">first</span><span class="p">,</span> <span class="n">higher</span><span class="o">.</span><span class="n">second</span><span class="p">]</span>
    
    <span class="c1">#check that set_components and add_component create self attrs called </span>
    <span class="c1"># the same as the component</span>
    
    <span class="k">class</span> <span class="nc">Higher</span> <span class="p">(</span><span class="n">MultiComponent</span><span class="p">):</span>
        <span class="k">def</span> <span class="fm">__init__</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
            <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span> <span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_components</span> <span class="p">(</span><span class="n">Intermediate</span> <span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;first_intermediate&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">),</span>
                                 <span class="n">Intermediate</span> <span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;second_intermediate&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">))</span>
    <span class="n">higher</span> <span class="o">=</span> <span class="n">Higher</span><span class="p">()</span>

    <span class="k">assert</span> <span class="n">higher</span><span class="o">.</span><span class="n">components</span> <span class="o">==</span> <span class="p">(</span><span class="n">higher</span><span class="o">.</span><span class="n">first_intermediate</span><span class="p">,</span> <span class="n">higher</span><span class="o">.</span><span class="n">second_intermediate</span><span class="p">)</span>

    <span class="k">class</span> <span class="nc">Higher</span> <span class="p">(</span><span class="n">MultiComponent</span><span class="p">):</span>
        <span class="k">def</span> <span class="fm">__init__</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
            <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span> <span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add_component</span> <span class="p">(</span><span class="n">Intermediate</span> <span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;first_intermediate&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add_component</span> <span class="p">(</span><span class="n">Intermediate</span> <span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;second_intermediate&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">))</span>
    <span class="n">higher</span> <span class="o">=</span> <span class="n">Higher</span><span class="p">()</span>

    <span class="k">assert</span> <span class="n">higher</span><span class="o">.</span><span class="n">components</span> <span class="o">==</span> <span class="p">[</span><span class="n">higher</span><span class="o">.</span><span class="n">first_intermediate</span><span class="p">,</span> <span class="n">higher</span><span class="o">.</span><span class="n">second_intermediate</span><span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">tst</span><span class="o">.</span><span class="n">run</span> <span class="p">(</span><span class="n">test_multi_comp_desc</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="s1">&#39;dummy&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>running test_multi_comp_desc
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="test_athena_pipeline_training" class="doc_header"><code>test_athena_pipeline_training</code><a href="https://github.com/Jaume-JCI/ds-blocks/tree/main/dsblocks/tests/core/test_compose.py#L1448" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>test_athena_pipeline_training</code>()</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># second example</span>
<span class="c1"># **********************************************</span>
<span class="c1"># exports tests.core.test_compose</span>
<span class="c1">#@pytest.mark.reference_fails</span>
<span class="k">def</span> <span class="nf">test_athena_pipeline_training</span> <span class="p">():</span>
    <span class="k">class</span> <span class="nc">Intermediate</span> <span class="p">(</span><span class="n">MultiComponent</span><span class="p">):</span>
        <span class="k">def</span> <span class="fm">__init__</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
            <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span> <span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">first</span> <span class="o">=</span> <span class="n">Component</span> <span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s1">_first_component&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">second</span> <span class="o">=</span> <span class="n">Component</span> <span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s1">_second_component&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">class</span> <span class="nc">Higher</span> <span class="p">(</span><span class="n">MultiComponent</span><span class="p">):</span>
        <span class="k">def</span> <span class="fm">__init__</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
            <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span> <span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">first</span> <span class="o">=</span> <span class="n">Intermediate</span> <span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;first_intermediate&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">second</span> <span class="o">=</span> <span class="n">Intermediate</span> <span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;second_intermediate&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">gather_descendants</span><span class="p">(</span><span class="n">nick_name</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    
    <span class="n">higher</span> <span class="o">=</span> <span class="n">Higher</span><span class="p">()</span>

    <span class="k">assert</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">higher</span><span class="o">.</span><span class="n">obj</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span><span class="o">==</span><span class="p">[</span><span class="s1">&#39;first_intermediate&#39;</span><span class="p">,</span> <span class="s1">&#39;first_intermediate_first_component&#39;</span><span class="p">,</span> <span class="s1">&#39;first_intermediate_second_component&#39;</span><span class="p">,</span> <span class="s1">&#39;second_intermediate&#39;</span><span class="p">,</span> <span class="s1">&#39;second_intermediate_first_component&#39;</span><span class="p">,</span> <span class="s1">&#39;second_intermediate_second_component&#39;</span><span class="p">]</span>

    <span class="c1"># check types</span>
    <span class="n">types</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">type</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">higher</span><span class="o">.</span><span class="n">obj</span><span class="o">.</span><span class="n">items</span><span class="p">()))</span>

    <span class="k">assert</span> <span class="nb">list</span><span class="p">(</span><span class="n">types</span><span class="p">)</span><span class="o">==</span><span class="p">[</span><span class="n">Intermediate</span><span class="p">,</span> <span class="n">Component</span><span class="p">,</span> <span class="n">Component</span><span class="p">,</span> <span class="n">Intermediate</span><span class="p">,</span> <span class="n">Component</span><span class="p">,</span> <span class="n">Component</span><span class="p">]</span>

    <span class="n">sorted_keys</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">higher</span><span class="o">.</span><span class="n">cls</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>
    <span class="k">assert</span> <span class="n">sorted_keys</span> <span class="o">==</span> <span class="p">[</span><span class="s1">&#39;Component&#39;</span><span class="p">,</span> <span class="s1">&#39;Intermediate&#39;</span><span class="p">]</span>

    <span class="k">assert</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">type</span><span class="p">,</span><span class="n">higher</span><span class="o">.</span><span class="n">cls</span><span class="p">[</span><span class="n">sorted_keys</span><span class="p">[</span><span class="mi">0</span><span class="p">]]))</span><span class="o">==</span><span class="p">[</span><span class="n">Component</span><span class="p">,</span> <span class="n">Component</span><span class="p">,</span> <span class="n">Component</span><span class="p">,</span> <span class="n">Component</span><span class="p">]</span>
    <span class="k">assert</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">type</span><span class="p">,</span><span class="n">higher</span><span class="o">.</span><span class="n">cls</span><span class="p">[</span><span class="n">sorted_keys</span><span class="p">[</span><span class="mi">1</span><span class="p">]]))</span><span class="o">==</span><span class="p">[</span><span class="n">Intermediate</span><span class="p">,</span> <span class="n">Intermediate</span><span class="p">]</span>

    <span class="c1"># ***********************</span>
    <span class="c1"># recursive behaviour: higher.first</span>
    <span class="n">intermediate</span> <span class="o">=</span> <span class="n">higher</span><span class="o">.</span><span class="n">first</span>
    <span class="k">assert</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">intermediate</span><span class="o">.</span><span class="n">obj</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span><span class="o">==</span><span class="p">[</span><span class="s1">&#39;first_intermediate_first_component&#39;</span><span class="p">,</span> <span class="s1">&#39;first_intermediate_second_component&#39;</span><span class="p">]</span>

    <span class="c1"># check types</span>
    <span class="n">types</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">type</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">intermediate</span><span class="o">.</span><span class="n">obj</span><span class="o">.</span><span class="n">items</span><span class="p">()))</span>
    <span class="k">assert</span> <span class="nb">list</span><span class="p">(</span><span class="n">types</span><span class="p">)</span><span class="o">==</span><span class="p">[</span><span class="n">Component</span><span class="p">,</span> <span class="n">Component</span><span class="p">]</span>

    <span class="n">sorted_keys</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">intermediate</span><span class="o">.</span><span class="n">cls</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>
    <span class="k">assert</span> <span class="n">sorted_keys</span><span class="o">==</span><span class="p">[</span><span class="s1">&#39;Component&#39;</span><span class="p">]</span>

    <span class="k">assert</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">type</span><span class="p">,</span><span class="n">intermediate</span><span class="o">.</span><span class="n">cls</span><span class="p">[</span><span class="n">sorted_keys</span><span class="p">[</span><span class="mi">0</span><span class="p">]]))</span><span class="o">==</span><span class="p">[</span><span class="n">Component</span><span class="p">,</span><span class="n">Component</span><span class="p">]</span>

    <span class="c1"># ***********************</span>
    <span class="c1"># recursive behaviour: higher.second</span>
    <span class="n">intermediate</span> <span class="o">=</span> <span class="n">higher</span><span class="o">.</span><span class="n">second</span>
    <span class="k">assert</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">intermediate</span><span class="o">.</span><span class="n">obj</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span><span class="o">==</span><span class="p">[</span><span class="s1">&#39;second_intermediate_first_component&#39;</span><span class="p">,</span> <span class="s1">&#39;second_intermediate_second_component&#39;</span><span class="p">]</span>

    <span class="c1"># check types</span>
    <span class="n">types</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">type</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">intermediate</span><span class="o">.</span><span class="n">obj</span><span class="o">.</span><span class="n">items</span><span class="p">()))</span>
    <span class="k">assert</span> <span class="nb">list</span><span class="p">(</span><span class="n">types</span><span class="p">)</span><span class="o">==</span><span class="p">[</span><span class="n">Component</span><span class="p">,</span> <span class="n">Component</span><span class="p">]</span>

    <span class="n">sorted_keys</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">intermediate</span><span class="o">.</span><span class="n">cls</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>
    <span class="k">assert</span> <span class="n">sorted_keys</span><span class="o">==</span><span class="p">[</span><span class="s1">&#39;Component&#39;</span><span class="p">]</span>

    <span class="k">assert</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">type</span><span class="p">,</span><span class="n">intermediate</span><span class="o">.</span><span class="n">cls</span><span class="p">[</span><span class="n">sorted_keys</span><span class="p">[</span><span class="mi">0</span><span class="p">]]))</span><span class="o">==</span><span class="p">[</span><span class="n">Component</span><span class="p">,</span><span class="n">Component</span><span class="p">]</span>


    <span class="c1"># **********************************************</span>
    <span class="c1"># full hierarchical paths</span>
    <span class="c1"># **********************************************</span>
    <span class="k">assert</span> <span class="nb">list</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">higher</span><span class="o">.</span><span class="n">full_cls</span><span class="p">))</span><span class="o">==</span><span class="p">[</span><span class="s1">&#39;Component&#39;</span><span class="p">,</span> <span class="s1">&#39;Intermediate&#39;</span><span class="p">]</span>

    <span class="k">assert</span> <span class="n">higher</span><span class="o">.</span><span class="n">full_cls</span><span class="p">[</span><span class="s1">&#39;Component&#39;</span><span class="p">]</span><span class="o">==</span><span class="p">[</span><span class="s1">&#39;higher.first_intermediate.first_intermediate_first_component&#39;</span><span class="p">,</span>
      <span class="s1">&#39;higher.first_intermediate.first_intermediate_second_component&#39;</span><span class="p">,</span>
      <span class="s1">&#39;higher.second_intermediate.second_intermediate_first_component&#39;</span><span class="p">,</span>
      <span class="s1">&#39;higher.second_intermediate.second_intermediate_second_component&#39;</span><span class="p">]</span>

    <span class="k">assert</span> <span class="n">higher</span><span class="o">.</span><span class="n">full_cls</span><span class="p">[</span><span class="s1">&#39;Intermediate&#39;</span><span class="p">]</span><span class="o">==</span><span class="p">[</span><span class="s1">&#39;higher.first_intermediate&#39;</span><span class="p">,</span> <span class="s1">&#39;higher.second_intermediate&#39;</span><span class="p">]</span>

    <span class="k">assert</span> <span class="nb">list</span><span class="p">(</span><span class="n">higher</span><span class="o">.</span><span class="n">first</span><span class="o">.</span><span class="n">full_cls</span><span class="p">)</span><span class="o">==</span><span class="p">[</span><span class="s1">&#39;Component&#39;</span><span class="p">]</span>

    <span class="k">assert</span> <span class="n">higher</span><span class="o">.</span><span class="n">first</span><span class="o">.</span><span class="n">full_cls</span><span class="p">[</span><span class="s1">&#39;Component&#39;</span><span class="p">]</span><span class="o">==</span><span class="p">[</span><span class="s1">&#39;higher.first_intermediate.first_intermediate_first_component&#39;</span><span class="p">,</span>
      <span class="s1">&#39;higher.first_intermediate.first_intermediate_second_component&#39;</span><span class="p">]</span>

    <span class="k">assert</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">higher</span><span class="o">.</span><span class="n">full_obj</span><span class="p">))</span><span class="o">==</span><span class="p">[</span><span class="s1">&#39;first_intermediate&#39;</span><span class="p">,</span>
     <span class="s1">&#39;first_intermediate_first_component&#39;</span><span class="p">,</span>
     <span class="s1">&#39;first_intermediate_second_component&#39;</span><span class="p">,</span>
     <span class="s1">&#39;second_intermediate&#39;</span><span class="p">,</span>
     <span class="s1">&#39;second_intermediate_first_component&#39;</span><span class="p">,</span>
     <span class="s1">&#39;second_intermediate_second_component&#39;</span><span class="p">]</span>

    <span class="k">assert</span> <span class="n">higher</span><span class="o">.</span><span class="n">full_obj</span><span class="p">[</span><span class="s1">&#39;first_intermediate&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;higher.first_intermediate&#39;</span>

    <span class="k">assert</span> <span class="n">higher</span><span class="o">.</span><span class="n">full_obj</span><span class="p">[</span><span class="s1">&#39;first_intermediate_first_component&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;higher.first_intermediate.first_intermediate_first_component&#39;</span>

    <span class="k">assert</span> <span class="n">higher</span><span class="o">.</span><span class="n">full_obj</span><span class="p">[</span><span class="s1">&#39;first_intermediate_second_component&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;higher.first_intermediate.first_intermediate_second_component&#39;</span>

    <span class="k">assert</span> <span class="n">higher</span><span class="o">.</span><span class="n">full_obj</span><span class="p">[</span><span class="s1">&#39;second_intermediate&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;higher.second_intermediate&#39;</span>

    <span class="k">assert</span> <span class="n">higher</span><span class="o">.</span><span class="n">full_obj</span><span class="p">[</span><span class="s1">&#39;second_intermediate_first_component&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;higher.second_intermediate.second_intermediate_first_component&#39;</span>

    <span class="k">assert</span> <span class="n">higher</span><span class="o">.</span><span class="n">full_obj</span><span class="p">[</span><span class="s1">&#39;second_intermediate_second_component&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;higher.second_intermediate.second_intermediate_second_component&#39;</span>

    <span class="k">assert</span> <span class="nb">list</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">higher</span><span class="o">.</span><span class="n">second</span><span class="o">.</span><span class="n">full_obj</span><span class="p">))</span><span class="o">==</span><span class="p">[</span><span class="s1">&#39;second_intermediate_first_component&#39;</span><span class="p">,</span> <span class="s1">&#39;second_intermediate_second_component&#39;</span><span class="p">]</span>

    <span class="k">assert</span> <span class="n">higher</span><span class="o">.</span><span class="n">second</span><span class="o">.</span><span class="n">full_obj</span><span class="p">[</span><span class="s1">&#39;second_intermediate_first_component&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;higher.second_intermediate.second_intermediate_first_component&#39;</span>

    <span class="k">assert</span> <span class="n">higher</span><span class="o">.</span><span class="n">second</span><span class="o">.</span><span class="n">full_obj</span><span class="p">[</span><span class="s1">&#39;second_intermediate_second_component&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;higher.second_intermediate.second_intermediate_second_component&#39;</span>

    <span class="k">assert</span> <span class="n">higher</span><span class="o">.</span><span class="n">hierarchy_path</span><span class="o">==</span><span class="s1">&#39;higher&#39;</span>

    <span class="k">assert</span> <span class="n">higher</span><span class="o">.</span><span class="n">first</span><span class="o">.</span><span class="n">hierarchy_path</span><span class="o">==</span><span class="s1">&#39;higher.first_intermediate&#39;</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">tst</span><span class="o">.</span><span class="n">run</span> <span class="p">(</span><span class="n">test_athena_pipeline_training</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="s1">&#39;dummy&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>running test_athena_pipeline_training
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Gathering-and-saving-object-info">Gathering and saving object info<a class="anchor-link" href="#Gathering-and-saving-object-info"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="test_gather_and_save_info" class="doc_header"><code>test_gather_and_save_info</code><a href="https://github.com/Jaume-JCI/ds-blocks/tree/main/dsblocks/tests/core/test_compose.py#L716" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>test_gather_and_save_info</code>()</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">test_gather_and_save_info</span> <span class="p">():</span>
    <span class="kn">from</span> <span class="nn">dsblocks.utils.dummies</span> <span class="kn">import</span> <span class="n">Intermediate</span><span class="p">,</span> <span class="n">Higher</span>
    <span class="n">higher</span> <span class="o">=</span> <span class="n">Higher</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">z</span><span class="o">=</span><span class="mi">60</span><span class="p">)</span>

    <span class="n">path_results</span> <span class="o">=</span> <span class="s1">&#39;test_gather_and_save_info&#39;</span>
    <span class="n">path_session</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">path_results</span><span class="si">}</span><span class="s1">_session&#39;</span>
    <span class="n">remove_previous_results</span> <span class="p">(</span><span class="n">path_results</span><span class="p">)</span>
    <span class="n">remove_previous_results</span> <span class="p">(</span><span class="n">path_session</span><span class="p">)</span>
    <span class="k">with</span> <span class="n">pytest</span><span class="o">.</span><span class="n">raises</span> <span class="p">(</span><span class="ne">FileNotFoundError</span><span class="p">):</span>
        <span class="n">os</span><span class="o">.</span><span class="n">listdir</span> <span class="p">(</span><span class="n">path_session</span><span class="p">)</span>

    <span class="n">higher</span><span class="o">.</span><span class="n">gather_and_save_info</span> <span class="p">(</span><span class="n">path_session</span><span class="o">=</span><span class="n">path_session</span><span class="p">)</span>

    <span class="k">assert</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span> <span class="p">(</span><span class="n">path_session</span><span class="p">)</span><span class="o">==</span><span class="p">[</span><span class="s1">&#39;last_run&#39;</span><span class="p">]</span>
    <span class="k">assert</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span> <span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">path_session</span><span class="si">}</span><span class="s1">/last_run&#39;</span><span class="p">)</span><span class="o">==</span><span class="p">[</span><span class="s1">&#39;pipeline.pk&#39;</span><span class="p">]</span>

    <span class="n">pipe</span> <span class="o">=</span> <span class="n">joblib</span><span class="o">.</span><span class="n">load</span> <span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">path_session</span><span class="si">}</span><span class="s1">/last_run/pipeline.pk&#39;</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">pipe</span><span class="o">.</span><span class="n">x</span><span class="o">==</span><span class="mi">20</span>
    <span class="k">assert</span> <span class="n">pipe</span><span class="o">.</span><span class="n">first</span><span class="o">.</span><span class="n">z</span><span class="o">==</span><span class="mi">60</span>
    <span class="k">assert</span> <span class="n">pipe</span><span class="o">.</span><span class="n">first</span><span class="o">.</span><span class="n">x</span><span class="o">==</span><span class="mi">3</span>

    <span class="k">with</span> <span class="n">pytest</span><span class="o">.</span><span class="n">raises</span> <span class="p">(</span><span class="ne">FileNotFoundError</span><span class="p">):</span>
        <span class="n">os</span><span class="o">.</span><span class="n">listdir</span> <span class="p">(</span><span class="n">path_results</span><span class="p">)</span>

    <span class="n">remove_previous_results</span> <span class="p">(</span><span class="n">path_session</span><span class="p">)</span>
    <span class="n">higher</span> <span class="o">=</span> <span class="n">Higher</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">z</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span> <span class="n">path_results</span><span class="o">=</span><span class="n">path_results</span><span class="p">)</span>

    <span class="n">path_results</span> <span class="o">=</span> <span class="s1">&#39;test_gather_and_save_info&#39;</span>
    <span class="n">path_session</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">path_results</span><span class="si">}</span><span class="s1">_session&#39;</span>

    <span class="k">with</span> <span class="n">pytest</span><span class="o">.</span><span class="n">raises</span> <span class="p">(</span><span class="ne">FileNotFoundError</span><span class="p">):</span>
        <span class="n">os</span><span class="o">.</span><span class="n">listdir</span> <span class="p">(</span><span class="n">path_session</span><span class="p">)</span>

    <span class="n">higher</span><span class="o">.</span><span class="n">gather_and_save_info</span> <span class="p">(</span><span class="n">path_session</span><span class="o">=</span><span class="n">path_session</span><span class="p">)</span>

    <span class="k">assert</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span> <span class="p">(</span><span class="n">path_session</span><span class="p">)</span><span class="o">==</span><span class="p">[</span><span class="s1">&#39;last_run&#39;</span><span class="p">]</span>
    <span class="k">assert</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span> <span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">path_session</span><span class="si">}</span><span class="s1">/last_run&#39;</span><span class="p">)</span><span class="o">==</span><span class="p">[</span><span class="s1">&#39;pipeline.pk&#39;</span><span class="p">]</span>
    <span class="n">pipe</span> <span class="o">=</span> <span class="n">joblib</span><span class="o">.</span><span class="n">load</span> <span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">path_session</span><span class="si">}</span><span class="s1">/last_run/pipeline.pk&#39;</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">pipe</span><span class="o">.</span><span class="n">x</span><span class="o">==</span><span class="mi">20</span>
    <span class="k">assert</span> <span class="n">pipe</span><span class="o">.</span><span class="n">first</span><span class="o">.</span><span class="n">z</span><span class="o">==</span><span class="mi">60</span>
    <span class="k">assert</span> <span class="n">pipe</span><span class="o">.</span><span class="n">first</span><span class="o">.</span><span class="n">x</span><span class="o">==</span><span class="mi">3</span>

    <span class="k">assert</span> <span class="s1">&#39;pipeline.pk&#39;</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span> <span class="p">(</span><span class="n">path_results</span><span class="p">)</span>
    <span class="n">pipe</span> <span class="o">=</span> <span class="n">joblib</span><span class="o">.</span><span class="n">load</span> <span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">path_results</span><span class="si">}</span><span class="s1">/pipeline.pk&#39;</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">pipe</span><span class="o">.</span><span class="n">x</span><span class="o">==</span><span class="mi">20</span>
    <span class="k">assert</span> <span class="n">pipe</span><span class="o">.</span><span class="n">first</span><span class="o">.</span><span class="n">z</span><span class="o">==</span><span class="mi">60</span>
    <span class="k">assert</span> <span class="n">pipe</span><span class="o">.</span><span class="n">first</span><span class="o">.</span><span class="n">x</span><span class="o">==</span><span class="mi">3</span>
    
    <span class="n">remove_previous_results</span> <span class="p">(</span><span class="n">path_results</span><span class="p">)</span>
    <span class="n">remove_previous_results</span> <span class="p">(</span><span class="n">path_session</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">tst</span><span class="o">.</span><span class="n">run</span> <span class="p">(</span><span class="n">test_gather_and_save_info</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="s1">&#39;dummy&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>running test_gather_and_save_info
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Passing-parameters-specific-of-hierarchy-level">Passing parameters specific of hierarchy level<a class="anchor-link" href="#Passing-parameters-specific-of-hierarchy-level"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="test_multi_comp_hierarchy" class="doc_header"><code>test_multi_comp_hierarchy</code><a href="https://github.com/Jaume-JCI/ds-blocks/tree/main/dsblocks/tests/core/test_compose.py#L769" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>test_multi_comp_hierarchy</code>()</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1">#@pytest.mark.reference_fails</span>
<span class="k">def</span> <span class="nf">test_multi_comp_hierarchy</span> <span class="p">():</span>
    <span class="kn">from</span> <span class="nn">dsblocks.utils.dummies</span> <span class="kn">import</span> <span class="n">Intermediate</span><span class="p">,</span> <span class="n">Higher</span>
    
    <span class="n">higher</span> <span class="o">=</span> <span class="n">Higher</span><span class="p">()</span>

    <span class="n">levels</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
        <span class="n">until</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">verbose</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">)</span>
    <span class="n">higher</span> <span class="o">=</span> <span class="n">Higher</span> <span class="p">(</span><span class="n">levels</span><span class="o">=</span><span class="n">levels</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

    <span class="k">assert</span> <span class="n">higher</span><span class="o">.</span><span class="n">hierarchy_level</span><span class="o">==</span><span class="mi">0</span> <span class="ow">and</span> <span class="n">higher</span><span class="o">.</span><span class="n">first</span><span class="o">.</span><span class="n">hierarchy_level</span><span class="o">==</span><span class="mi">1</span> <span class="ow">and</span> <span class="n">higher</span><span class="o">.</span><span class="n">first</span><span class="o">.</span><span class="n">first</span><span class="o">.</span><span class="n">hierarchy_level</span><span class="o">==</span><span class="mi">2</span>

    <span class="k">assert</span> <span class="n">higher</span><span class="o">.</span><span class="n">verbose</span><span class="o">==</span><span class="mi">1</span> <span class="ow">and</span> <span class="n">higher</span><span class="o">.</span><span class="n">first</span><span class="o">.</span><span class="n">verbose</span><span class="o">==</span><span class="mi">1</span> <span class="ow">and</span> <span class="n">higher</span><span class="o">.</span><span class="n">first</span><span class="o">.</span><span class="n">first</span><span class="o">.</span><span class="n">verbose</span><span class="o">==</span><span class="mi">0</span>

    <span class="n">levels</span><span class="p">[</span><span class="s1">&#39;until&#39;</span><span class="p">]</span><span class="o">=</span><span class="mi">0</span>
    <span class="n">higher</span> <span class="o">=</span> <span class="n">Higher</span> <span class="p">(</span><span class="n">levels</span><span class="o">=</span><span class="n">levels</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">higher</span><span class="o">.</span><span class="n">verbose</span><span class="o">==</span><span class="mi">1</span> <span class="ow">and</span> <span class="n">higher</span><span class="o">.</span><span class="n">first</span><span class="o">.</span><span class="n">verbose</span><span class="o">==</span><span class="mi">0</span> <span class="ow">and</span> <span class="n">higher</span><span class="o">.</span><span class="n">first</span><span class="o">.</span><span class="n">first</span><span class="o">.</span><span class="n">verbose</span><span class="o">==</span><span class="mi">0</span>

    <span class="n">levels</span><span class="p">[</span><span class="s1">&#39;until&#39;</span><span class="p">]</span><span class="o">=</span><span class="mi">2</span>
    <span class="n">higher</span> <span class="o">=</span> <span class="n">Higher</span> <span class="p">(</span><span class="n">levels</span><span class="o">=</span><span class="n">levels</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">higher</span><span class="o">.</span><span class="n">verbose</span><span class="o">==</span><span class="mi">1</span> <span class="ow">and</span> <span class="n">higher</span><span class="o">.</span><span class="n">first</span><span class="o">.</span><span class="n">verbose</span><span class="o">==</span><span class="mi">1</span> <span class="ow">and</span> <span class="n">higher</span><span class="o">.</span><span class="n">first</span><span class="o">.</span><span class="n">first</span><span class="o">.</span><span class="n">verbose</span><span class="o">==</span><span class="mi">1</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">tst</span><span class="o">.</span><span class="n">run</span> <span class="p">(</span><span class="n">test_multi_comp_hierarchy</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="s1">&#39;dummy&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>running test_multi_comp_hierarchy
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Profiling">Profiling<a class="anchor-link" href="#Profiling"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="test_multi_comp_profiling" class="doc_header"><code>test_multi_comp_profiling</code><a href="https://github.com/Jaume-JCI/ds-blocks/tree/main/dsblocks/tests/core/test_compose.py#L793" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>test_multi_comp_profiling</code>()</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">test_multi_comp_profiling</span> <span class="p">():</span>
    <span class="k">class</span> <span class="nc">A</span><span class="p">(</span><span class="n">Component</span><span class="p">):</span>
        <span class="k">def</span> <span class="fm">__init__</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">time</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
            <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">_fit</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="o">*</span><span class="mi">2</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">_apply</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">):</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="p">)</span>
            <span class="k">return</span> <span class="mi">1</span>

    <span class="k">class</span> <span class="nc">Intermediate</span> <span class="p">(</span><span class="n">MultiComponent</span><span class="p">):</span>
        <span class="k">def</span> <span class="fm">__init__</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
            <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span> <span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">first</span> <span class="o">=</span> <span class="n">A</span> <span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s1">_first_component&#39;</span><span class="p">,</span> <span class="n">time</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">second</span> <span class="o">=</span> <span class="n">A</span> <span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s1">_second_component&#39;</span><span class="p">,</span> <span class="n">time</span><span class="o">=</span><span class="mf">0.03</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">def</span> <span class="nf">_fit</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">first</span><span class="o">.</span><span class="n">fit</span> <span class="p">(</span><span class="n">X</span><span class="p">,</span><span class="n">y</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">second</span><span class="o">.</span><span class="n">fit</span> <span class="p">(</span><span class="n">X</span><span class="p">,</span><span class="n">y</span><span class="p">)</span>
        <span class="k">def</span> <span class="nf">_apply</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">):</span>
            <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">first</span><span class="o">.</span><span class="n">apply</span> <span class="p">(</span><span class="n">X</span><span class="p">)</span>
            <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">second</span><span class="o">.</span><span class="n">apply</span> <span class="p">(</span><span class="n">X</span><span class="p">)</span>
            <span class="k">return</span> <span class="mi">1</span>

    <span class="k">class</span> <span class="nc">Higher</span> <span class="p">(</span><span class="n">MultiComponent</span><span class="p">):</span>
        <span class="k">def</span> <span class="fm">__init__</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
            <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span> <span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">first</span> <span class="o">=</span> <span class="n">Intermediate</span> <span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;first&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">second</span> <span class="o">=</span> <span class="n">Intermediate</span> <span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;second&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">def</span> <span class="nf">_fit</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">first</span><span class="o">.</span><span class="n">fit</span> <span class="p">(</span><span class="n">X</span><span class="p">,</span><span class="n">y</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">second</span><span class="o">.</span><span class="n">fit</span> <span class="p">(</span><span class="n">X</span><span class="p">,</span><span class="n">y</span><span class="p">)</span>
        <span class="k">def</span> <span class="nf">_apply</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">):</span>
            <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">first</span><span class="o">.</span><span class="n">apply</span> <span class="p">(</span><span class="n">X</span><span class="p">)</span>
            <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">second</span><span class="o">.</span><span class="n">apply</span> <span class="p">(</span><span class="n">X</span><span class="p">)</span>
            <span class="k">return</span> <span class="mi">1</span>

    <span class="n">higher</span> <span class="o">=</span> <span class="n">Higher</span><span class="p">()</span>
    <span class="n">higher</span><span class="o">.</span><span class="n">fit</span> <span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">_</span> <span class="o">=</span> <span class="n">higher</span><span class="o">.</span><span class="n">apply</span> <span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">dfd</span> <span class="o">=</span> <span class="n">higher</span><span class="o">.</span><span class="n">gather_times</span><span class="p">()</span>

    <span class="n">values</span> <span class="o">=</span> <span class="n">dfd</span><span class="o">.</span><span class="n">avg</span><span class="p">[(</span><span class="s1">&#39;whole&#39;</span><span class="p">,</span><span class="s1">&#39;apply&#39;</span><span class="p">)]</span><span class="o">.</span><span class="n">values</span>
    <span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">-</span> <span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">&lt;</span> <span class="mf">0.1</span>
    <span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="mi">3</span><span class="p">:</span><span class="mi">5</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">-</span> <span class="n">values</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">&lt;</span> <span class="mf">0.1</span>
    <span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="mi">5</span><span class="p">:</span><span class="mi">7</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">-</span> <span class="n">values</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span> <span class="o">&lt;</span> <span class="mf">0.1</span>

    <span class="n">values</span> <span class="o">=</span> <span class="n">dfd</span><span class="o">.</span><span class="n">avg</span><span class="p">[(</span><span class="s1">&#39;whole&#39;</span><span class="p">,</span><span class="s1">&#39;fit&#39;</span><span class="p">)]</span><span class="o">.</span><span class="n">values</span>
    <span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">-</span> <span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">&lt;</span> <span class="mf">0.1</span>
    <span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="mi">3</span><span class="p">:</span><span class="mi">5</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">-</span> <span class="n">values</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">&lt;</span> <span class="mf">0.1</span>
    <span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="mi">5</span><span class="p">:</span><span class="mi">7</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">-</span> <span class="n">values</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span> <span class="o">&lt;</span> <span class="mf">0.1</span>

    <span class="n">display</span><span class="p">(</span><span class="s1">&#39;avg&#39;</span><span class="p">,</span> <span class="n">dfd</span><span class="o">.</span><span class="n">avg</span><span class="p">)</span>

    <span class="k">assert</span> <span class="p">(</span><span class="n">dfd</span><span class="o">.</span><span class="n">novh_avg</span> <span class="o">&lt;=</span> <span class="n">dfd</span><span class="o">.</span><span class="n">avg</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
    <span class="k">assert</span> <span class="p">(</span><span class="n">dfd</span><span class="o">.</span><span class="n">novh_avg</span> <span class="o">&lt;</span> <span class="n">dfd</span><span class="o">.</span><span class="n">avg</span><span class="p">)</span><span class="o">.</span><span class="n">any</span><span class="p">()</span><span class="o">.</span><span class="n">any</span><span class="p">()</span>

    <span class="k">assert</span> <span class="p">((</span><span class="n">dfd</span><span class="o">.</span><span class="n">novh_avg</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="o">-</span><span class="mi">4</span><span class="p">:]</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">to_frame</span><span class="p">()</span><span class="o">.</span><span class="n">T</span><span class="p">)</span> <span class="o">==</span> <span class="n">dfd</span><span class="o">.</span><span class="n">no_overhead_total</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>

    <span class="k">assert</span> <span class="p">((</span><span class="n">dfd</span><span class="o">.</span><span class="n">avg</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">dfd</span><span class="o">.</span><span class="n">novh_avg</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="o">-</span><span class="mi">4</span><span class="p">:]</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span><span class="o">.</span><span class="n">values</span> <span class="o">==</span> <span class="n">dfd</span><span class="o">.</span><span class="n">overhead_total</span><span class="o">.</span><span class="n">values</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>

    <span class="n">display</span><span class="p">(</span><span class="s1">&#39;no_overhead_total&#39;</span><span class="p">,</span> <span class="n">dfd</span><span class="o">.</span><span class="n">no_overhead_total</span><span class="p">)</span>
    <span class="n">display</span><span class="p">(</span><span class="s1">&#39;overhead_total&#39;</span><span class="p">,</span> <span class="n">dfd</span><span class="o">.</span><span class="n">overhead_total</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">tst</span><span class="o">.</span><span class="n">run</span> <span class="p">(</span><span class="n">test_multi_comp_profiling</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="s1">&#39;dummy&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>running test_multi_comp_profiling
</pre>
</div>
</div>

<div class="output_area">



<div class="output_text output_subarea ">
<pre>&#39;avg&#39;</pre>
</div>

</div>

<div class="output_area">


<div class="output_html rendered_html output_subarea "><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead tr th {
        text-align: left;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr>
      <th></th>
      <th></th>
      <th colspan="2" halign="left">whole</th>
      <th>leaf</th>
    </tr>
    <tr>
      <th></th>
      <th></th>
      <th>fit</th>
      <th>apply</th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <th>higher</th>
      <td>0.214606</td>
      <td>0.110269</td>
      <td>False</td>
    </tr>
    <tr>
      <th rowspan="2" valign="top">1</th>
      <th>first</th>
      <td>0.100974</td>
      <td>0.051814</td>
      <td>False</td>
    </tr>
    <tr>
      <th>second</th>
      <td>0.101388</td>
      <td>0.051393</td>
      <td>False</td>
    </tr>
    <tr>
      <th rowspan="4" valign="top">2</th>
      <th>first_first_component</th>
      <td>0.024412</td>
      <td>0.012448</td>
      <td>True</td>
    </tr>
    <tr>
      <th>first_second_component</th>
      <td>0.064191</td>
      <td>0.032388</td>
      <td>True</td>
    </tr>
    <tr>
      <th>second_first_component</th>
      <td>0.024061</td>
      <td>0.012362</td>
      <td>True</td>
    </tr>
    <tr>
      <th>second_second_component</th>
      <td>0.065051</td>
      <td>0.032335</td>
      <td>True</td>
    </tr>
  </tbody>
</table>
</div></div>

</div>

<div class="output_area">



<div class="output_text output_subarea ">
<pre>&#39;no_overhead_total&#39;</pre>
</div>

</div>

<div class="output_area">


<div class="output_html rendered_html output_subarea "><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead tr th {
        text-align: left;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr>
      <th></th>
      <th colspan="2" halign="left">whole</th>
      <th>leaf</th>
    </tr>
    <tr>
      <th></th>
      <th>fit</th>
      <th>apply</th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0.160327</td>
      <td>0.0803</td>
      <td>4.0</td>
    </tr>
  </tbody>
</table>
</div></div>

</div>

<div class="output_area">



<div class="output_text output_subarea ">
<pre>&#39;overhead_total&#39;</pre>
</div>

</div>

<div class="output_area">


<div class="output_html rendered_html output_subarea "><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead tr th {
        text-align: left;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr>
      <th></th>
      <th></th>
      <th colspan="2" halign="left">whole</th>
      <th>leaf</th>
    </tr>
    <tr>
      <th></th>
      <th></th>
      <th>fit</th>
      <th>apply</th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <th>higher</th>
      <td>0.054279</td>
      <td>0.029968</td>
      <td>-4.0</td>
    </tr>
  </tbody>
</table>
</div></div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="assert_all_equal">assert_all_equal<a class="anchor-link" href="#assert_all_equal"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="test_multi_comp_all_equal" class="doc_header"><code>test_multi_comp_all_equal</code><a href="https://github.com/Jaume-JCI/ds-blocks/tree/main/dsblocks/tests/core/test_compose.py#L860" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>test_multi_comp_all_equal</code>()</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1">#@pytest.mark.reference_fails</span>
<span class="k">def</span> <span class="nf">test_multi_comp_all_equal</span> <span class="p">():</span>
    <span class="n">path_results</span> <span class="o">=</span> <span class="s1">&#39;multi_component_assert_equal&#39;</span>
    <span class="n">remove_previous_results</span> <span class="p">(</span><span class="n">path_results</span><span class="o">=</span><span class="n">path_results</span><span class="p">)</span>

    <span class="c1"># 1. by setting components as attributes:</span>
    <span class="k">class</span> <span class="nc">NewComposition</span><span class="p">(</span><span class="n">MultiComponent</span><span class="p">):</span>

        <span class="k">def</span> <span class="fm">__init__</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">noise</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
            <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">tr1</span> <span class="o">=</span> <span class="n">Component</span><span class="p">(</span><span class="n">FunctionTransformer</span> <span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">*</span><span class="mi">3</span> <span class="o">+</span> <span class="n">noise</span><span class="p">),</span>
                                 <span class="n">name</span><span class="o">=</span><span class="s1">&#39;tr1&#39;</span><span class="p">,</span>
                                 <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tr2</span> <span class="o">=</span> <span class="n">Component</span><span class="p">(</span><span class="n">FunctionTransformer</span> <span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">*</span><span class="mi">2</span><span class="p">),</span>
                                 <span class="n">name</span><span class="o">=</span><span class="s1">&#39;tr2&#39;</span><span class="p">,</span>
                                 <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">_apply</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">tr1</span> <span class="p">(</span><span class="n">X</span><span class="p">)</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">tr2</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>

    <span class="n">X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">])</span>

    <span class="n">composition1</span> <span class="o">=</span> <span class="n">NewComposition</span> <span class="p">(</span><span class="n">path_results</span><span class="o">=</span><span class="n">path_results</span><span class="p">)</span>
    <span class="n">result1</span> <span class="o">=</span> <span class="n">composition1</span> <span class="p">(</span><span class="n">X</span><span class="p">)</span>

    <span class="n">path_results2</span> <span class="o">=</span> <span class="s1">&#39;multi_component_assert_equal_2&#39;</span>
    <span class="n">remove_previous_results</span> <span class="p">(</span><span class="n">path_results</span><span class="o">=</span><span class="n">path_results2</span><span class="p">)</span>
    <span class="n">composition2</span> <span class="o">=</span> <span class="n">NewComposition</span> <span class="p">(</span><span class="n">path_results</span><span class="o">=</span><span class="n">path_results2</span><span class="p">)</span>
    <span class="n">result2</span> <span class="o">=</span> <span class="n">composition2</span> <span class="p">(</span><span class="n">X</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">composition1</span><span class="o">.</span><span class="n">assert_all_equal</span> <span class="p">(</span><span class="n">path_results2</span><span class="p">)</span>

    <span class="n">remove_previous_results</span> <span class="p">(</span><span class="n">path_results</span><span class="o">=</span><span class="n">path_results2</span><span class="p">)</span>
    <span class="n">composition2</span> <span class="o">=</span> <span class="n">NewComposition</span> <span class="p">(</span><span class="n">path_results</span><span class="o">=</span><span class="n">path_results2</span><span class="p">,</span> <span class="n">noise</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
    <span class="n">result2</span> <span class="o">=</span> <span class="n">composition2</span> <span class="p">(</span><span class="n">X</span><span class="p">)</span>
    <span class="k">assert</span> <span class="ow">not</span> <span class="n">composition1</span><span class="o">.</span><span class="n">assert_all_equal</span> <span class="p">(</span><span class="n">path_results2</span><span class="p">)</span>

    <span class="c1"># *************************</span>
    <span class="c1"># check verbosity</span>
    <span class="c1"># *************************</span>
    <span class="n">composition1</span> <span class="o">=</span> <span class="n">NewComposition</span> <span class="p">(</span><span class="n">path_results</span><span class="o">=</span><span class="n">path_results</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">composition1</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span> <span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">******************************&#39;</span><span class="p">)</span>
    <span class="n">composition1</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span> <span class="p">(</span><span class="s1">&#39;verbose&#39;</span><span class="p">)</span>
    <span class="n">composition1</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span> <span class="p">(</span><span class="s1">&#39;******************************&#39;</span><span class="p">)</span>
    <span class="k">assert</span> <span class="ow">not</span> <span class="n">composition1</span><span class="o">.</span><span class="n">assert_all_equal</span> <span class="p">(</span><span class="n">path_results2</span><span class="p">)</span>

    <span class="n">composition1</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span> <span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">******************************&#39;</span><span class="p">)</span>
    <span class="n">composition1</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span> <span class="p">(</span><span class="s1">&#39;not verbose&#39;</span><span class="p">)</span>
    <span class="n">composition1</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span> <span class="p">(</span><span class="s1">&#39;******************************&#39;</span><span class="p">)</span>
    <span class="k">assert</span> <span class="ow">not</span> <span class="n">composition1</span><span class="o">.</span><span class="n">assert_all_equal</span> <span class="p">(</span><span class="n">path_results2</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">composition1</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span> <span class="p">(</span><span class="s1">&#39;logger works again&#39;</span><span class="p">)</span>
    
    <span class="c1"># *******************************</span>
    <span class="c1"># check recursion</span>
    <span class="c1"># *******************************</span>
    <span class="k">class</span> <span class="nc">NewComposition</span> <span class="p">(</span><span class="n">MultiComponent</span><span class="p">):</span>

        <span class="k">def</span> <span class="fm">__init__</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">noise</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
            <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">tr1</span> <span class="o">=</span> <span class="n">Component</span><span class="p">(</span><span class="n">FunctionTransformer</span> <span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">*</span><span class="mi">2</span> <span class="o">+</span> <span class="n">noise</span><span class="p">),</span>
                                 <span class="n">name</span><span class="o">=</span><span class="s1">&#39;tr1&#39;</span><span class="p">,</span>
                                 <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tr2</span> <span class="o">=</span> <span class="n">Component</span><span class="p">(</span><span class="n">FunctionTransformer</span> <span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">*</span><span class="mi">3</span><span class="p">),</span>
                                 <span class="n">name</span><span class="o">=</span><span class="s1">&#39;tr2&#39;</span><span class="p">,</span>
                                 <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">_apply</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">tr1</span> <span class="p">(</span><span class="n">X</span><span class="p">)</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">tr2</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
        
    <span class="n">path_results3</span> <span class="o">=</span> <span class="s1">&#39;multi_component_assert_equal_3&#39;</span>
    <span class="n">composition3</span> <span class="o">=</span> <span class="n">NewComposition</span> <span class="p">(</span><span class="n">path_results</span><span class="o">=</span><span class="n">path_results3</span><span class="p">)</span>
    <span class="n">result3</span> <span class="o">=</span> <span class="n">composition3</span> <span class="p">(</span><span class="n">X</span><span class="p">)</span>
    <span class="k">assert</span> <span class="ow">not</span> <span class="n">composition3</span><span class="o">.</span><span class="n">assert_all_equal</span> <span class="p">(</span><span class="n">path_results</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">composition3</span><span class="o">.</span><span class="n">assert_all_equal</span> <span class="p">(</span><span class="n">path_results</span><span class="p">,</span> <span class="n">max_recursion</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="k">assert</span> <span class="ow">not</span> <span class="n">composition3</span><span class="o">.</span><span class="n">assert_all_equal</span> <span class="p">(</span><span class="n">path_results</span><span class="p">,</span> <span class="n">max_recursion</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    
    <span class="k">class</span> <span class="nc">NewComposition</span> <span class="p">(</span><span class="n">MultiComponent</span><span class="p">):</span>

        <span class="k">def</span> <span class="fm">__init__</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">noise</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
            <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">tr1</span> <span class="o">=</span> <span class="n">Component</span><span class="p">(</span><span class="n">FunctionTransformer</span> <span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">*</span><span class="mi">4</span> <span class="o">+</span> <span class="n">noise</span><span class="p">),</span>
                                 <span class="n">name</span><span class="o">=</span><span class="s1">&#39;tr1&#39;</span><span class="p">,</span>
                                 <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tr2</span> <span class="o">=</span> <span class="n">Component</span><span class="p">(</span><span class="n">FunctionTransformer</span> <span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">*</span><span class="mi">5</span><span class="p">),</span>
                                 <span class="n">name</span><span class="o">=</span><span class="s1">&#39;tr2&#39;</span><span class="p">,</span>
                                 <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">_apply</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">tr1</span> <span class="p">(</span><span class="n">X</span><span class="p">)</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">tr2</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
        
    <span class="n">remove_previous_results</span> <span class="p">(</span><span class="n">path_results</span><span class="o">=</span><span class="n">path_results3</span><span class="p">)</span>
    <span class="n">composition4</span> <span class="o">=</span> <span class="n">NewComposition</span> <span class="p">(</span><span class="n">path_results</span><span class="o">=</span><span class="n">path_results3</span><span class="p">)</span>
    <span class="n">result3</span> <span class="o">=</span> <span class="n">composition4</span> <span class="p">(</span><span class="n">X</span><span class="p">)</span>
    <span class="k">assert</span> <span class="ow">not</span> <span class="n">composition4</span><span class="o">.</span><span class="n">assert_all_equal</span> <span class="p">(</span><span class="n">path_results</span><span class="p">)</span>
    <span class="k">assert</span> <span class="ow">not</span> <span class="n">composition4</span><span class="o">.</span><span class="n">assert_all_equal</span> <span class="p">(</span><span class="n">path_results</span><span class="p">,</span> <span class="n">max_recursion</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="k">assert</span> <span class="ow">not</span> <span class="n">composition4</span><span class="o">.</span><span class="n">assert_all_equal</span> <span class="p">(</span><span class="n">path_results</span><span class="p">,</span> <span class="n">max_recursion</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        
    <span class="c1"># *************************</span>
    <span class="c1"># remove results</span>
    <span class="c1"># *************************</span>
    <span class="n">remove_previous_results</span> <span class="p">(</span><span class="n">path_results</span><span class="o">=</span><span class="n">path_results</span><span class="p">)</span>
    <span class="n">remove_previous_results</span> <span class="p">(</span><span class="n">path_results</span><span class="o">=</span><span class="n">path_results2</span><span class="p">)</span>
    <span class="n">remove_previous_results</span> <span class="p">(</span><span class="n">path_results</span><span class="o">=</span><span class="n">path_results3</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">tst</span><span class="o">.</span><span class="n">run</span> <span class="p">(</span><span class="n">test_multi_comp_all_equal</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="s1">&#39;dummy&#39;</span><span class="p">,</span> <span class="n">debug</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>running test_multi_comp_all_equal
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>Component tr1 =&gt; results are different: 
Not equal to tolerance rtol=1e-07, atol=0

Mismatched elements: 3 / 3 (100%)
Max absolute difference: 0.1
Max relative difference: 0.03225806
 x: array([3, 6, 9])
 y: array([3.1, 6.1, 9.1])
Results are different in components [&#39;tr1&#39;]

******************************
verbose
******************************
comparing results for tr1
loading our results...
loading from /home/jcidatascience/jaume/workspace/remote/block-types/multi_component_assert_equal/whole/tr1_result.pk
loading from /home/jcidatascience/jaume/workspace/remote/block-types/multi_component_assert_equal_2/whole/tr1_result.pk
Component tr1 =&gt; results are different: 
Not equal to tolerance rtol=1e-07, atol=0

Mismatched elements: 3 / 3 (100%)
Max absolute difference: 0.1
Max relative difference: 0.03225806
 x: array([3, 6, 9])
 y: array([3.1, 6.1, 9.1])
comparing results for tr2
loading our results...
loading from /home/jcidatascience/jaume/workspace/remote/block-types/multi_component_assert_equal/whole/tr2_result.pk
loading from /home/jcidatascience/jaume/workspace/remote/block-types/multi_component_assert_equal_2/whole/tr2_result.pk
Results are equal.

Results are different in components [&#39;tr1&#39;]

******************************
not verbose
******************************
Component tr1 =&gt; results are different: 
Not equal to tolerance rtol=1e-07, atol=0

Mismatched elements: 3 / 3 (100%)
Max absolute difference: 0.1
Max relative difference: 0.03225806
 x: array([3, 6, 9])
 y: array([3.1, 6.1, 9.1])
Results are different in components [&#39;tr1&#39;]
logger works again
Component tr1 =&gt; results are different: 
Not equal to tolerance rtol=1e-07, atol=0

Mismatched elements: 3 / 3 (100%)
Max absolute difference: 3
Max relative difference: 0.33333333
 x: array([2, 4, 6])
 y: array([3, 6, 9])
Component tr2 =&gt; results are different: 
Not equal to tolerance rtol=1e-07, atol=0

Mismatched elements: 3 / 3 (100%)
Max absolute difference: 3
Max relative difference: 0.5
 x: array([3, 6, 9])
 y: array([2, 4, 6])
Results are different in components [&#39;tr1&#39;, &#39;tr2&#39;]
Component tr1 =&gt; results are different: 
Not equal to tolerance rtol=1e-07, atol=0

Mismatched elements: 3 / 3 (100%)
Max absolute difference: 3
Max relative difference: 0.33333333
 x: array([2, 4, 6])
 y: array([3, 6, 9])
Component tr2 =&gt; results are different: 
Not equal to tolerance rtol=1e-07, atol=0

Mismatched elements: 3 / 3 (100%)
Max absolute difference: 3
Max relative difference: 0.5
 x: array([3, 6, 9])
 y: array([2, 4, 6])
Results are different in components [&#39;tr1&#39;, &#39;tr2&#39;]
Component tr1 =&gt; results are different: 
Not equal to tolerance rtol=1e-07, atol=0

Mismatched elements: 3 / 3 (100%)
Max absolute difference: 3
Max relative difference: 0.33333333
 x: array([ 4,  8, 12])
 y: array([3, 6, 9])
Component tr2 =&gt; results are different: 
Not equal to tolerance rtol=1e-07, atol=0

Mismatched elements: 3 / 3 (100%)
Max absolute difference: 9
Max relative difference: 1.5
 x: array([ 5, 10, 15])
 y: array([2, 4, 6])
Results are different in components [&#39;tr1&#39;, &#39;tr2&#39;]
Component new_composition =&gt; results are different: 
Not equal to tolerance rtol=1e-07, atol=0

Mismatched elements: 3 / 3 (100%)
Max absolute difference: 12
Max relative difference: 0.8
 x: array([ 9, 18, 27])
 y: array([ 5, 10, 15])
Results are different in components [&#39;new_composition&#39;]
Component tr1 =&gt; results are different: 
Not equal to tolerance rtol=1e-07, atol=0

Mismatched elements: 3 / 3 (100%)
Max absolute difference: 3
Max relative difference: 0.33333333
 x: array([ 4,  8, 12])
 y: array([3, 6, 9])
Component tr2 =&gt; results are different: 
Not equal to tolerance rtol=1e-07, atol=0

Mismatched elements: 3 / 3 (100%)
Max absolute difference: 9
Max relative difference: 1.5
 x: array([ 5, 10, 15])
 y: array([2, 4, 6])
Results are different in components [&#39;tr1&#39;, &#39;tr2&#39;]
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="setters">setters<a class="anchor-link" href="#setters"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="test_multi_component_setters" class="doc_header"><code>test_multi_component_setters</code><a href="https://github.com/Jaume-JCI/ds-blocks/tree/main/dsblocks/tests/core/test_compose.py#L967" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>test_multi_component_setters</code>()</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1">#@pytest.mark.reference_fails</span>
<span class="k">def</span> <span class="nf">test_multi_component_setters</span> <span class="p">():</span>
    <span class="n">multi_component</span> <span class="o">=</span> <span class="n">SimpleMultiComponent</span> <span class="p">()</span>

    <span class="n">all_true</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">all</span><span class="p">([</span><span class="n">x</span><span class="o">.</span><span class="n">data_io</span><span class="o">.</span><span class="n">save_splits</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">x</span><span class="o">.</span><span class="n">data_io</span><span class="o">.</span><span class="n">save_splits</span><span class="p">])</span>
    <span class="k">assert</span> <span class="n">all_true</span> <span class="p">(</span><span class="n">multi_component</span><span class="p">)</span>

    <span class="n">c0</span><span class="p">,</span> <span class="n">c1</span> <span class="o">=</span> <span class="n">multi_component</span><span class="o">.</span><span class="n">components</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">multi_component</span><span class="o">.</span><span class="n">components</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

    <span class="k">assert</span> <span class="n">all_true</span> <span class="p">(</span><span class="n">c0</span><span class="p">)</span> <span class="ow">and</span> <span class="n">all_true</span> <span class="p">(</span><span class="n">c1</span><span class="p">)</span>

    <span class="n">multi_component</span><span class="o">.</span><span class="n">set_save_splits</span> <span class="p">({</span><span class="s1">&#39;training&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span> <span class="s1">&#39;test&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span> <span class="s1">&#39;validation&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span> <span class="s1">&#39;whole&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">})</span>

    <span class="n">tv_false</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="p">(</span><span class="nb">all</span> <span class="p">([</span><span class="n">x</span><span class="o">.</span><span class="n">data_io</span><span class="o">.</span><span class="n">save_splits</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;training&#39;</span><span class="p">,</span> <span class="s1">&#39;whole&#39;</span><span class="p">]])</span>
                          <span class="ow">and</span> <span class="nb">all</span> <span class="p">([(</span><span class="ow">not</span> <span class="n">x</span><span class="o">.</span><span class="n">data_io</span><span class="o">.</span><span class="n">save_splits</span><span class="p">[</span><span class="n">k</span><span class="p">])</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;test&#39;</span><span class="p">,</span> <span class="s1">&#39;validation&#39;</span><span class="p">]]))</span>
    <span class="k">assert</span> <span class="n">tv_false</span><span class="p">(</span><span class="n">c0</span><span class="p">)</span> <span class="ow">and</span> <span class="n">tv_false</span> <span class="p">(</span><span class="n">c1</span><span class="p">)</span> <span class="ow">and</span> <span class="n">tv_false</span> <span class="p">(</span><span class="n">multi_component</span><span class="p">)</span>

    <span class="n">cond</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">data_io</span><span class="o">.</span><span class="n">load_model_flag</span>
    <span class="k">assert</span> <span class="n">cond</span> <span class="p">(</span><span class="n">c0</span><span class="p">)</span> <span class="ow">and</span> <span class="n">cond</span> <span class="p">(</span><span class="n">c1</span><span class="p">)</span> <span class="ow">and</span> <span class="n">cond</span> <span class="p">(</span><span class="n">multi_component</span><span class="p">)</span>

    <span class="n">multi_component</span><span class="o">.</span><span class="n">set_load_model</span> <span class="p">(</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">cond</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="ow">not</span> <span class="n">x</span><span class="o">.</span><span class="n">data_io</span><span class="o">.</span><span class="n">load_model_flag</span>
    <span class="k">assert</span> <span class="n">cond</span> <span class="p">(</span><span class="n">c0</span><span class="p">)</span> <span class="ow">and</span> <span class="n">cond</span> <span class="p">(</span><span class="n">c1</span><span class="p">)</span> <span class="ow">and</span> <span class="n">cond</span> <span class="p">(</span><span class="n">multi_component</span><span class="p">)</span>

    <span class="n">cond</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">data_io</span><span class="o">.</span><span class="n">save_model_flag</span>
    <span class="k">assert</span> <span class="n">cond</span> <span class="p">(</span><span class="n">c0</span><span class="p">)</span> <span class="ow">and</span> <span class="n">cond</span> <span class="p">(</span><span class="n">c1</span><span class="p">)</span> <span class="ow">and</span> <span class="n">cond</span> <span class="p">(</span><span class="n">multi_component</span><span class="p">)</span>

    <span class="n">multi_component</span><span class="o">.</span><span class="n">set_save_model</span> <span class="p">(</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">cond</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="ow">not</span> <span class="n">x</span><span class="o">.</span><span class="n">data_io</span><span class="o">.</span><span class="n">save_model_flag</span>
    <span class="k">assert</span> <span class="n">cond</span> <span class="p">(</span><span class="n">c0</span><span class="p">)</span> <span class="ow">and</span> <span class="n">cond</span> <span class="p">(</span><span class="n">c1</span><span class="p">)</span> <span class="ow">and</span> <span class="n">cond</span> <span class="p">(</span><span class="n">multi_component</span><span class="p">)</span>

    <span class="c1">#set_save_result</span>
    <span class="n">cond</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">data_io</span><span class="o">.</span><span class="n">save_result_flag</span>
    <span class="k">assert</span> <span class="n">cond</span> <span class="p">(</span><span class="n">c0</span><span class="p">)</span> <span class="ow">and</span> <span class="n">cond</span> <span class="p">(</span><span class="n">c1</span><span class="p">)</span> <span class="ow">and</span> <span class="n">cond</span> <span class="p">(</span><span class="n">multi_component</span><span class="p">)</span>

    <span class="n">multi_component</span><span class="o">.</span><span class="n">set_save_result</span> <span class="p">(</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">cond</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="ow">not</span> <span class="n">x</span><span class="o">.</span><span class="n">data_io</span><span class="o">.</span><span class="n">save_result_flag</span>
    <span class="k">assert</span> <span class="n">cond</span> <span class="p">(</span><span class="n">c0</span><span class="p">)</span> <span class="ow">and</span> <span class="n">cond</span> <span class="p">(</span><span class="n">c1</span><span class="p">)</span> <span class="ow">and</span> <span class="n">cond</span> <span class="p">(</span><span class="n">multi_component</span><span class="p">)</span>

    <span class="c1"># set_load_result</span>
    <span class="n">cond</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">data_io</span><span class="o">.</span><span class="n">load_result_flag</span>
    <span class="k">assert</span> <span class="n">cond</span> <span class="p">(</span><span class="n">c0</span><span class="p">)</span> <span class="ow">and</span> <span class="n">cond</span> <span class="p">(</span><span class="n">c1</span><span class="p">)</span> <span class="ow">and</span> <span class="n">cond</span> <span class="p">(</span><span class="n">multi_component</span><span class="p">)</span>

    <span class="n">multi_component</span><span class="o">.</span><span class="n">set_load_result</span> <span class="p">(</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">cond</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="ow">not</span> <span class="n">x</span><span class="o">.</span><span class="n">data_io</span><span class="o">.</span><span class="n">load_result_flag</span>
    <span class="k">assert</span> <span class="n">cond</span> <span class="p">(</span><span class="n">c0</span><span class="p">)</span> <span class="ow">and</span> <span class="n">cond</span> <span class="p">(</span><span class="n">c1</span><span class="p">)</span> <span class="ow">and</span> <span class="n">cond</span> <span class="p">(</span><span class="n">multi_component</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">tst</span><span class="o">.</span><span class="n">run</span> <span class="p">(</span><span class="n">test_multi_component_setters</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="s1">&#39;dummy&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>running test_multi_component_setters
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="show_result_statistics">show_result_statistics<a class="anchor-link" href="#show_result_statistics"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="test_show_result_statistics" class="doc_header"><code>test_show_result_statistics</code><a href="https://github.com/Jaume-JCI/ds-blocks/tree/main/dsblocks/tests/core/test_compose.py#L1015" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>test_show_result_statistics</code>()</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1">#@pytest.mark.reference_fails</span>
<span class="k">def</span> <span class="nf">test_show_result_statistics</span> <span class="p">():</span>
    <span class="n">path_results</span> <span class="o">=</span> <span class="s1">&#39;show_result_statistics&#39;</span>
    <span class="n">remove_previous_results</span> <span class="p">(</span><span class="n">path_results</span><span class="o">=</span><span class="n">path_results</span><span class="p">)</span>
    <span class="n">multi_component</span> <span class="o">=</span> <span class="n">SimpleMultiComponent</span> <span class="p">(</span><span class="n">path_results</span><span class="o">=</span><span class="n">path_results</span><span class="p">)</span>
    <span class="n">X</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">])</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">multi_component</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
    <span class="n">multi_component</span><span class="o">.</span><span class="n">show_result_statistics</span><span class="p">();</span>

    <span class="n">remove_previous_results</span> <span class="p">(</span><span class="n">path_results</span><span class="o">=</span><span class="n">path_results</span><span class="p">)</span>
    <span class="n">X</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;a&#39;</span><span class="p">:[</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">],</span> <span class="s1">&#39;b&#39;</span><span class="p">:[</span><span class="mi">7</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span><span class="mi">9</span><span class="p">]})</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">multi_component</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
    <span class="n">multi_component</span><span class="o">.</span><span class="n">show_result_statistics</span><span class="p">();</span>
    <span class="n">remove_previous_results</span> <span class="p">(</span><span class="n">path_results</span><span class="o">=</span><span class="n">path_results</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">tst</span><span class="o">.</span><span class="n">run</span> <span class="p">(</span><span class="n">test_show_result_statistics</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="s1">&#39;dummy&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>running test_show_result_statistics
</pre>
</div>
</div>

<div class="output_area">



<div class="output_text output_subarea ">
<pre>&#39;tr1&#39;</pre>
</div>

</div>

<div class="output_area">


<div class="output_html rendered_html output_subarea "><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>0</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>count</th>
      <td>3.0</td>
    </tr>
    <tr>
      <th>mean</th>
      <td>6.0</td>
    </tr>
    <tr>
      <th>std</th>
      <td>3.0</td>
    </tr>
    <tr>
      <th>min</th>
      <td>3.0</td>
    </tr>
    <tr>
      <th>25%</th>
      <td>4.5</td>
    </tr>
    <tr>
      <th>50%</th>
      <td>6.0</td>
    </tr>
    <tr>
      <th>75%</th>
      <td>7.5</td>
    </tr>
    <tr>
      <th>max</th>
      <td>9.0</td>
    </tr>
  </tbody>
</table>
</div></div>

</div>

<div class="output_area">



<div class="output_text output_subarea ">
<pre>&#39;tr2&#39;</pre>
</div>

</div>

<div class="output_area">


<div class="output_html rendered_html output_subarea "><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>0</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>count</th>
      <td>3.0</td>
    </tr>
    <tr>
      <th>mean</th>
      <td>4.0</td>
    </tr>
    <tr>
      <th>std</th>
      <td>2.0</td>
    </tr>
    <tr>
      <th>min</th>
      <td>2.0</td>
    </tr>
    <tr>
      <th>25%</th>
      <td>3.0</td>
    </tr>
    <tr>
      <th>50%</th>
      <td>4.0</td>
    </tr>
    <tr>
      <th>75%</th>
      <td>5.0</td>
    </tr>
    <tr>
      <th>max</th>
      <td>6.0</td>
    </tr>
  </tbody>
</table>
</div></div>

</div>

<div class="output_area">



<div class="output_text output_subarea ">
<pre>&#39;tr1&#39;</pre>
</div>

</div>

<div class="output_area">


<div class="output_html rendered_html output_subarea "><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>a</th>
      <th>b</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>count</th>
      <td>3.0</td>
      <td>3.0</td>
    </tr>
    <tr>
      <th>mean</th>
      <td>15.0</td>
      <td>24.0</td>
    </tr>
    <tr>
      <th>std</th>
      <td>3.0</td>
      <td>3.0</td>
    </tr>
    <tr>
      <th>min</th>
      <td>12.0</td>
      <td>21.0</td>
    </tr>
    <tr>
      <th>25%</th>
      <td>13.5</td>
      <td>22.5</td>
    </tr>
    <tr>
      <th>50%</th>
      <td>15.0</td>
      <td>24.0</td>
    </tr>
    <tr>
      <th>75%</th>
      <td>16.5</td>
      <td>25.5</td>
    </tr>
    <tr>
      <th>max</th>
      <td>18.0</td>
      <td>27.0</td>
    </tr>
  </tbody>
</table>
</div></div>

</div>

<div class="output_area">



<div class="output_text output_subarea ">
<pre>&#39;tr2&#39;</pre>
</div>

</div>

<div class="output_area">


<div class="output_html rendered_html output_subarea "><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>a</th>
      <th>b</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>count</th>
      <td>3.0</td>
      <td>3.0</td>
    </tr>
    <tr>
      <th>mean</th>
      <td>10.0</td>
      <td>16.0</td>
    </tr>
    <tr>
      <th>std</th>
      <td>2.0</td>
      <td>2.0</td>
    </tr>
    <tr>
      <th>min</th>
      <td>8.0</td>
      <td>14.0</td>
    </tr>
    <tr>
      <th>25%</th>
      <td>9.0</td>
      <td>15.0</td>
    </tr>
    <tr>
      <th>50%</th>
      <td>10.0</td>
      <td>16.0</td>
    </tr>
    <tr>
      <th>75%</th>
      <td>11.0</td>
      <td>17.0</td>
    </tr>
    <tr>
      <th>max</th>
      <td>12.0</td>
      <td>18.0</td>
    </tr>
  </tbody>
</table>
</div></div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Passing-list-of-components">Passing list of components<a class="anchor-link" href="#Passing-list-of-components"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="test_pass_components" class="doc_header"><code>test_pass_components</code><a href="https://github.com/Jaume-JCI/ds-blocks/tree/main/dsblocks/tests/core/test_compose.py#L1030" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>test_pass_components</code>()</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">test_pass_components</span> <span class="p">():</span>
    <span class="n">config</span> <span class="o">=</span> <span class="nb">dict</span> <span class="p">(</span><span class="n">path_results</span><span class="o">=</span><span class="s1">&#39;my_path&#39;</span><span class="p">,</span> <span class="n">Second</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">path_results</span><span class="o">=</span><span class="s1">&#39;other_path&#39;</span><span class="p">))</span>
    <span class="n">multi</span> <span class="o">=</span> <span class="n">MultiComponent</span> <span class="p">(</span><span class="n">Component</span> <span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;first&#39;</span><span class="p">,</span> <span class="n">class_name</span><span class="o">=</span><span class="s1">&#39;First&#39;</span><span class="p">,</span> <span class="n">folder</span><span class="o">=</span><span class="s1">&#39;one&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">config</span><span class="p">),</span>
                            <span class="n">Component</span> <span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;second&#39;</span><span class="p">,</span> <span class="n">class_name</span><span class="o">=</span><span class="s1">&#39;Second&#39;</span><span class="p">,</span> <span class="n">folder</span><span class="o">=</span><span class="s1">&#39;two&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">config</span><span class="p">),</span>
                            <span class="n">name</span><span class="o">=</span><span class="s1">&#39;Inner&#39;</span><span class="p">,</span>
                            <span class="o">**</span><span class="n">config</span><span class="p">)</span>

    <span class="n">check_last_part</span> <span class="p">(</span><span class="n">multi</span><span class="o">.</span><span class="n">path_results</span><span class="p">,</span> <span class="s1">&#39;my_path&#39;</span><span class="p">)</span>
    <span class="n">check_last_part</span> <span class="p">(</span><span class="n">multi</span><span class="o">.</span><span class="n">second</span><span class="o">.</span><span class="n">path_results</span><span class="p">,</span> <span class="s1">&#39;other_path&#39;</span><span class="p">)</span>
    <span class="n">check_last_part</span> <span class="p">(</span><span class="n">multi</span><span class="o">.</span><span class="n">first</span><span class="o">.</span><span class="n">path_results</span><span class="p">,</span> <span class="s1">&#39;my_path&#39;</span><span class="p">)</span>

    <span class="k">assert</span> <span class="n">multi</span><span class="o">.</span><span class="n">first</span><span class="o">.</span><span class="n">data_io</span><span class="o">.</span><span class="n">folder</span><span class="o">==</span><span class="s1">&#39;one&#39;</span>
    <span class="k">assert</span> <span class="n">multi</span><span class="o">.</span><span class="n">second</span><span class="o">.</span><span class="n">data_io</span><span class="o">.</span><span class="n">folder</span><span class="o">==</span><span class="s1">&#39;two&#39;</span>

    <span class="k">def</span> <span class="nf">make_inner</span> <span class="p">(</span><span class="n">folder</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">MultiComponent</span> <span class="p">(</span><span class="n">Component</span> <span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;first&#39;</span><span class="p">,</span> <span class="n">class_name</span><span class="o">=</span><span class="s1">&#39;First&#39;</span><span class="p">,</span> <span class="n">folder</span><span class="o">=</span><span class="s1">&#39;folder_first&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">),</span>
                               <span class="n">Component</span> <span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;second&#39;</span><span class="p">,</span> <span class="n">class_name</span><span class="o">=</span><span class="s1">&#39;Second&#39;</span><span class="p">,</span> <span class="n">folder</span><span class="o">=</span><span class="s1">&#39;folder_second&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">),</span>
                               <span class="n">folder</span><span class="o">=</span><span class="n">folder</span><span class="p">,</span>
                               <span class="n">class_name</span><span class="o">=</span><span class="s1">&#39;Inner&#39;</span><span class="p">,</span>
                               <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span>
                               <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="n">multi</span> <span class="o">=</span> <span class="n">MultiComponent</span> <span class="p">(</span><span class="n">make_inner</span> <span class="p">(</span><span class="s1">&#39;one&#39;</span><span class="p">,</span> <span class="s1">&#39;inner1&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">config</span><span class="p">),</span> <span class="n">make_inner</span> <span class="p">(</span><span class="s1">&#39;two&#39;</span><span class="p">,</span> <span class="s1">&#39;inner2&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">config</span><span class="p">),</span> <span class="o">**</span><span class="n">config</span><span class="p">)</span>

    <span class="n">check_last_part</span> <span class="p">(</span><span class="n">multi</span><span class="o">.</span><span class="n">inner1</span><span class="o">.</span><span class="n">first</span><span class="o">.</span><span class="n">data_io</span><span class="o">.</span><span class="n">get_path_result_file</span><span class="p">(),</span> 
        <span class="s1">&#39;my_path/one/folder_first/whole/first_result.pk&#39;</span><span class="p">)</span>

    <span class="n">check_last_part</span> <span class="p">(</span><span class="n">multi</span><span class="o">.</span><span class="n">inner1</span><span class="o">.</span><span class="n">second</span><span class="o">.</span><span class="n">data_io</span><span class="o">.</span><span class="n">get_path_result_file</span><span class="p">(),</span>
        <span class="s1">&#39;other_path/one/folder_second/whole/second_result.pk&#39;</span><span class="p">)</span>

    <span class="n">check_last_part</span> <span class="p">(</span><span class="n">multi</span><span class="o">.</span><span class="n">inner2</span><span class="o">.</span><span class="n">first</span><span class="o">.</span><span class="n">data_io</span><span class="o">.</span><span class="n">get_path_result_file</span><span class="p">(),</span> 
        <span class="s1">&#39;my_path/two/folder_first/whole/first_result.pk&#39;</span><span class="p">)</span>

    <span class="n">check_last_part</span> <span class="p">(</span><span class="n">multi</span><span class="o">.</span><span class="n">inner2</span><span class="o">.</span><span class="n">second</span><span class="o">.</span><span class="n">data_io</span><span class="o">.</span><span class="n">get_path_result_file</span><span class="p">(),</span> 
        <span class="s1">&#39;other_path/two/folder_second/whole/second_result.pk&#39;</span><span class="p">)</span>

    <span class="n">config</span> <span class="o">=</span> <span class="nb">dict</span> <span class="p">(</span><span class="n">path_results</span><span class="o">=</span><span class="s1">&#39;my_path&#39;</span><span class="p">,</span> <span class="n">Inner</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">path_results</span><span class="o">=</span><span class="s1">&#39;other_path&#39;</span><span class="p">))</span>
    <span class="k">def</span> <span class="nf">make_inner</span> <span class="p">(</span><span class="n">folder</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">MultiComponent</span> <span class="p">(</span><span class="n">Component</span> <span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;first&#39;</span><span class="p">,</span> <span class="n">class_name</span><span class="o">=</span><span class="s1">&#39;First&#39;</span><span class="p">,</span> <span class="n">folder</span><span class="o">=</span><span class="s1">&#39;folder_first&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">),</span>
                               <span class="n">Component</span> <span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;second&#39;</span><span class="p">,</span> <span class="n">class_name</span><span class="o">=</span><span class="s1">&#39;Second&#39;</span><span class="p">,</span> <span class="n">folder</span><span class="o">=</span><span class="s1">&#39;folder_second&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">),</span>
                               <span class="n">folder</span><span class="o">=</span><span class="n">folder</span><span class="p">,</span>
                               <span class="n">class_name</span><span class="o">=</span><span class="s1">&#39;Inner&#39;</span><span class="p">,</span>
                               <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span>
                               <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="n">multi</span> <span class="o">=</span> <span class="n">MultiComponent</span> <span class="p">(</span><span class="n">make_inner</span> <span class="p">(</span><span class="s1">&#39;one&#39;</span><span class="p">,</span> <span class="s1">&#39;inner1&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">config</span><span class="p">),</span> 
                            <span class="n">make_inner</span> <span class="p">(</span><span class="s1">&#39;two&#39;</span><span class="p">,</span> <span class="s1">&#39;inner2&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">config</span><span class="p">),</span> 
                            <span class="n">folder</span><span class="o">=</span><span class="s1">&#39;__class__&#39;</span><span class="p">,</span>
                            <span class="n">class_name</span><span class="o">=</span><span class="s1">&#39;Higher&#39;</span><span class="p">,</span>
                            <span class="n">name</span><span class="o">=</span><span class="s1">&#39;higher&#39;</span><span class="p">,</span>
                            <span class="o">**</span><span class="n">config</span><span class="p">)</span>

    <span class="n">check_last_part</span> <span class="p">(</span><span class="n">multi</span><span class="o">.</span><span class="n">inner1</span><span class="o">.</span><span class="n">first</span><span class="o">.</span><span class="n">data_io</span><span class="o">.</span><span class="n">get_path_result_file</span><span class="p">(),</span> 
        <span class="s1">&#39;my_path/higher/one/folder_first/whole/first_result.pk&#39;</span><span class="p">)</span>

    <span class="n">check_last_part</span> <span class="p">(</span><span class="n">multi</span><span class="o">.</span><span class="n">inner1</span><span class="o">.</span><span class="n">second</span><span class="o">.</span><span class="n">data_io</span><span class="o">.</span><span class="n">get_path_result_file</span><span class="p">(),</span> 
        <span class="s1">&#39;my_path/higher/one/folder_second/whole/second_result.pk&#39;</span><span class="p">)</span>

    <span class="n">check_last_part</span> <span class="p">(</span><span class="n">multi</span><span class="o">.</span><span class="n">inner2</span><span class="o">.</span><span class="n">first</span><span class="o">.</span><span class="n">data_io</span><span class="o">.</span><span class="n">get_path_result_file</span><span class="p">(),</span> 
        <span class="s1">&#39;my_path/higher/two/folder_first/whole/first_result.pk&#39;</span><span class="p">)</span>

    <span class="n">check_last_part</span> <span class="p">(</span><span class="n">multi</span><span class="o">.</span><span class="n">inner2</span><span class="o">.</span><span class="n">second</span><span class="o">.</span><span class="n">data_io</span><span class="o">.</span><span class="n">get_path_result_file</span><span class="p">(),</span> 
        <span class="s1">&#39;my_path/higher/two/folder_second/whole/second_result.pk&#39;</span><span class="p">)</span>

    <span class="n">check_last_part</span> <span class="p">(</span><span class="n">multi</span><span class="o">.</span><span class="n">inner1</span><span class="o">.</span><span class="n">data_io</span><span class="o">.</span><span class="n">get_path_result_file</span><span class="p">(),</span> 
        <span class="s1">&#39;other_path/higher/one/whole/inner1_result.pk&#39;</span><span class="p">)</span>

    <span class="n">check_last_part</span> <span class="p">(</span><span class="n">multi</span><span class="o">.</span><span class="n">inner2</span><span class="o">.</span><span class="n">data_io</span><span class="o">.</span><span class="n">get_path_result_file</span><span class="p">(),</span> 
        <span class="s1">&#39;other_path/higher/two/whole/inner2_result.pk&#39;</span><span class="p">)</span>

    <span class="n">multi</span> <span class="o">=</span> <span class="n">MultiComponent</span> <span class="p">(</span><span class="n">make_inner</span> <span class="p">(</span><span class="s1">&#39;one&#39;</span><span class="p">,</span> <span class="s1">&#39;inner1&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">config</span><span class="p">,</span> <span class="n">propagate</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span> 
                            <span class="n">make_inner</span> <span class="p">(</span><span class="s1">&#39;two&#39;</span><span class="p">,</span> <span class="s1">&#39;inner2&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">config</span><span class="p">,</span> <span class="n">propagate</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span> 
                            <span class="n">folder</span><span class="o">=</span><span class="s1">&#39;__class__&#39;</span><span class="p">,</span>
                            <span class="n">class_name</span><span class="o">=</span><span class="s1">&#39;Higher&#39;</span><span class="p">,</span>
                            <span class="n">name</span><span class="o">=</span><span class="s1">&#39;higher&#39;</span><span class="p">,</span>
                            <span class="o">**</span><span class="n">config</span><span class="p">)</span>

    <span class="n">check_last_part</span> <span class="p">(</span><span class="n">multi</span><span class="o">.</span><span class="n">inner1</span><span class="o">.</span><span class="n">first</span><span class="o">.</span><span class="n">data_io</span><span class="o">.</span><span class="n">get_path_result_file</span><span class="p">(),</span> 
        <span class="s1">&#39;other_path/higher/one/folder_first/whole/first_result.pk&#39;</span><span class="p">)</span>

    <span class="n">check_last_part</span> <span class="p">(</span><span class="n">multi</span><span class="o">.</span><span class="n">inner1</span><span class="o">.</span><span class="n">second</span><span class="o">.</span><span class="n">data_io</span><span class="o">.</span><span class="n">get_path_result_file</span><span class="p">(),</span> 
                     <span class="s1">&#39;other_path/higher/one/folder_second/whole/second_result.pk&#39;</span><span class="p">)</span>

    <span class="n">check_last_part</span> <span class="p">(</span><span class="n">multi</span><span class="o">.</span><span class="n">inner2</span><span class="o">.</span><span class="n">first</span><span class="o">.</span><span class="n">data_io</span><span class="o">.</span><span class="n">get_path_result_file</span><span class="p">(),</span> 
                     <span class="s1">&#39;other_path/higher/two/folder_first/whole/first_result.pk&#39;</span><span class="p">)</span>

    <span class="n">check_last_part</span> <span class="p">(</span><span class="n">multi</span><span class="o">.</span><span class="n">inner2</span><span class="o">.</span><span class="n">second</span><span class="o">.</span><span class="n">data_io</span><span class="o">.</span><span class="n">get_path_result_file</span><span class="p">(),</span> 
                     <span class="s1">&#39;other_path/higher/two/folder_second/whole/second_result.pk&#39;</span><span class="p">)</span>

    <span class="n">check_last_part</span> <span class="p">(</span><span class="n">multi</span><span class="o">.</span><span class="n">inner1</span><span class="o">.</span><span class="n">data_io</span><span class="o">.</span><span class="n">get_path_result_file</span><span class="p">(),</span> 
                     <span class="s1">&#39;other_path/higher/one/whole/inner1_result.pk&#39;</span><span class="p">)</span>

    <span class="n">check_last_part</span> <span class="p">(</span><span class="n">multi</span><span class="o">.</span><span class="n">inner2</span><span class="o">.</span><span class="n">data_io</span><span class="o">.</span><span class="n">get_path_result_file</span><span class="p">(),</span> 
                     <span class="s1">&#39;other_path/higher/two/whole/inner2_result.pk&#39;</span><span class="p">)</span>

    <span class="n">check_last_part</span> <span class="p">(</span><span class="n">multi</span><span class="o">.</span><span class="n">data_io</span><span class="o">.</span><span class="n">get_path_result_file</span><span class="p">(),</span> 
                     <span class="s1">&#39;my_path/higher/whole/higher_result.pk&#39;</span><span class="p">)</span>

    <span class="n">multi</span> <span class="o">=</span> <span class="n">MultiComponent</span> <span class="p">(</span><span class="n">make_inner</span> <span class="p">(</span><span class="s1">&#39;one&#39;</span><span class="p">,</span> <span class="s1">&#39;inner1&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">config</span><span class="p">),</span> 
                            <span class="n">make_inner</span> <span class="p">(</span><span class="s1">&#39;two&#39;</span><span class="p">,</span> <span class="s1">&#39;inner2&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">config</span><span class="p">),</span> 
                            <span class="n">folder</span><span class="o">=</span><span class="s1">&#39;__class__&#39;</span><span class="p">,</span>
                            <span class="n">class_name</span><span class="o">=</span><span class="s1">&#39;Higher&#39;</span><span class="p">,</span>
                            <span class="n">name</span><span class="o">=</span><span class="s1">&#39;higher&#39;</span><span class="p">,</span>
                            <span class="n">propagate</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                            <span class="o">**</span><span class="n">config</span><span class="p">)</span>

    <span class="n">check_last_part</span> <span class="p">(</span><span class="n">multi</span><span class="o">.</span><span class="n">inner1</span><span class="o">.</span><span class="n">first</span><span class="o">.</span><span class="n">data_io</span><span class="o">.</span><span class="n">get_path_result_file</span><span class="p">(),</span> 
                     <span class="s1">&#39;my_path/higher/one/folder_first/whole/first_result.pk&#39;</span><span class="p">)</span>

    <span class="n">check_last_part</span> <span class="p">(</span><span class="n">multi</span><span class="o">.</span><span class="n">inner1</span><span class="o">.</span><span class="n">second</span><span class="o">.</span><span class="n">data_io</span><span class="o">.</span><span class="n">get_path_result_file</span><span class="p">(),</span> 
                     <span class="s1">&#39;my_path/higher/one/folder_second/whole/second_result.pk&#39;</span><span class="p">)</span>

    <span class="n">check_last_part</span> <span class="p">(</span><span class="n">multi</span><span class="o">.</span><span class="n">inner2</span><span class="o">.</span><span class="n">first</span><span class="o">.</span><span class="n">data_io</span><span class="o">.</span><span class="n">get_path_result_file</span><span class="p">(),</span> 
                     <span class="s1">&#39;my_path/higher/two/folder_first/whole/first_result.pk&#39;</span><span class="p">)</span>

    <span class="n">check_last_part</span> <span class="p">(</span><span class="n">multi</span><span class="o">.</span><span class="n">inner2</span><span class="o">.</span><span class="n">second</span><span class="o">.</span><span class="n">data_io</span><span class="o">.</span><span class="n">get_path_result_file</span><span class="p">(),</span> 
                     <span class="s1">&#39;my_path/higher/two/folder_second/whole/second_result.pk&#39;</span><span class="p">)</span>

    <span class="n">check_last_part</span> <span class="p">(</span><span class="n">multi</span><span class="o">.</span><span class="n">inner1</span><span class="o">.</span><span class="n">data_io</span><span class="o">.</span><span class="n">get_path_result_file</span><span class="p">(),</span> 
                     <span class="s1">&#39;my_path/higher/one/whole/inner1_result.pk&#39;</span><span class="p">)</span>

    <span class="n">check_last_part</span> <span class="p">(</span><span class="n">multi</span><span class="o">.</span><span class="n">inner2</span><span class="o">.</span><span class="n">data_io</span><span class="o">.</span><span class="n">get_path_result_file</span><span class="p">(),</span> 
                     <span class="s1">&#39;my_path/higher/two/whole/inner2_result.pk&#39;</span><span class="p">)</span>

    <span class="n">check_last_part</span> <span class="p">(</span><span class="n">multi</span><span class="o">.</span><span class="n">data_io</span><span class="o">.</span><span class="n">get_path_result_file</span><span class="p">(),</span> 
                     <span class="s1">&#39;my_path/higher/whole/higher_result.pk&#39;</span><span class="p">)</span>

    <span class="n">config</span> <span class="o">=</span> <span class="nb">dict</span> <span class="p">(</span><span class="n">path_results</span><span class="o">=</span><span class="s1">&#39;my_path&#39;</span><span class="p">,</span> <span class="n">Inner</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">path_results</span><span class="o">=</span><span class="s1">&#39;other_path&#39;</span><span class="p">,</span> <span class="n">stop_propagation</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
    <span class="n">multi</span> <span class="o">=</span> <span class="n">MultiComponent</span> <span class="p">(</span><span class="n">make_inner</span> <span class="p">(</span><span class="s1">&#39;one&#39;</span><span class="p">,</span> <span class="s1">&#39;inner1&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">config</span><span class="p">,</span> <span class="n">propagate</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span> 
                            <span class="n">make_inner</span> <span class="p">(</span><span class="s1">&#39;two&#39;</span><span class="p">,</span> <span class="s1">&#39;inner2&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">config</span><span class="p">,</span> <span class="n">propagate</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span> 
                            <span class="n">folder</span><span class="o">=</span><span class="s1">&#39;__class__&#39;</span><span class="p">,</span>
                            <span class="n">class_name</span><span class="o">=</span><span class="s1">&#39;Higher&#39;</span><span class="p">,</span>
                            <span class="n">name</span><span class="o">=</span><span class="s1">&#39;higher&#39;</span><span class="p">,</span>
                            <span class="n">propagate</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                            <span class="o">**</span><span class="n">config</span><span class="p">)</span>

    <span class="n">check_last_part</span> <span class="p">(</span><span class="n">multi</span><span class="o">.</span><span class="n">inner1</span><span class="o">.</span><span class="n">first</span><span class="o">.</span><span class="n">data_io</span><span class="o">.</span><span class="n">get_path_result_file</span><span class="p">(),</span> 
                     <span class="s1">&#39;other_path/higher/one/folder_first/whole/first_result.pk&#39;</span><span class="p">)</span>

    <span class="n">check_last_part</span> <span class="p">(</span><span class="n">multi</span><span class="o">.</span><span class="n">inner1</span><span class="o">.</span><span class="n">second</span><span class="o">.</span><span class="n">data_io</span><span class="o">.</span><span class="n">get_path_result_file</span><span class="p">(),</span> 
                     <span class="s1">&#39;other_path/higher/one/folder_second/whole/second_result.pk&#39;</span><span class="p">)</span>

    <span class="n">check_last_part</span> <span class="p">(</span><span class="n">multi</span><span class="o">.</span><span class="n">inner2</span><span class="o">.</span><span class="n">first</span><span class="o">.</span><span class="n">data_io</span><span class="o">.</span><span class="n">get_path_result_file</span><span class="p">(),</span> 
                     <span class="s1">&#39;other_path/higher/two/folder_first/whole/first_result.pk&#39;</span><span class="p">)</span>

    <span class="n">check_last_part</span> <span class="p">(</span><span class="n">multi</span><span class="o">.</span><span class="n">inner2</span><span class="o">.</span><span class="n">second</span><span class="o">.</span><span class="n">data_io</span><span class="o">.</span><span class="n">get_path_result_file</span><span class="p">(),</span> 
                     <span class="s1">&#39;other_path/higher/two/folder_second/whole/second_result.pk&#39;</span><span class="p">)</span>

    <span class="n">check_last_part</span> <span class="p">(</span><span class="n">multi</span><span class="o">.</span><span class="n">inner1</span><span class="o">.</span><span class="n">data_io</span><span class="o">.</span><span class="n">get_path_result_file</span><span class="p">(),</span> 
                     <span class="s1">&#39;other_path/higher/one/whole/inner1_result.pk&#39;</span><span class="p">)</span>

    <span class="n">check_last_part</span> <span class="p">(</span><span class="n">multi</span><span class="o">.</span><span class="n">inner2</span><span class="o">.</span><span class="n">data_io</span><span class="o">.</span><span class="n">get_path_result_file</span><span class="p">(),</span> 
                     <span class="s1">&#39;other_path/higher/two/whole/inner2_result.pk&#39;</span><span class="p">)</span>

    <span class="n">check_last_part</span> <span class="p">(</span><span class="n">multi</span><span class="o">.</span><span class="n">data_io</span><span class="o">.</span><span class="n">get_path_result_file</span><span class="p">(),</span> 
                     <span class="s1">&#39;my_path/higher/whole/higher_result.pk&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">tst</span><span class="o">.</span><span class="n">run</span> <span class="p">(</span><span class="n">test_pass_components</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="s1">&#39;dummy&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>running test_pass_components
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="chain_folders">chain_folders<a class="anchor-link" href="#chain_folders"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="test_chain_folders" class="doc_header"><code>test_chain_folders</code><a href="https://github.com/Jaume-JCI/ds-blocks/tree/main/dsblocks/tests/core/test_compose.py#L1186" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>test_chain_folders</code>()</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">test_chain_folders</span> <span class="p">():</span>
    <span class="n">config</span> <span class="o">=</span> <span class="nb">dict</span> <span class="p">(</span><span class="n">path_results</span><span class="o">=</span><span class="s1">&#39;my_path&#39;</span><span class="p">,</span> <span class="n">Second</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">path_results</span><span class="o">=</span><span class="s1">&#39;other_path&#39;</span><span class="p">))</span>
    <span class="k">def</span> <span class="nf">first_level</span> <span class="p">():</span>
        <span class="n">a0</span><span class="o">=</span><span class="n">Component</span> <span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;first&#39;</span><span class="p">,</span> <span class="n">class_name</span><span class="o">=</span><span class="s1">&#39;First&#39;</span><span class="p">,</span> <span class="n">folder</span><span class="o">=</span><span class="s1">&#39;folder_first&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">config</span><span class="p">)</span>
        <span class="n">b0</span><span class="o">=</span><span class="n">Component</span> <span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;second&#39;</span><span class="p">,</span> <span class="n">class_name</span><span class="o">=</span><span class="s1">&#39;Second&#39;</span><span class="p">,</span> <span class="n">folder</span><span class="o">=</span><span class="s1">&#39;folder_second&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">config</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">a0</span><span class="p">,</span> <span class="n">b0</span>

    <span class="n">a0</span><span class="p">,</span> <span class="n">b0</span> <span class="o">=</span> <span class="n">first_level</span><span class="p">()</span>

    <span class="k">assert</span> <span class="n">a0</span><span class="o">.</span><span class="n">data_io</span><span class="o">.</span><span class="n">folder</span><span class="o">==</span><span class="s1">&#39;folder_first&#39;</span>

    <span class="k">def</span> <span class="nf">second_level</span> <span class="p">():</span>
        <span class="n">a0</span><span class="p">,</span> <span class="n">b0</span> <span class="o">=</span> <span class="n">first_level</span> <span class="p">()</span>
        <span class="n">a1</span><span class="o">=</span> <span class="n">MultiComponent</span> <span class="p">(</span><span class="n">a0</span><span class="p">,</span> <span class="n">b0</span><span class="p">,</span> <span class="n">folder</span><span class="o">=</span><span class="s1">&#39;one&#39;</span><span class="p">,</span> <span class="n">class_name</span><span class="o">=</span><span class="s1">&#39;Inner&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;inner1&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">config</span><span class="p">)</span>
        <span class="n">a0</span><span class="p">,</span> <span class="n">b0</span> <span class="o">=</span> <span class="n">first_level</span> <span class="p">()</span>
        <span class="n">b1</span><span class="o">=</span> <span class="n">MultiComponent</span> <span class="p">(</span><span class="n">a0</span><span class="p">,</span> <span class="n">b0</span><span class="p">,</span> <span class="n">folder</span><span class="o">=</span><span class="s1">&#39;two&#39;</span><span class="p">,</span> <span class="n">class_name</span><span class="o">=</span><span class="s1">&#39;Inner&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;inner2&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">config</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">a1</span><span class="p">,</span> <span class="n">b1</span>

    <span class="n">a1</span><span class="p">,</span> <span class="n">b1</span> <span class="o">=</span> <span class="n">second_level</span> <span class="p">()</span>

    <span class="k">assert</span> <span class="n">a1</span><span class="o">.</span><span class="n">first</span><span class="o">.</span><span class="n">data_io</span><span class="o">.</span><span class="n">folder</span><span class="o">==</span><span class="s1">&#39;one/folder_first&#39;</span>
    <span class="k">assert</span> <span class="n">a1</span><span class="o">.</span><span class="n">second</span><span class="o">.</span><span class="n">data_io</span><span class="o">.</span><span class="n">folder</span><span class="o">==</span><span class="s1">&#39;one/folder_second&#39;</span>
    <span class="k">assert</span> <span class="n">b1</span><span class="o">.</span><span class="n">first</span><span class="o">.</span><span class="n">data_io</span><span class="o">.</span><span class="n">folder</span><span class="o">==</span><span class="s1">&#39;two/folder_first&#39;</span>
    <span class="k">assert</span> <span class="n">b1</span><span class="o">.</span><span class="n">second</span><span class="o">.</span><span class="n">data_io</span><span class="o">.</span><span class="n">folder</span><span class="o">==</span><span class="s1">&#39;two/folder_second&#39;</span>

    <span class="k">def</span> <span class="nf">third_level</span> <span class="p">():</span>
        <span class="n">a1</span><span class="p">,</span> <span class="n">b1</span> <span class="o">=</span> <span class="n">second_level</span> <span class="p">()</span>
        <span class="n">a2</span><span class="o">=</span> <span class="n">MultiComponent</span> <span class="p">(</span><span class="n">a1</span><span class="p">,</span> <span class="n">b1</span><span class="p">,</span> <span class="n">folder</span><span class="o">=</span><span class="s1">&#39;third1&#39;</span><span class="p">,</span> <span class="n">class_name</span><span class="o">=</span><span class="s1">&#39;Higher&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;higher1&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">config</span><span class="p">)</span>
        <span class="n">a1</span><span class="p">,</span> <span class="n">b1</span> <span class="o">=</span> <span class="n">second_level</span> <span class="p">()</span>
        <span class="n">b2</span><span class="o">=</span> <span class="n">MultiComponent</span> <span class="p">(</span><span class="n">a1</span><span class="p">,</span> <span class="n">b1</span><span class="p">,</span> <span class="n">folder</span><span class="o">=</span><span class="s1">&#39;third2&#39;</span><span class="p">,</span> <span class="n">class_name</span><span class="o">=</span><span class="s1">&#39;Higher&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;higher2&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">config</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">a2</span><span class="p">,</span> <span class="n">b2</span>

    <span class="n">a2</span><span class="p">,</span> <span class="n">b2</span> <span class="o">=</span> <span class="n">third_level</span> <span class="p">()</span>

    <span class="k">assert</span> <span class="n">a2</span><span class="o">.</span><span class="n">inner1</span><span class="o">.</span><span class="n">first</span><span class="o">.</span><span class="n">data_io</span><span class="o">.</span><span class="n">folder</span><span class="o">==</span><span class="s1">&#39;third1/one/folder_first&#39;</span>
    <span class="k">assert</span> <span class="n">a2</span><span class="o">.</span><span class="n">inner1</span><span class="o">.</span><span class="n">second</span><span class="o">.</span><span class="n">data_io</span><span class="o">.</span><span class="n">folder</span><span class="o">==</span><span class="s1">&#39;third1/one/folder_second&#39;</span>
    <span class="k">assert</span> <span class="n">b2</span><span class="o">.</span><span class="n">inner1</span><span class="o">.</span><span class="n">first</span><span class="o">.</span><span class="n">data_io</span><span class="o">.</span><span class="n">folder</span><span class="o">==</span><span class="s1">&#39;third2/one/folder_first&#39;</span>
    <span class="k">assert</span> <span class="n">b2</span><span class="o">.</span><span class="n">inner1</span><span class="o">.</span><span class="n">second</span><span class="o">.</span><span class="n">data_io</span><span class="o">.</span><span class="n">folder</span><span class="o">==</span><span class="s1">&#39;third2/one/folder_second&#39;</span>
    <span class="k">assert</span> <span class="n">b2</span><span class="o">.</span><span class="n">inner2</span><span class="o">.</span><span class="n">first</span><span class="o">.</span><span class="n">data_io</span><span class="o">.</span><span class="n">folder</span><span class="o">==</span><span class="s1">&#39;third2/two/folder_first&#39;</span>
    <span class="k">assert</span> <span class="n">b2</span><span class="o">.</span><span class="n">inner2</span><span class="o">.</span><span class="n">second</span><span class="o">.</span><span class="n">data_io</span><span class="o">.</span><span class="n">folder</span><span class="o">==</span><span class="s1">&#39;third2/two/folder_second&#39;</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">tst</span><span class="o">.</span><span class="n">run</span> <span class="p">(</span><span class="n">test_chain_folders</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="s1">&#39;dummy&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>running test_chain_folders
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="set_unique_names-&amp;-set_root">set_unique_names &amp; set_root<a class="anchor-link" href="#set_unique_names-&amp;-set_root"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="test_set_root" class="doc_header"><code>test_set_root</code><a href="https://github.com/Jaume-JCI/ds-blocks/tree/main/dsblocks/tests/core/test_compose.py#L1228" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>test_set_root</code>()</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">test_set_root</span> <span class="p">():</span>
    <span class="n">config</span> <span class="o">=</span> <span class="nb">dict</span> <span class="p">(</span><span class="n">path_results</span><span class="o">=</span><span class="s1">&#39;my_path&#39;</span><span class="p">,</span> <span class="n">Second</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">path_results</span><span class="o">=</span><span class="s1">&#39;other_path&#39;</span><span class="p">))</span>
    <span class="k">def</span> <span class="nf">first_level</span> <span class="p">():</span>
        <span class="n">a0</span><span class="o">=</span><span class="n">Component</span> <span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;first&#39;</span><span class="p">,</span> <span class="n">class_name</span><span class="o">=</span><span class="s1">&#39;First&#39;</span><span class="p">,</span> <span class="n">folder</span><span class="o">=</span><span class="s1">&#39;folder_first&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">config</span><span class="p">)</span>
        <span class="n">b0</span><span class="o">=</span><span class="n">Component</span> <span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;second&#39;</span><span class="p">,</span> <span class="n">class_name</span><span class="o">=</span><span class="s1">&#39;Second&#39;</span><span class="p">,</span> <span class="n">folder</span><span class="o">=</span><span class="s1">&#39;folder_second&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">config</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">a0</span><span class="p">,</span> <span class="n">b0</span>

    <span class="n">a0</span><span class="p">,</span> <span class="n">b0</span> <span class="o">=</span> <span class="n">first_level</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">second_level</span> <span class="p">():</span>
        <span class="n">a0</span><span class="p">,</span> <span class="n">b0</span> <span class="o">=</span> <span class="n">first_level</span> <span class="p">()</span>
        <span class="n">a1</span><span class="o">=</span> <span class="n">MultiComponent</span> <span class="p">(</span><span class="n">a0</span><span class="p">,</span> <span class="n">b0</span><span class="p">,</span> <span class="n">folder</span><span class="o">=</span><span class="s1">&#39;one&#39;</span><span class="p">,</span> <span class="n">class_name</span><span class="o">=</span><span class="s1">&#39;Inner&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;inner1&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">config</span><span class="p">)</span>
        <span class="n">a0</span><span class="p">,</span> <span class="n">b0</span> <span class="o">=</span> <span class="n">first_level</span> <span class="p">()</span>
        <span class="n">b1</span><span class="o">=</span> <span class="n">MultiComponent</span> <span class="p">(</span><span class="n">a0</span><span class="p">,</span> <span class="n">b0</span><span class="p">,</span> <span class="n">folder</span><span class="o">=</span><span class="s1">&#39;two&#39;</span><span class="p">,</span> <span class="n">class_name</span><span class="o">=</span><span class="s1">&#39;Inner&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;inner2&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">config</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">a1</span><span class="p">,</span> <span class="n">b1</span>

    <span class="n">a1</span><span class="p">,</span> <span class="n">b1</span> <span class="o">=</span> <span class="n">second_level</span> <span class="p">()</span>

    <span class="k">def</span> <span class="nf">third_level</span> <span class="p">():</span>
        <span class="n">a1</span><span class="p">,</span> <span class="n">b1</span> <span class="o">=</span> <span class="n">second_level</span> <span class="p">()</span>
        <span class="n">a2</span><span class="o">=</span> <span class="n">MultiComponent</span> <span class="p">(</span><span class="n">a1</span><span class="p">,</span> <span class="n">b1</span><span class="p">,</span> <span class="n">folder</span><span class="o">=</span><span class="s1">&#39;third1&#39;</span><span class="p">,</span> <span class="n">class_name</span><span class="o">=</span><span class="s1">&#39;Higher&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;higher1&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">config</span><span class="p">)</span>
        <span class="n">a1</span><span class="p">,</span> <span class="n">b1</span> <span class="o">=</span> <span class="n">second_level</span> <span class="p">()</span>
        <span class="n">b2</span><span class="o">=</span> <span class="n">MultiComponent</span> <span class="p">(</span><span class="n">a1</span><span class="p">,</span> <span class="n">b1</span><span class="p">,</span> <span class="n">folder</span><span class="o">=</span><span class="s1">&#39;third2&#39;</span><span class="p">,</span> <span class="n">class_name</span><span class="o">=</span><span class="s1">&#39;Higher&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;higher2&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">config</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">a2</span><span class="p">,</span> <span class="n">b2</span>

    <span class="n">a2</span><span class="p">,</span> <span class="n">b2</span> <span class="o">=</span> <span class="n">third_level</span> <span class="p">()</span>
    <span class="n">c</span> <span class="o">=</span> <span class="n">MultiComponent</span> <span class="p">(</span><span class="n">a2</span><span class="p">,</span> <span class="n">b2</span><span class="p">)</span>
    <span class="k">assert</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">c</span><span class="o">.</span><span class="n">higher1</span><span class="o">.</span><span class="n">inner1</span><span class="o">.</span><span class="n">components</span><span class="p">]</span> <span class="o">==</span> <span class="p">[</span><span class="s1">&#39;first&#39;</span><span class="p">,</span> <span class="s1">&#39;second&#39;</span><span class="p">]</span>
    <span class="k">assert</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">c</span><span class="o">.</span><span class="n">higher1</span><span class="o">.</span><span class="n">inner2</span><span class="o">.</span><span class="n">components</span><span class="p">]</span> <span class="o">==</span> <span class="p">[</span><span class="s1">&#39;first&#39;</span><span class="p">,</span> <span class="s1">&#39;second&#39;</span><span class="p">]</span>

    <span class="n">c</span> <span class="o">=</span> <span class="n">MultiComponent</span> <span class="p">(</span><span class="n">a2</span><span class="p">,</span> <span class="n">b2</span><span class="p">,</span> <span class="n">root</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">assert</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">c</span><span class="o">.</span><span class="n">higher1</span><span class="o">.</span><span class="n">inner1</span><span class="o">.</span><span class="n">components</span><span class="p">]</span> <span class="o">==</span> <span class="p">[</span><span class="s1">&#39;first&#39;</span><span class="p">,</span> <span class="s1">&#39;second&#39;</span><span class="p">]</span>
    <span class="k">assert</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">c</span><span class="o">.</span><span class="n">higher1</span><span class="o">.</span><span class="n">inner2</span><span class="o">.</span><span class="n">components</span><span class="p">]</span> <span class="o">==</span> <span class="p">[</span><span class="s1">&#39;first_1&#39;</span><span class="p">,</span> <span class="s1">&#39;second_1&#39;</span><span class="p">]</span>
    <span class="k">assert</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">data_io</span><span class="o">.</span><span class="n">fitting_file_name</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">c</span><span class="o">.</span><span class="n">higher1</span><span class="o">.</span><span class="n">inner2</span><span class="o">.</span><span class="n">components</span><span class="p">]</span> <span class="o">==</span> <span class="p">[</span><span class="s1">&#39;first_1_estimator.pk&#39;</span><span class="p">,</span> <span class="s1">&#39;second_1_estimator.pk&#39;</span><span class="p">]</span>
    <span class="k">assert</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">data_io</span><span class="o">.</span><span class="n">result_file_name</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">c</span><span class="o">.</span><span class="n">higher1</span><span class="o">.</span><span class="n">inner2</span><span class="o">.</span><span class="n">components</span><span class="p">]</span> <span class="o">==</span> <span class="p">[</span><span class="s1">&#39;first_1_result.pk&#39;</span><span class="p">,</span> <span class="s1">&#39;second_1_result.pk&#39;</span><span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">tst</span><span class="o">.</span><span class="n">run</span> <span class="p">(</span><span class="n">test_set_root</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="s1">&#39;dummy&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>running test_set_root
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Pass-functions-and-estimators-in-component-list">Pass functions and estimators in component list<a class="anchor-link" href="#Pass-functions-and-estimators-in-component-list"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="test_pass_functions_to_multi_component" class="doc_header"><code>test_pass_functions_to_multi_component</code><a href="https://github.com/Jaume-JCI/ds-blocks/tree/main/dsblocks/tests/core/test_compose.py#L1267" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>test_pass_functions_to_multi_component</code>()</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">dsblocks.utils.dummies</span> <span class="kn">import</span> <span class="n">Sum1</span><span class="p">,</span> <span class="n">DummyEstimator</span>

<span class="k">def</span> <span class="nf">test_pass_functions_to_multi_component</span> <span class="p">():</span>
    <span class="k">def</span> <span class="nf">myf</span> <span class="p">(</span><span class="n">x</span><span class="p">):</span> <span class="k">return</span> <span class="n">x</span><span class="o">*</span><span class="mi">2</span>
    <span class="n">pipe</span> <span class="o">=</span> <span class="n">MultiComponent</span> <span class="p">(</span><span class="n">Sum1</span> <span class="p">(),</span> <span class="n">myf</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">+</span><span class="mi">3</span><span class="p">,</span> <span class="p">(</span><span class="s1">&#39;Minus&#39;</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="n">DummyEstimator</span> <span class="p">()</span> <span class="p">)</span>
    <span class="n">X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span> <span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">])</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">X</span>
    <span class="n">pipe</span><span class="o">.</span><span class="n">components</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">fit</span> <span class="p">(</span><span class="n">X</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">pipe</span><span class="o">.</span><span class="n">components</span><span class="p">:</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">c</span> <span class="p">(</span><span class="n">r</span><span class="p">)</span>
    <span class="k">assert</span> <span class="p">(</span><span class="n">r</span><span class="o">==</span> <span class="p">(</span> <span class="p">((</span><span class="n">X</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="mi">2</span><span class="o">+</span><span class="mi">3</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="mi">3</span><span class="o">+</span><span class="n">X</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="p">))</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
    <span class="n">class_names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Sum1&#39;</span><span class="p">,</span> <span class="s1">&#39;Myf&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;Lambda&gt;&#39;</span><span class="p">,</span> <span class="s1">&#39;Minus&#39;</span><span class="p">,</span> <span class="s1">&#39;DummyEstimator&#39;</span><span class="p">]</span>
    <span class="k">assert</span> <span class="nb">all</span><span class="p">([</span><span class="n">x</span><span class="o">.</span><span class="n">class_name</span><span class="o">==</span><span class="n">y</span> <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">pipe</span><span class="o">.</span><span class="n">components</span><span class="p">,</span> <span class="n">class_names</span><span class="p">)])</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">tst</span><span class="o">.</span><span class="n">run</span> <span class="p">(</span><span class="n">test_pass_functions_to_multi_component</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="s1">&#39;dummy&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>running test_pass_functions_to_multi_component
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="set_suffix">set_suffix<a class="anchor-link" href="#set_suffix"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="test_set_suffix" class="doc_header"><code>test_set_suffix</code><a href="https://github.com/Jaume-JCI/ds-blocks/tree/main/dsblocks/tests/core/test_compose.py#L1280" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>test_set_suffix</code>()</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">test_set_suffix</span> <span class="p">():</span>
    <span class="kn">from</span> <span class="nn">dsblocks.utils.dummies</span> <span class="kn">import</span> <span class="n">Higher</span>

    <span class="n">higher</span> <span class="o">=</span> <span class="n">Higher</span> <span class="p">()</span>
    <span class="k">assert</span> <span class="n">higher</span><span class="o">.</span><span class="n">name</span><span class="o">==</span><span class="s1">&#39;higher&#39;</span>
    <span class="k">assert</span> <span class="n">higher</span><span class="o">.</span><span class="n">first_intermediate</span><span class="o">.</span><span class="n">name</span><span class="o">==</span><span class="s1">&#39;first_intermediate&#39;</span>
    <span class="k">assert</span> <span class="n">higher</span><span class="o">.</span><span class="n">second_intermediate</span><span class="o">.</span><span class="n">name</span><span class="o">==</span><span class="s1">&#39;second_intermediate&#39;</span>
    <span class="k">assert</span> <span class="n">higher</span><span class="o">.</span><span class="n">second_intermediate</span><span class="o">.</span><span class="n">first_component</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;first_component&#39;</span>
    <span class="k">assert</span> <span class="n">higher</span><span class="o">.</span><span class="n">second_intermediate</span><span class="o">.</span><span class="n">second_component</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;second_component&#39;</span>

    <span class="n">higher</span><span class="o">.</span><span class="n">set_suffix</span> <span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">higher</span><span class="o">.</span><span class="n">name</span><span class="o">==</span><span class="s1">&#39;higher_a&#39;</span>
    <span class="k">assert</span> <span class="n">higher</span><span class="o">.</span><span class="n">first_intermediate</span><span class="o">.</span><span class="n">name</span><span class="o">==</span><span class="s1">&#39;first_intermediate_a&#39;</span>
    <span class="k">assert</span> <span class="n">higher</span><span class="o">.</span><span class="n">second_intermediate</span><span class="o">.</span><span class="n">name</span><span class="o">==</span><span class="s1">&#39;second_intermediate_a&#39;</span>
    <span class="k">assert</span> <span class="n">higher</span><span class="o">.</span><span class="n">second_intermediate</span><span class="o">.</span><span class="n">first_component</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;first_component_a&#39;</span>
    <span class="k">assert</span> <span class="n">higher</span><span class="o">.</span><span class="n">second_intermediate</span><span class="o">.</span><span class="n">second_component</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;second_component_a&#39;</span>

    <span class="n">higher</span><span class="o">.</span><span class="n">set_suffix</span> <span class="p">(</span><span class="s1">&#39;b&#39;</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">higher</span><span class="o">.</span><span class="n">name</span><span class="o">==</span><span class="s1">&#39;higher_b&#39;</span>
    <span class="k">assert</span> <span class="n">higher</span><span class="o">.</span><span class="n">first_intermediate</span><span class="o">.</span><span class="n">name</span><span class="o">==</span><span class="s1">&#39;first_intermediate_b&#39;</span>
    <span class="k">assert</span> <span class="n">higher</span><span class="o">.</span><span class="n">second_intermediate</span><span class="o">.</span><span class="n">name</span><span class="o">==</span><span class="s1">&#39;second_intermediate_b&#39;</span>
    <span class="k">assert</span> <span class="n">higher</span><span class="o">.</span><span class="n">second_intermediate</span><span class="o">.</span><span class="n">first_component</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;first_component_b&#39;</span>
    <span class="k">assert</span> <span class="n">higher</span><span class="o">.</span><span class="n">second_intermediate</span><span class="o">.</span><span class="n">second_component</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;second_component_b&#39;</span>

    <span class="n">higher</span><span class="o">.</span><span class="n">set_suffix</span> <span class="p">(</span><span class="s1">&#39;c&#39;</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">higher</span><span class="o">.</span><span class="n">name</span><span class="o">==</span><span class="s1">&#39;higher_c&#39;</span>
    <span class="k">assert</span> <span class="n">higher</span><span class="o">.</span><span class="n">first_intermediate</span><span class="o">.</span><span class="n">name</span><span class="o">==</span><span class="s1">&#39;first_intermediate_c&#39;</span>
    <span class="k">assert</span> <span class="n">higher</span><span class="o">.</span><span class="n">second_intermediate</span><span class="o">.</span><span class="n">name</span><span class="o">==</span><span class="s1">&#39;second_intermediate_c&#39;</span>
    <span class="k">assert</span> <span class="n">higher</span><span class="o">.</span><span class="n">second_intermediate</span><span class="o">.</span><span class="n">first_component</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;first_component_c&#39;</span>
    <span class="k">assert</span> <span class="n">higher</span><span class="o">.</span><span class="n">second_intermediate</span><span class="o">.</span><span class="n">second_component</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;second_component_c&#39;</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">tst</span><span class="o">.</span><span class="n">run</span> <span class="p">(</span><span class="n">test_set_suffix</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="s1">&#39;dummy&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>running test_set_suffix
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Pipeline-/-Sequential">Pipeline / Sequential<a class="anchor-link" href="#Pipeline-/-Sequential"> </a></h2>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="Pipeline" class="doc_header"><code>class</code> <code>Pipeline</code><a href="https://github.com/Jaume-JCI/ds-blocks/tree/main/dsblocks/core/compose.py#L546" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>Pipeline</code>(<strong>*<code>components</code></strong>, <strong>**<code>kwargs</code></strong>) :: <a href="/compose.html#MultiComponent"><code>MultiComponent</code></a></p>
</blockquote>

<pre><code>Pipeline composed of a list of components that run sequentially.

During training, the components of the list are trained one after the other,
where one component is fed the result of transforming the data with the list
of components located before in the pipeline.

The `Pipeline` class is a subclass of `SamplingComponent`, which itself is a
subclass of `Component`. This provides the functionality of `Component`
to any implemented pipeline, such as logging the messages, loading / saving the
results, and convert the data format so that it can work as part of other
pipelines with potentially other data formats.

Being a subclass of `SamplingComponent`, the `transform` method
receives an input data  `X` that contains both data and labels.

Furthermore, the Pipeline constructor sets `separate_labels=False` by default,
which means that the `fit` method also receives an input data `X` that contains
not only data but also labels. This is necessary because some of the components in
the pipeline might be of class `SamplingComponent`, and such components
need the input data `X` to contain labels when calling `transform` (and note that
this method is called when calling `fit` on a pipeline, since we do `fit_transform`
on all the components except for the last one)</code></pre>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Simple-pipeline-example">Simple pipeline example<a class="anchor-link" href="#Simple-pipeline-example"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="Transform1" class="doc_header"><code>class</code> <code>Transform1</code><a href="https://github.com/Jaume-JCI/ds-blocks/tree/main/dsblocks/tests/core/test_compose.py#L1312" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>Transform1</code>(<strong>**<code>kwargs</code></strong>) :: <a href="/components.html#Component"><code>Component</code></a></p>
</blockquote>

<pre><code>Base component class used in our Pipeline.</code></pre>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="Transform2" class="doc_header"><code>class</code> <code>Transform2</code><a href="https://github.com/Jaume-JCI/ds-blocks/tree/main/dsblocks/tests/core/test_compose.py#L1324" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>Transform2</code>(<strong>**<code>kwargs</code></strong>) :: <a href="/components.html#Component"><code>Component</code></a></p>
</blockquote>

<pre><code>Base component class used in our Pipeline.</code></pre>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="SimplePipeline" class="doc_header"><code>class</code> <code>SimplePipeline</code><a href="https://github.com/Jaume-JCI/ds-blocks/tree/main/dsblocks/tests/core/test_compose.py#L1336" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>SimplePipeline</code>(<strong>**<code>kwargs</code></strong>) :: <a href="/compose.html#Pipeline"><code>Pipeline</code></a></p>
</blockquote>

<pre><code>Pipeline composed of a list of components that run sequentially.

During training, the components of the list are trained one after the other,
where one component is fed the result of transforming the data with the list
of components located before in the pipeline.

The `Pipeline` class is a subclass of `SamplingComponent`, which itself is a
subclass of `Component`. This provides the functionality of `Component`
to any implemented pipeline, such as logging the messages, loading / saving the
results, and convert the data format so that it can work as part of other
pipelines with potentially other data formats.

Being a subclass of `SamplingComponent`, the `transform` method
receives an input data  `X` that contains both data and labels.

Furthermore, the Pipeline constructor sets `separate_labels=False` by default,
which means that the `fit` method also receives an input data `X` that contains
not only data but also labels. This is necessary because some of the components in
the pipeline might be of class `SamplingComponent`, and such components
need the input data `X` to contain labels when calling `transform` (and note that
this method is called when calling `fit` on a pipeline, since we do `fit_transform`
on all the components except for the last one)</code></pre>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">class</span> <span class="nc">Transform1</span> <span class="p">(</span><span class="n">Component</span><span class="p">):</span>

    <span class="k">def</span> <span class="fm">__init__</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span> <span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">estimator</span> <span class="o">=</span> <span class="n">Bunch</span><span class="p">(</span><span class="nb">sum</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_fit</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">estimator</span><span class="o">.</span><span class="n">sum</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_apply</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">x</span><span class="o">*</span><span class="mi">1000</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">estimator</span><span class="o">.</span><span class="n">sum</span>

<span class="k">class</span> <span class="nc">Transform2</span> <span class="p">(</span><span class="n">Component</span><span class="p">):</span>

    <span class="k">def</span> <span class="fm">__init__</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span> <span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">estimator</span> <span class="o">=</span> <span class="n">Bunch</span><span class="p">(</span><span class="n">maxim</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_fit</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">estimator</span><span class="o">.</span><span class="n">maxim</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_apply</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">x</span><span class="o">*</span><span class="mi">100</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">estimator</span><span class="o">.</span><span class="n">maxim</span>
    
<span class="k">class</span> <span class="nc">SimplePipeline</span> <span class="p">(</span><span class="n">Pipeline</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span> <span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="c1"># custom transform</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tr1</span> <span class="o">=</span> <span class="n">Transform1</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> 

        <span class="c1"># slklearn transform</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tr2</span> <span class="o">=</span> <span class="n">Transform2</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Tests-for-fit_apply-method">Tests for <code>fit_apply</code> method<a class="anchor-link" href="#Tests-for-fit_apply-method"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="test_pipeline_fit_apply" class="doc_header"><code>test_pipeline_fit_apply</code><a href="https://github.com/Jaume-JCI/ds-blocks/tree/main/dsblocks/tests/core/test_compose.py#L1348" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>test_pipeline_fit_apply</code>()</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1">#@pytest.mark.reference_fails</span>
<span class="k">def</span> <span class="nf">test_pipeline_fit_apply</span> <span class="p">():</span>
    <span class="c1"># test `fit_apply` method</span>
    <span class="n">pipeline</span> <span class="o">=</span> <span class="n">SimplePipeline</span><span class="p">()</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">])</span>
    <span class="n">r1</span> <span class="o">=</span> <span class="n">pipeline</span><span class="o">.</span><span class="n">fit_apply</span> <span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>
    <span class="nb">print</span> <span class="p">(</span><span class="n">r1</span><span class="p">)</span>

    <span class="n">x1</span> <span class="o">=</span> <span class="n">x</span> <span class="o">*</span> <span class="mi">1000</span> <span class="o">+</span> <span class="nb">sum</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="n">x2</span> <span class="o">=</span> <span class="n">x1</span> <span class="o">*</span> <span class="mi">100</span> <span class="o">+</span> <span class="nb">max</span><span class="p">(</span><span class="n">x1</span><span class="p">)</span>
    <span class="k">assert</span> <span class="p">(</span><span class="n">r1</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span><span class="o">==</span><span class="n">x2</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
    
    <span class="c1"># *********************************</span>
    <span class="c1"># Another way of building a pipeline</span>
    <span class="c1"># *********************************</span>
    <span class="n">pipeline</span> <span class="o">=</span> <span class="n">Sequential</span> <span class="p">(</span><span class="n">Transform1</span><span class="p">(),</span> 
                           <span class="n">Transform2</span><span class="p">())</span>

    <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">])</span>
    <span class="n">r1</span> <span class="o">=</span> <span class="n">pipeline</span><span class="o">.</span><span class="n">fit_apply</span> <span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>

    <span class="n">x1</span> <span class="o">=</span> <span class="n">x</span> <span class="o">*</span> <span class="mi">1000</span> <span class="o">+</span> <span class="nb">sum</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="n">x2</span> <span class="o">=</span> <span class="n">x1</span> <span class="o">*</span> <span class="mi">100</span> <span class="o">+</span> <span class="nb">max</span><span class="p">(</span><span class="n">x1</span><span class="p">)</span>
    <span class="k">assert</span> <span class="p">(</span><span class="n">r1</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span><span class="o">==</span><span class="n">x2</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">tst</span><span class="o">.</span><span class="n">run</span> <span class="p">(</span><span class="n">test_pipeline_fit_apply</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="s1">&#39;dummy&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>running test_pipeline_fit_apply
[[306212]
 [406212]
 [506212]]
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="Second-example">Second example<a class="anchor-link" href="#Second-example"> </a></h4>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="test_pipeline_fit_apply_bis" class="doc_header"><code>test_pipeline_fit_apply_bis</code><a href="https://github.com/Jaume-JCI/ds-blocks/tree/main/dsblocks/tests/core/test_compose.py#L1374" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>test_pipeline_fit_apply_bis</code>()</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1">#@pytest.mark.reference_fails</span>
<span class="k">def</span> <span class="nf">test_pipeline_fit_apply_bis</span> <span class="p">():</span>
    <span class="c1"># test `fit_apply` method</span>
    <span class="k">class</span> <span class="nc">NewMulti</span> <span class="p">(</span><span class="n">MultiComponent</span><span class="p">):</span>

        <span class="k">def</span> <span class="fm">__init__</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
            <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span> <span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

            <span class="c1"># custom transform</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tr1</span> <span class="o">=</span> <span class="n">Transform1</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> 

            <span class="c1"># slklearn transform</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tr2</span> <span class="o">=</span> <span class="n">Transform2</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> 

        <span class="k">def</span> <span class="nf">_fit</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tr1</span><span class="o">.</span><span class="n">fit</span> <span class="p">(</span><span class="n">X</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tr2</span><span class="o">.</span><span class="n">fit</span> <span class="p">(</span><span class="n">X</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">_apply</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
            <span class="n">X1</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">tr1</span><span class="o">.</span><span class="n">apply</span> <span class="p">(</span><span class="n">X</span><span class="p">)</span>
            <span class="n">X2</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">tr2</span><span class="o">.</span><span class="n">apply</span> <span class="p">(</span><span class="n">X</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">X1</span><span class="o">+</span><span class="n">X2</span>

    <span class="n">new_multi</span> <span class="o">=</span> <span class="n">NewMulti</span><span class="p">()</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">])</span>
    <span class="n">r2</span> <span class="o">=</span> <span class="n">new_multi</span><span class="o">.</span><span class="n">fit_apply</span> <span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="nb">print</span> <span class="p">(</span><span class="n">r2</span><span class="p">)</span>
    
    <span class="n">x2b</span> <span class="o">=</span> <span class="mi">100</span> <span class="o">*</span> <span class="n">x</span> <span class="o">+</span> <span class="nb">max</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="n">x1</span> <span class="o">=</span> <span class="n">x</span> <span class="o">*</span> <span class="mi">1000</span> <span class="o">+</span> <span class="nb">sum</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="k">assert</span> <span class="p">(</span><span class="n">r2</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span><span class="o">==</span><span class="p">(</span><span class="n">x1</span> <span class="o">+</span> <span class="n">x2b</span><span class="p">))</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">tst</span><span class="o">.</span><span class="n">run</span> <span class="p">(</span><span class="n">test_pipeline_fit_apply_bis</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="s1">&#39;dummy&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>running test_pipeline_fit_apply_bis
[3317 4417 5517]
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Adding-new-components-to-pipeline">Adding new components to pipeline<a class="anchor-link" href="#Adding-new-components-to-pipeline"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="test_pipeline_new_comp" class="doc_header"><code>test_pipeline_new_comp</code><a href="https://github.com/Jaume-JCI/ds-blocks/tree/main/dsblocks/tests/core/test_compose.py#L1407" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>test_pipeline_new_comp</code>()</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1">#@pytest.mark.reference_fails</span>
<span class="k">def</span> <span class="nf">test_pipeline_new_comp</span> <span class="p">():</span>
    <span class="c1"># test automatic creation of pipeline components</span>

    <span class="c1"># 1. by setting components as attributes:</span>
    <span class="k">class</span> <span class="nc">NewPipeline</span><span class="p">(</span><span class="n">Pipeline</span><span class="p">):</span>
        <span class="k">def</span> <span class="fm">__init__</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
            <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tr1</span> <span class="o">=</span> <span class="n">Component</span><span class="p">(</span><span class="n">FunctionTransformer</span> <span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tr2</span> <span class="o">=</span> <span class="n">Component</span><span class="p">(</span><span class="n">FunctionTransformer</span> <span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">*</span><span class="mi">2</span><span class="p">))</span>
    <span class="n">pipeline</span> <span class="o">=</span> <span class="n">NewPipeline</span><span class="p">()</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">pipeline</span><span class="o">.</span><span class="n">transform</span> <span class="p">(</span><span class="mi">3</span><span class="p">)</span>
    <span class="nb">print</span> <span class="p">(</span><span class="n">result</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">result</span> <span class="o">==</span> <span class="mi">8</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">tst</span><span class="o">.</span><span class="n">run</span> <span class="p">(</span><span class="n">test_pipeline_new_comp</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="s1">&#39;dummy&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>running test_pipeline_new_comp
8
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="test_pipeline_set_comp" class="doc_header"><code>test_pipeline_set_comp</code><a href="https://github.com/Jaume-JCI/ds-blocks/tree/main/dsblocks/tests/core/test_compose.py#L1423" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>test_pipeline_set_comp</code>()</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1">#@pytest.mark.reference_fails</span>
<span class="k">def</span> <span class="nf">test_pipeline_set_comp</span> <span class="p">():</span>
    <span class="c1">#2. by using `set_components`</span>
    <span class="k">class</span> <span class="nc">NewPipeline</span><span class="p">(</span><span class="n">Pipeline</span><span class="p">):</span>
        <span class="k">def</span> <span class="fm">__init__</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
            <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="n">tr1</span> <span class="o">=</span> <span class="n">Component</span><span class="p">(</span><span class="n">FunctionTransformer</span> <span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span>
            <span class="n">tr2</span> <span class="o">=</span> <span class="n">Component</span><span class="p">(</span><span class="n">FunctionTransformer</span> <span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">*</span><span class="mi">2</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_components</span> <span class="p">(</span><span class="n">tr1</span><span class="p">,</span> <span class="n">tr2</span><span class="p">)</span>

            <span class="c1"># the following transform is not added to the pipeline component list:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tr3</span> <span class="o">=</span> <span class="n">Component</span><span class="p">(</span><span class="n">FunctionTransformer</span> <span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span>

            <span class="c1"># The reason is that once set_components is called, the component list </span>
            <span class="c1"># is frozen and inmutable setting new components by attribute doesn&#39;t </span>
            <span class="c1"># result in adding them to the component list</span>

    <span class="n">pipeline</span> <span class="o">=</span> <span class="n">NewPipeline</span><span class="p">()</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">pipeline</span><span class="o">.</span><span class="n">transform</span> <span class="p">(</span><span class="mi">3</span><span class="p">)</span>

    <span class="k">assert</span> <span class="n">result</span> <span class="o">==</span> <span class="mi">8</span>
    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">pipeline</span><span class="o">.</span><span class="n">components</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span>
    <span class="nb">print</span> <span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">pipeline</span><span class="o">.</span><span class="n">components</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">tst</span><span class="o">.</span><span class="n">run</span> <span class="p">(</span><span class="n">test_pipeline_set_comp</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="s1">&#39;dummy&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>running test_pipeline_set_comp
8 2
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="test_athena_pipeline_training" class="doc_header"><code>test_athena_pipeline_training</code><a href="https://github.com/Jaume-JCI/ds-blocks/tree/main/dsblocks/tests/core/test_compose.py#L1448" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>test_athena_pipeline_training</code>()</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1">#@pytest.mark.reference_fails</span>
<span class="k">def</span> <span class="nf">test_athena_pipeline_training</span> <span class="p">():</span>
<span class="c1">#3. after calling `set_components()`, we can add new components with `add_component()`</span>
    <span class="k">class</span> <span class="nc">NewPipeline</span><span class="p">(</span><span class="n">Pipeline</span><span class="p">):</span>
        <span class="k">def</span> <span class="fm">__init__</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
            <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="n">tr1</span> <span class="o">=</span> <span class="n">Component</span><span class="p">(</span><span class="n">FunctionTransformer</span> <span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span>
            <span class="n">tr2</span> <span class="o">=</span> <span class="n">Component</span><span class="p">(</span><span class="n">FunctionTransformer</span> <span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">*</span><span class="mi">2</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_components</span> <span class="p">(</span><span class="n">tr1</span><span class="p">,</span> <span class="n">tr2</span><span class="p">)</span>

            <span class="n">tr3</span> <span class="o">=</span> <span class="n">Component</span><span class="p">(</span><span class="n">FunctionTransformer</span> <span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">+</span><span class="mi">2</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add_component</span><span class="p">(</span><span class="n">tr3</span><span class="p">)</span>

    <span class="n">pipeline</span> <span class="o">=</span> <span class="n">NewPipeline</span><span class="p">()</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">pipeline</span><span class="o">.</span><span class="n">transform</span> <span class="p">(</span><span class="mi">3</span><span class="p">)</span>

    <span class="k">assert</span> <span class="n">result</span> <span class="o">==</span> <span class="mi">10</span>
    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">pipeline</span><span class="o">.</span><span class="n">components</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span>
    <span class="nb">print</span> <span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">pipeline</span><span class="o">.</span><span class="n">components</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">tst</span><span class="o">.</span><span class="n">run</span> <span class="p">(</span><span class="n">test_athena_pipeline_training</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="s1">&#39;dummy&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>running test_athena_pipeline_training
10 3
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Tests-for-load_estimator-method">Tests for <code>load_estimator</code> method<a class="anchor-link" href="#Tests-for-load_estimator-method"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="test_pipeline_load_estimator" class="doc_header"><code>test_pipeline_load_estimator</code><a href="https://github.com/Jaume-JCI/ds-blocks/tree/main/dsblocks/tests/core/test_compose.py#L1469" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>test_pipeline_load_estimator</code>()</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1">#@pytest.mark.reference_fails</span>
<span class="k">def</span> <span class="nf">test_pipeline_load_estimator</span> <span class="p">():</span>
    <span class="c1"># test `load_estimator` method</span>

    <span class="c1"># Transform1: custom Transform</span>
    <span class="k">class</span> <span class="nc">Transform1</span> <span class="p">(</span><span class="n">PickleSaverComponent</span><span class="p">):</span>

        <span class="k">def</span> <span class="fm">__init__</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
            <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span> <span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">estimator</span><span class="o">=</span> <span class="n">Bunch</span><span class="p">(</span><span class="n">inv_c</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">_fit</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">estimator</span><span class="o">.</span><span class="n">inv_c</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">ravel</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>

        <span class="k">def</span> <span class="nf">_apply</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">x</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">estimator</span><span class="o">.</span><span class="n">inv_c</span>

    <span class="k">class</span> <span class="nc">NewPipeline</span> <span class="p">(</span><span class="n">Pipeline</span><span class="p">):</span>

        <span class="k">def</span> <span class="fm">__init__</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
            <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span> <span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

            <span class="c1"># custom transform</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tr1</span> <span class="o">=</span> <span class="n">Transform1</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> 

            <span class="c1"># slklearn transform</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tr2</span> <span class="o">=</span> <span class="n">PickleSaverComponent</span><span class="p">(</span><span class="n">StandardScaler</span><span class="p">(),</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">_fit</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tr1</span><span class="o">.</span><span class="n">fit</span> <span class="p">(</span><span class="n">X</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tr2</span><span class="o">.</span><span class="n">fit</span> <span class="p">(</span><span class="n">X</span><span class="p">)</span>

    <span class="c1"># remove any previously stored </span>
    <span class="n">path_results</span> <span class="o">=</span> <span class="s1">&#39;pipeline_loading_saving&#39;</span>
    <span class="n">remove_previous_results</span> <span class="p">(</span><span class="n">path_results</span><span class="o">=</span><span class="n">path_results</span><span class="p">)</span>

    <span class="n">pipeline</span> <span class="o">=</span> <span class="n">NewPipeline</span><span class="p">(</span><span class="n">path_results</span><span class="o">=</span><span class="n">path_results</span><span class="p">,</span> <span class="n">save_test_result</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">pipeline</span><span class="o">.</span><span class="n">fit</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">])</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>
    <span class="n">result1</span> <span class="o">=</span> <span class="n">pipeline</span><span class="o">.</span><span class="n">transform</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">300</span><span class="p">,</span><span class="mi">400</span><span class="p">,</span><span class="mi">500</span><span class="p">])</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>
    <span class="nb">print</span> <span class="p">(</span><span class="n">pipeline</span><span class="o">.</span><span class="n">tr2</span><span class="o">.</span><span class="n">estimator</span><span class="o">.</span><span class="n">mean_</span><span class="p">)</span>

    <span class="k">del</span> <span class="n">pipeline</span> 
    <span class="n">pipeline</span> <span class="o">=</span> <span class="n">NewPipeline</span><span class="p">(</span><span class="n">path_results</span><span class="o">=</span><span class="n">path_results</span><span class="p">,</span> <span class="n">save_test_result</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">pipeline</span><span class="o">.</span><span class="n">load_estimator</span> <span class="p">()</span>
    <span class="nb">print</span> <span class="p">(</span><span class="n">pipeline</span><span class="o">.</span><span class="n">tr2</span><span class="o">.</span><span class="n">estimator</span><span class="o">.</span><span class="n">mean_</span><span class="p">)</span>
    <span class="n">result2</span> <span class="o">=</span> <span class="n">pipeline</span><span class="o">.</span><span class="n">transform</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">300</span><span class="p">,</span><span class="mi">400</span><span class="p">,</span><span class="mi">500</span><span class="p">])</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>

    <span class="n">np</span><span class="o">.</span><span class="n">testing</span><span class="o">.</span><span class="n">assert_array_equal</span> <span class="p">(</span><span class="n">result1</span><span class="p">,</span> <span class="n">result2</span><span class="p">)</span>

    <span class="c1"># remove stored files resulting from running the current test</span>
    <span class="n">remove_previous_results</span> <span class="p">(</span><span class="n">path_results</span><span class="o">=</span><span class="n">path_results</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">tst</span><span class="o">.</span><span class="n">run</span> <span class="p">(</span><span class="n">test_pipeline_load_estimator</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="s1">&#39;dummy&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>running test_pipeline_load_estimator
[4.]
[4.]
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="construct_diagram">construct_diagram<a class="anchor-link" href="#construct_diagram"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="build_pipeline_construct_diagram_1" class="doc_header"><code>build_pipeline_construct_diagram_1</code><a href="https://github.com/Jaume-JCI/ds-blocks/tree/main/dsblocks/tests/core/test_compose.py#L1523" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>build_pipeline_construct_diagram_1</code>(<strong><code>path_results</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="build_pipeline_construct_diagram_2" class="doc_header"><code>build_pipeline_construct_diagram_2</code><a href="https://github.com/Jaume-JCI/ds-blocks/tree/main/dsblocks/tests/core/test_compose.py#L1540" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>build_pipeline_construct_diagram_2</code>(<strong><code>path_results</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="test_construct_diagram" class="doc_header"><code>test_construct_diagram</code><a href="https://github.com/Jaume-JCI/ds-blocks/tree/main/dsblocks/tests/core/test_compose.py#L1560" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>test_construct_diagram</code>()</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1">#@pytest.mark.reference_fails</span>

<span class="k">def</span> <span class="nf">build_pipeline_construct_diagram_1</span> <span class="p">(</span><span class="n">path_results</span><span class="p">):</span>
    <span class="k">class</span> <span class="nc">Intermediate</span> <span class="p">(</span><span class="n">MultiComponent</span><span class="p">):</span>
        <span class="k">def</span> <span class="fm">__init__</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
            <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span> <span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">first</span> <span class="o">=</span> <span class="n">Component</span> <span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;first_component&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">second</span> <span class="o">=</span> <span class="n">Component</span> <span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;second_component&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">class</span> <span class="nc">Higher</span> <span class="p">(</span><span class="n">Pipeline</span><span class="p">):</span>
        <span class="k">def</span> <span class="fm">__init__</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
            <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span> <span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">first</span> <span class="o">=</span> <span class="n">Intermediate</span> <span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;first_intermediate&#39;</span><span class="p">,</span> <span class="n">class_name</span><span class="o">=</span><span class="s1">&#39;First&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">second</span> <span class="o">=</span> <span class="n">Intermediate</span> <span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;second_intermediate&#39;</span><span class="p">,</span> <span class="n">class_name</span><span class="o">=</span><span class="s1">&#39;Second&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="n">pipeline</span> <span class="o">=</span> <span class="n">Higher</span><span class="p">(</span><span class="n">path_results</span><span class="o">=</span><span class="n">path_results</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">pipeline</span>

<span class="k">def</span> <span class="nf">build_pipeline_construct_diagram_2</span> <span class="p">(</span><span class="n">path_results</span><span class="p">):</span>
    <span class="k">class</span> <span class="nc">NewPipeline</span> <span class="p">(</span><span class="n">Pipeline</span><span class="p">):</span>
        <span class="k">def</span> <span class="fm">__init__</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
            <span class="n">data_io</span> <span class="o">=</span> <span class="n">PickleIO</span> <span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">data_io</span><span class="o">=</span><span class="n">data_io</span><span class="p">,</span>
                             <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">tr1</span> <span class="o">=</span> <span class="n">Component</span><span class="p">(</span><span class="n">FunctionTransformer</span> <span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">*</span><span class="mi">3</span><span class="p">),</span>
                                 <span class="n">data_io</span><span class="o">=</span><span class="n">data_io</span><span class="p">,</span>
                                 <span class="n">class_name</span><span class="o">=</span><span class="s1">&#39;FirstTransform&#39;</span><span class="p">,</span>
                                 <span class="n">name</span><span class="o">=</span><span class="s1">&#39;tr1&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tr2</span> <span class="o">=</span> <span class="n">Component</span><span class="p">(</span><span class="n">FunctionTransformer</span> <span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">*</span><span class="mi">2</span><span class="p">),</span>
                                 <span class="n">data_io</span><span class="o">=</span><span class="n">data_io</span><span class="p">,</span>
                                 <span class="n">class_name</span><span class="o">=</span><span class="s1">&#39;SecondTransform&#39;</span><span class="p">,</span>
                                 <span class="n">name</span><span class="o">=</span><span class="s1">&#39;tr2&#39;</span><span class="p">)</span>
            
    <span class="n">pipeline</span> <span class="o">=</span> <span class="n">NewPipeline</span> <span class="p">(</span><span class="n">path_results</span><span class="o">=</span><span class="n">path_results</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">pipeline</span>

<span class="k">def</span> <span class="nf">test_construct_diagram</span> <span class="p">():</span>
    <span class="n">path_results</span> <span class="o">=</span> <span class="s1">&#39;construct_diagram&#39;</span>
    <span class="n">remove_previous_results</span> <span class="p">(</span><span class="n">path_results</span><span class="o">=</span><span class="n">path_results</span><span class="p">)</span>

    <span class="c1"># ********************************************</span>
    <span class="c1"># example without dimensionality of outputs</span>
    <span class="c1"># ********************************************</span>
    <span class="n">pipeline</span> <span class="o">=</span> <span class="n">build_pipeline_construct_diagram_1</span> <span class="p">(</span><span class="n">path_results</span><span class="p">)</span>
    <span class="n">diagram</span> <span class="o">=</span> <span class="n">pipeline</span><span class="o">.</span><span class="n">construct_diagram</span> <span class="p">()</span>
    <span class="n">display</span> <span class="p">(</span><span class="n">diagram</span><span class="p">)</span>
    
    <span class="c1"># ********************************************</span>
    <span class="c1"># example that shows dimensionality of outputs</span>
    <span class="c1"># ********************************************</span>
    <span class="n">pipeline</span> <span class="o">=</span> <span class="n">build_pipeline_construct_diagram_2</span> <span class="p">(</span><span class="n">path_results</span><span class="p">)</span>
    <span class="n">X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">])</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">pipeline</span> <span class="p">(</span><span class="n">X</span><span class="p">)</span>

    <span class="n">diagram</span> <span class="o">=</span> <span class="n">pipeline</span><span class="o">.</span><span class="n">construct_diagram</span> <span class="p">()</span>
    <span class="n">display</span> <span class="p">(</span><span class="n">diagram</span><span class="p">)</span>
    
    <span class="n">remove_previous_results</span> <span class="p">(</span><span class="n">path_results</span><span class="o">=</span><span class="n">path_results</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">tst</span><span class="o">.</span><span class="n">run</span> <span class="p">(</span><span class="n">test_construct_diagram</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="s1">&#39;dummy&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>running test_construct_diagram
</pre>
</div>
</div>

<div class="output_area">


<div class="output_svg output_subarea ">
<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: G Pages: 1 -->
<svg width="96pt" height="322pt"
 viewBox="0.00 0.00 96.15 321.99" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 317.9896)">
<title>G</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-317.9896 92.1471,-317.9896 92.1471,4 -4,4"/>
<!-- data -->
<g id="node1" class="node">
<title>data</title>
<ellipse fill="none" stroke="#000000" cx="33.1471" cy="-288.6419" rx="25.1964" ry="25.1964"/>
<text text-anchor="middle" x="33.1471" y="-284.9419" font-family="Times,serif" font-size="14.00" fill="#000000">data</text>
</g>
<!-- First -->
<g id="node2" class="node">
<title>First</title>
<polygon fill="none" stroke="#000000" points="60.1471,-212.2941 6.1471,-212.2941 6.1471,-176.2941 60.1471,-176.2941 60.1471,-212.2941"/>
<text text-anchor="middle" x="33.1471" y="-190.5941" font-family="Times,serif" font-size="14.00" fill="#000000">First</text>
</g>
<!-- data&#45;&gt;First -->
<g id="edge1" class="edge">
<title>data&#45;&gt;First</title>
<path fill="none" stroke="#000000" d="M33.1471,-262.8609C33.1471,-250.4145 33.1471,-235.4473 33.1471,-222.6765"/>
<polygon fill="#000000" stroke="#000000" points="36.6472,-222.5692 33.1471,-212.5692 29.6472,-222.5692 36.6472,-222.5692"/>
<text text-anchor="middle" x="60.6471" y="-234.0941" font-family="Times,serif" font-size="14.00" fill="#000000">train / test</text>
</g>
<!-- Second -->
<g id="node3" class="node">
<title>Second</title>
<polygon fill="none" stroke="#000000" points="61.1471,-139.2941 5.1471,-139.2941 5.1471,-103.2941 61.1471,-103.2941 61.1471,-139.2941"/>
<text text-anchor="middle" x="33.1471" y="-117.5941" font-family="Times,serif" font-size="14.00" fill="#000000">Second</text>
</g>
<!-- First&#45;&gt;Second -->
<g id="edge2" class="edge">
<title>First&#45;&gt;Second</title>
<path fill="none" stroke="#000000" d="M33.1471,-176.2492C33.1471,-168.177 33.1471,-158.4705 33.1471,-149.4759"/>
<polygon fill="#000000" stroke="#000000" points="36.6472,-149.3844 33.1471,-139.3845 29.6472,-149.3845 36.6472,-149.3844"/>
</g>
<!-- output -->
<g id="node4" class="node">
<title>output</title>
<ellipse fill="none" stroke="#000000" cx="33.1471" cy="-33.1471" rx="33.2948" ry="33.2948"/>
<text text-anchor="middle" x="33.1471" y="-29.4471" font-family="Times,serif" font-size="14.00" fill="#000000">output</text>
</g>
<!-- Second&#45;&gt;output -->
<g id="edge3" class="edge">
<title>Second&#45;&gt;output</title>
<path fill="none" stroke="#000000" d="M33.1471,-103.03C33.1471,-95.2531 33.1471,-85.821 33.1471,-76.4362"/>
<polygon fill="#000000" stroke="#000000" points="36.6472,-76.3519 33.1471,-66.352 29.6472,-76.352 36.6472,-76.3519"/>
</g>
</g>
</svg>

</div>

</div>

<div class="output_area">


<div class="output_svg output_subarea ">
<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: G Pages: 1 -->
<svg width="122pt" height="350pt"
 viewBox="0.00 0.00 122.00 349.99" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 345.9896)">
<title>G</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-345.9896 118,-345.9896 118,4 -4,4"/>
<!-- data -->
<g id="node1" class="node">
<title>data</title>
<ellipse fill="none" stroke="#000000" cx="57" cy="-316.6419" rx="25.1964" ry="25.1964"/>
<text text-anchor="middle" x="57" y="-312.9419" font-family="Times,serif" font-size="14.00" fill="#000000">data</text>
</g>
<!-- FirstTransform -->
<g id="node2" class="node">
<title>FirstTransform</title>
<polygon fill="none" stroke="#000000" points="106.5,-240.2941 7.5,-240.2941 7.5,-204.2941 106.5,-204.2941 106.5,-240.2941"/>
<text text-anchor="middle" x="57" y="-218.5941" font-family="Times,serif" font-size="14.00" fill="#000000">FirstTransform</text>
</g>
<!-- data&#45;&gt;FirstTransform -->
<g id="edge1" class="edge">
<title>data&#45;&gt;FirstTransform</title>
<path fill="none" stroke="#000000" d="M57,-290.8609C57,-278.4145 57,-263.4473 57,-250.6765"/>
<polygon fill="#000000" stroke="#000000" points="60.5001,-250.5692 57,-240.5692 53.5001,-250.5692 60.5001,-250.5692"/>
<text text-anchor="middle" x="84.5" y="-262.0941" font-family="Times,serif" font-size="14.00" fill="#000000">train / test</text>
</g>
<!-- SecondTransform -->
<g id="node3" class="node">
<title>SecondTransform</title>
<polygon fill="none" stroke="#000000" points="114,-153.2941 0,-153.2941 0,-117.2941 114,-117.2941 114,-153.2941"/>
<text text-anchor="middle" x="57" y="-131.5941" font-family="Times,serif" font-size="14.00" fill="#000000">SecondTransform</text>
</g>
<!-- FirstTransform&#45;&gt;SecondTransform -->
<g id="edge2" class="edge">
<title>FirstTransform&#45;&gt;SecondTransform</title>
<path fill="none" stroke="#000000" d="M57,-204.2677C57,-192.4859 57,-176.8548 57,-163.4522"/>
<polygon fill="#000000" stroke="#000000" points="60.5001,-163.2974 57,-153.2975 53.5001,-163.2975 60.5001,-163.2974"/>
<text text-anchor="middle" x="69" y="-175.0941" font-family="Times,serif" font-size="14.00" fill="#000000"> (3,)</text>
</g>
<!-- output -->
<g id="node4" class="node">
<title>output</title>
<ellipse fill="none" stroke="#000000" cx="57" cy="-33.1471" rx="33.2948" ry="33.2948"/>
<text text-anchor="middle" x="57" y="-29.4471" font-family="Times,serif" font-size="14.00" fill="#000000">output</text>
</g>
<!-- SecondTransform&#45;&gt;output -->
<g id="edge3" class="edge">
<title>SecondTransform&#45;&gt;output</title>
<path fill="none" stroke="#000000" d="M57,-117.0323C57,-105.7651 57,-90.8033 57,-76.6375"/>
<polygon fill="#000000" stroke="#000000" points="60.5001,-76.5275 57,-66.5276 53.5001,-76.5276 60.5001,-76.5275"/>
<text text-anchor="middle" x="69" y="-88.0941" font-family="Times,serif" font-size="14.00" fill="#000000"> (3,)</text>
</g>
</g>
</svg>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="show_summary">show_summary<a class="anchor-link" href="#show_summary"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="test_show_summary" class="doc_header"><code>test_show_summary</code><a href="https://github.com/Jaume-JCI/ds-blocks/tree/main/dsblocks/tests/core/test_compose.py#L1585" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>test_show_summary</code>()</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1">#@pytest.mark.reference_fails</span>
<span class="k">def</span> <span class="nf">test_show_summary</span> <span class="p">():</span>
    <span class="n">path_results</span> <span class="o">=</span> <span class="s1">&#39;show_summary&#39;</span>
    <span class="n">remove_previous_results</span> <span class="p">(</span><span class="n">path_results</span><span class="o">=</span><span class="n">path_results</span><span class="p">)</span>

    <span class="n">pipeline</span> <span class="o">=</span> <span class="n">build_pipeline_construct_diagram_2</span> <span class="p">(</span><span class="n">path_results</span><span class="p">)</span>
    <span class="n">X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">])</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">pipeline</span> <span class="p">(</span><span class="n">X</span><span class="p">)</span>

    <span class="n">pipeline</span><span class="o">.</span><span class="n">show_summary</span> <span class="p">()</span>
    
    <span class="n">remove_previous_results</span> <span class="p">(</span><span class="n">path_results</span><span class="o">=</span><span class="n">path_results</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">tst</span><span class="o">.</span><span class="n">run</span> <span class="p">(</span><span class="n">test_show_summary</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="s1">&#39;dummy&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>running test_show_summary
----------------------------------------------------------------------------------------------------
0: FirstTransform =&gt;  (3,)
----------------------------------------------------------------------------------------------------
1: SecondTransform =&gt;  (3,)
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Profiling-(second-case)">Profiling (second case)<a class="anchor-link" href="#Profiling-(second-case)"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="test_multi_comp_profiling2" class="doc_header"><code>test_multi_comp_profiling2</code><a href="https://github.com/Jaume-JCI/ds-blocks/tree/main/dsblocks/tests/core/test_compose.py#L1598" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>test_multi_comp_profiling2</code>()</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">test_multi_comp_profiling2</span> <span class="p">():</span>
    <span class="k">class</span> <span class="nc">SpendTime</span> <span class="p">(</span><span class="n">Component</span><span class="p">):</span>
        <span class="k">def</span> <span class="fm">__init__</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">time_fit</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">time_apply</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">time_fit_apply</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
            <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            
    <span class="k">class</span> <span class="nc">HasFitApply</span><span class="p">(</span><span class="n">SpendTime</span><span class="p">):</span>
        <span class="k">def</span> <span class="fm">__init__</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
            <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">_fit</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">time_fit</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">_apply</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">):</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">time_apply</span><span class="p">)</span>
            <span class="k">return</span> <span class="mi">1</span>
        
        <span class="k">def</span> <span class="nf">_fit_apply</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">time_fit_apply</span><span class="p">)</span>
            <span class="k">return</span> <span class="mi">1</span>

    <span class="k">class</span> <span class="nc">HasFitAndApply</span><span class="p">(</span><span class="n">SpendTime</span><span class="p">):</span>
        <span class="k">def</span> <span class="fm">__init__</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
            <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">_fit</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">time_fit</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">_apply</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">):</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">time_apply</span><span class="p">)</span>
            <span class="k">return</span> <span class="mi">1</span>
        
    <span class="k">class</span> <span class="nc">HasOnlyApply</span><span class="p">(</span><span class="n">SpendTime</span><span class="p">):</span>
        <span class="k">def</span> <span class="fm">__init__</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
            <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">_apply</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">):</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">time_apply</span><span class="p">)</span>
            <span class="k">return</span> <span class="mi">1</span>
        
    <span class="k">class</span> <span class="nc">AllCombined</span> <span class="p">(</span><span class="n">Sequential</span><span class="p">):</span>
        <span class="k">def</span> <span class="fm">__init__</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
            <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">has_fit_and_apply</span> <span class="o">=</span> <span class="n">HasFitAndApply</span> <span class="p">(</span><span class="n">time_fit</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">time_apply</span><span class="o">=</span><span class="mf">0.15</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">has_fit_apply1</span> <span class="o">=</span> <span class="n">HasFitApply</span> <span class="p">(</span><span class="n">time_fit_apply</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">has_only_apply</span> <span class="o">=</span> <span class="n">HasOnlyApply</span> <span class="p">(</span><span class="n">time_apply</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">has_fit_apply2</span> <span class="o">=</span> <span class="n">HasFitApply</span> <span class="p">(</span><span class="n">time_fit_apply</span><span class="o">=</span><span class="mf">0.25</span><span class="p">)</span>
        
    <span class="n">all_combined</span> <span class="o">=</span> <span class="n">AllCombined</span> <span class="p">()</span>
    <span class="n">all_combined</span><span class="o">.</span><span class="n">fit_apply</span> <span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">dfd</span> <span class="o">=</span> <span class="n">all_combined</span><span class="o">.</span><span class="n">gather_times</span><span class="p">()</span>

    <span class="n">display</span><span class="p">(</span><span class="s1">&#39;sum&#39;</span><span class="p">,</span> <span class="n">dfd</span><span class="o">.</span><span class="n">sum</span><span class="p">)</span>
    <span class="n">display</span><span class="p">(</span><span class="s1">&#39;component overhead&#39;</span><span class="p">,</span> <span class="n">dfd</span><span class="o">.</span><span class="n">component_ovh</span><span class="p">)</span>
    <span class="n">display</span><span class="p">(</span><span class="s1">&#39;no_overhead_total&#39;</span><span class="p">,</span> <span class="n">dfd</span><span class="o">.</span><span class="n">no_overhead_total</span><span class="p">)</span>
    <span class="n">display</span><span class="p">(</span><span class="s1">&#39;overhead_total&#39;</span><span class="p">,</span> <span class="n">dfd</span><span class="o">.</span><span class="n">overhead_total</span><span class="p">)</span>
    <span class="n">display</span> <span class="p">(</span><span class="s1">&#39;sum - novh_sum&#39;</span><span class="p">,</span> <span class="n">dfd</span><span class="o">.</span><span class="n">sum</span><span class="p">[</span><span class="s1">&#39;whole&#39;</span><span class="p">]</span><span class="o">-</span><span class="n">dfd</span><span class="o">.</span><span class="n">novh_sum</span><span class="p">[</span><span class="s1">&#39;whole&#39;</span><span class="p">])</span>
    <span class="n">display</span><span class="p">(</span><span class="s1">&#39;overhead summary&#39;</span><span class="p">,</span> <span class="n">dfd</span><span class="o">.</span><span class="n">overhead_summary</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="kc">False</span><span class="p">:</span>
        <span class="n">all_combined</span><span class="o">.</span><span class="n">fit</span> <span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">dfd</span> <span class="o">=</span> <span class="n">all_combined</span><span class="o">.</span><span class="n">gather_times</span><span class="p">()</span>

        <span class="n">display</span><span class="p">(</span><span class="s1">&#39;sum&#39;</span><span class="p">,</span> <span class="n">dfd</span><span class="o">.</span><span class="n">sum</span><span class="p">)</span>
        <span class="n">display</span><span class="p">(</span><span class="s1">&#39;no_overhead_total&#39;</span><span class="p">,</span> <span class="n">dfd</span><span class="o">.</span><span class="n">no_overhead_total</span><span class="p">)</span>
        <span class="n">display</span><span class="p">(</span><span class="s1">&#39;overhead_total&#39;</span><span class="p">,</span> <span class="n">dfd</span><span class="o">.</span><span class="n">overhead_total</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">tst</span><span class="o">.</span><span class="n">run</span> <span class="p">(</span><span class="n">test_multi_comp_profiling2</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="s1">&#39;dummy&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>running test_multi_comp_profiling2
</pre>
</div>
</div>

<div class="output_area">



<div class="output_text output_subarea ">
<pre>&#39;sum&#39;</pre>
</div>

</div>

<div class="output_area">


<div class="output_html rendered_html output_subarea "><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead tr th {
        text-align: left;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr>
      <th></th>
      <th></th>
      <th>whole</th>
      <th>leaf</th>
    </tr>
    <tr>
      <th></th>
      <th></th>
      <th>fit_apply</th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <th>all_combined</th>
      <td>1.039505</td>
      <td>False</td>
    </tr>
    <tr>
      <th rowspan="4" valign="top">1</th>
      <th>has_fit_and_apply</th>
      <td>0.255676</td>
      <td>True</td>
    </tr>
    <tr>
      <th>has_fit_apply</th>
      <td>0.304372</td>
      <td>True</td>
    </tr>
    <tr>
      <th>has_fit_apply</th>
      <td>0.254772</td>
      <td>True</td>
    </tr>
    <tr>
      <th>has_only_apply</th>
      <td>0.204211</td>
      <td>True</td>
    </tr>
  </tbody>
</table>
</div></div>

</div>

<div class="output_area">



<div class="output_text output_subarea ">
<pre>&#39;component overhead&#39;</pre>
</div>

</div>

<div class="output_area">


<div class="output_html rendered_html output_subarea "><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th></th>
      <th>(whole, fit_apply)</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <th>all_combined</th>
      <td>0.004267</td>
    </tr>
    <tr>
      <th rowspan="4" valign="top">1</th>
      <th>has_fit_and_apply</th>
      <td>0.130518</td>
    </tr>
    <tr>
      <th>has_fit_apply</th>
      <td>0.004041</td>
    </tr>
    <tr>
      <th>has_fit_apply</th>
      <td>0.004472</td>
    </tr>
    <tr>
      <th>has_only_apply</th>
      <td>0.003983</td>
    </tr>
  </tbody>
</table>
</div></div>

</div>

<div class="output_area">



<div class="output_text output_subarea ">
<pre>&#39;no_overhead_total&#39;</pre>
</div>

</div>

<div class="output_area">


<div class="output_html rendered_html output_subarea "><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead tr th {
        text-align: left;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr>
      <th></th>
      <th>whole</th>
      <th>leaf</th>
    </tr>
    <tr>
      <th></th>
      <th>fit_apply</th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0.876016</td>
      <td>4.0</td>
    </tr>
  </tbody>
</table>
</div></div>

</div>

<div class="output_area">



<div class="output_text output_subarea ">
<pre>&#39;overhead_total&#39;</pre>
</div>

</div>

<div class="output_area">


<div class="output_html rendered_html output_subarea "><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead tr th {
        text-align: left;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr>
      <th></th>
      <th></th>
      <th>whole</th>
      <th>leaf</th>
    </tr>
    <tr>
      <th></th>
      <th></th>
      <th>fit_apply</th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <th>all_combined</th>
      <td>0.16349</td>
      <td>-4.0</td>
    </tr>
  </tbody>
</table>
</div></div>

</div>

<div class="output_area">



<div class="output_text output_subarea ">
<pre>&#39;sum - novh_sum&#39;</pre>
</div>

</div>

<div class="output_area">


<div class="output_html rendered_html output_subarea "><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th></th>
      <th>fit_apply</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <th>all_combined</th>
      <td>0.004267</td>
    </tr>
    <tr>
      <th rowspan="4" valign="top">1</th>
      <th>has_fit_and_apply</th>
      <td>0.005360</td>
    </tr>
    <tr>
      <th>has_fit_apply</th>
      <td>0.004041</td>
    </tr>
    <tr>
      <th>has_fit_apply</th>
      <td>0.004472</td>
    </tr>
    <tr>
      <th>has_only_apply</th>
      <td>0.003983</td>
    </tr>
  </tbody>
</table>
</div></div>

</div>

<div class="output_area">



<div class="output_text output_subarea ">
<pre>&#39;overhead summary&#39;</pre>
</div>

</div>

<div class="output_area">


<div class="output_html rendered_html output_subarea "><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>total</th>
      <th>total leaf</th>
      <th>total non-leaf</th>
      <th>remaining / unexplained</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0.16349</td>
      <td>0.143015</td>
      <td>0.020474</td>
      <td>0.0</td>
    </tr>
  </tbody>
</table>
</div></div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="make_pipeline-function">make_pipeline function<a class="anchor-link" href="#make_pipeline-function"> </a></h2>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="make_pipeline" class="doc_header"><code>make_pipeline</code><a href="https://github.com/Jaume-JCI/ds-blocks/tree/main/dsblocks/core/compose.py#L678" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>make_pipeline</code>(<strong>*<code>components</code></strong>, <strong>**<code>kwargs</code></strong>)</p>
</blockquote>

<pre><code>Create `Pipeline` object of class `cls`, given `components` list.</code></pre>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Usage-example">Usage example<a class="anchor-link" href="#Usage-example"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="test_make_pipeline" class="doc_header"><code>test_make_pipeline</code><a href="https://github.com/Jaume-JCI/ds-blocks/tree/main/dsblocks/tests/core/test_compose.py#L1666" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>test_make_pipeline</code>()</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1">#@pytest.mark.reference_fails</span>
<span class="k">def</span> <span class="nf">test_make_pipeline</span> <span class="p">():</span>
    <span class="n">tr1</span> <span class="o">=</span> <span class="n">Component</span><span class="p">(</span><span class="n">FunctionTransformer</span> <span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span>
    <span class="n">tr2</span> <span class="o">=</span> <span class="n">Component</span><span class="p">(</span><span class="n">FunctionTransformer</span> <span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">*</span><span class="mi">2</span><span class="p">))</span>
    <span class="n">pipeline</span> <span class="o">=</span> <span class="n">make_pipeline</span> <span class="p">(</span><span class="n">tr1</span><span class="p">,</span> <span class="n">tr2</span><span class="p">)</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">pipeline</span><span class="o">.</span><span class="n">transform</span> <span class="p">(</span><span class="mi">3</span><span class="p">)</span>

    <span class="nb">print</span> <span class="p">(</span><span class="n">result</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">result</span> <span class="o">==</span> <span class="mi">8</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">tst</span><span class="o">.</span><span class="n">run</span> <span class="p">(</span><span class="n">test_make_pipeline</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="s1">&#39;dummy&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>running test_make_pipeline
8
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="pipeline_factory">pipeline_factory<a class="anchor-link" href="#pipeline_factory"> </a></h2>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="pipeline_factory" class="doc_header"><code>pipeline_factory</code><a href="https://github.com/Jaume-JCI/ds-blocks/tree/main/dsblocks/core/compose.py#L685" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>pipeline_factory</code>(<strong><code>pipeline_class</code></strong>, <strong>**<code>kwargs</code></strong>)</p>
</blockquote>

<pre><code>Creates a pipeline object given its class `pipeline_class`

Parameters
----------
pipeline_class : class or str
    Name of the pipeline class used for creating the object.
    This can be either of type string or class.</code></pre>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Usage-example">Usage example<a class="anchor-link" href="#Usage-example"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="test_pipeline_factory" class="doc_header"><code>test_pipeline_factory</code><a href="https://github.com/Jaume-JCI/ds-blocks/tree/main/dsblocks/tests/core/test_compose.py#L1677" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>test_pipeline_factory</code>()</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1">#@pytest.mark.reference_fails</span>
<span class="k">def</span> <span class="nf">test_pipeline_factory</span> <span class="p">():</span>
    <span class="n">path_results</span> <span class="o">=</span> <span class="s1">&#39;pipeline_factory&#39;</span>
    <span class="n">remove_previous_results</span> <span class="p">(</span><span class="n">path_results</span><span class="o">=</span><span class="n">path_results</span><span class="p">)</span>

    <span class="n">pipeline1</span> <span class="o">=</span> <span class="n">pipeline_factory</span> <span class="p">(</span><span class="n">SimplePipeline</span><span class="p">,</span> <span class="n">path_results</span><span class="o">=</span><span class="n">path_results</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">pipeline1</span><span class="o">.</span><span class="n">path_results</span><span class="o">==</span><span class="n">Path</span><span class="p">(</span><span class="n">path_results</span><span class="p">)</span><span class="o">.</span><span class="n">resolve</span><span class="p">()</span>
    <span class="c1">#pipeline2 = pipeline_factory (&#39;SimplePipeline&#39;, path_results=path_results)</span>
    <span class="c1">#assert pipeline2.path_results==Path(path_results).resolve()</span>

    <span class="n">remove_previous_results</span> <span class="p">(</span><span class="n">path_results</span><span class="o">=</span><span class="n">path_results</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">tst</span><span class="o">.</span><span class="n">run</span> <span class="p">(</span><span class="n">test_pipeline_factory</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="s1">&#39;dummy&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>running test_pipeline_factory
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="PandasPipeline">PandasPipeline<a class="anchor-link" href="#PandasPipeline"> </a></h2>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="PandasPipeline" class="doc_header"><code>class</code> <code>PandasPipeline</code><a href="https://github.com/Jaume-JCI/ds-blocks/tree/main/dsblocks/core/compose.py#L704" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>PandasPipeline</code>(<strong><code>data_converter</code></strong>=<em><code>'PandasConverter'</code></em>, <strong><code>data_io</code></strong>=<em><code>'PandasIO'</code></em>, <strong><code>separate_labels</code></strong>=<em><code>False</code></em>, <strong>**<code>kwargs</code></strong>) :: <a href="/compose.html#Pipeline"><code>Pipeline</code></a></p>
</blockquote>

<pre><code>Pipeline that saves results in parquet format, and preserves DataFrame format.

See `Pipeline` class for an explanation of using `separate_labels=False`</code></pre>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Usage-example">Usage example<a class="anchor-link" href="#Usage-example"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="PandasTransformWithLabels1" class="doc_header"><code>class</code> <code>PandasTransformWithLabels1</code><a href="https://github.com/Jaume-JCI/ds-blocks/tree/main/dsblocks/tests/core/test_compose.py#L1692" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>PandasTransformWithLabels1</code>(<strong>**<code>kwargs</code></strong>) :: <a href="/components.html#PandasComponent"><code>PandasComponent</code></a></p>
</blockquote>

<pre><code>Component that preserves the DataFrame format for incoming data and results.

This component also writes results in parquet format, by default.
See `PandasConverter` in `core.data_conversion` for details on the data
conversion performed.</code></pre>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="PandasTransformWithLabels2" class="doc_header"><code>class</code> <code>PandasTransformWithLabels2</code><a href="https://github.com/Jaume-JCI/ds-blocks/tree/main/dsblocks/tests/core/test_compose.py#L1705" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>PandasTransformWithLabels2</code>(<strong>**<code>kwargs</code></strong>) :: <a href="/components.html#PandasComponent"><code>PandasComponent</code></a></p>
</blockquote>

<pre><code>Component that preserves the DataFrame format for incoming data and results.

This component also writes results in parquet format, by default.
See `PandasConverter` in `core.data_conversion` for details on the data
conversion performed.</code></pre>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="SimplePandasPipeline" class="doc_header"><code>class</code> <code>SimplePandasPipeline</code><a href="https://github.com/Jaume-JCI/ds-blocks/tree/main/dsblocks/tests/core/test_compose.py#L1718" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>SimplePandasPipeline</code>(<strong>**<code>kwargs</code></strong>) :: <a href="/compose.html#PandasPipeline"><code>PandasPipeline</code></a></p>
</blockquote>

<pre><code>Pipeline that saves results in parquet format, and preserves DataFrame format.

See `Pipeline` class for an explanation of using `separate_labels=False`</code></pre>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="TransformWithLabels1" class="doc_header"><code>class</code> <code>TransformWithLabels1</code><a href="https://github.com/Jaume-JCI/ds-blocks/tree/main/dsblocks/tests/core/test_compose.py#L1731" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>TransformWithLabels1</code>(<strong>**<code>kwargs</code></strong>) :: <a href="/components.html#Component"><code>Component</code></a></p>
</blockquote>

<pre><code>Base component class used in our Pipeline.</code></pre>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="TransformWithLabels2" class="doc_header"><code>class</code> <code>TransformWithLabels2</code><a href="https://github.com/Jaume-JCI/ds-blocks/tree/main/dsblocks/tests/core/test_compose.py#L1743" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>TransformWithLabels2</code>(<strong>**<code>kwargs</code></strong>) :: <a href="/components.html#Component"><code>Component</code></a></p>
</blockquote>

<pre><code>Base component class used in our Pipeline.</code></pre>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="SimplePandasPipelineNoPandasComponent" class="doc_header"><code>class</code> <code>SimplePandasPipelineNoPandasComponent</code><a href="https://github.com/Jaume-JCI/ds-blocks/tree/main/dsblocks/tests/core/test_compose.py#L1756" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>SimplePandasPipelineNoPandasComponent</code>(<strong>**<code>kwargs</code></strong>) :: <a href="/compose.html#PandasPipeline"><code>PandasPipeline</code></a></p>
</blockquote>

<pre><code>Pipeline that saves results in parquet format, and preserves DataFrame format.

See `Pipeline` class for an explanation of using `separate_labels=False`</code></pre>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># **********************************************</span>
<span class="c1"># Good example</span>
<span class="c1"># **********************************************</span>
<span class="k">class</span> <span class="nc">PandasTransformWithLabels1</span> <span class="p">(</span><span class="n">PandasComponent</span><span class="p">):</span>

    <span class="k">def</span> <span class="fm">__init__</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span> <span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">estimator</span><span class="o">=</span> <span class="n">Bunch</span><span class="p">(</span><span class="nb">sum</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_fit</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">estimator</span><span class="o">.</span><span class="n">sum</span> <span class="o">=</span> <span class="n">X</span><span class="p">[</span><span class="n">y</span><span class="o">==</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_apply</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">):</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">X</span><span class="o">*</span><span class="mi">1000</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">estimator</span><span class="o">.</span><span class="n">sum</span>
        <span class="k">return</span> <span class="n">r</span>
    
<span class="k">class</span> <span class="nc">PandasTransformWithLabels2</span> <span class="p">(</span><span class="n">PandasComponent</span><span class="p">):</span>

    <span class="k">def</span> <span class="fm">__init__</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span> <span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">estimator</span><span class="o">=</span> <span class="n">Bunch</span><span class="p">(</span><span class="n">maxim</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_fit</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">estimator</span><span class="o">.</span><span class="n">maxim</span> <span class="o">=</span> <span class="n">X</span><span class="p">[</span><span class="n">y</span><span class="o">==</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_apply</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">):</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">X</span><span class="o">*</span><span class="mi">100</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">estimator</span><span class="o">.</span><span class="n">maxim</span>
        <span class="k">return</span> <span class="n">r</span>
            
<span class="k">class</span> <span class="nc">SimplePandasPipeline</span> <span class="p">(</span><span class="n">PandasPipeline</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span> <span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="c1"># custom transform</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tr1</span> <span class="o">=</span> <span class="n">PandasTransformWithLabels1</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> 

        <span class="c1"># slklearn transform</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tr2</span> <span class="o">=</span> <span class="n">PandasTransformWithLabels2</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        
<span class="c1"># **********************************************</span>
<span class="c1"># Bad example</span>
<span class="c1"># **********************************************</span>
<span class="k">class</span> <span class="nc">TransformWithLabels1</span> <span class="p">(</span><span class="n">Component</span><span class="p">):</span>

    <span class="k">def</span> <span class="fm">__init__</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span> <span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">estimator</span><span class="o">=</span> <span class="n">Bunch</span><span class="p">(</span><span class="nb">sum</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_fit</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">estimator</span><span class="o">.</span><span class="n">sum</span> <span class="o">=</span> <span class="n">X</span><span class="p">[</span><span class="n">y</span><span class="o">==</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_apply</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">x</span><span class="o">*</span><span class="mi">1000</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">estimator</span><span class="o">.</span><span class="n">sum</span>

<span class="k">class</span> <span class="nc">TransformWithLabels2</span> <span class="p">(</span><span class="n">Component</span><span class="p">):</span>

    <span class="k">def</span> <span class="fm">__init__</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span> <span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">estimator</span><span class="o">=</span> <span class="n">Bunch</span><span class="p">(</span><span class="n">maxim</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_fit</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">estimator</span><span class="o">.</span><span class="n">maxim</span> <span class="o">=</span> <span class="n">X</span><span class="p">[</span><span class="n">y</span><span class="o">==</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_apply</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">x</span><span class="o">*</span><span class="mi">100</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">estimator</span><span class="o">.</span><span class="n">maxim</span>
    

<span class="k">class</span> <span class="nc">SimplePandasPipelineNoPandasComponent</span> <span class="p">(</span><span class="n">PandasPipeline</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span> <span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="c1"># custom transform</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tr1</span> <span class="o">=</span> <span class="n">TransformWithLabels1</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> 

        <span class="c1"># slklearn transform</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tr2</span> <span class="o">=</span> <span class="n">TransformWithLabels2</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="test_pandas_pipeline" class="doc_header"><code>test_pandas_pipeline</code><a href="https://github.com/Jaume-JCI/ds-blocks/tree/main/dsblocks/tests/core/test_compose.py#L1769" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>test_pandas_pipeline</code>()</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1">#@pytest.mark.reference_fails</span>
<span class="k">def</span> <span class="nf">test_pandas_pipeline</span> <span class="p">():</span>
    <span class="n">path_results</span> <span class="o">=</span> <span class="s1">&#39;pandas_pipeline&#39;</span>
    <span class="n">remove_previous_results</span> <span class="p">(</span><span class="n">path_results</span><span class="o">=</span><span class="n">path_results</span><span class="p">)</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span> <span class="p">({</span><span class="s1">&#39;a&#39;</span><span class="p">:[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">],</span> <span class="s1">&#39;b&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">8</span><span class="p">],</span> <span class="s1">&#39;label&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]})</span>

    <span class="n">pipe</span> <span class="o">=</span> <span class="n">SimplePandasPipelineNoPandasComponent</span> <span class="p">()</span>
    <span class="k">with</span> <span class="n">pytest</span><span class="o">.</span><span class="n">raises</span> <span class="p">(</span><span class="ne">KeyError</span><span class="p">):</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">pipe</span><span class="o">.</span><span class="n">fit_transform</span> <span class="p">(</span><span class="n">df</span><span class="p">)</span>
        <span class="n">display</span> <span class="p">(</span><span class="n">r</span><span class="p">)</span>

    <span class="n">pipe</span> <span class="o">=</span> <span class="n">SimplePandasPipeline</span> <span class="p">()</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">pipe</span><span class="o">.</span><span class="n">fit_transform</span> <span class="p">(</span><span class="n">df</span><span class="p">)</span>
    <span class="n">display</span> <span class="p">(</span><span class="n">r</span><span class="p">)</span>

    <span class="n">tr1</span> <span class="o">=</span> <span class="n">PandasTransformWithLabels1</span> <span class="p">()</span>
    <span class="n">tr2</span> <span class="o">=</span> <span class="n">PandasTransformWithLabels2</span> <span class="p">()</span>
    <span class="n">r1</span><span class="o">=</span><span class="n">tr1</span><span class="o">.</span><span class="n">fit_transform</span> <span class="p">(</span><span class="n">df</span><span class="p">)</span>
    <span class="n">r2</span><span class="o">=</span><span class="n">tr2</span><span class="o">.</span><span class="n">fit_transform</span> <span class="p">(</span><span class="n">r1</span><span class="p">)</span>
    <span class="k">assert</span> <span class="p">(</span><span class="n">r</span><span class="o">==</span><span class="n">r2</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>

    <span class="n">df_equal</span> <span class="o">=</span> <span class="p">(</span><span class="n">r1</span><span class="o">==</span><span class="n">df</span><span class="o">*</span><span class="mi">1000</span><span class="o">+</span><span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">label</span><span class="o">==</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">))[[</span><span class="s1">&#39;a&#39;</span><span class="p">,</span><span class="s1">&#39;b&#39;</span><span class="p">]]</span>
    <span class="k">assert</span> <span class="n">df_equal</span><span class="o">.</span><span class="n">all</span><span class="p">()</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>

    <span class="n">df_equal</span> <span class="o">=</span> <span class="p">(</span><span class="n">r2</span><span class="o">==</span><span class="n">r1</span><span class="o">*</span><span class="mi">100</span><span class="o">+</span><span class="n">r1</span><span class="p">[</span><span class="n">r1</span><span class="o">.</span><span class="n">label</span><span class="o">==</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">))[[</span><span class="s1">&#39;a&#39;</span><span class="p">,</span><span class="s1">&#39;b&#39;</span><span class="p">]]</span>
    <span class="k">assert</span> <span class="n">df_equal</span><span class="o">.</span><span class="n">all</span><span class="p">()</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
    <span class="n">remove_previous_results</span> <span class="p">(</span><span class="n">path_results</span><span class="o">=</span><span class="n">path_results</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">tst</span><span class="o">.</span><span class="n">run</span> <span class="p">(</span><span class="n">test_pandas_pipeline</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="s1">&#39;dummy&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>running test_pandas_pipeline
</pre>
</div>
</div>

<div class="output_area">


<div class="output_html rendered_html output_subarea "><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>a</th>
      <th>b</th>
      <th>label</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>104404</td>
      <td>509212</td>
      <td>1</td>
    </tr>
    <tr>
      <th>1</th>
      <td>204404</td>
      <td>609212</td>
      <td>0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>304404</td>
      <td>709212</td>
      <td>1</td>
    </tr>
    <tr>
      <th>3</th>
      <td>404404</td>
      <td>809212</td>
      <td>0</td>
    </tr>
  </tbody>
</table>
</div></div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Parallel">Parallel<a class="anchor-link" href="#Parallel"> </a></h2>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="Parallel" class="doc_header"><code>class</code> <code>Parallel</code><a href="https://github.com/Jaume-JCI/ds-blocks/tree/main/dsblocks/core/compose.py#L721" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>Parallel</code>(<strong>*<code>components</code></strong>, <strong><code>select_input_to_fit</code></strong>=<em><code>None</code></em>, <strong><code>select_input</code></strong>=<em><code>None</code></em>, <strong><code>initialize_result</code></strong>=<em><code>None</code></em>, <strong><code>join_result</code></strong>=<em><code>None</code></em>, <strong><code>finalize_result</code></strong>=<em><code>None</code></em>, <strong>**<code>kwargs</code></strong>) :: <a href="/compose.html#MultiComponent"><code>MultiComponent</code></a></p>
</blockquote>

<pre><code>List of components that don't have sequential dependencies.

As the name suggests, these components could run in parallel,
if a concurrency mechanism is employed.</code></pre>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Usage-example">Usage example<a class="anchor-link" href="#Usage-example"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="test_parallel" class="doc_header"><code>test_parallel</code><a href="https://github.com/Jaume-JCI/ds-blocks/tree/main/dsblocks/tests/core/test_compose.py#L1798" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>test_parallel</code>()</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1">#@pytest.mark.reference_fails</span>
<span class="k">def</span> <span class="nf">test_parallel</span> <span class="p">():</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">])</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">parallel</span> <span class="o">=</span> <span class="n">Parallel</span> <span class="p">(</span><span class="n">Transform1</span> <span class="p">(),</span>
                         <span class="n">Transform2</span> <span class="p">())</span>
    <span class="n">r1</span> <span class="o">=</span> <span class="n">parallel</span><span class="o">.</span><span class="n">fit_apply</span> <span class="p">(</span><span class="n">x</span><span class="p">)</span>

    <span class="n">x1</span> <span class="o">=</span> <span class="n">x</span> <span class="o">*</span> <span class="mi">1000</span> <span class="o">+</span> <span class="n">x</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">x2</span> <span class="o">=</span> <span class="n">x</span> <span class="o">*</span> <span class="mi">100</span> <span class="o">+</span> <span class="n">x</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">r_ref</span> <span class="o">=</span> <span class="p">[</span><span class="n">x1</span><span class="p">,</span> <span class="n">x2</span><span class="p">]</span>
    <span class="k">assert</span> <span class="nb">all</span><span class="p">([(</span><span class="n">x</span><span class="o">==</span><span class="n">y</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()</span> <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">r1</span><span class="p">,</span> <span class="n">r_ref</span><span class="p">)])</span>

    <span class="n">parallel</span> <span class="o">=</span> <span class="n">Parallel</span> <span class="p">(</span><span class="n">Transform1</span> <span class="p">(),</span>
                         <span class="n">Transform2</span> <span class="p">(),</span>
                         <span class="n">initialize_result</span><span class="o">=</span><span class="k">lambda</span> <span class="p">:</span> <span class="p">{},</span>
                         <span class="n">join_result</span><span class="o">=</span><span class="k">lambda</span> <span class="n">Xr</span><span class="p">,</span> <span class="n">Xi_r</span><span class="p">,</span> <span class="n">components</span><span class="p">,</span> <span class="n">i</span><span class="p">:</span> <span class="p">{</span><span class="o">**</span><span class="n">Xr</span><span class="p">,</span> <span class="o">**</span><span class="p">{</span><span class="n">components</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">name</span><span class="p">:</span><span class="n">Xi_r</span><span class="p">}})</span>

    <span class="n">r1</span> <span class="o">=</span> <span class="n">parallel</span><span class="o">.</span><span class="n">fit_apply</span> <span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="k">assert</span> <span class="nb">list</span><span class="p">(</span><span class="n">r1</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span><span class="o">==</span><span class="p">[</span><span class="s1">&#39;transform1&#39;</span><span class="p">,</span><span class="s1">&#39;transform2&#39;</span><span class="p">]</span>
    <span class="k">assert</span> <span class="p">(</span><span class="n">r1</span><span class="p">[</span><span class="s1">&#39;transform1&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">r_ref</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
    <span class="k">assert</span> <span class="p">(</span><span class="n">r1</span><span class="p">[</span><span class="s1">&#39;transform2&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">r_ref</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">tst</span><span class="o">.</span><span class="n">run</span> <span class="p">(</span><span class="n">test_parallel</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="s1">&#39;dummy&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>running test_parallel
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="find_last_result-example"><code>find_last_result</code> example<a class="anchor-link" href="#find_last_result-example"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="test_pipeline_find_last_result" class="doc_header"><code>test_pipeline_find_last_result</code><a href="https://github.com/Jaume-JCI/ds-blocks/tree/main/dsblocks/tests/core/test_compose.py#L1821" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>test_pipeline_find_last_result</code>()</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="test_pipeline_find_last_result_parallel1" class="doc_header"><code>test_pipeline_find_last_result_parallel1</code><a href="https://github.com/Jaume-JCI/ds-blocks/tree/main/dsblocks/tests/core/test_compose.py#L1855" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>test_pipeline_find_last_result_parallel1</code>()</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="test_pipeline_find_last_result_parallel2" class="doc_header"><code>test_pipeline_find_last_result_parallel2</code><a href="https://github.com/Jaume-JCI/ds-blocks/tree/main/dsblocks/tests/core/test_compose.py#L1886" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>test_pipeline_find_last_result_parallel2</code>()</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="test_pipeline_find_last_result_parallel3" class="doc_header"><code>test_pipeline_find_last_result_parallel3</code><a href="https://github.com/Jaume-JCI/ds-blocks/tree/main/dsblocks/tests/core/test_compose.py#L1925" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>test_pipeline_find_last_result_parallel3</code>()</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">dsblocks.utils.dummies</span> <span class="kn">import</span> <span class="n">make_pipe1</span><span class="p">,</span> <span class="n">make_pipe2</span>
<span class="k">def</span> <span class="nf">test_pipeline_find_last_result</span> <span class="p">():</span>
    <span class="n">path_results</span> <span class="o">=</span> <span class="s1">&#39;test_pipeline_find_last_result&#39;</span>
    
    <span class="c1"># pipelines</span>
    <span class="n">pipe1</span> <span class="o">=</span> <span class="n">make_pipe1</span> <span class="p">()</span>
    <span class="n">X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">])</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">r1</span> <span class="o">=</span> <span class="n">pipe1</span><span class="o">.</span><span class="n">apply</span> <span class="p">(</span><span class="n">X</span><span class="p">)</span>
    <span class="nb">print</span> <span class="p">(</span><span class="n">r1</span><span class="p">)</span>
    <span class="n">pipe2</span> <span class="o">=</span> <span class="n">make_pipe1</span> <span class="p">(</span><span class="n">path_results</span><span class="o">=</span><span class="n">path_results</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="n">pipe2</span><span class="o">.</span><span class="n">A</span><span class="p">,</span> <span class="n">pipe2</span><span class="o">.</span><span class="n">B</span>
    <span class="c1"># second</span>
    <span class="n">X2</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">apply</span> <span class="p">(</span><span class="n">X</span><span class="p">)</span>
    <span class="n">X2</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="n">apply</span> <span class="p">(</span><span class="n">X2</span><span class="p">)</span>

    <span class="n">is_source</span> <span class="o">=</span> <span class="n">pipe2</span><span class="o">.</span><span class="n">find_last_result</span> <span class="p">()</span>
    <span class="k">assert</span> <span class="n">is_source</span>

    <span class="n">pipe2</span><span class="o">.</span><span class="n">A</span><span class="o">.</span><span class="n">raise_error</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">pipe2</span><span class="o">.</span><span class="n">B</span><span class="o">.</span><span class="n">raise_error</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">pipe2</span><span class="o">.</span><span class="n">C</span><span class="o">.</span><span class="n">raise_error</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">pipe2</span><span class="o">.</span><span class="n">D</span><span class="o">.</span><span class="n">raise_error</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">pipe2</span><span class="o">.</span><span class="n">E</span><span class="o">.</span><span class="n">raise_error</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">with</span> <span class="n">pytest</span><span class="o">.</span><span class="n">raises</span> <span class="p">(</span><span class="ne">RuntimeError</span><span class="p">):</span>
        <span class="n">_</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">apply</span> <span class="p">(</span><span class="n">X</span><span class="p">)</span>
    <span class="n">pipe2</span><span class="o">.</span><span class="n">C</span><span class="o">.</span><span class="n">raise_error</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">with</span> <span class="n">pytest</span><span class="o">.</span><span class="n">raises</span> <span class="p">(</span><span class="ne">RuntimeError</span><span class="p">):</span>
        <span class="n">_</span> <span class="o">=</span> <span class="n">pipe2</span><span class="o">.</span><span class="n">apply</span> <span class="p">()</span>
    <span class="n">pipe2</span><span class="o">.</span><span class="n">C</span><span class="o">.</span><span class="n">raise_error</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">r2</span> <span class="o">=</span> <span class="n">pipe2</span><span class="o">.</span><span class="n">apply</span> <span class="p">()</span>
    <span class="k">assert</span> <span class="p">(</span><span class="n">r1</span><span class="o">==</span><span class="n">r2</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
    <span class="nb">print</span> <span class="p">(</span><span class="n">r2</span><span class="p">)</span>
    
    <span class="n">remove_previous_results</span> <span class="p">(</span><span class="n">path_results</span><span class="o">=</span><span class="n">path_results</span><span class="p">)</span>
    
<span class="k">def</span> <span class="nf">test_pipeline_find_last_result_parallel1</span> <span class="p">():</span>
    <span class="n">path_results</span> <span class="o">=</span> <span class="s1">&#39;test_pipeline_find_last_result_parallel1&#39;</span>
    
    <span class="n">remove_previous_results</span> <span class="p">(</span><span class="n">path_results</span><span class="o">=</span><span class="n">path_results</span><span class="p">)</span>
    <span class="c1"># pipelines</span>
    <span class="n">pipe1</span> <span class="o">=</span> <span class="n">make_pipe2</span> <span class="p">()</span>
    <span class="n">X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">])</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">r1</span> <span class="o">=</span> <span class="n">pipe1</span><span class="o">.</span><span class="n">apply</span> <span class="p">(</span><span class="n">X</span><span class="p">)</span>
    <span class="nb">print</span> <span class="p">(</span><span class="n">r1</span><span class="p">)</span>
    <span class="c1"># second</span>
    <span class="n">pipe2</span> <span class="o">=</span> <span class="n">make_pipe2</span> <span class="p">(</span><span class="n">path_results</span><span class="o">=</span><span class="n">path_results</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">root</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">a</span> <span class="o">=</span> <span class="n">pipe2</span><span class="o">.</span><span class="n">obj</span><span class="o">.</span><span class="n">A</span> <span class="p">(</span><span class="n">X</span><span class="p">)</span>
    <span class="n">b1</span> <span class="o">=</span> <span class="n">pipe2</span><span class="o">.</span><span class="n">obj</span><span class="o">.</span><span class="n">B1</span> <span class="p">(</span><span class="n">a</span><span class="p">)</span>
    <span class="n">b2a</span> <span class="o">=</span> <span class="n">pipe2</span><span class="o">.</span><span class="n">obj</span><span class="o">.</span><span class="n">B2a</span> <span class="p">(</span><span class="n">a</span><span class="p">)</span>
    <span class="n">b3a</span> <span class="o">=</span> <span class="n">pipe2</span><span class="o">.</span><span class="n">obj</span><span class="o">.</span><span class="n">B3a</span> <span class="p">(</span><span class="n">a</span><span class="p">)</span>
    <span class="n">b3b</span> <span class="o">=</span> <span class="n">pipe2</span><span class="o">.</span><span class="n">obj</span><span class="o">.</span><span class="n">B3b</span> <span class="p">(</span><span class="n">b3a</span><span class="p">)</span>
    
    <span class="c1">#pipe2.obj.A.raise_error = True</span>
    <span class="c1">#pipe2.obj.B1.raise_error = True</span>
    <span class="c1">#pipe2.obj.B2a.raise_error = True</span>
    <span class="n">pipe2</span><span class="o">.</span><span class="n">obj</span><span class="o">.</span><span class="n">B3a</span><span class="o">.</span><span class="n">raise_error</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="c1">#pipe2.obj.B3b.raise_error = True</span>

    <span class="n">is_source</span> <span class="o">=</span> <span class="n">pipe2</span><span class="o">.</span><span class="n">find_last_result</span> <span class="p">()</span>
    <span class="nb">print</span> <span class="p">(</span><span class="n">is_source</span><span class="p">)</span>
    <span class="n">r2</span> <span class="o">=</span> <span class="n">pipe2</span><span class="o">.</span><span class="n">apply</span> <span class="p">()</span>
    <span class="k">assert</span> <span class="p">(</span><span class="n">r1</span><span class="o">==</span><span class="n">r2</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
    <span class="nb">print</span> <span class="p">(</span><span class="n">r2</span><span class="p">)</span>
    
    <span class="n">remove_previous_results</span> <span class="p">(</span><span class="n">path_results</span><span class="o">=</span><span class="n">path_results</span><span class="p">)</span>
    
<span class="k">def</span> <span class="nf">test_pipeline_find_last_result_parallel2</span> <span class="p">():</span>
    <span class="n">path_results</span> <span class="o">=</span> <span class="s1">&#39;test_pipeline_find_last_result_parallel2&#39;</span>
    
    <span class="n">remove_previous_results</span> <span class="p">(</span><span class="n">path_results</span><span class="o">=</span><span class="n">path_results</span><span class="p">)</span>
    <span class="c1"># pipelines</span>
    <span class="n">pipe1</span> <span class="o">=</span> <span class="n">make_pipe2</span> <span class="p">()</span>
    <span class="n">X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">])</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">r1</span> <span class="o">=</span> <span class="n">pipe1</span><span class="o">.</span><span class="n">apply</span> <span class="p">(</span><span class="n">X</span><span class="p">)</span>
    <span class="nb">print</span> <span class="p">(</span><span class="n">r1</span><span class="p">)</span>
    <span class="c1"># second</span>
    <span class="n">pipe2</span> <span class="o">=</span> <span class="n">make_pipe2</span> <span class="p">(</span><span class="n">path_results</span><span class="o">=</span><span class="n">path_results</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">root</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">a</span> <span class="o">=</span> <span class="n">pipe2</span><span class="o">.</span><span class="n">obj</span><span class="o">.</span><span class="n">A</span> <span class="p">(</span><span class="n">X</span><span class="p">)</span>
    <span class="c1"># B1</span>
    <span class="n">b1</span> <span class="o">=</span> <span class="n">pipe2</span><span class="o">.</span><span class="n">obj</span><span class="o">.</span><span class="n">B1</span> <span class="p">(</span><span class="n">a</span><span class="p">)</span>
    <span class="c1"># B2</span>
    <span class="n">b2a</span> <span class="o">=</span> <span class="n">pipe2</span><span class="o">.</span><span class="n">obj</span><span class="o">.</span><span class="n">B2a</span> <span class="p">(</span><span class="n">a</span><span class="p">)</span>
    <span class="n">b2b</span> <span class="o">=</span> <span class="n">pipe2</span><span class="o">.</span><span class="n">obj</span><span class="o">.</span><span class="n">B2b</span> <span class="p">(</span><span class="n">b2a</span><span class="p">)</span>
    <span class="n">b2c</span> <span class="o">=</span> <span class="n">pipe2</span><span class="o">.</span><span class="n">obj</span><span class="o">.</span><span class="n">B2c</span> <span class="p">(</span><span class="n">b2b</span><span class="p">)</span>
    <span class="c1"># B3</span>
    <span class="n">b3a</span> <span class="o">=</span> <span class="n">pipe2</span><span class="o">.</span><span class="n">obj</span><span class="o">.</span><span class="n">B3a</span> <span class="p">(</span><span class="n">a</span><span class="p">)</span>
    <span class="n">b3b</span> <span class="o">=</span> <span class="n">pipe2</span><span class="o">.</span><span class="n">obj</span><span class="o">.</span><span class="n">B3b</span> <span class="p">(</span><span class="n">b3a</span><span class="p">)</span>
    <span class="n">b3c</span> <span class="o">=</span> <span class="n">pipe2</span><span class="o">.</span><span class="n">obj</span><span class="o">.</span><span class="n">B3c</span> <span class="p">(</span><span class="n">b3b</span><span class="p">)</span>
    <span class="c1"># B4</span>
    <span class="n">b4</span> <span class="o">=</span> <span class="n">pipe2</span><span class="o">.</span><span class="n">obj</span><span class="o">.</span><span class="n">B4</span> <span class="p">(</span><span class="n">a</span><span class="p">)</span>
    
    <span class="n">pipe2</span><span class="o">.</span><span class="n">obj</span><span class="o">.</span><span class="n">A</span><span class="o">.</span><span class="n">raise_error</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">pipe2</span><span class="o">.</span><span class="n">obj</span><span class="o">.</span><span class="n">B2a</span><span class="o">.</span><span class="n">raise_error</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">pipe2</span><span class="o">.</span><span class="n">obj</span><span class="o">.</span><span class="n">B2b</span><span class="o">.</span><span class="n">raise_error</span> <span class="o">=</span> <span class="kc">True</span>
    
    <span class="n">pipe2</span><span class="o">.</span><span class="n">obj</span><span class="o">.</span><span class="n">B3a</span><span class="o">.</span><span class="n">raise_error</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">pipe2</span><span class="o">.</span><span class="n">obj</span><span class="o">.</span><span class="n">B3b</span><span class="o">.</span><span class="n">raise_error</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="n">is_source</span> <span class="o">=</span> <span class="n">pipe2</span><span class="o">.</span><span class="n">find_last_result</span> <span class="p">()</span>
    <span class="nb">print</span> <span class="p">(</span><span class="n">is_source</span><span class="p">)</span>
    <span class="n">r2</span> <span class="o">=</span> <span class="n">pipe2</span><span class="o">.</span><span class="n">apply</span> <span class="p">()</span>
    <span class="k">assert</span> <span class="p">(</span><span class="n">r1</span><span class="o">==</span><span class="n">r2</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
    
    <span class="n">remove_previous_results</span> <span class="p">(</span><span class="n">path_results</span><span class="o">=</span><span class="n">path_results</span><span class="p">)</span>
    
<span class="k">def</span> <span class="nf">test_pipeline_find_last_result_parallel3</span> <span class="p">():</span>
    <span class="n">path_results</span> <span class="o">=</span> <span class="s1">&#39;test_pipeline_find_last_result_parallel3&#39;</span>
        
    <span class="n">remove_previous_results</span> <span class="p">(</span><span class="n">path_results</span><span class="o">=</span><span class="n">path_results</span><span class="p">)</span>
    <span class="c1"># pipelines</span>
    <span class="n">pipe1</span> <span class="o">=</span> <span class="n">make_pipe2</span> <span class="p">()</span>
    <span class="n">X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">])</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">r1</span> <span class="o">=</span> <span class="n">pipe1</span><span class="o">.</span><span class="n">apply</span> <span class="p">(</span><span class="n">X</span><span class="p">)</span>
    <span class="nb">print</span> <span class="p">(</span><span class="n">r1</span><span class="p">)</span>
    <span class="c1"># second</span>
    <span class="n">pipe2</span> <span class="o">=</span> <span class="n">make_pipe2</span> <span class="p">(</span><span class="n">path_results</span><span class="o">=</span><span class="n">path_results</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">root</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">new_parallel</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">a</span> <span class="o">=</span> <span class="n">pipe2</span><span class="o">.</span><span class="n">obj</span><span class="o">.</span><span class="n">A</span> <span class="p">(</span><span class="n">X</span><span class="p">)</span>
    <span class="c1"># B</span>
    <span class="n">b</span> <span class="o">=</span> <span class="n">pipe2</span><span class="o">.</span><span class="n">new_parallel</span> <span class="p">(</span><span class="n">a</span><span class="p">)</span>
    <span class="c1"># B2</span>
    <span class="n">c</span> <span class="o">=</span> <span class="n">pipe2</span><span class="o">.</span><span class="n">obj</span><span class="o">.</span><span class="n">C</span> <span class="p">(</span><span class="n">b</span><span class="p">)</span>
    
    <span class="n">pipe2</span><span class="o">.</span><span class="n">obj</span><span class="o">.</span><span class="n">A</span><span class="o">.</span><span class="n">raise_error</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">pipe2</span><span class="o">.</span><span class="n">new_parallel</span><span class="o">.</span><span class="n">raise_error</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="n">is_source</span> <span class="o">=</span> <span class="n">pipe2</span><span class="o">.</span><span class="n">find_last_result</span> <span class="p">()</span>
    <span class="nb">print</span> <span class="p">(</span><span class="n">is_source</span><span class="p">)</span>
    <span class="n">r2</span> <span class="o">=</span> <span class="n">pipe2</span><span class="o">.</span><span class="n">apply</span> <span class="p">()</span>
    <span class="k">assert</span> <span class="p">(</span><span class="n">r1</span><span class="o">==</span><span class="n">r2</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
    
    <span class="n">remove_previous_results</span> <span class="p">(</span><span class="n">path_results</span><span class="o">=</span><span class="n">path_results</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">tst</span><span class="o">.</span><span class="n">run</span> <span class="p">(</span><span class="n">test_pipeline_find_last_result</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="s1">&#39;dummy&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>running test_pipeline_find_last_result
[[211]
 [311]
 [411]]
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>applying A (on whole data)
saving to /home/jcidatascience/jaume/workspace/remote/block-types/test_pipeline_find_last_result/whole/A_result.pk
applying B (on whole data)
saving to /home/jcidatascience/jaume/workspace/remote/block-types/test_pipeline_find_last_result/whole/B_result.pk
applying pipeline (on whole data)
applying B (on whole data)
loading from /home/jcidatascience/jaume/workspace/remote/block-types/test_pipeline_find_last_result/whole/B_result.pk
loaded pre-computed result
applying pipeline (on whole data)
applying B (on whole data)
loading from /home/jcidatascience/jaume/workspace/remote/block-types/test_pipeline_find_last_result/whole/B_result.pk
loaded pre-computed result
applying C (on whole data)
saving to /home/jcidatascience/jaume/workspace/remote/block-types/test_pipeline_find_last_result/whole/C_result.pk
applying D (on whole data)
saving to /home/jcidatascience/jaume/workspace/remote/block-types/test_pipeline_find_last_result/whole/D_result.pk
applying E (on whole data)
saving to /home/jcidatascience/jaume/workspace/remote/block-types/test_pipeline_find_last_result/whole/E_result.pk
saving to /home/jcidatascience/jaume/workspace/remote/block-types/test_pipeline_find_last_result/whole/pipeline_result.pk
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>[[211]
 [311]
 [411]]
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">tst</span><span class="o">.</span><span class="n">run</span> <span class="p">(</span><span class="n">test_pipeline_find_last_result_parallel1</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="s1">&#39;dummy&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>running test_pipeline_find_last_result_parallel1
parallel class: &lt;class &#39;dsblocks.core.compose.Parallel&#39;&gt;
[[ 22.  32.  42.]
 [212. 312. 412.]
 [ 33.  43.  53.]
 [  5.   6.   7.]]
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>applying A (on whole data)
saving to /home/jcidatascience/jaume/workspace/remote/block-types/test_pipeline_find_last_result_parallel1/whole/A_result.pk
applying B1 (on whole data)
saving to /home/jcidatascience/jaume/workspace/remote/block-types/test_pipeline_find_last_result_parallel1/whole/B1_result.pk
applying B2a (on whole data)
saving to /home/jcidatascience/jaume/workspace/remote/block-types/test_pipeline_find_last_result_parallel1/whole/B2a_result.pk
applying B3a (on whole data)
saving to /home/jcidatascience/jaume/workspace/remote/block-types/test_pipeline_find_last_result_parallel1/whole/B3a_result.pk
applying B3b (on whole data)
saving to /home/jcidatascience/jaume/workspace/remote/block-types/test_pipeline_find_last_result_parallel1/whole/B3b_result.pk
applying pipeline (on whole data)
applying A (on whole data)
loading from /home/jcidatascience/jaume/workspace/remote/block-types/test_pipeline_find_last_result_parallel1/whole/A_result.pk
loaded pre-computed result
applying parallel (on whole data)
applying B1 (on whole data)
loading from /home/jcidatascience/jaume/workspace/remote/block-types/test_pipeline_find_last_result_parallel1/whole/B1_result.pk
loaded pre-computed result
applying pipeline_1 (on whole data)
applying B2a (on whole data)
loading from /home/jcidatascience/jaume/workspace/remote/block-types/test_pipeline_find_last_result_parallel1/whole/B2a_result.pk
loaded pre-computed result
applying B2b (on whole data)
saving to /home/jcidatascience/jaume/workspace/remote/block-types/test_pipeline_find_last_result_parallel1/whole/B2b_result.pk
applying B2c (on whole data)
saving to /home/jcidatascience/jaume/workspace/remote/block-types/test_pipeline_find_last_result_parallel1/whole/B2c_result.pk
saving to /home/jcidatascience/jaume/workspace/remote/block-types/test_pipeline_find_last_result_parallel1/whole/pipeline_1_result.pk
applying pipeline_1_1 (on whole data)
applying B3b (on whole data)
loading from /home/jcidatascience/jaume/workspace/remote/block-types/test_pipeline_find_last_result_parallel1/whole/B3b_result.pk
loaded pre-computed result
applying B3c (on whole data)
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>parallel class: &lt;class &#39;dsblocks.core.compose.Parallel&#39;&gt;
True
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>saving to /home/jcidatascience/jaume/workspace/remote/block-types/test_pipeline_find_last_result_parallel1/whole/B3c_result.pk
saving to /home/jcidatascience/jaume/workspace/remote/block-types/test_pipeline_find_last_result_parallel1/whole/pipeline_1_1_result.pk
applying B4 (on whole data)
saving to /home/jcidatascience/jaume/workspace/remote/block-types/test_pipeline_find_last_result_parallel1/whole/B4_result.pk
saving to /home/jcidatascience/jaume/workspace/remote/block-types/test_pipeline_find_last_result_parallel1/whole/parallel_result.pk
applying C (on whole data)
saving to /home/jcidatascience/jaume/workspace/remote/block-types/test_pipeline_find_last_result_parallel1/whole/C_result.pk
applying D (on whole data)
saving to /home/jcidatascience/jaume/workspace/remote/block-types/test_pipeline_find_last_result_parallel1/whole/D_result.pk
saving to /home/jcidatascience/jaume/workspace/remote/block-types/test_pipeline_find_last_result_parallel1/whole/pipeline_result.pk
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>[[ 22.  32.  42.]
 [212. 312. 412.]
 [ 33.  43.  53.]
 [  5.   6.   7.]]
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">tst</span><span class="o">.</span><span class="n">run</span> <span class="p">(</span><span class="n">test_pipeline_find_last_result_parallel2</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="s1">&#39;dummy&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>running test_pipeline_find_last_result_parallel2
parallel class: &lt;class &#39;dsblocks.core.compose.Parallel&#39;&gt;
[[ 22.  32.  42.]
 [212. 312. 412.]
 [ 33.  43.  53.]
 [  5.   6.   7.]]
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>applying A (on whole data)
saving to /home/jcidatascience/jaume/workspace/remote/block-types/test_pipeline_find_last_result_parallel2/whole/A_result.pk
applying B1 (on whole data)
saving to /home/jcidatascience/jaume/workspace/remote/block-types/test_pipeline_find_last_result_parallel2/whole/B1_result.pk
applying B2a (on whole data)
saving to /home/jcidatascience/jaume/workspace/remote/block-types/test_pipeline_find_last_result_parallel2/whole/B2a_result.pk
applying B2b (on whole data)
saving to /home/jcidatascience/jaume/workspace/remote/block-types/test_pipeline_find_last_result_parallel2/whole/B2b_result.pk
applying B2c (on whole data)
saving to /home/jcidatascience/jaume/workspace/remote/block-types/test_pipeline_find_last_result_parallel2/whole/B2c_result.pk
applying B3a (on whole data)
saving to /home/jcidatascience/jaume/workspace/remote/block-types/test_pipeline_find_last_result_parallel2/whole/B3a_result.pk
applying B3b (on whole data)
saving to /home/jcidatascience/jaume/workspace/remote/block-types/test_pipeline_find_last_result_parallel2/whole/B3b_result.pk
applying B3c (on whole data)
saving to /home/jcidatascience/jaume/workspace/remote/block-types/test_pipeline_find_last_result_parallel2/whole/B3c_result.pk
applying B4 (on whole data)
saving to /home/jcidatascience/jaume/workspace/remote/block-types/test_pipeline_find_last_result_parallel2/whole/B4_result.pk
applying pipeline (on whole data)
applying parallel (on whole data)
applying B1 (on whole data)
loading from /home/jcidatascience/jaume/workspace/remote/block-types/test_pipeline_find_last_result_parallel2/whole/B1_result.pk
loaded pre-computed result
applying pipeline_1 (on whole data)
applying B2c (on whole data)
loading from /home/jcidatascience/jaume/workspace/remote/block-types/test_pipeline_find_last_result_parallel2/whole/B2c_result.pk
loaded pre-computed result
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>parallel class: &lt;class &#39;dsblocks.core.compose.Parallel&#39;&gt;
True
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>saving to /home/jcidatascience/jaume/workspace/remote/block-types/test_pipeline_find_last_result_parallel2/whole/pipeline_1_result.pk
applying pipeline_1_1 (on whole data)
applying B3c (on whole data)
loading from /home/jcidatascience/jaume/workspace/remote/block-types/test_pipeline_find_last_result_parallel2/whole/B3c_result.pk
loaded pre-computed result
saving to /home/jcidatascience/jaume/workspace/remote/block-types/test_pipeline_find_last_result_parallel2/whole/pipeline_1_1_result.pk
applying B4 (on whole data)
loading from /home/jcidatascience/jaume/workspace/remote/block-types/test_pipeline_find_last_result_parallel2/whole/B4_result.pk
loaded pre-computed result
saving to /home/jcidatascience/jaume/workspace/remote/block-types/test_pipeline_find_last_result_parallel2/whole/parallel_result.pk
applying C (on whole data)
saving to /home/jcidatascience/jaume/workspace/remote/block-types/test_pipeline_find_last_result_parallel2/whole/C_result.pk
applying D (on whole data)
saving to /home/jcidatascience/jaume/workspace/remote/block-types/test_pipeline_find_last_result_parallel2/whole/D_result.pk
saving to /home/jcidatascience/jaume/workspace/remote/block-types/test_pipeline_find_last_result_parallel2/whole/pipeline_result.pk
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">tst</span><span class="o">.</span><span class="n">run</span> <span class="p">(</span><span class="n">test_pipeline_find_last_result_parallel3</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="s1">&#39;dummy&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>running test_pipeline_find_last_result_parallel3
parallel class: &lt;class &#39;dsblocks.core.compose.Parallel&#39;&gt;
[[ 22.  32.  42.]
 [212. 312. 412.]
 [ 33.  43.  53.]
 [  5.   6.   7.]]
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>applying A (on whole data)
saving to /home/jcidatascience/jaume/workspace/remote/block-types/test_pipeline_find_last_result_parallel3/whole/A_result.pk
applying new_parallel (on whole data)
applying B1 (on whole data)
saving to /home/jcidatascience/jaume/workspace/remote/block-types/test_pipeline_find_last_result_parallel3/whole/B1_result.pk
applying pipeline_1 (on whole data)
applying B2a (on whole data)
saving to /home/jcidatascience/jaume/workspace/remote/block-types/test_pipeline_find_last_result_parallel3/whole/B2a_result.pk
applying B2b (on whole data)
saving to /home/jcidatascience/jaume/workspace/remote/block-types/test_pipeline_find_last_result_parallel3/whole/B2b_result.pk
applying B2c (on whole data)
saving to /home/jcidatascience/jaume/workspace/remote/block-types/test_pipeline_find_last_result_parallel3/whole/B2c_result.pk
saving to /home/jcidatascience/jaume/workspace/remote/block-types/test_pipeline_find_last_result_parallel3/whole/pipeline_1_result.pk
applying pipeline_1_1 (on whole data)
applying B3a (on whole data)
saving to /home/jcidatascience/jaume/workspace/remote/block-types/test_pipeline_find_last_result_parallel3/whole/B3a_result.pk
applying B3b (on whole data)
saving to /home/jcidatascience/jaume/workspace/remote/block-types/test_pipeline_find_last_result_parallel3/whole/B3b_result.pk
applying B3c (on whole data)
saving to /home/jcidatascience/jaume/workspace/remote/block-types/test_pipeline_find_last_result_parallel3/whole/B3c_result.pk
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>parallel class: &lt;class &#39;dsblocks.utils.dummies.NewParallel&#39;&gt;
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>saving to /home/jcidatascience/jaume/workspace/remote/block-types/test_pipeline_find_last_result_parallel3/whole/pipeline_1_1_result.pk
applying B4 (on whole data)
saving to /home/jcidatascience/jaume/workspace/remote/block-types/test_pipeline_find_last_result_parallel3/whole/B4_result.pk
saving to /home/jcidatascience/jaume/workspace/remote/block-types/test_pipeline_find_last_result_parallel3/whole/new_parallel_result.pk
applying C (on whole data)
saving to /home/jcidatascience/jaume/workspace/remote/block-types/test_pipeline_find_last_result_parallel3/whole/C_result.pk
applying pipeline (on whole data)
applying C (on whole data)
loading from /home/jcidatascience/jaume/workspace/remote/block-types/test_pipeline_find_last_result_parallel3/whole/C_result.pk
loaded pre-computed result
applying D (on whole data)
saving to /home/jcidatascience/jaume/workspace/remote/block-types/test_pipeline_find_last_result_parallel3/whole/D_result.pk
saving to /home/jcidatascience/jaume/workspace/remote/block-types/test_pipeline_find_last_result_parallel3/whole/pipeline_result.pk
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>True
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="find_last_fitted_model-example"><code>find_last_fitted_model</code> example<a class="anchor-link" href="#find_last_fitted_model-example"> </a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="Example-with-Sequential-pipeline">Example with Sequential pipeline<a class="anchor-link" href="#Example-with-Sequential-pipeline"> </a></h4>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="test_pipeline_find_last_fitted_model_seq" class="doc_header"><code>test_pipeline_find_last_fitted_model_seq</code><a href="https://github.com/Jaume-JCI/ds-blocks/tree/main/dsblocks/tests/core/test_compose.py#L1955" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>test_pipeline_find_last_fitted_model_seq</code>()</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">dsblocks.utils.dummies</span> <span class="kn">import</span> <span class="n">make_pipe_fit1</span>

<span class="k">def</span> <span class="nf">test_pipeline_find_last_fitted_model_seq</span> <span class="p">():</span>
    <span class="n">path_results</span> <span class="o">=</span> <span class="s1">&#39;test_pipeline_find_last_fitted_model_seq&#39;</span>
    <span class="n">remove_previous_results</span> <span class="p">(</span><span class="n">path_results</span><span class="o">=</span><span class="n">path_results</span><span class="p">)</span>
    
    <span class="c1"># pipelines</span>
    <span class="n">pipe1</span> <span class="o">=</span> <span class="n">make_pipe_fit1</span> <span class="p">()</span>
    <span class="n">X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">])</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">r1</span> <span class="o">=</span> <span class="n">pipe1</span><span class="o">.</span><span class="n">fit_apply</span> <span class="p">(</span><span class="n">X</span><span class="p">)</span>
    <span class="nb">print</span> <span class="p">(</span><span class="n">r1</span><span class="p">)</span>
    <span class="n">pipe2</span> <span class="o">=</span> <span class="n">make_pipe_fit1</span> <span class="p">(</span><span class="n">path_results</span><span class="o">=</span><span class="n">path_results</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
    <span class="c1"># second</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">pipe2</span><span class="o">.</span><span class="n">A</span><span class="o">.</span><span class="n">fit_apply</span> <span class="p">(</span><span class="n">X</span><span class="p">)</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">pipe2</span><span class="o">.</span><span class="n">B</span><span class="o">.</span><span class="n">fit_apply</span> <span class="p">(</span><span class="n">r</span><span class="p">)</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">pipe2</span><span class="o">.</span><span class="n">C</span><span class="o">.</span><span class="n">fit_apply</span> <span class="p">(</span><span class="n">r</span><span class="p">)</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">pipe2</span><span class="o">.</span><span class="n">D</span><span class="o">.</span><span class="n">fit_apply</span> <span class="p">(</span><span class="n">r</span><span class="p">)</span>

    <span class="n">all_fitted</span> <span class="o">=</span> <span class="n">pipe2</span><span class="o">.</span><span class="n">find_last_fitted_model</span> <span class="p">()</span>
    <span class="k">assert</span> <span class="ow">not</span> <span class="n">all_fitted</span>

    <span class="n">pipe2</span><span class="o">.</span><span class="n">A</span><span class="o">.</span><span class="n">raise_error</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">pipe2</span><span class="o">.</span><span class="n">B</span><span class="o">.</span><span class="n">raise_error</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">pipe2</span><span class="o">.</span><span class="n">B</span><span class="o">.</span><span class="n">create_estimator</span><span class="p">()</span>
    <span class="k">assert</span> <span class="n">pipe2</span><span class="o">.</span><span class="n">B</span><span class="o">.</span><span class="n">estimator</span> <span class="o">==</span> <span class="n">Bunch</span><span class="p">()</span>
    <span class="n">pipe2</span><span class="o">.</span><span class="n">C</span><span class="o">.</span><span class="n">raise_error</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">pipe2</span><span class="o">.</span><span class="n">C</span><span class="o">.</span><span class="n">create_estimator</span><span class="p">()</span>
    <span class="k">assert</span> <span class="n">pipe2</span><span class="o">.</span><span class="n">C</span><span class="o">.</span><span class="n">estimator</span> <span class="o">==</span> <span class="n">Bunch</span><span class="p">()</span>
    <span class="n">r2</span> <span class="o">=</span> <span class="n">pipe2</span><span class="o">.</span><span class="n">fit_apply</span> <span class="p">(</span><span class="kc">None</span><span class="p">)</span>
    <span class="k">assert</span> <span class="p">(</span><span class="n">r1</span><span class="o">==</span><span class="n">r2</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
    <span class="nb">print</span> <span class="p">(</span><span class="n">r2</span><span class="p">)</span>
    
    <span class="n">remove_previous_results</span> <span class="p">(</span><span class="n">path_results</span><span class="o">=</span><span class="n">path_results</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">tst</span><span class="o">.</span><span class="n">run</span> <span class="p">(</span><span class="n">test_pipeline_find_last_fitted_model_seq</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="s1">&#39;dummy&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>running test_pipeline_find_last_fitted_model_seq
[[34034]
 [44034]
 [54034]]
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>applying A (on whole data)
saving to /home/jcidatascience/jaume/workspace/remote/block-types/test_pipeline_find_last_fitted_model_seq/whole/A_result.pk
fitting B (using whole data)
saving to /home/jcidatascience/jaume/workspace/remote/block-types/test_pipeline_find_last_fitted_model_seq/models/B_estimator.pk
applying B (on whole data)
saving to /home/jcidatascience/jaume/workspace/remote/block-types/test_pipeline_find_last_fitted_model_seq/whole/B_result.pk
fitting C (using whole data)
saving to /home/jcidatascience/jaume/workspace/remote/block-types/test_pipeline_find_last_fitted_model_seq/models/C_estimator.pk
applying C (on whole data)
saving to /home/jcidatascience/jaume/workspace/remote/block-types/test_pipeline_find_last_fitted_model_seq/whole/C_result.pk
applying D (on whole data)
saving to /home/jcidatascience/jaume/workspace/remote/block-types/test_pipeline_find_last_fitted_model_seq/whole/D_result.pk
fitting pipeline (using whole data)
loading from /home/jcidatascience/jaume/workspace/remote/block-types/test_pipeline_find_last_fitted_model_seq/models/B_estimator.pk
loading from /home/jcidatascience/jaume/workspace/remote/block-types/test_pipeline_find_last_fitted_model_seq/models/C_estimator.pk
applying D (on whole data)
loading from /home/jcidatascience/jaume/workspace/remote/block-types/test_pipeline_find_last_fitted_model_seq/whole/D_result.pk
loaded pre-computed result
fitting E (using whole data)
saving to /home/jcidatascience/jaume/workspace/remote/block-types/test_pipeline_find_last_fitted_model_seq/models/E_estimator.pk
applying E (on whole data)
saving to /home/jcidatascience/jaume/workspace/remote/block-types/test_pipeline_find_last_fitted_model_seq/whole/E_result.pk
applying F (on whole data)
saving to /home/jcidatascience/jaume/workspace/remote/block-types/test_pipeline_find_last_fitted_model_seq/whole/F_result.pk
fitting G (using whole data)
saving to /home/jcidatascience/jaume/workspace/remote/block-types/test_pipeline_find_last_fitted_model_seq/models/G_estimator.pk
applying G (on whole data)
saving to /home/jcidatascience/jaume/workspace/remote/block-types/test_pipeline_find_last_fitted_model_seq/whole/G_result.pk
saving to /home/jcidatascience/jaume/workspace/remote/block-types/test_pipeline_find_last_fitted_model_seq/whole/pipeline_result.pk
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>[[34034]
 [44034]
 [54034]]
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="Example-with-Parallel-pipeline">Example with Parallel pipeline<a class="anchor-link" href="#Example-with-Parallel-pipeline"> </a></h4>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="test_pipeline_find_last_fitted_model_parallel" class="doc_header"><code>test_pipeline_find_last_fitted_model_parallel</code><a href="https://github.com/Jaume-JCI/ds-blocks/tree/main/dsblocks/tests/core/test_compose.py#L1990" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>test_pipeline_find_last_fitted_model_parallel</code>()</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="test_pipeline_find_last_fitted_model_parallel_remove" class="doc_header"><code>test_pipeline_find_last_fitted_model_parallel_remove</code><a href="https://github.com/Jaume-JCI/ds-blocks/tree/main/dsblocks/tests/core/test_compose.py#L2036" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>test_pipeline_find_last_fitted_model_parallel_remove</code>()</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">dsblocks.utils.dummies</span> <span class="kn">import</span> <span class="n">make_pipe_fit2</span>

<span class="k">def</span> <span class="nf">test_pipeline_find_last_fitted_model_parallel</span> <span class="p">():</span>
    <span class="n">path_results</span> <span class="o">=</span> <span class="s1">&#39;test_pipeline_find_last_fitted_model_parallel&#39;</span>
    <span class="n">remove_previous_results</span> <span class="p">(</span><span class="n">path_results</span><span class="o">=</span><span class="n">path_results</span><span class="p">)</span>
    
    <span class="c1"># pipelines</span>
    <span class="n">pipe1</span> <span class="o">=</span> <span class="n">make_pipe_fit2</span> <span class="p">()</span>
    <span class="n">X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">])</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">r1</span> <span class="o">=</span> <span class="n">pipe1</span><span class="o">.</span><span class="n">fit_apply</span> <span class="p">(</span><span class="n">X</span><span class="p">)</span>
    <span class="nb">print</span> <span class="p">(</span><span class="n">r1</span><span class="p">)</span>
    <span class="n">pipe2</span> <span class="o">=</span> <span class="n">make_pipe_fit2</span> <span class="p">(</span><span class="n">path_results</span><span class="o">=</span><span class="n">path_results</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">root</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="c1"># second</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">pipe2</span><span class="o">.</span><span class="n">A0</span><span class="o">.</span><span class="n">fit_apply</span> <span class="p">(</span><span class="n">X</span><span class="p">)</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">pipe2</span><span class="o">.</span><span class="n">A1</span><span class="o">.</span><span class="n">fit_apply</span> <span class="p">(</span><span class="n">r</span><span class="p">)</span>
    <span class="n">b2</span> <span class="o">=</span> <span class="n">pipe2</span><span class="o">.</span><span class="n">obj</span><span class="o">.</span><span class="n">B2</span><span class="o">.</span><span class="n">fit_apply</span> <span class="p">(</span><span class="n">r</span><span class="p">)</span>
    <span class="n">b3a</span> <span class="o">=</span> <span class="n">pipe2</span><span class="o">.</span><span class="n">obj</span><span class="o">.</span><span class="n">B3a</span><span class="o">.</span><span class="n">fit_apply</span> <span class="p">(</span><span class="n">r</span><span class="p">)</span>
    <span class="n">b3b</span> <span class="o">=</span> <span class="n">pipe2</span><span class="o">.</span><span class="n">obj</span><span class="o">.</span><span class="n">B3b</span><span class="o">.</span><span class="n">fit_apply</span> <span class="p">(</span><span class="n">b3a</span><span class="p">)</span>
    <span class="n">b4a</span> <span class="o">=</span> <span class="n">pipe2</span><span class="o">.</span><span class="n">obj</span><span class="o">.</span><span class="n">B4a</span><span class="o">.</span><span class="n">fit_apply</span> <span class="p">(</span><span class="n">r</span><span class="p">)</span>
    <span class="n">b4b</span> <span class="o">=</span> <span class="n">pipe2</span><span class="o">.</span><span class="n">obj</span><span class="o">.</span><span class="n">B4b</span><span class="o">.</span><span class="n">fit_apply</span> <span class="p">(</span><span class="n">b4a</span><span class="p">)</span>
    <span class="n">b4c</span> <span class="o">=</span> <span class="n">pipe2</span><span class="o">.</span><span class="n">obj</span><span class="o">.</span><span class="n">B4c</span><span class="o">.</span><span class="n">fit_apply</span> <span class="p">(</span><span class="n">b4b</span><span class="p">)</span>
    <span class="n">b4d</span> <span class="o">=</span> <span class="n">pipe2</span><span class="o">.</span><span class="n">obj</span><span class="o">.</span><span class="n">B4d</span><span class="o">.</span><span class="n">fit_apply</span> <span class="p">(</span><span class="n">b4c</span><span class="p">)</span>
    <span class="n">b4e</span> <span class="o">=</span> <span class="n">pipe2</span><span class="o">.</span><span class="n">obj</span><span class="o">.</span><span class="n">B4e</span><span class="o">.</span><span class="n">fit_apply</span> <span class="p">(</span><span class="n">b4d</span><span class="p">)</span>

    <span class="n">all_fitted</span> <span class="o">=</span> <span class="n">pipe2</span><span class="o">.</span><span class="n">find_last_fitted_model</span> <span class="p">()</span>
    <span class="k">assert</span> <span class="ow">not</span> <span class="n">all_fitted</span>

    <span class="n">pipe2</span><span class="o">.</span><span class="n">A0</span><span class="o">.</span><span class="n">raise_error</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">pipe2</span><span class="o">.</span><span class="n">obj</span><span class="o">.</span><span class="n">B3a</span><span class="o">.</span><span class="n">raise_error</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">pipe2</span><span class="o">.</span><span class="n">obj</span><span class="o">.</span><span class="n">B4a</span><span class="o">.</span><span class="n">raise_error</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">pipe2</span><span class="o">.</span><span class="n">obj</span><span class="o">.</span><span class="n">B4b</span><span class="o">.</span><span class="n">raise_error</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">pipe2</span><span class="o">.</span><span class="n">obj</span><span class="o">.</span><span class="n">B4c</span><span class="o">.</span><span class="n">raise_error</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">pipe2</span><span class="o">.</span><span class="n">obj</span><span class="o">.</span><span class="n">B4d</span><span class="o">.</span><span class="n">raise_error</span> <span class="o">=</span> <span class="kc">True</span>
    
    <span class="n">pipe2</span><span class="o">.</span><span class="n">A1</span><span class="o">.</span><span class="n">create_estimator</span><span class="p">()</span>
    <span class="n">pipe2</span><span class="o">.</span><span class="n">obj</span><span class="o">.</span><span class="n">B2</span><span class="o">.</span><span class="n">create_estimator</span><span class="p">()</span>
    <span class="n">pipe2</span><span class="o">.</span><span class="n">obj</span><span class="o">.</span><span class="n">B3a</span><span class="o">.</span><span class="n">create_estimator</span><span class="p">()</span>
    <span class="n">pipe2</span><span class="o">.</span><span class="n">obj</span><span class="o">.</span><span class="n">B3b</span><span class="o">.</span><span class="n">create_estimator</span><span class="p">()</span>
    <span class="n">pipe2</span><span class="o">.</span><span class="n">obj</span><span class="o">.</span><span class="n">B4b</span><span class="o">.</span><span class="n">create_estimator</span><span class="p">()</span>
    <span class="n">pipe2</span><span class="o">.</span><span class="n">obj</span><span class="o">.</span><span class="n">B4c</span><span class="o">.</span><span class="n">create_estimator</span><span class="p">()</span>
    <span class="n">pipe2</span><span class="o">.</span><span class="n">obj</span><span class="o">.</span><span class="n">B4e</span><span class="o">.</span><span class="n">create_estimator</span><span class="p">()</span>
    
    <span class="n">pipe2</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span> <span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="se">\n</span><span class="si">{</span><span class="s2">&quot;-&quot;</span><span class="o">*</span><span class="mi">100</span><span class="si">}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">r2</span> <span class="o">=</span> <span class="n">pipe2</span><span class="o">.</span><span class="n">fit_apply</span> <span class="p">(</span><span class="kc">None</span><span class="p">)</span>
    <span class="k">assert</span> <span class="p">(</span><span class="n">r1</span><span class="o">==</span><span class="n">r2</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
    
    <span class="n">remove_previous_results</span> <span class="p">(</span><span class="n">path_results</span><span class="o">=</span><span class="n">path_results</span><span class="p">)</span>
    
<span class="k">def</span> <span class="nf">test_pipeline_find_last_fitted_model_parallel_remove</span> <span class="p">():</span>
    
    <span class="n">path_results</span> <span class="o">=</span> <span class="s1">&#39;test_pipeline_find_last_fitted_model_parallel_remove&#39;</span>
    <span class="n">remove_previous_results</span> <span class="p">(</span><span class="n">path_results</span><span class="o">=</span><span class="n">path_results</span><span class="p">)</span>
    
    <span class="c1"># ******************************************************</span>
    <span class="c1"># pipelines</span>
    <span class="n">pipe1</span> <span class="o">=</span> <span class="n">make_pipe_fit2</span> <span class="p">()</span>
    <span class="n">X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">])</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">r1</span> <span class="o">=</span> <span class="n">pipe1</span><span class="o">.</span><span class="n">fit_apply</span> <span class="p">(</span><span class="n">X</span><span class="p">)</span>
    
    <span class="c1"># ******************************************************</span>
    <span class="n">pipe2</span> <span class="o">=</span> <span class="n">make_pipe_fit2</span> <span class="p">(</span><span class="n">path_results</span><span class="o">=</span><span class="n">path_results</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">root</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    
    <span class="n">r</span> <span class="o">=</span> <span class="n">pipe2</span><span class="o">.</span><span class="n">A0</span><span class="o">.</span><span class="n">fit_apply</span> <span class="p">(</span><span class="n">X</span><span class="p">)</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">pipe2</span><span class="o">.</span><span class="n">A1</span><span class="o">.</span><span class="n">fit_apply</span> <span class="p">(</span><span class="n">r</span><span class="p">)</span>
    
    <span class="n">b1</span> <span class="o">=</span> <span class="n">pipe2</span><span class="o">.</span><span class="n">obj</span><span class="o">.</span><span class="n">B1</span><span class="o">.</span><span class="n">fit_apply</span> <span class="p">(</span><span class="n">r</span><span class="p">)</span>
    <span class="n">b2</span> <span class="o">=</span> <span class="n">pipe2</span><span class="o">.</span><span class="n">obj</span><span class="o">.</span><span class="n">B2</span><span class="o">.</span><span class="n">fit_apply</span> <span class="p">(</span><span class="n">r</span><span class="p">)</span>
    
    <span class="n">b3a</span> <span class="o">=</span> <span class="n">pipe2</span><span class="o">.</span><span class="n">obj</span><span class="o">.</span><span class="n">B3a</span><span class="o">.</span><span class="n">fit_apply</span> <span class="p">(</span><span class="n">r</span><span class="p">)</span>
    <span class="n">b3b</span> <span class="o">=</span> <span class="n">pipe2</span><span class="o">.</span><span class="n">obj</span><span class="o">.</span><span class="n">B3b</span><span class="o">.</span><span class="n">fit_apply</span> <span class="p">(</span><span class="n">b3a</span><span class="p">)</span>
    <span class="n">b3c</span> <span class="o">=</span> <span class="n">pipe2</span><span class="o">.</span><span class="n">obj</span><span class="o">.</span><span class="n">B3c</span><span class="o">.</span><span class="n">fit_apply</span> <span class="p">(</span><span class="n">b3b</span><span class="p">)</span>
    <span class="n">b3d</span> <span class="o">=</span> <span class="n">pipe2</span><span class="o">.</span><span class="n">obj</span><span class="o">.</span><span class="n">B3d</span><span class="o">.</span><span class="n">fit_apply</span> <span class="p">(</span><span class="n">b3c</span><span class="p">)</span>
    
    <span class="n">b4a</span> <span class="o">=</span> <span class="n">pipe2</span><span class="o">.</span><span class="n">obj</span><span class="o">.</span><span class="n">B4a</span><span class="o">.</span><span class="n">fit_apply</span> <span class="p">(</span><span class="n">r</span><span class="p">)</span>
    <span class="n">b4b</span> <span class="o">=</span> <span class="n">pipe2</span><span class="o">.</span><span class="n">obj</span><span class="o">.</span><span class="n">B4b</span><span class="o">.</span><span class="n">fit_apply</span> <span class="p">(</span><span class="n">b4a</span><span class="p">)</span>
    <span class="n">b4c</span> <span class="o">=</span> <span class="n">pipe2</span><span class="o">.</span><span class="n">obj</span><span class="o">.</span><span class="n">B4c</span><span class="o">.</span><span class="n">fit_apply</span> <span class="p">(</span><span class="n">b4b</span><span class="p">)</span>
    <span class="n">b4d</span> <span class="o">=</span> <span class="n">pipe2</span><span class="o">.</span><span class="n">obj</span><span class="o">.</span><span class="n">B4d</span><span class="o">.</span><span class="n">fit_apply</span> <span class="p">(</span><span class="n">b4c</span><span class="p">)</span>
    <span class="n">b4e</span> <span class="o">=</span> <span class="n">pipe2</span><span class="o">.</span><span class="n">obj</span><span class="o">.</span><span class="n">B4e</span><span class="o">.</span><span class="n">fit_apply</span> <span class="p">(</span><span class="n">b4d</span><span class="p">)</span>
    
    <span class="n">b5</span> <span class="o">=</span> <span class="n">pipe2</span><span class="o">.</span><span class="n">obj</span><span class="o">.</span><span class="n">B5</span><span class="o">.</span><span class="n">fit_apply</span> <span class="p">(</span><span class="n">r</span><span class="p">)</span>
    
    <span class="n">pipe2</span><span class="o">.</span><span class="n">obj</span><span class="o">.</span><span class="n">B4d</span><span class="o">.</span><span class="n">set_load_result</span> <span class="p">(</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">pipe2</span><span class="o">.</span><span class="n">obj</span><span class="o">.</span><span class="n">B4e</span><span class="o">.</span><span class="n">set_load_result</span> <span class="p">(</span><span class="kc">False</span><span class="p">)</span>

    <span class="n">all_fitted</span> <span class="o">=</span> <span class="n">pipe2</span><span class="o">.</span><span class="n">find_last_fitted_model</span> <span class="p">()</span>
    <span class="k">assert</span> <span class="ow">not</span> <span class="n">all_fitted</span>

    <span class="n">pipe2</span><span class="o">.</span><span class="n">A0</span><span class="o">.</span><span class="n">raise_error</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">pipe2</span><span class="o">.</span><span class="n">A1</span><span class="o">.</span><span class="n">raise_error</span> <span class="o">=</span> <span class="kc">True</span>
    
    <span class="n">pipe2</span><span class="o">.</span><span class="n">obj</span><span class="o">.</span><span class="n">B1</span><span class="o">.</span><span class="n">applied</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">pipe2</span><span class="o">.</span><span class="n">obj</span><span class="o">.</span><span class="n">B2</span><span class="o">.</span><span class="n">fit_applied</span> <span class="o">=</span> <span class="kc">False</span>
        
    <span class="n">pipe2</span><span class="o">.</span><span class="n">obj</span><span class="o">.</span><span class="n">B3a</span><span class="o">.</span><span class="n">raise_error</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">pipe2</span><span class="o">.</span><span class="n">obj</span><span class="o">.</span><span class="n">B3b</span><span class="o">.</span><span class="n">raise_error</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">pipe2</span><span class="o">.</span><span class="n">obj</span><span class="o">.</span><span class="n">B3c</span><span class="o">.</span><span class="n">raise_error</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">pipe2</span><span class="o">.</span><span class="n">obj</span><span class="o">.</span><span class="n">B3d</span><span class="o">.</span><span class="n">fit_applied</span> <span class="o">=</span> <span class="kc">False</span>
        
    <span class="n">pipe2</span><span class="o">.</span><span class="n">obj</span><span class="o">.</span><span class="n">B4a</span><span class="o">.</span><span class="n">raise_error</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">pipe2</span><span class="o">.</span><span class="n">obj</span><span class="o">.</span><span class="n">B4b</span><span class="o">.</span><span class="n">raise_error</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">pipe2</span><span class="o">.</span><span class="n">obj</span><span class="o">.</span><span class="n">B4c</span><span class="o">.</span><span class="n">fit_applied</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">pipe2</span><span class="o">.</span><span class="n">obj</span><span class="o">.</span><span class="n">B4d</span><span class="o">.</span><span class="n">applied</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">pipe2</span><span class="o">.</span><span class="n">obj</span><span class="o">.</span><span class="n">B4e</span><span class="o">.</span><span class="n">fit_applied</span> <span class="o">=</span> <span class="kc">False</span>
    
    <span class="n">pipe2</span><span class="o">.</span><span class="n">obj</span><span class="o">.</span><span class="n">B5</span><span class="o">.</span><span class="n">fit_applied</span> <span class="o">=</span> <span class="kc">False</span>
    
    <span class="n">pipe2</span><span class="o">.</span><span class="n">A1</span><span class="o">.</span><span class="n">create_estimator</span><span class="p">()</span>
    <span class="n">pipe2</span><span class="o">.</span><span class="n">obj</span><span class="o">.</span><span class="n">B2</span><span class="o">.</span><span class="n">create_estimator</span><span class="p">()</span>
    <span class="n">pipe2</span><span class="o">.</span><span class="n">obj</span><span class="o">.</span><span class="n">B3a</span><span class="o">.</span><span class="n">create_estimator</span><span class="p">()</span>
    <span class="n">pipe2</span><span class="o">.</span><span class="n">obj</span><span class="o">.</span><span class="n">B3b</span><span class="o">.</span><span class="n">create_estimator</span><span class="p">()</span>
    <span class="n">pipe2</span><span class="o">.</span><span class="n">obj</span><span class="o">.</span><span class="n">B4b</span><span class="o">.</span><span class="n">create_estimator</span><span class="p">()</span>
    <span class="n">pipe2</span><span class="o">.</span><span class="n">obj</span><span class="o">.</span><span class="n">B4c</span><span class="o">.</span><span class="n">create_estimator</span><span class="p">()</span>
    <span class="n">pipe2</span><span class="o">.</span><span class="n">obj</span><span class="o">.</span><span class="n">B4e</span><span class="o">.</span><span class="n">create_estimator</span><span class="p">()</span>
    <span class="n">pipe2</span><span class="o">.</span><span class="n">obj</span><span class="o">.</span><span class="n">B5</span><span class="o">.</span><span class="n">create_estimator</span><span class="p">()</span>
    
    <span class="n">pipe2</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span> <span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="se">\n</span><span class="si">{</span><span class="s2">&quot;-&quot;</span><span class="o">*</span><span class="mi">100</span><span class="si">}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">r2</span> <span class="o">=</span> <span class="n">pipe2</span><span class="o">.</span><span class="n">fit_apply</span> <span class="p">(</span><span class="kc">None</span><span class="p">)</span>
    <span class="k">assert</span> <span class="p">(</span><span class="n">r1</span><span class="o">==</span><span class="n">r2</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
    
    <span class="k">assert</span> <span class="n">pipe2</span><span class="o">.</span><span class="n">obj</span><span class="o">.</span><span class="n">B1</span><span class="o">.</span><span class="n">applied</span>
    <span class="k">assert</span> <span class="n">pipe2</span><span class="o">.</span><span class="n">obj</span><span class="o">.</span><span class="n">B2</span><span class="o">.</span><span class="n">fit_applied</span>
    <span class="k">assert</span> <span class="n">pipe2</span><span class="o">.</span><span class="n">obj</span><span class="o">.</span><span class="n">B3d</span><span class="o">.</span><span class="n">fit_applied</span>
    
    <span class="k">assert</span> <span class="n">pipe2</span><span class="o">.</span><span class="n">obj</span><span class="o">.</span><span class="n">B4c</span><span class="o">.</span><span class="n">fit_applied</span>
    <span class="k">assert</span> <span class="n">pipe2</span><span class="o">.</span><span class="n">obj</span><span class="o">.</span><span class="n">B4d</span><span class="o">.</span><span class="n">applied</span>
    <span class="k">assert</span> <span class="n">pipe2</span><span class="o">.</span><span class="n">obj</span><span class="o">.</span><span class="n">B4e</span><span class="o">.</span><span class="n">fit_applied</span>
    
    <span class="k">assert</span> <span class="n">pipe2</span><span class="o">.</span><span class="n">obj</span><span class="o">.</span><span class="n">B5</span><span class="o">.</span><span class="n">fit_applied</span>
    
    <span class="n">remove_previous_results</span> <span class="p">(</span><span class="n">path_results</span><span class="o">=</span><span class="n">path_results</span><span class="p">)</span>
    
    <span class="c1"># ******************************************************</span>
    <span class="n">pipe2</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span> <span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="se">\n</span><span class="si">{</span><span class="s2">&quot;*&quot;</span><span class="o">*</span><span class="mi">100</span><span class="si">}</span><span class="se">\n</span><span class="si">{</span><span class="s2">&quot;*&quot;</span><span class="o">*</span><span class="mi">100</span><span class="si">}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">pipe2</span> <span class="o">=</span> <span class="n">make_pipe_fit2</span> <span class="p">(</span><span class="n">path_results</span><span class="o">=</span><span class="n">path_results</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">root</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="c1"># second</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">pipe2</span><span class="o">.</span><span class="n">A0</span><span class="o">.</span><span class="n">fit_apply</span> <span class="p">(</span><span class="n">X</span><span class="p">)</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">pipe2</span><span class="o">.</span><span class="n">A1</span><span class="o">.</span><span class="n">fit_apply</span> <span class="p">(</span><span class="n">r</span><span class="p">)</span>
    
    <span class="n">b1</span> <span class="o">=</span> <span class="n">pipe2</span><span class="o">.</span><span class="n">obj</span><span class="o">.</span><span class="n">B1</span><span class="o">.</span><span class="n">fit_apply</span> <span class="p">(</span><span class="n">r</span><span class="p">)</span>
    <span class="n">b2</span> <span class="o">=</span> <span class="n">pipe2</span><span class="o">.</span><span class="n">obj</span><span class="o">.</span><span class="n">B2</span><span class="o">.</span><span class="n">fit_apply</span> <span class="p">(</span><span class="n">r</span><span class="p">)</span>
    
    <span class="n">b3a</span> <span class="o">=</span> <span class="n">pipe2</span><span class="o">.</span><span class="n">obj</span><span class="o">.</span><span class="n">B3a</span><span class="o">.</span><span class="n">fit_apply</span> <span class="p">(</span><span class="n">r</span><span class="p">)</span>
    <span class="n">b3b</span> <span class="o">=</span> <span class="n">pipe2</span><span class="o">.</span><span class="n">obj</span><span class="o">.</span><span class="n">B3b</span><span class="o">.</span><span class="n">fit_apply</span> <span class="p">(</span><span class="n">b3a</span><span class="p">)</span>
    <span class="n">b3c</span> <span class="o">=</span> <span class="n">pipe2</span><span class="o">.</span><span class="n">obj</span><span class="o">.</span><span class="n">B3c</span><span class="o">.</span><span class="n">fit_apply</span> <span class="p">(</span><span class="n">b3b</span><span class="p">)</span>
    <span class="n">b3d</span> <span class="o">=</span> <span class="n">pipe2</span><span class="o">.</span><span class="n">obj</span><span class="o">.</span><span class="n">B3d</span><span class="o">.</span><span class="n">fit_apply</span> <span class="p">(</span><span class="n">b3c</span><span class="p">)</span>
    
    <span class="n">b4a</span> <span class="o">=</span> <span class="n">pipe2</span><span class="o">.</span><span class="n">obj</span><span class="o">.</span><span class="n">B4a</span><span class="o">.</span><span class="n">fit_apply</span> <span class="p">(</span><span class="n">r</span><span class="p">)</span>
    <span class="n">b4b</span> <span class="o">=</span> <span class="n">pipe2</span><span class="o">.</span><span class="n">obj</span><span class="o">.</span><span class="n">B4b</span><span class="o">.</span><span class="n">fit_apply</span> <span class="p">(</span><span class="n">b4a</span><span class="p">)</span>
    <span class="n">b4c</span> <span class="o">=</span> <span class="n">pipe2</span><span class="o">.</span><span class="n">obj</span><span class="o">.</span><span class="n">B4c</span><span class="o">.</span><span class="n">fit_apply</span> <span class="p">(</span><span class="n">b4b</span><span class="p">)</span>
    <span class="n">b4d</span> <span class="o">=</span> <span class="n">pipe2</span><span class="o">.</span><span class="n">obj</span><span class="o">.</span><span class="n">B4d</span><span class="o">.</span><span class="n">fit_apply</span> <span class="p">(</span><span class="n">b4c</span><span class="p">)</span>
    <span class="n">b4e</span> <span class="o">=</span> <span class="n">pipe2</span><span class="o">.</span><span class="n">obj</span><span class="o">.</span><span class="n">B4e</span><span class="o">.</span><span class="n">fit_apply</span> <span class="p">(</span><span class="n">b4d</span><span class="p">)</span>
    
    <span class="n">b5</span> <span class="o">=</span> <span class="n">pipe2</span><span class="o">.</span><span class="n">obj</span><span class="o">.</span><span class="n">B5</span><span class="o">.</span><span class="n">fit_apply</span> <span class="p">(</span><span class="n">r</span><span class="p">)</span>
    
    <span class="n">os</span><span class="o">.</span><span class="n">remove</span> <span class="p">(</span><span class="n">pipe2</span><span class="o">.</span><span class="n">obj</span><span class="o">.</span><span class="n">B4d</span><span class="o">.</span><span class="n">data_io</span><span class="o">.</span><span class="n">get_path_result_file</span> <span class="p">())</span>
    <span class="n">os</span><span class="o">.</span><span class="n">remove</span> <span class="p">(</span><span class="n">pipe2</span><span class="o">.</span><span class="n">obj</span><span class="o">.</span><span class="n">B4e</span><span class="o">.</span><span class="n">data_io</span><span class="o">.</span><span class="n">get_path_result_file</span> <span class="p">())</span>


    <span class="n">all_fitted</span> <span class="o">=</span> <span class="n">pipe2</span><span class="o">.</span><span class="n">find_last_fitted_model</span> <span class="p">()</span>
    <span class="k">assert</span> <span class="ow">not</span> <span class="n">all_fitted</span>

    <span class="n">pipe2</span><span class="o">.</span><span class="n">A0</span><span class="o">.</span><span class="n">raise_error</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">pipe2</span><span class="o">.</span><span class="n">A1</span><span class="o">.</span><span class="n">raise_error</span> <span class="o">=</span> <span class="kc">True</span>
    
    <span class="n">pipe2</span><span class="o">.</span><span class="n">obj</span><span class="o">.</span><span class="n">B1</span><span class="o">.</span><span class="n">applied</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">pipe2</span><span class="o">.</span><span class="n">obj</span><span class="o">.</span><span class="n">B2</span><span class="o">.</span><span class="n">fit_applied</span> <span class="o">=</span> <span class="kc">False</span>
        
    <span class="n">pipe2</span><span class="o">.</span><span class="n">obj</span><span class="o">.</span><span class="n">B3a</span><span class="o">.</span><span class="n">raise_error</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">pipe2</span><span class="o">.</span><span class="n">obj</span><span class="o">.</span><span class="n">B3b</span><span class="o">.</span><span class="n">raise_error</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">pipe2</span><span class="o">.</span><span class="n">obj</span><span class="o">.</span><span class="n">B3c</span><span class="o">.</span><span class="n">raise_error</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">pipe2</span><span class="o">.</span><span class="n">obj</span><span class="o">.</span><span class="n">B3d</span><span class="o">.</span><span class="n">fit_applied</span> <span class="o">=</span> <span class="kc">False</span>
        
    <span class="n">pipe2</span><span class="o">.</span><span class="n">obj</span><span class="o">.</span><span class="n">B4a</span><span class="o">.</span><span class="n">raise_error</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">pipe2</span><span class="o">.</span><span class="n">obj</span><span class="o">.</span><span class="n">B4b</span><span class="o">.</span><span class="n">raise_error</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">pipe2</span><span class="o">.</span><span class="n">obj</span><span class="o">.</span><span class="n">B4c</span><span class="o">.</span><span class="n">fit_applied</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">pipe2</span><span class="o">.</span><span class="n">obj</span><span class="o">.</span><span class="n">B4d</span><span class="o">.</span><span class="n">applied</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">pipe2</span><span class="o">.</span><span class="n">obj</span><span class="o">.</span><span class="n">B4e</span><span class="o">.</span><span class="n">fit_applied</span> <span class="o">=</span> <span class="kc">False</span>
    
    <span class="n">pipe2</span><span class="o">.</span><span class="n">obj</span><span class="o">.</span><span class="n">B5</span><span class="o">.</span><span class="n">fit_applied</span> <span class="o">=</span> <span class="kc">False</span>
    
    <span class="n">pipe2</span><span class="o">.</span><span class="n">A1</span><span class="o">.</span><span class="n">create_estimator</span><span class="p">()</span>
    <span class="n">pipe2</span><span class="o">.</span><span class="n">obj</span><span class="o">.</span><span class="n">B2</span><span class="o">.</span><span class="n">create_estimator</span><span class="p">()</span>
    <span class="n">pipe2</span><span class="o">.</span><span class="n">obj</span><span class="o">.</span><span class="n">B3a</span><span class="o">.</span><span class="n">create_estimator</span><span class="p">()</span>
    <span class="n">pipe2</span><span class="o">.</span><span class="n">obj</span><span class="o">.</span><span class="n">B3b</span><span class="o">.</span><span class="n">create_estimator</span><span class="p">()</span>
    <span class="n">pipe2</span><span class="o">.</span><span class="n">obj</span><span class="o">.</span><span class="n">B4b</span><span class="o">.</span><span class="n">create_estimator</span><span class="p">()</span>
    <span class="n">pipe2</span><span class="o">.</span><span class="n">obj</span><span class="o">.</span><span class="n">B4c</span><span class="o">.</span><span class="n">create_estimator</span><span class="p">()</span>
    <span class="n">pipe2</span><span class="o">.</span><span class="n">obj</span><span class="o">.</span><span class="n">B4e</span><span class="o">.</span><span class="n">create_estimator</span><span class="p">()</span>
    <span class="n">pipe2</span><span class="o">.</span><span class="n">obj</span><span class="o">.</span><span class="n">B5</span><span class="o">.</span><span class="n">create_estimator</span><span class="p">()</span>
    
    <span class="n">pipe2</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span> <span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="se">\n</span><span class="si">{</span><span class="s2">&quot;-&quot;</span><span class="o">*</span><span class="mi">100</span><span class="si">}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">r2</span> <span class="o">=</span> <span class="n">pipe2</span><span class="o">.</span><span class="n">fit_apply</span> <span class="p">(</span><span class="kc">None</span><span class="p">)</span>
    <span class="k">assert</span> <span class="p">(</span><span class="n">r1</span><span class="o">==</span><span class="n">r2</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
    
    <span class="k">assert</span> <span class="n">pipe2</span><span class="o">.</span><span class="n">obj</span><span class="o">.</span><span class="n">B1</span><span class="o">.</span><span class="n">applied</span>
    <span class="k">assert</span> <span class="n">pipe2</span><span class="o">.</span><span class="n">obj</span><span class="o">.</span><span class="n">B2</span><span class="o">.</span><span class="n">fit_applied</span>
    <span class="k">assert</span> <span class="n">pipe2</span><span class="o">.</span><span class="n">obj</span><span class="o">.</span><span class="n">B3d</span><span class="o">.</span><span class="n">fit_applied</span>
    
    <span class="k">assert</span> <span class="n">pipe2</span><span class="o">.</span><span class="n">obj</span><span class="o">.</span><span class="n">B4c</span><span class="o">.</span><span class="n">fit_applied</span>
    <span class="k">assert</span> <span class="n">pipe2</span><span class="o">.</span><span class="n">obj</span><span class="o">.</span><span class="n">B4d</span><span class="o">.</span><span class="n">applied</span>
    <span class="k">assert</span> <span class="n">pipe2</span><span class="o">.</span><span class="n">obj</span><span class="o">.</span><span class="n">B4e</span><span class="o">.</span><span class="n">fit_applied</span>
    
    <span class="k">assert</span> <span class="n">pipe2</span><span class="o">.</span><span class="n">obj</span><span class="o">.</span><span class="n">B5</span><span class="o">.</span><span class="n">fit_applied</span>

    
    <span class="n">remove_previous_results</span> <span class="p">(</span><span class="n">path_results</span><span class="o">=</span><span class="n">path_results</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">tst</span><span class="o">.</span><span class="n">run</span> <span class="p">(</span><span class="n">test_pipeline_find_last_fitted_model_parallel</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="s1">&#39;dummy&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>running test_pipeline_find_last_fitted_model_parallel
parallel class: &lt;class &#39;dsblocks.core.compose.Parallel&#39;&gt;
[[ 57256.]
 [ 58256.]
 [ 59256.]
 [ 57476.]
 [ 58476.]
 [ 59476.]
 [369986.]
 [469986.]
 [569986.]
 [405496.]
 [505496.]
 [605496.]
 [ 57676.]
 [ 58676.]
 [ 59676.]]
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>applying A0 (on whole data)
saving to /home/jcidatascience/jaume/workspace/remote/block-types/test_pipeline_find_last_fitted_model_parallel/whole/A0_result.pk
fitting A1 (using whole data)
saving to /home/jcidatascience/jaume/workspace/remote/block-types/test_pipeline_find_last_fitted_model_parallel/models/A1_estimator.pk
applying A1 (on whole data)
saving to /home/jcidatascience/jaume/workspace/remote/block-types/test_pipeline_find_last_fitted_model_parallel/whole/A1_result.pk
fitting B2 (using whole data)
saving to /home/jcidatascience/jaume/workspace/remote/block-types/test_pipeline_find_last_fitted_model_parallel/models/B2_estimator.pk
applying B2 (on whole data)
saving to /home/jcidatascience/jaume/workspace/remote/block-types/test_pipeline_find_last_fitted_model_parallel/whole/B2_result.pk
fitting B3a (using whole data)
saving to /home/jcidatascience/jaume/workspace/remote/block-types/test_pipeline_find_last_fitted_model_parallel/models/B3a_estimator.pk
applying B3a (on whole data)
saving to /home/jcidatascience/jaume/workspace/remote/block-types/test_pipeline_find_last_fitted_model_parallel/whole/B3a_result.pk
fitting B3b (using whole data)
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>parallel class: &lt;class &#39;dsblocks.core.compose.Parallel&#39;&gt;
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>saving to /home/jcidatascience/jaume/workspace/remote/block-types/test_pipeline_find_last_fitted_model_parallel/models/B3b_estimator.pk
applying B3b (on whole data)
saving to /home/jcidatascience/jaume/workspace/remote/block-types/test_pipeline_find_last_fitted_model_parallel/whole/B3b_result.pk
applying B4a (on whole data)
saving to /home/jcidatascience/jaume/workspace/remote/block-types/test_pipeline_find_last_fitted_model_parallel/whole/B4a_result.pk
fitting B4b (using whole data)
saving to /home/jcidatascience/jaume/workspace/remote/block-types/test_pipeline_find_last_fitted_model_parallel/models/B4b_estimator.pk
applying B4b (on whole data)
saving to /home/jcidatascience/jaume/workspace/remote/block-types/test_pipeline_find_last_fitted_model_parallel/whole/B4b_result.pk
fitting B4c (using whole data)
saving to /home/jcidatascience/jaume/workspace/remote/block-types/test_pipeline_find_last_fitted_model_parallel/models/B4c_estimator.pk
applying B4c (on whole data)
saving to /home/jcidatascience/jaume/workspace/remote/block-types/test_pipeline_find_last_fitted_model_parallel/whole/B4c_result.pk
applying B4d (on whole data)
saving to /home/jcidatascience/jaume/workspace/remote/block-types/test_pipeline_find_last_fitted_model_parallel/whole/B4d_result.pk
fitting B4e (using whole data)
saving to /home/jcidatascience/jaume/workspace/remote/block-types/test_pipeline_find_last_fitted_model_parallel/models/B4e_estimator.pk
applying B4e (on whole data)
saving to /home/jcidatascience/jaume/workspace/remote/block-types/test_pipeline_find_last_fitted_model_parallel/whole/B4e_result.pk

----------------------------------------------------------------------------------------------------

fitting pipeline (using whole data)
fitting A1 (using whole data)
loading from /home/jcidatascience/jaume/workspace/remote/block-types/test_pipeline_find_last_fitted_model_parallel/models/A1_estimator.pk
loaded pre-trained A1
applying A1 (on whole data)
loading from /home/jcidatascience/jaume/workspace/remote/block-types/test_pipeline_find_last_fitted_model_parallel/whole/A1_result.pk
loaded pre-computed result
fitting parallel (using whole data)
applying B1 (on whole data)
saving to /home/jcidatascience/jaume/workspace/remote/block-types/test_pipeline_find_last_fitted_model_parallel/whole/B1_result.pk
fitting B2 (using whole data)
loading from /home/jcidatascience/jaume/workspace/remote/block-types/test_pipeline_find_last_fitted_model_parallel/models/B2_estimator.pk
loaded pre-trained B2
applying B2 (on whole data)
loading from /home/jcidatascience/jaume/workspace/remote/block-types/test_pipeline_find_last_fitted_model_parallel/whole/B2_result.pk
loaded pre-computed result
fitting pipeline_1 (using whole data)
loading from /home/jcidatascience/jaume/workspace/remote/block-types/test_pipeline_find_last_fitted_model_parallel/models/B3a_estimator.pk
fitting B3b (using whole data)
loading from /home/jcidatascience/jaume/workspace/remote/block-types/test_pipeline_find_last_fitted_model_parallel/models/B3b_estimator.pk
loaded pre-trained B3b
applying B3b (on whole data)
loading from /home/jcidatascience/jaume/workspace/remote/block-types/test_pipeline_find_last_fitted_model_parallel/whole/B3b_result.pk
loaded pre-computed result
applying B3c (on whole data)
saving to /home/jcidatascience/jaume/workspace/remote/block-types/test_pipeline_find_last_fitted_model_parallel/whole/B3c_result.pk
fitting B3d (using whole data)
saving to /home/jcidatascience/jaume/workspace/remote/block-types/test_pipeline_find_last_fitted_model_parallel/models/B3d_estimator.pk
applying B3d (on whole data)
saving to /home/jcidatascience/jaume/workspace/remote/block-types/test_pipeline_find_last_fitted_model_parallel/whole/B3d_result.pk
saving to /home/jcidatascience/jaume/workspace/remote/block-types/test_pipeline_find_last_fitted_model_parallel/whole/pipeline_1_result.pk
fitting pipeline_1_1 (using whole data)
loading from /home/jcidatascience/jaume/workspace/remote/block-types/test_pipeline_find_last_fitted_model_parallel/models/B4b_estimator.pk
loading from /home/jcidatascience/jaume/workspace/remote/block-types/test_pipeline_find_last_fitted_model_parallel/models/B4c_estimator.pk
fitting B4e (using whole data)
loading from /home/jcidatascience/jaume/workspace/remote/block-types/test_pipeline_find_last_fitted_model_parallel/models/B4e_estimator.pk
loaded pre-trained B4e
applying B4e (on whole data)
loading from /home/jcidatascience/jaume/workspace/remote/block-types/test_pipeline_find_last_fitted_model_parallel/whole/B4e_result.pk
loaded pre-computed result
saving to /home/jcidatascience/jaume/workspace/remote/block-types/test_pipeline_find_last_fitted_model_parallel/whole/pipeline_1_1_result.pk
fitting B5 (using whole data)
saving to /home/jcidatascience/jaume/workspace/remote/block-types/test_pipeline_find_last_fitted_model_parallel/models/B5_estimator.pk
applying B5 (on whole data)
saving to /home/jcidatascience/jaume/workspace/remote/block-types/test_pipeline_find_last_fitted_model_parallel/whole/B5_result.pk
saving to /home/jcidatascience/jaume/workspace/remote/block-types/test_pipeline_find_last_fitted_model_parallel/whole/parallel_result.pk
applying C (on whole data)
saving to /home/jcidatascience/jaume/workspace/remote/block-types/test_pipeline_find_last_fitted_model_parallel/whole/C_result.pk
fitting D (using whole data)
saving to /home/jcidatascience/jaume/workspace/remote/block-types/test_pipeline_find_last_fitted_model_parallel/models/D_estimator.pk
applying D (on whole data)
saving to /home/jcidatascience/jaume/workspace/remote/block-types/test_pipeline_find_last_fitted_model_parallel/whole/D_result.pk
applying E (on whole data)
saving to /home/jcidatascience/jaume/workspace/remote/block-types/test_pipeline_find_last_fitted_model_parallel/whole/E_result.pk
saving to /home/jcidatascience/jaume/workspace/remote/block-types/test_pipeline_find_last_fitted_model_parallel/whole/pipeline_result.pk
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">tst</span><span class="o">.</span><span class="n">run</span> <span class="p">(</span><span class="n">test_pipeline_find_last_fitted_model_parallel_remove</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="s1">&#39;dummy&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>running test_pipeline_find_last_fitted_model_parallel_remove
parallel class: &lt;class &#39;dsblocks.core.compose.Parallel&#39;&gt;
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>applying A0 (on whole data)
saving to /home/jcidatascience/jaume/workspace/remote/block-types/test_pipeline_find_last_fitted_model_parallel_remove/whole/A0_result.pk
fitting A1 (using whole data)
saving to /home/jcidatascience/jaume/workspace/remote/block-types/test_pipeline_find_last_fitted_model_parallel_remove/models/A1_estimator.pk
applying A1 (on whole data)
saving to /home/jcidatascience/jaume/workspace/remote/block-types/test_pipeline_find_last_fitted_model_parallel_remove/whole/A1_result.pk
applying B1 (on whole data)
saving to /home/jcidatascience/jaume/workspace/remote/block-types/test_pipeline_find_last_fitted_model_parallel_remove/whole/B1_result.pk
fitting B2 (using whole data)
saving to /home/jcidatascience/jaume/workspace/remote/block-types/test_pipeline_find_last_fitted_model_parallel_remove/models/B2_estimator.pk
applying B2 (on whole data)
saving to /home/jcidatascience/jaume/workspace/remote/block-types/test_pipeline_find_last_fitted_model_parallel_remove/whole/B2_result.pk
fitting B3a (using whole data)
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>parallel class: &lt;class &#39;dsblocks.core.compose.Parallel&#39;&gt;
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>saving to /home/jcidatascience/jaume/workspace/remote/block-types/test_pipeline_find_last_fitted_model_parallel_remove/models/B3a_estimator.pk
applying B3a (on whole data)
saving to /home/jcidatascience/jaume/workspace/remote/block-types/test_pipeline_find_last_fitted_model_parallel_remove/whole/B3a_result.pk
fitting B3b (using whole data)
saving to /home/jcidatascience/jaume/workspace/remote/block-types/test_pipeline_find_last_fitted_model_parallel_remove/models/B3b_estimator.pk
applying B3b (on whole data)
saving to /home/jcidatascience/jaume/workspace/remote/block-types/test_pipeline_find_last_fitted_model_parallel_remove/whole/B3b_result.pk
applying B3c (on whole data)
saving to /home/jcidatascience/jaume/workspace/remote/block-types/test_pipeline_find_last_fitted_model_parallel_remove/whole/B3c_result.pk
fitting B3d (using whole data)
saving to /home/jcidatascience/jaume/workspace/remote/block-types/test_pipeline_find_last_fitted_model_parallel_remove/models/B3d_estimator.pk
applying B3d (on whole data)
saving to /home/jcidatascience/jaume/workspace/remote/block-types/test_pipeline_find_last_fitted_model_parallel_remove/whole/B3d_result.pk
applying B4a (on whole data)
saving to /home/jcidatascience/jaume/workspace/remote/block-types/test_pipeline_find_last_fitted_model_parallel_remove/whole/B4a_result.pk
fitting B4b (using whole data)
saving to /home/jcidatascience/jaume/workspace/remote/block-types/test_pipeline_find_last_fitted_model_parallel_remove/models/B4b_estimator.pk
applying B4b (on whole data)
saving to /home/jcidatascience/jaume/workspace/remote/block-types/test_pipeline_find_last_fitted_model_parallel_remove/whole/B4b_result.pk
fitting B4c (using whole data)
saving to /home/jcidatascience/jaume/workspace/remote/block-types/test_pipeline_find_last_fitted_model_parallel_remove/models/B4c_estimator.pk
applying B4c (on whole data)
saving to /home/jcidatascience/jaume/workspace/remote/block-types/test_pipeline_find_last_fitted_model_parallel_remove/whole/B4c_result.pk
applying B4d (on whole data)
saving to /home/jcidatascience/jaume/workspace/remote/block-types/test_pipeline_find_last_fitted_model_parallel_remove/whole/B4d_result.pk
fitting B4e (using whole data)
saving to /home/jcidatascience/jaume/workspace/remote/block-types/test_pipeline_find_last_fitted_model_parallel_remove/models/B4e_estimator.pk
applying B4e (on whole data)
saving to /home/jcidatascience/jaume/workspace/remote/block-types/test_pipeline_find_last_fitted_model_parallel_remove/whole/B4e_result.pk
fitting B5 (using whole data)
saving to /home/jcidatascience/jaume/workspace/remote/block-types/test_pipeline_find_last_fitted_model_parallel_remove/models/B5_estimator.pk
applying B5 (on whole data)
saving to /home/jcidatascience/jaume/workspace/remote/block-types/test_pipeline_find_last_fitted_model_parallel_remove/whole/B5_result.pk

----------------------------------------------------------------------------------------------------

fitting pipeline (using whole data)
loading from /home/jcidatascience/jaume/workspace/remote/block-types/test_pipeline_find_last_fitted_model_parallel_remove/models/A1_estimator.pk
fitting parallel (using whole data)
applying B1 (on whole data)
loading from /home/jcidatascience/jaume/workspace/remote/block-types/test_pipeline_find_last_fitted_model_parallel_remove/whole/B1_result.pk
loaded pre-computed result
fitting B2 (using whole data)
loading from /home/jcidatascience/jaume/workspace/remote/block-types/test_pipeline_find_last_fitted_model_parallel_remove/models/B2_estimator.pk
loaded pre-trained B2
applying B2 (on whole data)
loading from /home/jcidatascience/jaume/workspace/remote/block-types/test_pipeline_find_last_fitted_model_parallel_remove/whole/B2_result.pk
loaded pre-computed result
fitting pipeline_1 (using whole data)
loading from /home/jcidatascience/jaume/workspace/remote/block-types/test_pipeline_find_last_fitted_model_parallel_remove/models/B3a_estimator.pk
loading from /home/jcidatascience/jaume/workspace/remote/block-types/test_pipeline_find_last_fitted_model_parallel_remove/models/B3b_estimator.pk
fitting B3d (using whole data)
loading from /home/jcidatascience/jaume/workspace/remote/block-types/test_pipeline_find_last_fitted_model_parallel_remove/models/B3d_estimator.pk
loaded pre-trained B3d
applying B3d (on whole data)
loading from /home/jcidatascience/jaume/workspace/remote/block-types/test_pipeline_find_last_fitted_model_parallel_remove/whole/B3d_result.pk
loaded pre-computed result
saving to /home/jcidatascience/jaume/workspace/remote/block-types/test_pipeline_find_last_fitted_model_parallel_remove/whole/pipeline_1_result.pk
fitting pipeline_1_1 (using whole data)
loading from /home/jcidatascience/jaume/workspace/remote/block-types/test_pipeline_find_last_fitted_model_parallel_remove/models/B4b_estimator.pk
fitting B4c (using whole data)
loading from /home/jcidatascience/jaume/workspace/remote/block-types/test_pipeline_find_last_fitted_model_parallel_remove/models/B4c_estimator.pk
loaded pre-trained B4c
applying B4c (on whole data)
loading from /home/jcidatascience/jaume/workspace/remote/block-types/test_pipeline_find_last_fitted_model_parallel_remove/whole/B4c_result.pk
loaded pre-computed result
applying B4d (on whole data)
saving to /home/jcidatascience/jaume/workspace/remote/block-types/test_pipeline_find_last_fitted_model_parallel_remove/whole/B4d_result.pk
fitting B4e (using whole data)
loading from /home/jcidatascience/jaume/workspace/remote/block-types/test_pipeline_find_last_fitted_model_parallel_remove/models/B4e_estimator.pk
loaded pre-trained B4e
applying B4e (on whole data)
saving to /home/jcidatascience/jaume/workspace/remote/block-types/test_pipeline_find_last_fitted_model_parallel_remove/whole/B4e_result.pk
saving to /home/jcidatascience/jaume/workspace/remote/block-types/test_pipeline_find_last_fitted_model_parallel_remove/whole/pipeline_1_1_result.pk
fitting B5 (using whole data)
loading from /home/jcidatascience/jaume/workspace/remote/block-types/test_pipeline_find_last_fitted_model_parallel_remove/models/B5_estimator.pk
loaded pre-trained B5
applying B5 (on whole data)
loading from /home/jcidatascience/jaume/workspace/remote/block-types/test_pipeline_find_last_fitted_model_parallel_remove/whole/B5_result.pk
loaded pre-computed result
saving to /home/jcidatascience/jaume/workspace/remote/block-types/test_pipeline_find_last_fitted_model_parallel_remove/whole/parallel_result.pk
applying C (on whole data)
saving to /home/jcidatascience/jaume/workspace/remote/block-types/test_pipeline_find_last_fitted_model_parallel_remove/whole/C_result.pk
fitting D (using whole data)
saving to /home/jcidatascience/jaume/workspace/remote/block-types/test_pipeline_find_last_fitted_model_parallel_remove/models/D_estimator.pk
applying D (on whole data)
saving to /home/jcidatascience/jaume/workspace/remote/block-types/test_pipeline_find_last_fitted_model_parallel_remove/whole/D_result.pk
applying E (on whole data)
saving to /home/jcidatascience/jaume/workspace/remote/block-types/test_pipeline_find_last_fitted_model_parallel_remove/whole/E_result.pk
saving to /home/jcidatascience/jaume/workspace/remote/block-types/test_pipeline_find_last_fitted_model_parallel_remove/whole/pipeline_result.pk

****************************************************************************************************
****************************************************************************************************

applying A0 (on whole data)
saving to /home/jcidatascience/jaume/workspace/remote/block-types/test_pipeline_find_last_fitted_model_parallel_remove/whole/A0_result.pk
fitting A1 (using whole data)
saving to /home/jcidatascience/jaume/workspace/remote/block-types/test_pipeline_find_last_fitted_model_parallel_remove/models/A1_estimator.pk
applying A1 (on whole data)
saving to /home/jcidatascience/jaume/workspace/remote/block-types/test_pipeline_find_last_fitted_model_parallel_remove/whole/A1_result.pk
applying B1 (on whole data)
saving to /home/jcidatascience/jaume/workspace/remote/block-types/test_pipeline_find_last_fitted_model_parallel_remove/whole/B1_result.pk
fitting B2 (using whole data)
saving to /home/jcidatascience/jaume/workspace/remote/block-types/test_pipeline_find_last_fitted_model_parallel_remove/models/B2_estimator.pk
applying B2 (on whole data)
saving to /home/jcidatascience/jaume/workspace/remote/block-types/test_pipeline_find_last_fitted_model_parallel_remove/whole/B2_result.pk
fitting B3a (using whole data)
saving to /home/jcidatascience/jaume/workspace/remote/block-types/test_pipeline_find_last_fitted_model_parallel_remove/models/B3a_estimator.pk
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>parallel class: &lt;class &#39;dsblocks.core.compose.Parallel&#39;&gt;
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>applying B3a (on whole data)
saving to /home/jcidatascience/jaume/workspace/remote/block-types/test_pipeline_find_last_fitted_model_parallel_remove/whole/B3a_result.pk
fitting B3b (using whole data)
saving to /home/jcidatascience/jaume/workspace/remote/block-types/test_pipeline_find_last_fitted_model_parallel_remove/models/B3b_estimator.pk
applying B3b (on whole data)
saving to /home/jcidatascience/jaume/workspace/remote/block-types/test_pipeline_find_last_fitted_model_parallel_remove/whole/B3b_result.pk
applying B3c (on whole data)
saving to /home/jcidatascience/jaume/workspace/remote/block-types/test_pipeline_find_last_fitted_model_parallel_remove/whole/B3c_result.pk
fitting B3d (using whole data)
saving to /home/jcidatascience/jaume/workspace/remote/block-types/test_pipeline_find_last_fitted_model_parallel_remove/models/B3d_estimator.pk
applying B3d (on whole data)
saving to /home/jcidatascience/jaume/workspace/remote/block-types/test_pipeline_find_last_fitted_model_parallel_remove/whole/B3d_result.pk
applying B4a (on whole data)
saving to /home/jcidatascience/jaume/workspace/remote/block-types/test_pipeline_find_last_fitted_model_parallel_remove/whole/B4a_result.pk
fitting B4b (using whole data)
saving to /home/jcidatascience/jaume/workspace/remote/block-types/test_pipeline_find_last_fitted_model_parallel_remove/models/B4b_estimator.pk
applying B4b (on whole data)
saving to /home/jcidatascience/jaume/workspace/remote/block-types/test_pipeline_find_last_fitted_model_parallel_remove/whole/B4b_result.pk
fitting B4c (using whole data)
saving to /home/jcidatascience/jaume/workspace/remote/block-types/test_pipeline_find_last_fitted_model_parallel_remove/models/B4c_estimator.pk
applying B4c (on whole data)
saving to /home/jcidatascience/jaume/workspace/remote/block-types/test_pipeline_find_last_fitted_model_parallel_remove/whole/B4c_result.pk
applying B4d (on whole data)
saving to /home/jcidatascience/jaume/workspace/remote/block-types/test_pipeline_find_last_fitted_model_parallel_remove/whole/B4d_result.pk
fitting B4e (using whole data)
saving to /home/jcidatascience/jaume/workspace/remote/block-types/test_pipeline_find_last_fitted_model_parallel_remove/models/B4e_estimator.pk
applying B4e (on whole data)
saving to /home/jcidatascience/jaume/workspace/remote/block-types/test_pipeline_find_last_fitted_model_parallel_remove/whole/B4e_result.pk
fitting B5 (using whole data)
saving to /home/jcidatascience/jaume/workspace/remote/block-types/test_pipeline_find_last_fitted_model_parallel_remove/models/B5_estimator.pk
applying B5 (on whole data)
saving to /home/jcidatascience/jaume/workspace/remote/block-types/test_pipeline_find_last_fitted_model_parallel_remove/whole/B5_result.pk

----------------------------------------------------------------------------------------------------

fitting pipeline (using whole data)
loading from /home/jcidatascience/jaume/workspace/remote/block-types/test_pipeline_find_last_fitted_model_parallel_remove/models/A1_estimator.pk
fitting parallel (using whole data)
applying B1 (on whole data)
loading from /home/jcidatascience/jaume/workspace/remote/block-types/test_pipeline_find_last_fitted_model_parallel_remove/whole/B1_result.pk
loaded pre-computed result
fitting B2 (using whole data)
loading from /home/jcidatascience/jaume/workspace/remote/block-types/test_pipeline_find_last_fitted_model_parallel_remove/models/B2_estimator.pk
loaded pre-trained B2
applying B2 (on whole data)
loading from /home/jcidatascience/jaume/workspace/remote/block-types/test_pipeline_find_last_fitted_model_parallel_remove/whole/B2_result.pk
loaded pre-computed result
fitting pipeline_1 (using whole data)
loading from /home/jcidatascience/jaume/workspace/remote/block-types/test_pipeline_find_last_fitted_model_parallel_remove/models/B3a_estimator.pk
loading from /home/jcidatascience/jaume/workspace/remote/block-types/test_pipeline_find_last_fitted_model_parallel_remove/models/B3b_estimator.pk
fitting B3d (using whole data)
loading from /home/jcidatascience/jaume/workspace/remote/block-types/test_pipeline_find_last_fitted_model_parallel_remove/models/B3d_estimator.pk
loaded pre-trained B3d
applying B3d (on whole data)
loading from /home/jcidatascience/jaume/workspace/remote/block-types/test_pipeline_find_last_fitted_model_parallel_remove/whole/B3d_result.pk
loaded pre-computed result
saving to /home/jcidatascience/jaume/workspace/remote/block-types/test_pipeline_find_last_fitted_model_parallel_remove/whole/pipeline_1_result.pk
fitting pipeline_1_1 (using whole data)
loading from /home/jcidatascience/jaume/workspace/remote/block-types/test_pipeline_find_last_fitted_model_parallel_remove/models/B4b_estimator.pk
fitting B4c (using whole data)
loading from /home/jcidatascience/jaume/workspace/remote/block-types/test_pipeline_find_last_fitted_model_parallel_remove/models/B4c_estimator.pk
loaded pre-trained B4c
applying B4c (on whole data)
loading from /home/jcidatascience/jaume/workspace/remote/block-types/test_pipeline_find_last_fitted_model_parallel_remove/whole/B4c_result.pk
loaded pre-computed result
applying B4d (on whole data)
saving to /home/jcidatascience/jaume/workspace/remote/block-types/test_pipeline_find_last_fitted_model_parallel_remove/whole/B4d_result.pk
fitting B4e (using whole data)
loading from /home/jcidatascience/jaume/workspace/remote/block-types/test_pipeline_find_last_fitted_model_parallel_remove/models/B4e_estimator.pk
loaded pre-trained B4e
applying B4e (on whole data)
saving to /home/jcidatascience/jaume/workspace/remote/block-types/test_pipeline_find_last_fitted_model_parallel_remove/whole/B4e_result.pk
saving to /home/jcidatascience/jaume/workspace/remote/block-types/test_pipeline_find_last_fitted_model_parallel_remove/whole/pipeline_1_1_result.pk
fitting B5 (using whole data)
loading from /home/jcidatascience/jaume/workspace/remote/block-types/test_pipeline_find_last_fitted_model_parallel_remove/models/B5_estimator.pk
loaded pre-trained B5
applying B5 (on whole data)
loading from /home/jcidatascience/jaume/workspace/remote/block-types/test_pipeline_find_last_fitted_model_parallel_remove/whole/B5_result.pk
loaded pre-computed result
saving to /home/jcidatascience/jaume/workspace/remote/block-types/test_pipeline_find_last_fitted_model_parallel_remove/whole/parallel_result.pk
applying C (on whole data)
saving to /home/jcidatascience/jaume/workspace/remote/block-types/test_pipeline_find_last_fitted_model_parallel_remove/whole/C_result.pk
fitting D (using whole data)
saving to /home/jcidatascience/jaume/workspace/remote/block-types/test_pipeline_find_last_fitted_model_parallel_remove/models/D_estimator.pk
applying D (on whole data)
saving to /home/jcidatascience/jaume/workspace/remote/block-types/test_pipeline_find_last_fitted_model_parallel_remove/whole/D_result.pk
applying E (on whole data)
saving to /home/jcidatascience/jaume/workspace/remote/block-types/test_pipeline_find_last_fitted_model_parallel_remove/whole/E_result.pk
saving to /home/jcidatascience/jaume/workspace/remote/block-types/test_pipeline_find_last_fitted_model_parallel_remove/whole/pipeline_result.pk
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="MultiModality">MultiModality<a class="anchor-link" href="#MultiModality"> </a></h2>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="MultiModality" class="doc_header"><code>class</code> <code>MultiModality</code><a href="https://github.com/Jaume-JCI/ds-blocks/tree/main/dsblocks/core/compose.py#L872" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>MultiModality</code>(<strong>*<code>components</code></strong>, <strong><code>use_name</code></strong>=<em><code>False</code></em>, <strong><code>component_class</code></strong>=<em><code>None</code></em>, <strong><code>configs</code></strong>=<em><code>None</code></em>, <strong>**<code>kwargs</code></strong>) :: <a href="/compose.html#Parallel"><code>Parallel</code></a></p>
</blockquote>

<pre><code>Analyzes multiple modalities using Parallel data flow.</code></pre>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Usage-example">Usage example<a class="anchor-link" href="#Usage-example"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="TransformM" class="doc_header"><code>class</code> <code>TransformM</code><a href="https://github.com/Jaume-JCI/ds-blocks/tree/main/dsblocks/tests/core/test_compose.py#L2196" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>TransformM</code>(<strong><code>modality</code></strong>=<em><code>''</code></em>, <strong><code>factor</code></strong>=<em><code>1000</code></em>, <strong>**<code>kwargs</code></strong>) :: <a href="/components.html#Component"><code>Component</code></a></p>
</blockquote>

<pre><code>Base component class used in our Pipeline.</code></pre>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="test_multi_modality" class="doc_header"><code>test_multi_modality</code><a href="https://github.com/Jaume-JCI/ds-blocks/tree/main/dsblocks/tests/core/test_compose.py#L2208" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>test_multi_modality</code>()</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1">#@pytest.mark.reference_fails</span>
<span class="k">class</span> <span class="nc">TransformM</span> <span class="p">(</span><span class="n">Component</span><span class="p">):</span>

    <span class="k">def</span> <span class="fm">__init__</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">modality</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">factor</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span> <span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">estimator</span><span class="o">=</span> <span class="n">Bunch</span><span class="p">(</span><span class="nb">sum</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_fit</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">estimator</span><span class="o">.</span><span class="n">sum</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_apply</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">x</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">factor</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">estimator</span><span class="o">.</span><span class="n">sum</span>
    
<span class="k">def</span> <span class="nf">test_multi_modality</span> <span class="p">():</span>
    <span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;transform1&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">]),</span>
            <span class="s1">&#39;transform2&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">10</span><span class="p">,</span><span class="mi">20</span><span class="p">,</span><span class="mi">30</span><span class="p">])}</span>
    
    <span class="n">parallel</span> <span class="o">=</span> <span class="n">MultiModality</span> <span class="p">(</span><span class="n">Transform1</span> <span class="p">(),</span>
                              <span class="n">Transform2</span> <span class="p">(),</span>
                              <span class="n">use_name</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">parallel</span><span class="o">.</span><span class="n">fit_apply</span> <span class="p">(</span><span class="n">data</span><span class="p">)</span>

    <span class="n">x1</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;transform1&#39;</span><span class="p">]</span>
    <span class="n">x1</span> <span class="o">=</span> <span class="n">x1</span> <span class="o">*</span> <span class="mi">1000</span> <span class="o">+</span> <span class="n">x1</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">x2</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;transform2&#39;</span><span class="p">]</span>
    <span class="n">x2</span> <span class="o">=</span> <span class="n">x2</span> <span class="o">*</span> <span class="mi">100</span> <span class="o">+</span> <span class="n">x2</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="k">assert</span> <span class="nb">list</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span><span class="o">==</span><span class="p">[</span><span class="s1">&#39;transform1&#39;</span><span class="p">,</span><span class="s1">&#39;transform2&#39;</span><span class="p">]</span>
    <span class="k">assert</span> <span class="p">(</span><span class="n">r</span><span class="p">[</span><span class="s1">&#39;transform1&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">x1</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
    <span class="k">assert</span> <span class="p">(</span><span class="n">r</span><span class="p">[</span><span class="s1">&#39;transform2&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">x2</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
    
    <span class="c1"># with configs</span>
    <span class="n">data</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">modA</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">]),</span>
                <span class="n">modB</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">10</span><span class="p">,</span><span class="mi">20</span><span class="p">,</span><span class="mi">30</span><span class="p">]))</span>
    <span class="n">configs</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">modA</span><span class="o">=</span><span class="nb">dict</span> <span class="p">(</span><span class="n">modality</span><span class="o">=</span><span class="s1">&#39;A&#39;</span><span class="p">,</span> <span class="n">factor</span><span class="o">=</span><span class="mi">2000</span><span class="p">),</span>
                   <span class="n">modB</span><span class="o">=</span><span class="nb">dict</span> <span class="p">(</span><span class="n">modality</span><span class="o">=</span><span class="s1">&#39;B&#39;</span><span class="p">,</span> <span class="n">factor</span><span class="o">=</span><span class="mi">3000</span><span class="p">))</span>

    <span class="n">parallel</span> <span class="o">=</span> <span class="n">MultiModality</span> <span class="p">(</span><span class="n">component_class</span><span class="o">=</span><span class="n">TransformM</span><span class="p">,</span>
                              <span class="n">configs</span><span class="o">=</span><span class="n">configs</span><span class="p">)</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">parallel</span><span class="o">.</span><span class="n">fit_apply</span> <span class="p">(</span><span class="n">data</span><span class="p">)</span>

    <span class="n">x1</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;modA&#39;</span><span class="p">]</span>
    <span class="n">x1</span> <span class="o">=</span> <span class="n">x1</span> <span class="o">*</span> <span class="mi">2000</span> <span class="o">+</span> <span class="n">x1</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">x2</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;modB&#39;</span><span class="p">]</span>
    <span class="n">x2</span> <span class="o">=</span> <span class="n">x2</span> <span class="o">*</span> <span class="mi">3000</span> <span class="o">+</span> <span class="n">x2</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="k">assert</span> <span class="nb">list</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span><span class="o">==</span><span class="p">[</span><span class="s1">&#39;modA&#39;</span><span class="p">,</span><span class="s1">&#39;modB&#39;</span><span class="p">]</span>
    <span class="k">assert</span> <span class="p">(</span><span class="n">r</span><span class="p">[</span><span class="s1">&#39;modA&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">x1</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
    <span class="k">assert</span> <span class="p">(</span><span class="n">r</span><span class="p">[</span><span class="s1">&#39;modB&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">x2</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>

    <span class="k">assert</span> <span class="n">parallel</span><span class="o">.</span><span class="n">transform_m_modA</span><span class="o">.</span><span class="n">modality</span> <span class="o">==</span> <span class="s1">&#39;A&#39;</span>
    <span class="k">assert</span> <span class="n">parallel</span><span class="o">.</span><span class="n">transform_m_modB</span><span class="o">.</span><span class="n">modality</span> <span class="o">==</span> <span class="s1">&#39;B&#39;</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">tst</span><span class="o">.</span><span class="n">run</span> <span class="p">(</span><span class="n">test_multi_modality</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="s1">&#39;dummy&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>running test_multi_modality
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="ColumnTransformer">ColumnTransformer<a class="anchor-link" href="#ColumnTransformer"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="ColumnSelector">ColumnSelector<a class="anchor-link" href="#ColumnSelector"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="ColumnSelector" class="doc_header"><code>class</code> <code>ColumnSelector</code><a href="https://github.com/Jaume-JCI/ds-blocks/tree/main/dsblocks/core/compose.py#L910" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>ColumnSelector</code>(<strong><code>columns</code></strong>=<em><code>[]</code></em>, <strong><code>remainder</code></strong>=<em><code>False</code></em>, <strong><code>verbose</code></strong>=<em><code>None</code></em>, <strong><code>force_verbose</code></strong>=<em><code>False</code></em>, <strong><code>logger</code></strong>=<em><code>None</code></em>, <strong><code>direct_apply</code></strong>=<em><code>True</code></em>, <strong>**<code>kwargs</code></strong>) :: <a href="/components.html#NoSaverComponent"><code>NoSaverComponent</code></a></p>
</blockquote>

<pre><code>Component that does not save any data.</code></pre>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="example-usage">example usage<a class="anchor-link" href="#example-usage"> </a></h4>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="test_column_selector" class="doc_header"><code>test_column_selector</code><a href="https://github.com/Jaume-JCI/ds-blocks/tree/main/dsblocks/tests/core/test_compose.py#L2248" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>test_column_selector</code>()</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1">#@pytest.mark.reference_fails</span>
<span class="k">def</span> <span class="nf">test_column_selector</span> <span class="p">():</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span> <span class="p">({</span><span class="s1">&#39;x1&#39;</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">)),</span>
                    <span class="s1">&#39;x2&#39;</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">10</span><span class="p">)),</span>
                    <span class="s1">&#39;x3&#39;</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="mi">20</span><span class="p">)),</span>
                    <span class="s1">&#39;x4&#39;</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">25</span><span class="p">,</span><span class="mi">30</span><span class="p">))</span>
                   <span class="p">})</span>
    <span class="n">dfr</span> <span class="o">=</span> <span class="n">ColumnSelector</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;x2&#39;</span><span class="p">,</span><span class="s1">&#39;x4&#39;</span><span class="p">],</span> <span class="n">error_if_apply</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
    <span class="k">assert</span> <span class="p">(</span><span class="n">dfr</span><span class="o">==</span><span class="n">df</span><span class="p">[[</span><span class="s1">&#39;x2&#39;</span><span class="p">,</span><span class="s1">&#39;x4&#39;</span><span class="p">]])</span><span class="o">.</span><span class="n">all</span><span class="p">()</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">tst</span><span class="o">.</span><span class="n">run</span> <span class="p">(</span><span class="n">test_column_selector</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="s1">&#39;dummy&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>running test_column_selector
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Concat">Concat<a class="anchor-link" href="#Concat"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="Concat" class="doc_header"><code>class</code> <code>Concat</code><a href="https://github.com/Jaume-JCI/ds-blocks/tree/main/dsblocks/core/compose.py#L934" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>Concat</code>(<strong><code>verbose</code></strong>=<em><code>None</code></em>, <strong><code>force_verbose</code></strong>=<em><code>False</code></em>, <strong><code>logger</code></strong>=<em><code>None</code></em>, <strong><code>direct_apply</code></strong>=<em><code>True</code></em>, <strong>**<code>kwargs</code></strong>) :: <a href="/components.html#NoSaverComponent"><code>NoSaverComponent</code></a></p>
</blockquote>

<pre><code>Component that does not save any data.</code></pre>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="example-usage">example usage<a class="anchor-link" href="#example-usage"> </a></h4>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="test_concat" class="doc_header"><code>test_concat</code><a href="https://github.com/Jaume-JCI/ds-blocks/tree/main/dsblocks/tests/core/test_compose.py#L2259" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>test_concat</code>()</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1">#@pytest.mark.reference_fails</span>
<span class="k">def</span> <span class="nf">test_concat</span> <span class="p">():</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span> <span class="p">({</span><span class="s1">&#39;x1&#39;</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">)),</span>
                    <span class="s1">&#39;x2&#39;</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">10</span><span class="p">)),</span>
                    <span class="s1">&#39;x3&#39;</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="mi">20</span><span class="p">)),</span>
                    <span class="s1">&#39;x4&#39;</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">25</span><span class="p">,</span><span class="mi">30</span><span class="p">))</span>
                   <span class="p">})</span>
    
    <span class="n">df2</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span> <span class="p">({</span><span class="s1">&#39;x5&#39;</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">)),</span>
                    <span class="s1">&#39;x6&#39;</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">10</span><span class="p">)),</span>
                    <span class="s1">&#39;x7&#39;</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="mi">20</span><span class="p">))</span>
                   <span class="p">})</span>
    <span class="n">dfr</span> <span class="o">=</span> <span class="n">Concat</span> <span class="p">(</span><span class="n">error_if_apply</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">df2</span><span class="p">)</span>
    <span class="k">assert</span> <span class="p">(</span><span class="n">dfr</span><span class="o">==</span><span class="n">pd</span><span class="o">.</span><span class="n">concat</span> <span class="p">([</span><span class="n">df</span><span class="p">,</span><span class="n">df2</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">all</span><span class="p">()</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">tst</span><span class="o">.</span><span class="n">run</span> <span class="p">(</span><span class="n">test_concat</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="s1">&#39;dummy&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>running test_concat
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="ColumnTransformer">ColumnTransformer<a class="anchor-link" href="#ColumnTransformer"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="ColumnTransformer" class="doc_header"><code>class</code> <code>ColumnTransformer</code><a href="https://github.com/Jaume-JCI/ds-blocks/tree/main/dsblocks/core/compose.py#L981" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>ColumnTransformer</code>(<strong>*<code>transformers</code></strong>, <strong><code>remainder</code></strong>=<em><code>'drop'</code></em>, <strong>**<code>kwargs</code></strong>) :: <code>_BaseColumnTransformer</code></p>
</blockquote>

<pre><code>Component containing a list of components inside.

The list must contain at least one component.

See `Pipeline` class.</code></pre>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Identity">Identity<a class="anchor-link" href="#Identity"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="Identity" class="doc_header"><code>class</code> <code>Identity</code><a href="https://github.com/Jaume-JCI/ds-blocks/tree/main/dsblocks/core/compose.py#L988" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>Identity</code>(<strong><code>verbose</code></strong>=<em><code>None</code></em>, <strong><code>force_verbose</code></strong>=<em><code>False</code></em>, <strong><code>logger</code></strong>=<em><code>None</code></em>, <strong><code>direct_apply</code></strong>=<em><code>True</code></em>, <strong>**<code>kwargs</code></strong>) :: <a href="/components.html#NoSaverComponent"><code>NoSaverComponent</code></a></p>
</blockquote>

<pre><code>Component that does not save any data.</code></pre>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="example-usage">example usage<a class="anchor-link" href="#example-usage"> </a></h4>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="test_identity" class="doc_header"><code>test_identity</code><a href="https://github.com/Jaume-JCI/ds-blocks/tree/main/dsblocks/tests/core/test_compose.py#L2275" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>test_identity</code>()</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1">#@pytest.mark.reference_fails</span>
<span class="k">def</span> <span class="nf">test_identity</span> <span class="p">():</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span> <span class="p">({</span><span class="s1">&#39;x1&#39;</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">)),</span>
                    <span class="s1">&#39;x2&#39;</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">10</span><span class="p">)),</span>
                    <span class="s1">&#39;x3&#39;</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="mi">20</span><span class="p">)),</span>
                    <span class="s1">&#39;x4&#39;</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">25</span><span class="p">,</span><span class="mi">30</span><span class="p">))</span>
                   <span class="p">})</span>
    
    <span class="n">dfr</span> <span class="o">=</span> <span class="n">Identity</span> <span class="p">(</span><span class="n">error_if_apply</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
    <span class="k">assert</span> <span class="p">(</span><span class="n">dfr</span><span class="o">==</span><span class="n">df</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">tst</span><span class="o">.</span><span class="n">run</span> <span class="p">(</span><span class="n">test_identity</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="s1">&#39;dummy&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>running test_identity
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="make_column_transformer">make_column_transformer<a class="anchor-link" href="#make_column_transformer"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="make_column_transformer_pipelines" class="doc_header"><code>make_column_transformer_pipelines</code><a href="https://github.com/Jaume-JCI/ds-blocks/tree/main/dsblocks/core/compose.py#L1045" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>make_column_transformer_pipelines</code>(<strong>*<code>transformers</code></strong>, <strong><code>remainder</code></strong>=<em><code>'drop'</code></em>, <strong>**<code>kwargs</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="make_column_transformer" class="doc_header"><code>make_column_transformer</code><a href="https://github.com/Jaume-JCI/ds-blocks/tree/main/dsblocks/core/compose.py#L1058" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>make_column_transformer</code>(<strong>*<code>transformers</code></strong>, <strong><code>remainder</code></strong>=<em><code>'drop'</code></em>, <strong><code>name</code></strong>=<em><code>None</code></em>, <strong><code>class_name</code></strong>=<em><code>None</code></em>, <strong>**<code>kwargs</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="Simple-example">Simple example<a class="anchor-link" href="#Simple-example"> </a></h4>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="column_transformer_data" class="doc_header"><code>column_transformer_data</code><a href="https://github.com/Jaume-JCI/ds-blocks/tree/main/dsblocks/tests/core/test_compose.py#L2286" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>column_transformer_data</code>()</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="test_make_column_transformer" class="doc_header"><code>test_make_column_transformer</code><a href="https://github.com/Jaume-JCI/ds-blocks/tree/main/dsblocks/tests/core/test_compose.py#L2300" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>test_make_column_transformer</code>(<strong><code>column_transformer_data</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">column_transformer_data</span> <span class="p">():</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span> <span class="p">({</span><span class="s1">&#39;cont1&#39;</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">)),</span>
                        <span class="s1">&#39;cont2&#39;</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">10</span><span class="p">)),</span>
                        <span class="s1">&#39;cont3&#39;</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="mi">20</span><span class="p">)),</span>
                        <span class="s1">&#39;cont4&#39;</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">25</span><span class="p">,</span><span class="mi">30</span><span class="p">)),</span>
                        <span class="s1">&#39;cat_1&#39;</span><span class="p">:</span> <span class="nb">list</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">]),</span>
                        <span class="s1">&#39;cat_2&#39;</span><span class="p">:</span> <span class="nb">list</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>
                        <span class="p">})</span>
        
    <span class="n">tr1</span> <span class="o">=</span> <span class="n">Component</span><span class="p">(</span><span class="n">FunctionTransformer</span> <span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;tr1&#39;</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">df</span><span class="p">,</span> <span class="n">tr1</span>
        
<span class="c1">#@pytest.mark.reference_fails</span>
<span class="k">def</span> <span class="nf">test_make_column_transformer</span> <span class="p">(</span><span class="n">column_transformer_data</span><span class="p">):</span>

    <span class="n">df</span><span class="p">,</span> <span class="n">tr1</span> <span class="o">=</span> <span class="n">column_transformer_data</span>

    <span class="n">tr1</span> <span class="o">=</span> <span class="n">Component</span><span class="p">(</span><span class="n">FunctionTransformer</span> <span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;tr1&#39;</span><span class="p">)</span>
    <span class="n">tr2</span> <span class="o">=</span> <span class="n">PandasComponent</span><span class="p">(</span><span class="n">FunctionTransformer</span> <span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">*</span><span class="mi">2</span><span class="p">),</span> 
                          <span class="n">transformed_columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;cont2_bis&#39;</span><span class="p">,</span><span class="s1">&#39;cat_1&#39;</span><span class="p">],</span> 
                          <span class="n">name</span><span class="o">=</span><span class="s1">&#39;tr2&#39;</span><span class="p">)</span>

    <span class="n">column_transformer</span> <span class="o">=</span> <span class="n">make_column_transformer</span> <span class="p">(</span>
        <span class="p">(</span><span class="n">tr1</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;cont2&#39;</span><span class="p">,</span> <span class="s1">&#39;cont4&#39;</span><span class="p">]),</span>
        <span class="p">(</span><span class="n">tr2</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;cont2&#39;</span><span class="p">,</span> <span class="s1">&#39;cat_1&#39;</span><span class="p">]),</span>
        <span class="n">error_if_apply</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">verbose</span><span class="o">=</span><span class="mi">2</span>
    <span class="p">)</span>
    <span class="nb">print</span> <span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="s2">&quot;-&quot;</span><span class="o">*</span><span class="mi">100</span><span class="si">}</span><span class="se">\n</span><span class="si">{</span><span class="n">column_transformer</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">dfr</span> <span class="o">=</span> <span class="n">column_transformer</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>

    <span class="c1"># display and test</span>
    <span class="n">display</span><span class="p">(</span><span class="n">dfr</span><span class="p">)</span>
    <span class="k">assert</span> <span class="p">(</span><span class="n">dfr</span><span class="p">[[</span><span class="s1">&#39;cont2&#39;</span><span class="p">,</span><span class="s1">&#39;cont4&#39;</span><span class="p">]]</span> <span class="o">==</span> <span class="n">tr1</span><span class="p">(</span><span class="n">df</span><span class="p">[[</span><span class="s1">&#39;cont2&#39;</span><span class="p">,</span><span class="s1">&#39;cont4&#39;</span><span class="p">]]))</span><span class="o">.</span><span class="n">all</span><span class="p">()</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
    <span class="k">assert</span> <span class="p">(</span><span class="n">dfr</span><span class="p">[[</span><span class="s1">&#39;cont2_bis&#39;</span><span class="p">,</span><span class="s1">&#39;cat_1&#39;</span><span class="p">]]</span> <span class="o">==</span> <span class="n">tr2</span><span class="p">(</span><span class="n">df</span><span class="p">[[</span><span class="s1">&#39;cont2&#39;</span><span class="p">,</span><span class="s1">&#39;cat_1&#39;</span><span class="p">]]))</span><span class="o">.</span><span class="n">all</span><span class="p">()</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
    <span class="k">assert</span> <span class="p">(</span><span class="n">dfr</span><span class="o">.</span><span class="n">columns</span> <span class="o">==</span> <span class="p">[</span><span class="s1">&#39;cont2&#39;</span><span class="p">,</span><span class="s1">&#39;cont4&#39;</span><span class="p">,</span> <span class="s1">&#39;cont2_bis&#39;</span><span class="p">,</span><span class="s1">&#39;cat_1&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
    <span class="k">assert</span> <span class="p">(</span><span class="n">column_transformer</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">column_transformer</span><span class="o">.</span><span class="n">class_name</span><span class="p">)</span> <span class="o">==</span> <span class="p">(</span><span class="s1">&#39;__base_column_transformer&#39;</span><span class="p">,</span> <span class="s1">&#39;_BaseColumnTransformer&#39;</span><span class="p">)</span>

    <span class="c1"># set name of column transformer</span>
    <span class="n">column_transformer</span> <span class="o">=</span> <span class="n">make_column_transformer</span> <span class="p">(</span>
        <span class="p">(</span><span class="n">tr1</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;cont2&#39;</span><span class="p">,</span> <span class="s1">&#39;cont4&#39;</span><span class="p">]),</span>
        <span class="p">(</span><span class="n">tr2</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;cont2&#39;</span><span class="p">,</span> <span class="s1">&#39;cat_1&#39;</span><span class="p">]),</span>
        <span class="n">name</span><span class="o">=</span><span class="s1">&#39;test_transformer&#39;</span><span class="p">,</span>
        <span class="n">class_name</span><span class="o">=</span><span class="s1">&#39;TestTransformer&#39;</span><span class="p">,</span>
        <span class="n">error_if_apply</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">verbose</span><span class="o">=</span><span class="mi">2</span>
    <span class="p">)</span>
    <span class="nb">print</span> <span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="s2">&quot;-&quot;</span><span class="o">*</span><span class="mi">100</span><span class="si">}</span><span class="se">\n</span><span class="si">{</span><span class="n">column_transformer</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="k">assert</span> <span class="p">(</span><span class="n">column_transformer</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">column_transformer</span><span class="o">.</span><span class="n">class_name</span><span class="p">)</span> <span class="o">==</span> <span class="p">(</span><span class="s1">&#39;test_transformer&#39;</span><span class="p">,</span> <span class="s1">&#39;TestTransformer&#39;</span><span class="p">)</span>

    <span class="c1"># set name of column transformer and parameters that are specific </span>
    <span class="c1"># for the column_transformer: path_results</span>
    <span class="n">column_transformer</span> <span class="o">=</span> <span class="n">make_column_transformer</span> <span class="p">(</span>
        <span class="p">(</span><span class="n">tr1</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;cont2&#39;</span><span class="p">,</span> <span class="s1">&#39;cont4&#39;</span><span class="p">]),</span>
        <span class="p">(</span><span class="n">tr2</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;cont2&#39;</span><span class="p">,</span> <span class="s1">&#39;cat_1&#39;</span><span class="p">]),</span>
        <span class="n">name</span><span class="o">=</span><span class="s1">&#39;test_transformer&#39;</span><span class="p">,</span>
        <span class="n">class_name</span><span class="o">=</span><span class="s1">&#39;TestTransformer&#39;</span><span class="p">,</span>
        <span class="n">TestTransformer</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">path_results</span><span class="o">=</span><span class="s1">&#39;mine&#39;</span><span class="p">),</span>
        <span class="n">path_results</span><span class="o">=</span><span class="s1">&#39;other&#39;</span><span class="p">,</span>
        <span class="n">error_if_apply</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">verbose</span><span class="o">=</span><span class="mi">2</span>
    <span class="p">)</span>
    <span class="nb">print</span> <span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="s2">&quot;-&quot;</span><span class="o">*</span><span class="mi">100</span><span class="si">}</span><span class="se">\n</span><span class="si">{</span><span class="n">column_transformer</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">column_transformer</span><span class="o">.</span><span class="n">path_results</span><span class="o">.</span><span class="n">name</span><span class="o">==</span><span class="s1">&#39;mine&#39;</span>
    <span class="k">assert</span> <span class="n">column_transformer</span><span class="o">.</span><span class="n">components</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">path_results</span><span class="o">.</span><span class="n">name</span><span class="o">==</span><span class="s1">&#39;other&#39;</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">tst</span><span class="o">.</span><span class="n">run</span> <span class="p">(</span><span class="n">test_make_column_transformer</span><span class="p">,</span> <span class="n">column_transformer_data</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="s1">&#39;dummy&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>running test_make_column_transformer
----------------------------------------------------------------------------------------------------
MultiComponent _BaseColumnTransformer (name=__base_column_transformer)
</pre>
</div>
</div>

<div class="output_area">


<div class="output_html rendered_html output_subarea "><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>cont2</th>
      <th>cont4</th>
      <th>cont2_bis</th>
      <th>cat_1</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>6</td>
      <td>26</td>
      <td>10</td>
      <td>2</td>
    </tr>
    <tr>
      <th>1</th>
      <td>7</td>
      <td>27</td>
      <td>12</td>
      <td>4</td>
    </tr>
    <tr>
      <th>2</th>
      <td>8</td>
      <td>28</td>
      <td>14</td>
      <td>6</td>
    </tr>
    <tr>
      <th>3</th>
      <td>9</td>
      <td>29</td>
      <td>16</td>
      <td>4</td>
    </tr>
    <tr>
      <th>4</th>
      <td>10</td>
      <td>30</td>
      <td>18</td>
      <td>2</td>
    </tr>
  </tbody>
</table>
</div></div>

</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>----------------------------------------------------------------------------------------------------
MultiComponent TestTransformer (name=test_transformer)
----------------------------------------------------------------------------------------------------
MultiComponent TestTransformer (name=test_transformer)
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="Using-passthrough">Using <code>passthrough</code><a class="anchor-link" href="#Using-passthrough"> </a></h4>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="test_make_column_transformer_passthrough" class="doc_header"><code>test_make_column_transformer_passthrough</code><a href="https://github.com/Jaume-JCI/ds-blocks/tree/main/dsblocks/tests/core/test_compose.py#L2355" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>test_make_column_transformer_passthrough</code>(<strong><code>column_transformer_data</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1">#@pytest.mark.reference_fails</span>
<span class="k">def</span> <span class="nf">test_make_column_transformer_passthrough</span> <span class="p">(</span><span class="n">column_transformer_data</span><span class="p">):</span>
    <span class="n">df</span><span class="p">,</span> <span class="n">tr1</span> <span class="o">=</span> <span class="n">column_transformer_data</span>
    
    <span class="n">column_transformer</span> <span class="o">=</span> <span class="n">make_column_transformer</span> <span class="p">(</span>
        <span class="p">(</span><span class="n">tr1</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;cont1&#39;</span><span class="p">,</span> <span class="s1">&#39;cont4&#39;</span><span class="p">]),</span>
        <span class="p">(</span><span class="s1">&#39;passthrough&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;cont2&#39;</span><span class="p">,</span> <span class="s1">&#39;cat_1&#39;</span><span class="p">]),</span>
        <span class="n">error_if_apply</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">verbose</span><span class="o">=</span><span class="mi">2</span>
    <span class="p">)</span>
    <span class="n">dfr</span> <span class="o">=</span> <span class="n">column_transformer</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>

    <span class="c1"># display and test</span>
    <span class="n">display</span><span class="p">(</span><span class="n">dfr</span><span class="p">)</span>
    <span class="k">assert</span> <span class="p">(</span><span class="n">dfr</span><span class="p">[[</span><span class="s1">&#39;cont1&#39;</span><span class="p">,</span><span class="s1">&#39;cont4&#39;</span><span class="p">]]</span> <span class="o">==</span> <span class="n">tr1</span><span class="p">(</span><span class="n">df</span><span class="p">[[</span><span class="s1">&#39;cont1&#39;</span><span class="p">,</span><span class="s1">&#39;cont4&#39;</span><span class="p">]]))</span><span class="o">.</span><span class="n">all</span><span class="p">()</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
    <span class="k">assert</span> <span class="p">(</span><span class="n">dfr</span><span class="p">[[</span><span class="s1">&#39;cont2&#39;</span><span class="p">,</span><span class="s1">&#39;cat_1&#39;</span><span class="p">]]</span> <span class="o">==</span> <span class="n">df</span><span class="p">[[</span><span class="s1">&#39;cont2&#39;</span><span class="p">,</span><span class="s1">&#39;cat_1&#39;</span><span class="p">]])</span><span class="o">.</span><span class="n">all</span><span class="p">()</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
    <span class="k">assert</span> <span class="p">(</span><span class="n">dfr</span><span class="o">.</span><span class="n">columns</span> <span class="o">==</span> <span class="p">[</span><span class="s1">&#39;cont1&#39;</span><span class="p">,</span><span class="s1">&#39;cont4&#39;</span><span class="p">,</span> <span class="s1">&#39;cont2&#39;</span><span class="p">,</span><span class="s1">&#39;cat_1&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">tst</span><span class="o">.</span><span class="n">run</span> <span class="p">(</span><span class="n">test_make_column_transformer_passthrough</span><span class="p">,</span> <span class="n">column_transformer_data</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="s1">&#39;dummy&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>running test_make_column_transformer_passthrough
</pre>
</div>
</div>

<div class="output_area">


<div class="output_html rendered_html output_subarea "><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>cont1</th>
      <th>cont4</th>
      <th>cont2</th>
      <th>cat_1</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>26</td>
      <td>5</td>
      <td>1</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2</td>
      <td>27</td>
      <td>6</td>
      <td>2</td>
    </tr>
    <tr>
      <th>2</th>
      <td>3</td>
      <td>28</td>
      <td>7</td>
      <td>3</td>
    </tr>
    <tr>
      <th>3</th>
      <td>4</td>
      <td>29</td>
      <td>8</td>
      <td>2</td>
    </tr>
    <tr>
      <th>4</th>
      <td>5</td>
      <td>30</td>
      <td>9</td>
      <td>1</td>
    </tr>
  </tbody>
</table>
</div></div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="Using-remainder">Using remainder<a class="anchor-link" href="#Using-remainder"> </a></h4>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="test_make_column_transformer_remainder" class="doc_header"><code>test_make_column_transformer_remainder</code><a href="https://github.com/Jaume-JCI/ds-blocks/tree/main/dsblocks/tests/core/test_compose.py#L2374" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>test_make_column_transformer_remainder</code>(<strong><code>column_transformer_data</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1">#@pytest.mark.reference_fails</span>
<span class="k">def</span> <span class="nf">test_make_column_transformer_remainder</span> <span class="p">(</span><span class="n">column_transformer_data</span><span class="p">):</span>
    
    <span class="n">df</span><span class="p">,</span> <span class="n">tr1</span> <span class="o">=</span> <span class="n">column_transformer_data</span>
    
    <span class="c1"># remainder is new transformation</span>
    <span class="n">tr3</span> <span class="o">=</span> <span class="n">Component</span><span class="p">(</span><span class="n">FunctionTransformer</span> <span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">+</span><span class="mi">100</span><span class="p">),</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;tr3&#39;</span><span class="p">)</span>
    <span class="n">column_transformer</span> <span class="o">=</span> <span class="n">make_column_transformer</span> <span class="p">(</span>
        <span class="p">(</span><span class="n">tr1</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;cont1&#39;</span><span class="p">,</span> <span class="s1">&#39;cont4&#39;</span><span class="p">]),</span>
        <span class="p">(</span><span class="s1">&#39;passthrough&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;cont2&#39;</span><span class="p">,</span> <span class="s1">&#39;cat_1&#39;</span><span class="p">]),</span>
        <span class="n">remainder</span><span class="o">=</span><span class="n">tr3</span><span class="p">,</span>
        <span class="n">error_if_apply</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">verbose</span><span class="o">=</span><span class="mi">2</span>
    <span class="p">)</span>
    <span class="n">dfr</span> <span class="o">=</span> <span class="n">column_transformer</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>

    <span class="c1"># display and test</span>
    <span class="n">display</span><span class="p">(</span><span class="s1">&#39;with tr3&#39;</span><span class="p">,</span> <span class="n">dfr</span><span class="p">)</span>
    <span class="k">assert</span> <span class="p">(</span><span class="n">dfr</span><span class="p">[[</span><span class="s1">&#39;cont1&#39;</span><span class="p">,</span><span class="s1">&#39;cont4&#39;</span><span class="p">]]</span> <span class="o">==</span> <span class="n">tr1</span><span class="p">(</span><span class="n">df</span><span class="p">[[</span><span class="s1">&#39;cont1&#39;</span><span class="p">,</span><span class="s1">&#39;cont4&#39;</span><span class="p">]]))</span><span class="o">.</span><span class="n">all</span><span class="p">()</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
    <span class="k">assert</span> <span class="p">(</span><span class="n">dfr</span><span class="p">[[</span><span class="s1">&#39;cont2&#39;</span><span class="p">,</span><span class="s1">&#39;cat_1&#39;</span><span class="p">]]</span> <span class="o">==</span> <span class="n">df</span><span class="p">[[</span><span class="s1">&#39;cont2&#39;</span><span class="p">,</span><span class="s1">&#39;cat_1&#39;</span><span class="p">]])</span><span class="o">.</span><span class="n">all</span><span class="p">()</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
    <span class="k">assert</span> <span class="p">(</span><span class="n">dfr</span><span class="p">[[</span><span class="s1">&#39;cont3&#39;</span><span class="p">,</span><span class="s1">&#39;cat_2&#39;</span><span class="p">]]</span> <span class="o">==</span> <span class="n">tr3</span><span class="p">(</span><span class="n">df</span><span class="p">[[</span><span class="s1">&#39;cont3&#39;</span><span class="p">,</span><span class="s1">&#39;cat_2&#39;</span><span class="p">]]))</span><span class="o">.</span><span class="n">all</span><span class="p">()</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
    <span class="k">assert</span> <span class="p">(</span><span class="n">dfr</span><span class="o">.</span><span class="n">columns</span> <span class="o">==</span> <span class="p">[</span><span class="s1">&#39;cont1&#39;</span><span class="p">,</span><span class="s1">&#39;cont4&#39;</span><span class="p">,</span> <span class="s1">&#39;cont2&#39;</span><span class="p">,</span><span class="s1">&#39;cat_1&#39;</span><span class="p">,</span><span class="s1">&#39;cont3&#39;</span><span class="p">,</span><span class="s1">&#39;cat_2&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>

    <span class="c1"># remainder is passthrough</span>
    <span class="k">del</span> <span class="n">tr1</span><span class="o">.</span><span class="n">nick_name</span>
    <span class="k">del</span> <span class="n">tr3</span><span class="o">.</span><span class="n">nick_name</span>
    <span class="n">column_transformer</span> <span class="o">=</span> <span class="n">make_column_transformer</span> <span class="p">(</span>
        <span class="p">(</span><span class="n">tr1</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;cont1&#39;</span><span class="p">,</span> <span class="s1">&#39;cont4&#39;</span><span class="p">]),</span>
        <span class="p">(</span><span class="n">tr3</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;cont2&#39;</span><span class="p">,</span> <span class="s1">&#39;cat_1&#39;</span><span class="p">]),</span>
        <span class="n">remainder</span><span class="o">=</span><span class="s1">&#39;passthrough&#39;</span><span class="p">,</span>
        <span class="n">error_if_apply</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">verbose</span><span class="o">=</span><span class="mi">2</span>
    <span class="p">)</span>
    <span class="n">dfr</span> <span class="o">=</span> <span class="n">column_transformer</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>

    <span class="n">display</span><span class="p">(</span><span class="s1">&#39;with passthrough&#39;</span><span class="p">,</span> <span class="n">dfr</span><span class="p">)</span>
    <span class="k">assert</span> <span class="p">(</span><span class="n">dfr</span><span class="p">[[</span><span class="s1">&#39;cont1&#39;</span><span class="p">,</span><span class="s1">&#39;cont4&#39;</span><span class="p">]]</span> <span class="o">==</span> <span class="n">tr1</span><span class="p">(</span><span class="n">df</span><span class="p">[[</span><span class="s1">&#39;cont1&#39;</span><span class="p">,</span><span class="s1">&#39;cont4&#39;</span><span class="p">]]))</span><span class="o">.</span><span class="n">all</span><span class="p">()</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
    <span class="k">assert</span> <span class="p">(</span><span class="n">dfr</span><span class="p">[[</span><span class="s1">&#39;cont2&#39;</span><span class="p">,</span><span class="s1">&#39;cat_1&#39;</span><span class="p">]]</span> <span class="o">==</span> <span class="n">tr3</span><span class="p">(</span><span class="n">df</span><span class="p">[[</span><span class="s1">&#39;cont2&#39;</span><span class="p">,</span><span class="s1">&#39;cat_1&#39;</span><span class="p">]]))</span><span class="o">.</span><span class="n">all</span><span class="p">()</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
    <span class="k">assert</span> <span class="p">(</span><span class="n">dfr</span><span class="p">[[</span><span class="s1">&#39;cont3&#39;</span><span class="p">,</span><span class="s1">&#39;cat_2&#39;</span><span class="p">]]</span> <span class="o">==</span> <span class="n">df</span><span class="p">[[</span><span class="s1">&#39;cont3&#39;</span><span class="p">,</span><span class="s1">&#39;cat_2&#39;</span><span class="p">]])</span><span class="o">.</span><span class="n">all</span><span class="p">()</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
    <span class="k">assert</span> <span class="p">(</span><span class="n">dfr</span><span class="o">.</span><span class="n">columns</span> <span class="o">==</span> <span class="p">[</span><span class="s1">&#39;cont1&#39;</span><span class="p">,</span><span class="s1">&#39;cont4&#39;</span><span class="p">,</span> <span class="s1">&#39;cont2&#39;</span><span class="p">,</span><span class="s1">&#39;cat_1&#39;</span><span class="p">,</span><span class="s1">&#39;cont3&#39;</span><span class="p">,</span><span class="s1">&#39;cat_2&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>

    <span class="c1"># remainder is tr3, and one of the transforms is drop</span>
    <span class="k">del</span> <span class="n">tr1</span><span class="o">.</span><span class="n">nick_name</span>
    <span class="k">del</span> <span class="n">tr3</span><span class="o">.</span><span class="n">nick_name</span>
    <span class="n">column_transformer</span> <span class="o">=</span> <span class="n">make_column_transformer</span> <span class="p">(</span>
        <span class="p">(</span><span class="n">tr1</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;cont1&#39;</span><span class="p">,</span> <span class="s1">&#39;cont4&#39;</span><span class="p">]),</span>
        <span class="p">(</span><span class="s1">&#39;drop&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;cont2&#39;</span><span class="p">,</span> <span class="s1">&#39;cat_1&#39;</span><span class="p">]),</span>
        <span class="n">remainder</span><span class="o">=</span><span class="n">tr3</span><span class="p">,</span>
        <span class="n">error_if_apply</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">verbose</span><span class="o">=</span><span class="mi">2</span>
    <span class="p">)</span>
    <span class="n">dfr</span> <span class="o">=</span> <span class="n">column_transformer</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>

    <span class="n">display</span><span class="p">(</span><span class="s1">&#39;with drop one of the transforms - cont2, cat_1&#39;</span><span class="p">,</span> <span class="n">dfr</span><span class="p">)</span>
    <span class="k">assert</span> <span class="p">(</span><span class="n">dfr</span><span class="p">[[</span><span class="s1">&#39;cont1&#39;</span><span class="p">,</span><span class="s1">&#39;cont4&#39;</span><span class="p">]]</span> <span class="o">==</span> <span class="n">tr1</span><span class="p">(</span><span class="n">df</span><span class="p">[[</span><span class="s1">&#39;cont1&#39;</span><span class="p">,</span><span class="s1">&#39;cont4&#39;</span><span class="p">]]))</span><span class="o">.</span><span class="n">all</span><span class="p">()</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
    <span class="k">assert</span> <span class="p">(</span><span class="n">dfr</span><span class="p">[[</span><span class="s1">&#39;cont3&#39;</span><span class="p">,</span><span class="s1">&#39;cat_2&#39;</span><span class="p">]]</span> <span class="o">==</span> <span class="n">tr3</span><span class="p">(</span><span class="n">df</span><span class="p">[[</span><span class="s1">&#39;cont3&#39;</span><span class="p">,</span><span class="s1">&#39;cat_2&#39;</span><span class="p">]]))</span><span class="o">.</span><span class="n">all</span><span class="p">()</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
    <span class="k">assert</span> <span class="p">(</span><span class="n">dfr</span><span class="o">.</span><span class="n">columns</span> <span class="o">==</span> <span class="p">[</span><span class="s1">&#39;cont1&#39;</span><span class="p">,</span><span class="s1">&#39;cont4&#39;</span><span class="p">,</span> <span class="s1">&#39;cont3&#39;</span><span class="p">,</span><span class="s1">&#39;cat_2&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
    
    <span class="c1"># check gather_descendants</span>
    <span class="n">column_transformer</span><span class="o">.</span><span class="n">gather_descendants</span><span class="p">()</span>
    <span class="k">assert</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">column_transformer</span><span class="o">.</span><span class="n">full_obj</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span><span class="o">==</span><span class="p">[</span><span class="s1">&#39;column_selector&#39;</span><span class="p">,</span> <span class="s1">&#39;concat&#39;</span><span class="p">,</span> <span class="s1">&#39;tr1&#39;</span><span class="p">,</span> <span class="s1">&#39;tr1_cc&#39;</span><span class="p">,</span> <span class="s1">&#39;tr3&#39;</span><span class="p">,</span> <span class="s1">&#39;tr3_rem&#39;</span><span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">tst</span><span class="o">.</span><span class="n">run</span> <span class="p">(</span><span class="n">test_make_column_transformer_remainder</span><span class="p">,</span> <span class="n">column_transformer_data</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="s1">&#39;dummy&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>running test_make_column_transformer_remainder
</pre>
</div>
</div>

<div class="output_area">



<div class="output_text output_subarea ">
<pre>&#39;with tr3&#39;</pre>
</div>

</div>

<div class="output_area">


<div class="output_html rendered_html output_subarea "><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>cont1</th>
      <th>cont4</th>
      <th>cont2</th>
      <th>cat_1</th>
      <th>cont3</th>
      <th>cat_2</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>26</td>
      <td>5</td>
      <td>1</td>
      <td>115</td>
      <td>100</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2</td>
      <td>27</td>
      <td>6</td>
      <td>2</td>
      <td>116</td>
      <td>101</td>
    </tr>
    <tr>
      <th>2</th>
      <td>3</td>
      <td>28</td>
      <td>7</td>
      <td>3</td>
      <td>117</td>
      <td>101</td>
    </tr>
    <tr>
      <th>3</th>
      <td>4</td>
      <td>29</td>
      <td>8</td>
      <td>2</td>
      <td>118</td>
      <td>100</td>
    </tr>
    <tr>
      <th>4</th>
      <td>5</td>
      <td>30</td>
      <td>9</td>
      <td>1</td>
      <td>119</td>
      <td>100</td>
    </tr>
  </tbody>
</table>
</div></div>

</div>

<div class="output_area">



<div class="output_text output_subarea ">
<pre>&#39;with passthrough&#39;</pre>
</div>

</div>

<div class="output_area">


<div class="output_html rendered_html output_subarea "><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>cont1</th>
      <th>cont4</th>
      <th>cont2</th>
      <th>cat_1</th>
      <th>cont3</th>
      <th>cat_2</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>26</td>
      <td>105</td>
      <td>101</td>
      <td>15</td>
      <td>0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2</td>
      <td>27</td>
      <td>106</td>
      <td>102</td>
      <td>16</td>
      <td>1</td>
    </tr>
    <tr>
      <th>2</th>
      <td>3</td>
      <td>28</td>
      <td>107</td>
      <td>103</td>
      <td>17</td>
      <td>1</td>
    </tr>
    <tr>
      <th>3</th>
      <td>4</td>
      <td>29</td>
      <td>108</td>
      <td>102</td>
      <td>18</td>
      <td>0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>5</td>
      <td>30</td>
      <td>109</td>
      <td>101</td>
      <td>19</td>
      <td>0</td>
    </tr>
  </tbody>
</table>
</div></div>

</div>

<div class="output_area">



<div class="output_text output_subarea ">
<pre>&#39;with drop one of the transforms - cont2, cat_1&#39;</pre>
</div>

</div>

<div class="output_area">


<div class="output_html rendered_html output_subarea "><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>cont1</th>
      <th>cont4</th>
      <th>cont3</th>
      <th>cat_2</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>26</td>
      <td>115</td>
      <td>100</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2</td>
      <td>27</td>
      <td>116</td>
      <td>101</td>
    </tr>
    <tr>
      <th>2</th>
      <td>3</td>
      <td>28</td>
      <td>117</td>
      <td>101</td>
    </tr>
    <tr>
      <th>3</th>
      <td>4</td>
      <td>29</td>
      <td>118</td>
      <td>100</td>
    </tr>
    <tr>
      <th>4</th>
      <td>5</td>
      <td>30</td>
      <td>119</td>
      <td>100</td>
    </tr>
  </tbody>
</table>
</div></div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="gather_descendants">gather_descendants<a class="anchor-link" href="#gather_descendants"> </a></h4>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="test_make_column_transformer_descendants" class="doc_header"><code>test_make_column_transformer_descendants</code><a href="https://github.com/Jaume-JCI/ds-blocks/tree/main/dsblocks/tests/core/test_compose.py#L2437" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>test_make_column_transformer_descendants</code>(<strong><code>column_transformer_data</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1">#@pytest.mark.reference_fails</span>
<span class="k">def</span> <span class="nf">test_make_column_transformer_descendants</span> <span class="p">(</span><span class="n">column_transformer_data</span><span class="p">):</span>
    
    <span class="n">df</span><span class="p">,</span> <span class="n">tr1</span> <span class="o">=</span> <span class="n">column_transformer_data</span>
    
    <span class="n">tr3</span> <span class="o">=</span> <span class="n">Component</span><span class="p">(</span><span class="n">FunctionTransformer</span> <span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">+</span><span class="mi">100</span><span class="p">),</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;tr3&#39;</span><span class="p">)</span>
    
    <span class="n">column_transformer</span> <span class="o">=</span> <span class="n">make_column_transformer</span> <span class="p">(</span>
        <span class="p">(</span><span class="n">tr1</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;cont1&#39;</span><span class="p">,</span> <span class="s1">&#39;cont4&#39;</span><span class="p">]),</span>
        <span class="p">(</span><span class="s1">&#39;drop&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;cont2&#39;</span><span class="p">,</span> <span class="s1">&#39;cat_1&#39;</span><span class="p">]),</span>
        <span class="n">remainder</span><span class="o">=</span><span class="n">tr3</span>
    <span class="p">)</span>
    
    <span class="c1"># check gather_descendants</span>
    <span class="n">column_transformer</span><span class="o">.</span><span class="n">gather_descendants</span><span class="p">()</span>
    <span class="k">assert</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">column_transformer</span><span class="o">.</span><span class="n">full_obj</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span><span class="o">==</span><span class="p">[</span><span class="s1">&#39;column_selector&#39;</span><span class="p">,</span> <span class="s1">&#39;concat&#39;</span><span class="p">,</span> <span class="s1">&#39;tr1&#39;</span><span class="p">,</span> <span class="s1">&#39;tr1_cc&#39;</span><span class="p">,</span> <span class="s1">&#39;tr3&#39;</span><span class="p">,</span> <span class="s1">&#39;tr3_rem&#39;</span><span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">tst</span><span class="o">.</span><span class="n">run</span> <span class="p">(</span><span class="n">test_make_column_transformer_descendants</span><span class="p">,</span> <span class="n">column_transformer_data</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="s1">&#39;dummy&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>running test_make_column_transformer_descendants
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="Example-using-fit_transform">Example using <code>fit_transform</code><a class="anchor-link" href="#Example-using-fit_transform"> </a></h4>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="test_make_column_transformer_fit_transform" class="doc_header"><code>test_make_column_transformer_fit_transform</code><a href="https://github.com/Jaume-JCI/ds-blocks/tree/main/dsblocks/tests/core/test_compose.py#L2455" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>test_make_column_transformer_fit_transform</code>(<strong><code>column_transformer_data</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1">#@pytest.mark.reference_fails</span>
<span class="k">def</span> <span class="nf">test_make_column_transformer_fit_transform</span> <span class="p">(</span><span class="n">column_transformer_data</span><span class="p">):</span>
    
    <span class="n">df</span><span class="p">,</span> <span class="n">tr1</span> <span class="o">=</span> <span class="n">column_transformer_data</span>
    
    <span class="k">class</span> <span class="nc">SumTimes100</span> <span class="p">(</span><span class="n">Component</span><span class="p">):</span>
        <span class="k">def</span> <span class="nf">_fit</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sum</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">def</span> <span class="nf">_apply</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">):</span>

            <span class="n">dfr</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span> <span class="p">({</span><span class="s1">&#39;c1_times100&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">sum</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="mi">100</span> <span class="o">+</span> <span class="n">X</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
                                 <span class="s1">&#39;c2_times100&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">sum</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="mi">100</span> <span class="o">+</span> <span class="n">X</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
                                 <span class="s1">&#39;c2_times1000&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">sum</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="mi">1000</span> <span class="o">+</span> <span class="n">X</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">})</span>
            <span class="k">return</span> <span class="n">dfr</span>

    <span class="n">tr1</span> <span class="o">=</span> <span class="n">SumTimes100</span> <span class="p">()</span>
    <span class="n">tr2</span> <span class="o">=</span> <span class="n">PandasComponent</span><span class="p">(</span><span class="n">FunctionTransformer</span> <span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">*</span><span class="mi">2</span><span class="p">),</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;tr2&#39;</span><span class="p">)</span>

    <span class="n">column_transformer</span> <span class="o">=</span> <span class="n">make_column_transformer</span> <span class="p">(</span>
        <span class="p">(</span><span class="n">tr1</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;cont2&#39;</span><span class="p">,</span> <span class="s1">&#39;cont4&#39;</span><span class="p">]),</span>
        <span class="p">(</span><span class="n">tr2</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;cont2&#39;</span><span class="p">,</span> <span class="s1">&#39;cat_1&#39;</span><span class="p">]),</span>
        <span class="n">error_if_apply</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">verbose</span><span class="o">=</span><span class="mi">2</span>
    <span class="p">)</span>
    <span class="n">dfr</span> <span class="o">=</span> <span class="n">column_transformer</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>

    <span class="c1"># display &amp; test</span>
    <span class="n">display</span><span class="p">(</span><span class="n">dfr</span><span class="p">)</span>
    <span class="k">assert</span> <span class="p">(</span><span class="n">dfr</span><span class="o">.</span><span class="n">columns</span> <span class="o">==</span> <span class="p">[</span><span class="s1">&#39;c1_times100&#39;</span><span class="p">,</span><span class="s1">&#39;c2_times100&#39;</span><span class="p">,</span> <span class="s1">&#39;c2_times1000&#39;</span><span class="p">,</span><span class="s1">&#39;cont2&#39;</span><span class="p">,</span> <span class="s1">&#39;cat_1&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
    <span class="k">assert</span> <span class="p">(</span><span class="n">dfr</span><span class="p">[</span><span class="s1">&#39;c1_times100&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="nb">sum</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">cont2</span><span class="p">)</span><span class="o">*</span><span class="mi">100</span><span class="o">+</span><span class="n">df</span><span class="o">.</span><span class="n">cont2</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
    <span class="k">assert</span> <span class="p">(</span><span class="n">dfr</span><span class="p">[</span><span class="s1">&#39;c2_times100&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="nb">sum</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">cont4</span><span class="p">)</span><span class="o">*</span><span class="mi">100</span><span class="o">+</span><span class="n">df</span><span class="o">.</span><span class="n">cont4</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
    <span class="k">assert</span> <span class="p">(</span><span class="n">dfr</span><span class="p">[</span><span class="s1">&#39;c2_times1000&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="nb">sum</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">cont4</span><span class="p">)</span><span class="o">*</span><span class="mi">1000</span><span class="o">+</span><span class="n">df</span><span class="o">.</span><span class="n">cont4</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">tst</span><span class="o">.</span><span class="n">run</span> <span class="p">(</span><span class="n">test_make_column_transformer_fit_transform</span><span class="p">,</span> <span class="n">column_transformer_data</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="s1">&#39;dummy&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>running test_make_column_transformer_fit_transform
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>fitting sum_times100_cc (using whole data)
fitting tr2_cc (using whole data)
</pre>
</div>
</div>

<div class="output_area">


<div class="output_html rendered_html output_subarea "><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>c1_times100</th>
      <th>c2_times100</th>
      <th>c2_times1000</th>
      <th>cont2</th>
      <th>cat_1</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>3505</td>
      <td>13525</td>
      <td>135025</td>
      <td>10</td>
      <td>2</td>
    </tr>
    <tr>
      <th>1</th>
      <td>3506</td>
      <td>13526</td>
      <td>135026</td>
      <td>12</td>
      <td>4</td>
    </tr>
    <tr>
      <th>2</th>
      <td>3507</td>
      <td>13527</td>
      <td>135027</td>
      <td>14</td>
      <td>6</td>
    </tr>
    <tr>
      <th>3</th>
      <td>3508</td>
      <td>13528</td>
      <td>135028</td>
      <td>16</td>
      <td>4</td>
    </tr>
    <tr>
      <th>4</th>
      <td>3509</td>
      <td>13529</td>
      <td>135029</td>
      <td>18</td>
      <td>2</td>
    </tr>
  </tbody>
</table>
</div></div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span> 
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="MultiSplitComponent">MultiSplitComponent<a class="anchor-link" href="#MultiSplitComponent"> </a></h2>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="MultiSplitComponent" class="doc_header"><code>class</code> <code>MultiSplitComponent</code><a href="https://github.com/Jaume-JCI/ds-blocks/tree/main/dsblocks/core/compose.py#L1073" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>MultiSplitComponent</code>(<strong><code>component</code></strong>=<em><code>None</code></em>, <strong><code>name</code></strong>=<em><code>None</code></em>, <strong><code>class_name</code></strong>=<em><code>None</code></em>, <strong><code>fit_to</code></strong>=<em><code>'training'</code></em>, <strong><code>fit_additional</code></strong>=<em><code>[]</code></em>, <strong><code>apply_to</code></strong>=<em><code>['training', 'validation', 'test']</code></em>, <strong><code>raise_error_if_split_doesnot_exist</code></strong>=<em><code>False</code></em>, <strong><code>raise_warning_if_split_doesnot_exist</code></strong>=<em><code>True</code></em>, <strong>**<code>kwargs</code></strong>) :: <a href="/compose.html#MultiComponent"><code>MultiComponent</code></a></p>
</blockquote>

<pre><code>Component containing a list of components inside.

The list must contain at least one component.

See `Pipeline` class.</code></pre>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="MultiSplitDict">MultiSplitDict<a class="anchor-link" href="#MultiSplitDict"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="MultiSplitDict" class="doc_header"><code>class</code> <code>MultiSplitDict</code><a href="https://github.com/Jaume-JCI/ds-blocks/tree/main/dsblocks/core/compose.py#L1212" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>MultiSplitDict</code>(<strong><code>component</code></strong>=<em><code>None</code></em>, <strong>**<code>kwargs</code></strong>) :: <a href="/compose.html#MultiSplitComponent"><code>MultiSplitComponent</code></a></p>
</blockquote>

<pre><code>Component containing a list of components inside.

The list must contain at least one component.

See `Pipeline` class.</code></pre>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Tests-/-usage-examples">Tests / usage examples<a class="anchor-link" href="#Tests-/-usage-examples"> </a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="apply-transform-on-multiple-splits">apply transform on multiple splits<a class="anchor-link" href="#apply-transform-on-multiple-splits"> </a></h4>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="Transform1" class="doc_header"><code>class</code> <code>Transform1</code><a href="https://github.com/Jaume-JCI/ds-blocks/tree/main/dsblocks/tests/core/test_compose.py#L1312" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>Transform1</code>(<strong>**<code>kwargs</code></strong>) :: <a href="/components.html#Component"><code>Component</code></a></p>
</blockquote>

<pre><code>Base component class used in our Pipeline.</code></pre>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="Transform2" class="doc_header"><code>class</code> <code>Transform2</code><a href="https://github.com/Jaume-JCI/ds-blocks/tree/main/dsblocks/tests/core/test_compose.py#L1324" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>Transform2</code>(<strong>**<code>kwargs</code></strong>) :: <a href="/components.html#Component"><code>Component</code></a></p>
</blockquote>

<pre><code>Base component class used in our Pipeline.</code></pre>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="multi_split_data" class="doc_header"><code>multi_split_data</code><a href="https://github.com/Jaume-JCI/ds-blocks/tree/main/dsblocks/tests/core/test_compose.py#L2516" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>multi_split_data</code>()</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="test_multi_split_transform" class="doc_header"><code>test_multi_split_transform</code><a href="https://github.com/Jaume-JCI/ds-blocks/tree/main/dsblocks/tests/core/test_compose.py#L2531" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>test_multi_split_transform</code>(<strong><code>multi_split_data</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">class</span> <span class="nc">Transform1</span> <span class="p">(</span><span class="n">Component</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span> <span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">estimator</span><span class="o">=</span> <span class="n">Bunch</span><span class="p">(</span><span class="nb">sum</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_fit</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">estimator</span><span class="o">.</span><span class="n">sum</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_apply</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">x</span><span class="o">*</span><span class="mi">1000</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">estimator</span><span class="o">.</span><span class="n">sum</span>
    
<span class="k">class</span> <span class="nc">Transform2</span> <span class="p">(</span><span class="n">Component</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span> <span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">estimator</span><span class="o">=</span> <span class="n">Bunch</span><span class="p">(</span><span class="n">maxim</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_fit</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">validation_data</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">test_data</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">estimator</span><span class="o">.</span><span class="n">maxim</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

        <span class="nb">print</span> <span class="p">(</span><span class="sa">f</span><span class="s1">&#39;validation_data: </span><span class="si">{</span><span class="n">validation_data</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="nb">print</span> <span class="p">(</span><span class="sa">f</span><span class="s1">&#39;test_data: </span><span class="si">{</span><span class="n">test_data</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="nb">dict</span> <span class="p">(</span><span class="n">validation</span><span class="o">=</span><span class="n">validation_data</span><span class="p">,</span>
                          <span class="n">test</span><span class="o">=</span><span class="n">test_data</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_apply</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">x</span><span class="o">*</span><span class="mi">100</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">estimator</span><span class="o">.</span><span class="n">maxim</span>

<span class="k">def</span> <span class="nf">multi_split_data</span> <span class="p">():</span>
    <span class="n">data</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">training</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">])</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span>
            <span class="n">validation</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">10</span><span class="p">,</span><span class="mi">20</span><span class="p">,</span><span class="mi">30</span><span class="p">])</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span>
            <span class="n">test</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">100</span><span class="p">,</span><span class="mi">200</span><span class="p">,</span><span class="mi">300</span><span class="p">])</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
            <span class="p">)</span>
    
    <span class="n">multi_transform1</span> <span class="o">=</span> <span class="n">MultiSplitDict</span> <span class="p">(</span><span class="n">component</span> <span class="o">=</span> <span class="n">Transform1</span><span class="p">())</span>
    
    <span class="n">tr2</span> <span class="o">=</span> <span class="n">Transform2</span><span class="p">()</span>
    <span class="n">multi_transform2</span> <span class="o">=</span> <span class="n">MultiSplitDict</span> <span class="p">(</span><span class="n">component</span><span class="o">=</span><span class="n">tr2</span><span class="p">,</span>
                                            <span class="n">fit_additional</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;validation&#39;</span><span class="p">,</span> <span class="s1">&#39;test&#39;</span><span class="p">])</span>
    
    <span class="k">return</span> <span class="n">data</span><span class="p">,</span> <span class="n">multi_transform1</span><span class="p">,</span> <span class="n">multi_transform2</span><span class="p">,</span> <span class="n">tr2</span>

<span class="c1">#@pytest.mark.reference_fails</span>
<span class="k">def</span> <span class="nf">test_multi_split_transform</span> <span class="p">(</span><span class="n">multi_split_data</span><span class="p">):</span>
    <span class="c1"># example 1: apply transform on multiple splits</span>
    <span class="n">data</span><span class="p">,</span> <span class="n">multi_transform1</span><span class="p">,</span> <span class="n">multi_transform2</span><span class="p">,</span> <span class="n">tr2</span> <span class="o">=</span> <span class="n">multi_split_data</span>
    
    <span class="n">result</span> <span class="o">=</span> <span class="n">multi_transform1</span><span class="o">.</span><span class="n">fit_transform</span> <span class="p">(</span><span class="n">data</span><span class="p">)</span>

    <span class="k">assert</span> <span class="nb">type</span><span class="p">(</span><span class="n">result</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">dict</span>
    <span class="k">assert</span> <span class="n">result</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="o">==</span> <span class="n">data</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">split</span> <span class="ow">in</span> <span class="n">result</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="k">assert</span> <span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="n">split</span><span class="p">]</span><span class="o">==</span><span class="nb">sum</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;training&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">ravel</span><span class="p">())</span><span class="o">+</span><span class="n">data</span><span class="p">[</span><span class="n">split</span><span class="p">]</span><span class="o">*</span><span class="mi">1000</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>

    <span class="c1"># check that automatic name given is based on component</span>
    <span class="k">assert</span> <span class="n">multi_transform1</span><span class="o">.</span><span class="n">name</span><span class="o">==</span><span class="s1">&#39;transform1_multi_split&#39;</span>
    <span class="k">assert</span> <span class="n">multi_transform1</span><span class="o">.</span><span class="n">class_name</span><span class="o">==</span><span class="s1">&#39;Transform1MultiSplit&#39;</span>

    <span class="c1"># check that we can assign a different name</span>
    <span class="n">multi_transform1</span> <span class="o">=</span> <span class="n">MultiSplitDict</span> <span class="p">(</span><span class="n">component</span> <span class="o">=</span> <span class="n">Transform1</span><span class="p">(),</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;different&#39;</span><span class="p">,</span> <span class="n">class_name</span><span class="o">=</span><span class="s1">&#39;Yes&#39;</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">multi_transform1</span><span class="o">.</span><span class="n">name</span><span class="o">==</span><span class="s1">&#39;different&#39;</span>
    <span class="k">assert</span> <span class="n">multi_transform1</span><span class="o">.</span><span class="n">class_name</span><span class="o">==</span><span class="s1">&#39;Yes&#39;</span>
    <span class="c1"># check that this new name is given only to MultiSplitDict, </span>
    <span class="c1"># not to the component that it&#39;s wrapping</span>
    <span class="k">assert</span> <span class="n">multi_transform1</span><span class="o">.</span><span class="n">component</span><span class="o">.</span><span class="n">name</span><span class="o">==</span><span class="s1">&#39;transform1&#39;</span>
    <span class="k">assert</span> <span class="n">multi_transform1</span><span class="o">.</span><span class="n">component</span><span class="o">.</span><span class="n">class_name</span><span class="o">==</span><span class="s1">&#39;Transform1&#39;</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">tst</span><span class="o">.</span><span class="n">run</span> <span class="p">(</span><span class="n">test_multi_split_transform</span><span class="p">,</span> <span class="n">multi_split_data</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="s1">&#39;dummy&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>running test_multi_split_transform
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="fit-method-gets-training,-validation-and-test">fit method gets training, validation and test<a class="anchor-link" href="#fit-method-gets-training,-validation-and-test"> </a></h4>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="test_multi_split_fit" class="doc_header"><code>test_multi_split_fit</code><a href="https://github.com/Jaume-JCI/ds-blocks/tree/main/dsblocks/tests/core/test_compose.py#L2557" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>test_multi_split_fit</code>(<strong><code>multi_split_data</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1">#@pytest.mark.reference_fails</span>
<span class="k">def</span> <span class="nf">test_multi_split_fit</span> <span class="p">(</span><span class="n">multi_split_data</span><span class="p">):</span>
    <span class="c1"># example 2: fit method gets training, validation and test</span>
    <span class="n">data</span><span class="p">,</span> <span class="n">multi_transform1</span><span class="p">,</span> <span class="n">multi_transform2</span><span class="p">,</span> <span class="n">tr2</span> <span class="o">=</span> <span class="n">multi_split_data</span>
    <span class="c1"># we apply the transform to only test</span>
    

    <span class="c1"># we apply the transform to only test data</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">multi_transform2</span><span class="o">.</span><span class="n">fit_transform</span> <span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">apply_to</span><span class="o">=</span><span class="s1">&#39;test&#39;</span><span class="p">)</span>

    <span class="k">assert</span> <span class="nb">type</span><span class="p">(</span><span class="n">result</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">dict</span>
    <span class="k">assert</span> <span class="nb">list</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="o">==</span> <span class="p">[</span><span class="s1">&#39;test&#39;</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">split</span> <span class="ow">in</span> <span class="n">result</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="k">assert</span> <span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="n">split</span><span class="p">]</span><span class="o">==</span><span class="nb">max</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;training&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">ravel</span><span class="p">())</span><span class="o">+</span><span class="n">data</span><span class="p">[</span><span class="n">split</span><span class="p">]</span><span class="o">*</span><span class="mi">100</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>

    <span class="k">for</span> <span class="n">split</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;validation&#39;</span><span class="p">,</span> <span class="s1">&#39;test&#39;</span><span class="p">]:</span>
        <span class="k">assert</span> <span class="p">(</span><span class="n">tr2</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">split</span><span class="p">]</span> <span class="o">==</span> <span class="n">data</span><span class="p">[</span><span class="n">split</span><span class="p">])</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">tst</span><span class="o">.</span><span class="n">run</span> <span class="p">(</span><span class="n">test_multi_split_fit</span><span class="p">,</span> <span class="n">multi_split_data</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="s1">&#39;dummy&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>running test_multi_split_fit
validation_data: [[10]
 [20]
 [30]]
test_data: [[100]
 [200]
 [300]]
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="chain-transformations">chain transformations<a class="anchor-link" href="#chain-transformations"> </a></h4>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="test_multi_split_chain" class="doc_header"><code>test_multi_split_chain</code><a href="https://github.com/Jaume-JCI/ds-blocks/tree/main/dsblocks/tests/core/test_compose.py#L2576" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>test_multi_split_chain</code>(<strong><code>multi_split_data</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1">#@pytest.mark.reference_fails</span>
<span class="k">def</span> <span class="nf">test_multi_split_chain</span> <span class="p">(</span><span class="n">multi_split_data</span><span class="p">):</span>
    <span class="n">data</span><span class="p">,</span> <span class="n">multi_transform1</span><span class="p">,</span> <span class="n">multi_transform2</span><span class="p">,</span> <span class="n">tr2</span> <span class="o">=</span> <span class="n">multi_split_data</span>
    
    <span class="c1"># test that we can chain transformations</span>

    <span class="n">result</span> <span class="o">=</span> <span class="n">multi_transform1</span><span class="o">.</span><span class="n">fit_transform</span> <span class="p">(</span><span class="n">data</span><span class="p">)</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">multi_transform2</span><span class="o">.</span><span class="n">fit_transform</span> <span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">apply_to</span><span class="o">=</span><span class="s1">&#39;test&#39;</span><span class="p">)</span>

    <span class="kn">import</span> <span class="nn">pytest</span> 

    <span class="c1">#check that we have no error if split does not exist</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">multi_transform1</span><span class="o">.</span><span class="n">fit_transform</span> <span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">apply_to</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;training&#39;</span><span class="p">,</span> <span class="s1">&#39;validation&#39;</span><span class="p">])</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">multi_transform2</span><span class="o">.</span><span class="n">fit_transform</span> <span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">apply_to</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;test&#39;</span><span class="p">])</span>
    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span>

    <span class="c1">#check that we have an error if we set the flag `raise_error_if_split_doesnot_exist=True`</span>
    <span class="n">multi_transform2</span><span class="o">.</span><span class="n">raise_error_if_split_doesnot_exist</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">multi_transform1</span><span class="o">.</span><span class="n">fit_transform</span> <span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">apply_to</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;training&#39;</span><span class="p">,</span> <span class="s1">&#39;validation&#39;</span><span class="p">])</span>
    <span class="k">with</span> <span class="n">pytest</span><span class="o">.</span><span class="n">raises</span> <span class="p">(</span><span class="ne">RuntimeError</span><span class="p">):</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">multi_transform2</span><span class="o">.</span><span class="n">fit_transform</span> <span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">apply_to</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;test&#39;</span><span class="p">])</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">tst</span><span class="o">.</span><span class="n">run</span> <span class="p">(</span><span class="n">test_multi_split_chain</span><span class="p">,</span> <span class="n">multi_split_data</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="s1">&#39;dummy&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>running test_multi_split_chain
validation_data: [[10006]
 [20006]
 [30006]]
test_data: [[100006]
 [200006]
 [300006]]
validation_data: [[10006]
 [20006]
 [30006]]
test_data: None
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="loading-/-saving">loading / saving<a class="anchor-link" href="#loading-/-saving"> </a></h4>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="test_multi_split_io" class="doc_header"><code>test_multi_split_io</code><a href="https://github.com/Jaume-JCI/ds-blocks/tree/main/dsblocks/tests/core/test_compose.py#L2599" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>test_multi_split_io</code>(<strong><code>multi_split_data</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1">#@pytest.mark.reference_fails</span>
<span class="k">def</span> <span class="nf">test_multi_split_io</span> <span class="p">(</span><span class="n">multi_split_data</span><span class="p">):</span>
    
    <span class="n">data</span><span class="p">,</span> <span class="n">multi_transform1</span><span class="p">,</span> <span class="n">multi_transform2</span><span class="p">,</span> <span class="n">tr2</span> <span class="o">=</span> <span class="n">multi_split_data</span>
    
    <span class="c1"># check loading / saving</span>
    <span class="kn">from</span> <span class="nn">dsblocks.utils.utils</span> <span class="kn">import</span> <span class="n">remove_previous_results</span>
    <span class="kn">from</span> <span class="nn">dsblocks.core.utils</span> <span class="kn">import</span> <span class="n">PickleIO</span>

    <span class="n">path_results</span> <span class="o">=</span> <span class="s1">&#39;results_multi_split&#39;</span>

    <span class="n">remove_previous_results</span> <span class="p">(</span><span class="n">path_results</span><span class="o">=</span><span class="n">path_results</span><span class="p">)</span>

    <span class="n">tr</span> <span class="o">=</span> <span class="n">PickleSaverComponent</span> <span class="p">(</span><span class="n">FunctionTransformer</span> <span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">*</span><span class="mi">2</span><span class="p">),</span>
                    <span class="n">name</span><span class="o">=</span><span class="s1">&#39;times2&#39;</span><span class="p">,</span>
                    <span class="n">path_results</span><span class="o">=</span><span class="n">path_results</span><span class="p">)</span>

    <span class="n">multi_transform</span> <span class="o">=</span> <span class="n">MultiSplitDict</span> <span class="p">(</span><span class="n">component</span><span class="o">=</span><span class="n">tr</span><span class="p">,</span>
                                           <span class="n">apply_to</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;validation&#39;</span><span class="p">,</span> <span class="s1">&#39;test&#39;</span><span class="p">],</span>
                                           <span class="n">path_results</span> <span class="o">=</span> <span class="n">path_results</span><span class="p">,</span>
                                           <span class="n">data_io</span><span class="o">=</span><span class="n">PickleIO</span> <span class="p">(</span><span class="n">path_results</span> <span class="o">=</span> <span class="n">path_results</span><span class="p">))</span>

    <span class="n">result</span> <span class="o">=</span> <span class="n">multi_transform</span> <span class="p">(</span><span class="n">data</span><span class="p">)</span>

    <span class="n">multi_transform2</span> <span class="o">=</span> <span class="n">MultiSplitDict</span> <span class="p">(</span><span class="n">data_io</span><span class="o">=</span><span class="n">PickleIO</span> <span class="p">(</span><span class="n">path_results</span> <span class="o">=</span> <span class="n">path_results</span><span class="p">),</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;times2_multi_split&#39;</span><span class="p">)</span>

    <span class="n">result2</span> <span class="o">=</span> <span class="n">multi_transform2</span><span class="o">.</span><span class="n">data_io</span><span class="o">.</span><span class="n">load_result</span> <span class="p">()</span>

    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">result</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="k">assert</span> <span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">==</span> <span class="n">result2</span><span class="p">[</span><span class="n">k</span><span class="p">])</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>

    <span class="k">assert</span> <span class="n">result</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span><span class="o">==</span><span class="n">result2</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>

    <span class="k">assert</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">path_results</span><span class="p">))</span><span class="o">==</span><span class="p">[</span><span class="s1">&#39;test&#39;</span><span class="p">,</span> <span class="s1">&#39;validation&#39;</span><span class="p">,</span> <span class="s1">&#39;whole&#39;</span><span class="p">]</span>

    <span class="k">assert</span> <span class="p">(</span><span class="n">tr</span><span class="o">.</span><span class="n">data_io</span><span class="o">.</span><span class="n">load_result</span><span class="p">(</span><span class="n">split</span><span class="o">=</span><span class="s1">&#39;test&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="n">result</span><span class="p">[</span><span class="s1">&#39;test&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>

    <span class="k">assert</span> <span class="p">(</span><span class="n">tr</span><span class="o">.</span><span class="n">data_io</span><span class="o">.</span><span class="n">load_result</span><span class="p">(</span><span class="n">split</span><span class="o">=</span><span class="s1">&#39;validation&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="n">result</span><span class="p">[</span><span class="s1">&#39;validation&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>

    <span class="k">assert</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">path_results</span><span class="si">}</span><span class="s1">/validation&#39;</span><span class="p">)</span><span class="o">==</span><span class="p">[</span><span class="s1">&#39;times2_result.pk&#39;</span><span class="p">]</span>

    <span class="k">assert</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">path_results</span><span class="si">}</span><span class="s1">/test&#39;</span><span class="p">)</span><span class="o">==</span><span class="p">[</span><span class="s1">&#39;times2_result.pk&#39;</span><span class="p">]</span>

    <span class="k">assert</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">path_results</span><span class="si">}</span><span class="s1">/whole&#39;</span><span class="p">)</span><span class="o">==</span><span class="p">[</span><span class="s1">&#39;times2_multi_split_result.pk&#39;</span><span class="p">]</span>

    <span class="n">remove_previous_results</span> <span class="p">(</span><span class="n">path_results</span><span class="o">=</span><span class="n">path_results</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">tst</span><span class="o">.</span><span class="n">run</span> <span class="p">(</span><span class="n">test_multi_split_io</span><span class="p">,</span> <span class="n">multi_split_data</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="s1">&#39;dummy&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>running test_multi_split_io
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="With-non-dictionary-input-/-output">With non-dictionary input / output<a class="anchor-link" href="#With-non-dictionary-input-/-output"> </a></h4>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="test_multi_split_non_dict" class="doc_header"><code>test_multi_split_non_dict</code><a href="https://github.com/Jaume-JCI/ds-blocks/tree/main/dsblocks/tests/core/test_compose.py#L2647" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>test_multi_split_non_dict</code>()</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1">#@pytest.mark.reference_fails</span>
<span class="k">def</span> <span class="nf">test_multi_split_non_dict</span> <span class="p">():</span>
    <span class="c1"># check loading / saving</span>
    <span class="n">tr</span> <span class="o">=</span> <span class="n">Component</span> <span class="p">(</span><span class="n">FunctionTransformer</span> <span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">*</span><span class="mi">2</span><span class="p">))</span>

    <span class="n">multi_transform</span> <span class="o">=</span> <span class="n">MultiSplitDict</span> <span class="p">(</span><span class="n">tr</span><span class="p">,</span> <span class="n">apply_to</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;test&#39;</span><span class="p">])</span>

    <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">100</span><span class="p">,</span><span class="mi">200</span><span class="p">,</span><span class="mi">300</span><span class="p">])</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">multi_transform</span> <span class="p">(</span><span class="n">data</span><span class="p">)</span>

    <span class="k">assert</span> <span class="nb">type</span><span class="p">(</span><span class="n">result</span><span class="p">)</span><span class="o">==</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span>
    <span class="k">assert</span> <span class="p">(</span><span class="n">result</span><span class="o">==</span><span class="n">data</span><span class="o">*</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">tst</span><span class="o">.</span><span class="n">run</span> <span class="p">(</span><span class="n">test_multi_split_non_dict</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="s1">&#39;dummy&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>running test_multi_split_non_dict
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>output applied to single split, converted to non-dictionary</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="test_multi_split_non_dict_bis" class="doc_header"><code>test_multi_split_non_dict_bis</code><a href="https://github.com/Jaume-JCI/ds-blocks/tree/main/dsblocks/tests/core/test_compose.py#L2661" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>test_multi_split_non_dict_bis</code>()</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1">#@pytest.mark.reference_fails</span>
<span class="k">def</span> <span class="nf">test_multi_split_non_dict_bis</span> <span class="p">():</span>
    <span class="n">tr</span> <span class="o">=</span> <span class="n">Component</span> <span class="p">(</span><span class="n">FunctionTransformer</span> <span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">*</span><span class="mi">2</span><span class="p">))</span>

    <span class="n">multi_transform</span> <span class="o">=</span> <span class="n">MultiSplitDict</span> <span class="p">(</span><span class="n">tr</span><span class="p">,</span> <span class="n">apply_to</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;test&#39;</span><span class="p">])</span>
    
    <span class="c1"># output applied to single split, converted to non-dictionary</span>
    <span class="n">data</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">training</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">])</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span>
                <span class="n">validation</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">10</span><span class="p">,</span><span class="mi">20</span><span class="p">,</span><span class="mi">30</span><span class="p">])</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span>
                <span class="n">test</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">100</span><span class="p">,</span><span class="mi">200</span><span class="p">,</span><span class="mi">300</span><span class="p">])</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">multi_transform</span> <span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">output_not_dict</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">assert</span> <span class="nb">type</span><span class="p">(</span><span class="n">result</span><span class="p">)</span><span class="o">==</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span>
    <span class="k">assert</span> <span class="p">(</span><span class="n">result</span><span class="o">==</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;test&#39;</span><span class="p">]</span><span class="o">*</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">tst</span><span class="o">.</span><span class="n">run</span> <span class="p">(</span><span class="n">test_multi_split_non_dict_bis</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="s1">&#39;dummy&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>running test_multi_split_non_dict_bis
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="MultiSplitDFColumn">MultiSplitDFColumn<a class="anchor-link" href="#MultiSplitDFColumn"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="MultiSplitDFColumn" class="doc_header"><code>class</code> <code>MultiSplitDFColumn</code><a href="https://github.com/Jaume-JCI/ds-blocks/tree/main/dsblocks/core/compose.py#L1268" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>MultiSplitDFColumn</code>(<strong><code>component</code></strong>=<em><code>None</code></em>, <strong>**<code>kwargs</code></strong>) :: <a href="/compose.html#MultiSplitComponent"><code>MultiSplitComponent</code></a></p>
</blockquote>

<pre><code>Component containing a list of components inside.

The list must contain at least one component.

See `Pipeline` class.</code></pre>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Tests-/-usage-examples">Tests / usage examples<a class="anchor-link" href="#Tests-/-usage-examples"> </a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="apply-transform-on-multiple-splits">apply transform on multiple splits<a class="anchor-link" href="#apply-transform-on-multiple-splits"> </a></h4>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="multi_split_data_df_column" class="doc_header"><code>multi_split_data_df_column</code><a href="https://github.com/Jaume-JCI/ds-blocks/tree/main/dsblocks/tests/core/test_compose.py#L2676" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>multi_split_data_df_column</code>()</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="test_multi_split_df_column_transform" class="doc_header"><code>test_multi_split_df_column_transform</code><a href="https://github.com/Jaume-JCI/ds-blocks/tree/main/dsblocks/tests/core/test_compose.py#L2695" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>test_multi_split_df_column_transform</code>()</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">multi_split_data_df_column</span> <span class="p">():</span>
    <span class="n">data</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">training</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">])</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span>
            <span class="n">validation</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">10</span><span class="p">,</span><span class="mi">20</span><span class="p">,</span><span class="mi">30</span><span class="p">])</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span>
            <span class="n">test</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">100</span><span class="p">,</span><span class="mi">200</span><span class="p">,</span><span class="mi">300</span><span class="p">])</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
            <span class="p">)</span>

    <span class="n">values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;training&#39;</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;validation&#39;</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;test&#39;</span><span class="p">]))</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span> <span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">values</span><span class="p">)</span>
    <span class="n">split</span> <span class="o">=</span> <span class="p">[[</span><span class="n">k</span><span class="p">]</span><span class="o">*</span><span class="n">data</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">data</span><span class="p">]</span>
    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;split&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">split</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">split</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">split</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>

    <span class="n">multi_transform1</span> <span class="o">=</span> <span class="n">MultiSplitDFColumn</span> <span class="p">(</span><span class="n">component</span> <span class="o">=</span> <span class="n">Transform1</span><span class="p">())</span>

    <span class="n">tr2</span> <span class="o">=</span> <span class="n">Transform2</span><span class="p">()</span>
    <span class="n">multi_transform2</span> <span class="o">=</span> <span class="n">MultiSplitDFColumn</span> <span class="p">(</span><span class="n">component</span><span class="o">=</span><span class="n">tr2</span><span class="p">,</span>
                                            <span class="n">fit_additional</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;validation&#39;</span><span class="p">,</span> <span class="s1">&#39;test&#39;</span><span class="p">])</span>

    <span class="k">return</span> <span class="n">df</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">multi_transform1</span><span class="p">,</span> <span class="n">multi_transform2</span><span class="p">,</span> <span class="n">tr2</span>

<span class="k">def</span> <span class="nf">test_multi_split_df_column_transform</span> <span class="p">():</span>
    <span class="c1"># example 1: apply transform on multiple splits</span>
    <span class="n">df</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">multi_transform1</span><span class="p">,</span> <span class="n">multi_transform2</span><span class="p">,</span> <span class="n">tr2</span> <span class="o">=</span> <span class="n">multi_split_data_df_column</span> <span class="p">()</span>

    <span class="n">result</span> <span class="o">=</span> <span class="n">multi_transform1</span><span class="o">.</span><span class="n">fit_transform</span> <span class="p">(</span><span class="n">df</span><span class="p">)</span>

    <span class="k">assert</span> <span class="nb">type</span><span class="p">(</span><span class="n">result</span><span class="p">)</span> <span class="ow">is</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span>

    <span class="k">assert</span> <span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">split</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span> <span class="o">==</span> <span class="nb">list</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>

    <span class="k">for</span> <span class="n">split</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="k">assert</span> <span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="n">result</span><span class="o">.</span><span class="n">split</span><span class="o">==</span><span class="n">split</span><span class="p">]</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="s1">&#39;split&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="o">==</span><span class="nb">sum</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;training&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">ravel</span><span class="p">())</span><span class="o">+</span><span class="n">data</span><span class="p">[</span><span class="n">split</span><span class="p">]</span><span class="o">*</span><span class="mi">1000</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>

    <span class="c1"># check that automatic name given is based on component</span>
    <span class="k">assert</span> <span class="n">multi_transform1</span><span class="o">.</span><span class="n">name</span><span class="o">==</span><span class="s1">&#39;transform1_multi_split&#39;</span>
    <span class="k">assert</span> <span class="n">multi_transform1</span><span class="o">.</span><span class="n">class_name</span><span class="o">==</span><span class="s1">&#39;Transform1MultiSplit&#39;</span>

    <span class="c1"># check that we can assign a different name</span>
    <span class="n">multi_transform1</span> <span class="o">=</span> <span class="n">MultiSplitDict</span> <span class="p">(</span><span class="n">component</span> <span class="o">=</span> <span class="n">Transform1</span><span class="p">(),</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;different&#39;</span><span class="p">,</span> <span class="n">class_name</span><span class="o">=</span><span class="s1">&#39;Yes&#39;</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">multi_transform1</span><span class="o">.</span><span class="n">name</span><span class="o">==</span><span class="s1">&#39;different&#39;</span>
    <span class="k">assert</span> <span class="n">multi_transform1</span><span class="o">.</span><span class="n">class_name</span><span class="o">==</span><span class="s1">&#39;Yes&#39;</span>
    <span class="c1"># check that this new name is given only to MultiSplitDict, </span>
    <span class="c1"># not to the component that it&#39;s wrapping</span>
    <span class="k">assert</span> <span class="n">multi_transform1</span><span class="o">.</span><span class="n">component</span><span class="o">.</span><span class="n">name</span><span class="o">==</span><span class="s1">&#39;transform1&#39;</span>
    <span class="k">assert</span> <span class="n">multi_transform1</span><span class="o">.</span><span class="n">component</span><span class="o">.</span><span class="n">class_name</span><span class="o">==</span><span class="s1">&#39;Transform1&#39;</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">tst</span><span class="o">.</span><span class="n">run</span> <span class="p">(</span><span class="n">test_multi_split_df_column_transform</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="s1">&#39;dummy&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>running test_multi_split_df_column_transform
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="fit-method-gets-training,-validation-and-test">fit method gets training, validation and test<a class="anchor-link" href="#fit-method-gets-training,-validation-and-test"> </a></h4>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="test_multi_split_df_column_fit" class="doc_header"><code>test_multi_split_df_column_fit</code><a href="https://github.com/Jaume-JCI/ds-blocks/tree/main/dsblocks/tests/core/test_compose.py#L2723" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>test_multi_split_df_column_fit</code>()</p>
</blockquote>

<pre><code>Example 2: fit method gets training, validation and test.</code></pre>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1">#@pytest.mark.reference_fails</span>
<span class="k">def</span> <span class="nf">test_multi_split_df_column_fit</span> <span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Example 2: fit method gets training, validation and test.&quot;&quot;&quot;</span>
    <span class="n">df</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">multi_transform1</span><span class="p">,</span> <span class="n">multi_transform2</span><span class="p">,</span> <span class="n">tr2</span> <span class="o">=</span> <span class="n">multi_split_data_df_column</span> <span class="p">()</span>
    <span class="c1"># we apply the transform to only test</span>


    <span class="c1"># we apply the transform to only test data</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">multi_transform2</span><span class="o">.</span><span class="n">fit_transform</span> <span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">apply_to</span><span class="o">=</span><span class="s1">&#39;test&#39;</span><span class="p">)</span>

    <span class="k">assert</span> <span class="nb">type</span><span class="p">(</span><span class="n">result</span><span class="p">)</span> <span class="ow">is</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span>
    <span class="k">assert</span> <span class="nb">list</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">split</span><span class="o">.</span><span class="n">unique</span><span class="p">())</span> <span class="o">==</span> <span class="p">[</span><span class="s1">&#39;test&#39;</span><span class="p">]</span>

    <span class="k">for</span> <span class="n">split</span> <span class="ow">in</span> <span class="n">result</span><span class="o">.</span><span class="n">split</span><span class="o">.</span><span class="n">unique</span><span class="p">():</span>
        <span class="k">assert</span> <span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="n">result</span><span class="o">.</span><span class="n">split</span><span class="o">==</span><span class="n">split</span><span class="p">]</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="s1">&#39;split&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="o">==</span><span class="nb">max</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;training&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">ravel</span><span class="p">())</span><span class="o">+</span><span class="n">data</span><span class="p">[</span><span class="n">split</span><span class="p">]</span><span class="o">*</span><span class="mi">100</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>

    <span class="k">for</span> <span class="n">split</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;validation&#39;</span><span class="p">,</span> <span class="s1">&#39;test&#39;</span><span class="p">]:</span>
        <span class="k">assert</span> <span class="p">(</span><span class="n">tr2</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">split</span><span class="p">]</span> <span class="o">==</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">split</span><span class="o">==</span><span class="n">split</span><span class="p">])</span><span class="o">.</span><span class="n">all</span><span class="p">()</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">tst</span><span class="o">.</span><span class="n">run</span> <span class="p">(</span><span class="n">test_multi_split_df_column_fit</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="s1">&#39;dummy&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>running test_multi_split_df_column_fit
validation_data:     0       split
3  10  validation
4  20  validation
5  30  validation
test_data:      0 split
6  100  test
7  200  test
8  300  test
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="ParallelInstances">ParallelInstances<a class="anchor-link" href="#ParallelInstances"> </a></h2>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="ParallelInstances" class="doc_header"><code>class</code> <code>ParallelInstances</code><a href="https://github.com/Jaume-JCI/ds-blocks/tree/main/dsblocks/core/compose.py#L1325" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>ParallelInstances</code>(<strong><code>component</code></strong>, <strong><code>configs</code></strong>=<em><code>[]</code></em>, <strong><code>n_iterations</code></strong>=<em><code>None</code></em>, <strong>**<code>kwargs</code></strong>) :: <a href="/compose.html#Parallel"><code>Parallel</code></a></p>
</blockquote>

<pre><code>Runs the same instance in a parallel loop.

The main difference with parallal, is that information specific about each iteration of the loop
is held in the ParallelInstances object, instead of the component object. Examples of this are:
    - start_idx, is_data_source, all_components_fitted, load_all_estimators
    - In ParallelCV, the train / test indexes to use for cross-validation.
    - The suffix to be used for each component.
    - Other things.</code></pre>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="CrossValidator">CrossValidator<a class="anchor-link" href="#CrossValidator"> </a></h2>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="CrossValidator" class="doc_header"><code>class</code> <code>CrossValidator</code><a href="https://github.com/Jaume-JCI/ds-blocks/tree/main/dsblocks/core/compose.py#L1372" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>CrossValidator</code>(<strong><code>component</code></strong>, <strong><code>splitter</code></strong>=<em><code>None</code></em>, <strong><code>evaluator</code></strong>=<em><code>None</code></em>, <strong><code>n_iterations</code></strong>=<em><code>None</code></em>, <strong><code>score_method</code></strong>=<em><code>None</code></em>, <strong><code>select_epoch</code></strong>=<em><code>False</code></em>, <strong><code>add_evaluation</code></strong>=<em><code>True</code></em>, <strong>**<code>kwargs</code></strong>) :: <a href="/compose.html#ParallelInstances"><code>ParallelInstances</code></a></p>
</blockquote>

<pre><code>Runs cross-validation on given pipeline.</code></pre>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Example-/-test">Example / test<a class="anchor-link" href="#Example-/-test"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="test_cross_validator_1" class="doc_header"><code>test_cross_validator_1</code><a href="https://github.com/Jaume-JCI/ds-blocks/tree/main/dsblocks/tests/core/test_compose.py#L2746" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>test_cross_validator_1</code>()</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="test_cross_validator_2" class="doc_header"><code>test_cross_validator_2</code><a href="https://github.com/Jaume-JCI/ds-blocks/tree/main/dsblocks/tests/core/test_compose.py#L2785" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>test_cross_validator_2</code>()</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="test_cross_validator_3" class="doc_header"><code>test_cross_validator_3</code><a href="https://github.com/Jaume-JCI/ds-blocks/tree/main/dsblocks/tests/core/test_compose.py#L2816" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>test_cross_validator_3</code>()</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">dsblocks.utils.dummies</span> <span class="kn">import</span> <span class="n">DummyClassifier</span>
<span class="kn">from</span> <span class="nn">dsblocks.blocks.blocks</span> <span class="kn">import</span> <span class="n">SkSplitGenerator</span>
<span class="kn">from</span> <span class="nn">dsblocks.blocks.blocks</span> <span class="kn">import</span> <span class="n">PandasEvaluator</span> 
    
<span class="k">def</span> <span class="nf">test_cross_validator_1</span> <span class="p">():</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span> <span class="p">({</span><span class="s1">&#39;a&#39;</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">)),</span>
                           <span class="s1">&#39;b&#39;</span><span class="p">:</span> <span class="nb">list</span> <span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">)),</span>
                           <span class="s1">&#39;label&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="mi">5</span><span class="o">+</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="mi">5</span><span class="p">})</span>

    <span class="n">splitter</span> <span class="o">=</span> <span class="n">SkSplitGenerator</span> <span class="p">(</span><span class="n">KFold</span> <span class="p">(</span><span class="n">n_splits</span><span class="o">=</span><span class="mi">5</span><span class="p">),</span> 
                                  <span class="n">label_col</span><span class="o">=</span><span class="s1">&#39;label&#39;</span><span class="p">,</span> 
                                      <span class="n">split_col</span><span class="o">=</span><span class="s1">&#39;split&#39;</span><span class="p">)</span>
    <span class="n">classifier</span> <span class="o">=</span> <span class="n">DummyClassifier</span> <span class="p">(</span><span class="n">data_converter</span><span class="o">=</span><span class="n">PandasConverter</span> <span class="p">(</span><span class="n">metadata</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;split&#39;</span><span class="p">]),</span>
                                  <span class="n">project_op</span><span class="o">=</span><span class="s1">&#39;min&#39;</span><span class="p">,</span> <span class="n">statistic</span><span class="o">=</span><span class="s1">&#39;min&#39;</span><span class="p">)</span>
    <span class="n">classifier</span> <span class="o">=</span> <span class="n">MultiSplitDFColumn</span> <span class="p">(</span><span class="n">classifier</span><span class="p">)</span>
    <span class="n">dfr</span> <span class="o">=</span> <span class="n">splitter</span><span class="o">.</span><span class="n">fit_apply</span> <span class="p">(</span><span class="n">df</span><span class="p">)</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">classifier</span><span class="o">.</span><span class="n">fit_apply</span> <span class="p">(</span><span class="n">dfr</span><span class="p">)</span>

    
    <span class="n">classifier</span> <span class="o">=</span> <span class="n">DummyClassifier</span> <span class="p">(</span><span class="n">data_converter</span><span class="o">=</span><span class="n">PandasConverter</span> <span class="p">(</span><span class="n">metadata</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;split&#39;</span><span class="p">]),</span>
                                  <span class="n">project_op</span><span class="o">=</span><span class="s1">&#39;min&#39;</span><span class="p">,</span> <span class="n">statistic</span><span class="o">=</span><span class="s1">&#39;min&#39;</span><span class="p">)</span>
    <span class="n">classifier</span> <span class="o">=</span> <span class="n">MultiSplitDFColumn</span> <span class="p">(</span><span class="n">classifier</span><span class="p">)</span>

    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span> <span class="p">({</span><span class="s1">&#39;a&#39;</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">)),</span>
                           <span class="s1">&#39;b&#39;</span><span class="p">:</span> <span class="nb">list</span> <span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">)),</span>
                           <span class="s1">&#39;label&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="mi">5</span><span class="o">+</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="mi">5</span><span class="p">})</span>
    <span class="n">splitter</span> <span class="o">=</span> <span class="n">SkSplitGenerator</span> <span class="p">(</span><span class="n">KFold</span> <span class="p">(</span><span class="n">n_splits</span><span class="o">=</span><span class="mi">5</span><span class="p">),</span> 
                                  <span class="n">label_col</span><span class="o">=</span><span class="s1">&#39;label&#39;</span><span class="p">,</span> 
                                      <span class="n">split_col</span><span class="o">=</span><span class="s1">&#39;split&#39;</span><span class="p">)</span>
    <span class="n">cv</span> <span class="o">=</span> <span class="n">CrossValidator</span> <span class="p">(</span><span class="n">classifier</span><span class="p">,</span> <span class="n">splitter</span><span class="o">=</span><span class="n">splitter</span><span class="p">)</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">cv</span><span class="o">.</span><span class="n">fit_apply</span> <span class="p">(</span><span class="n">df</span><span class="p">)</span>
    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="p">)</span><span class="o">==</span><span class="mi">5</span>

    <span class="k">assert</span> <span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">columns</span> <span class="o">==</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;label&#39;</span><span class="p">,</span><span class="s1">&#39;split&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>

    <span class="n">statistics</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">3000</span><span class="p">,</span> <span class="o">-</span><span class="mi">5000</span><span class="p">,</span> <span class="o">-</span><span class="mi">6000</span><span class="p">,</span> <span class="o">-</span><span class="mi">5000</span><span class="p">,</span> <span class="o">-</span><span class="mi">5000</span><span class="p">]</span>
    <span class="n">i</span><span class="o">=</span><span class="mi">0</span>
    <span class="k">assert</span> <span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">values</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">r_</span><span class="p">[</span><span class="n">statistics</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">+</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">2</span><span class="p">:],</span><span class="n">statistics</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">+</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[:</span><span class="mi">2</span><span class="p">]])</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">4</span><span class="p">):</span>
        <span class="k">assert</span> <span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">values</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">r_</span><span class="p">[</span><span class="n">statistics</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">+</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="o">*</span><span class="n">i</span><span class="p">],</span><span class="n">statistics</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">+</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">):],</span> <span class="n">statistics</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">+</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">2</span><span class="o">*</span><span class="n">i</span><span class="p">:</span><span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)]])</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
    <span class="n">i</span><span class="o">=</span><span class="mi">4</span>
    <span class="k">assert</span> <span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">values</span> <span class="o">==</span> <span class="n">statistics</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">+</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">test_cross_validator_2</span> <span class="p">():</span>
    <span class="k">def</span> <span class="nf">classifier_func</span> <span class="p">(</span><span class="n">X</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span> <span class="p">({</span><span class="s1">&#39;label&#39;</span><span class="p">:</span> <span class="n">X</span><span class="o">.</span><span class="n">label</span><span class="p">,</span> 
                              <span class="s1">&#39;classification&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">%</span> <span class="mi">2</span><span class="p">})</span>

    <span class="n">classifier_comp</span> <span class="o">=</span> <span class="n">Component</span> <span class="p">(</span><span class="n">apply</span><span class="o">=</span><span class="n">classifier_func</span><span class="p">)</span>
    <span class="n">classifier</span> <span class="o">=</span> <span class="n">MultiSplitDFColumn</span> <span class="p">(</span><span class="n">classifier_comp</span><span class="p">)</span>

    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span> <span class="p">({</span><span class="s1">&#39;a&#39;</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">)),</span>
                           <span class="s1">&#39;b&#39;</span><span class="p">:</span> <span class="nb">list</span> <span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">)),</span>
                           <span class="s1">&#39;label&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="mi">5</span><span class="o">+</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="mi">5</span><span class="p">})</span>
    <span class="n">splitter</span> <span class="o">=</span> <span class="n">SkSplitGenerator</span> <span class="p">(</span><span class="n">KFold</span> <span class="p">(</span><span class="n">n_splits</span><span class="o">=</span><span class="mi">5</span><span class="p">),</span> 
                                  <span class="n">label_col</span><span class="o">=</span><span class="s1">&#39;label&#39;</span><span class="p">,</span> 
                                      <span class="n">split_col</span><span class="o">=</span><span class="s1">&#39;split&#39;</span><span class="p">)</span>
    <span class="n">cv</span> <span class="o">=</span> <span class="n">CrossValidator</span> <span class="p">(</span><span class="n">classifier</span><span class="p">,</span> <span class="n">splitter</span><span class="o">=</span><span class="n">splitter</span><span class="p">)</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">cv</span><span class="o">.</span><span class="n">fit_apply</span> <span class="p">(</span><span class="n">df</span><span class="p">)</span>

    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span> <span class="p">({</span><span class="s1">&#39;a&#39;</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">)),</span>
                           <span class="s1">&#39;b&#39;</span><span class="p">:</span> <span class="nb">list</span> <span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">)),</span>
                           <span class="s1">&#39;label&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="mi">5</span><span class="o">+</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="mi">5</span><span class="p">})</span>
    <span class="n">splitter</span> <span class="o">=</span> <span class="n">SkSplitGenerator</span> <span class="p">(</span><span class="n">KFold</span> <span class="p">(</span><span class="n">n_splits</span><span class="o">=</span><span class="mi">5</span><span class="p">),</span> 
                                  <span class="n">label_col</span><span class="o">=</span><span class="s1">&#39;label&#39;</span><span class="p">,</span> 
                                      <span class="n">split_col</span><span class="o">=</span><span class="s1">&#39;split&#39;</span><span class="p">)</span>
    <span class="n">evaluator</span> <span class="o">=</span> <span class="n">MultiSplitDFColumn</span><span class="p">(</span><span class="n">PandasEvaluator</span><span class="p">(</span><span class="n">convert_after</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
                                  <span class="p">)</span>
    <span class="n">cv</span> <span class="o">=</span> <span class="n">CrossValidator</span> <span class="p">(</span><span class="n">classifier</span><span class="p">,</span> <span class="n">splitter</span><span class="o">=</span><span class="n">splitter</span><span class="p">,</span> <span class="n">evaluator</span><span class="o">=</span><span class="n">evaluator</span><span class="p">,</span> <span class="n">add_evaluation</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">cv</span><span class="o">.</span><span class="n">fit_apply</span> <span class="p">(</span><span class="n">df</span><span class="p">)</span>
    <span class="n">results</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
    <span class="k">assert</span> <span class="p">(</span><span class="n">results</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">results</span><span class="o">.</span><span class="n">split</span><span class="o">==</span><span class="s1">&#39;test&#39;</span><span class="p">,</span> <span class="s1">&#39;accuracy_score&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
    <span class="k">assert</span> <span class="p">(</span><span class="n">results</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">results</span><span class="o">.</span><span class="n">split</span><span class="o">==</span><span class="s1">&#39;training&#39;</span><span class="p">,</span> <span class="s1">&#39;accuracy_score&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="p">[</span><span class="mf">0.375</span><span class="p">,</span> <span class="mf">0.625</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.375</span><span class="p">,</span> <span class="mf">0.625</span><span class="p">])</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
    
<span class="k">def</span> <span class="nf">test_cross_validator_3</span> <span class="p">():</span>
    <span class="k">class</span> <span class="nc">DummyHistoryClassifier</span> <span class="p">(</span><span class="n">Component</span><span class="p">):</span>
        <span class="k">def</span> <span class="fm">__init__</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
            <span class="nb">super</span> <span class="p">()</span><span class="o">.</span><span class="fm">__init__</span> <span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">def</span> <span class="nf">_apply</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">X</span>
        <span class="k">def</span> <span class="nf">_fit</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dict_results</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s1">&#39;score&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span> <span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="o">-</span><span class="mi">5</span><span class="p">)</span> <span class="k">if</span> <span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">%</span> <span class="mi">2</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="k">else</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="o">-</span><span class="mi">4</span><span class="p">)}</span>
        <span class="k">def</span> <span class="nf">history</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">dict_results</span>

    <span class="n">classifier_comp</span> <span class="o">=</span> <span class="n">DummyHistoryClassifier</span> <span class="p">()</span>
    <span class="n">classifier</span> <span class="o">=</span> <span class="n">MultiSplitDFColumn</span> <span class="p">(</span><span class="n">classifier_comp</span><span class="p">)</span>

    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span> <span class="p">({</span><span class="s1">&#39;a&#39;</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">)),</span>
                           <span class="s1">&#39;b&#39;</span><span class="p">:</span> <span class="nb">list</span> <span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">)),</span>
                           <span class="s1">&#39;label&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="mi">5</span><span class="o">+</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="mi">5</span><span class="p">})</span>
    <span class="n">splitter</span> <span class="o">=</span> <span class="n">SkSplitGenerator</span> <span class="p">(</span><span class="n">KFold</span> <span class="p">(</span><span class="n">n_splits</span><span class="o">=</span><span class="mi">5</span><span class="p">),</span> <span class="n">label_col</span><span class="o">=</span><span class="s1">&#39;label&#39;</span><span class="p">,</span> <span class="n">split_col</span><span class="o">=</span><span class="s1">&#39;split&#39;</span><span class="p">)</span>
    <span class="n">cv</span> <span class="o">=</span> <span class="n">CrossValidator</span> <span class="p">(</span><span class="n">classifier</span><span class="p">,</span> <span class="n">splitter</span><span class="o">=</span><span class="n">splitter</span><span class="p">,</span> <span class="n">score_method</span><span class="o">=</span><span class="s1">&#39;history&#39;</span><span class="p">)</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">cv</span><span class="o">.</span><span class="n">fit_apply</span> <span class="p">(</span><span class="n">df</span><span class="p">)</span>

    <span class="k">assert</span> <span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="o">==</span> <span class="p">[</span><span class="s1">&#39;score&#39;</span><span class="p">]</span> 
            <span class="ow">and</span> <span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;score&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">3.6</span><span class="p">,</span> <span class="mf">2.6</span><span class="p">,</span> <span class="mf">1.2</span><span class="p">,</span> <span class="mf">1.</span> <span class="p">,</span> <span class="mf">1.2</span><span class="p">,</span> <span class="mf">2.2</span><span class="p">,</span> <span class="mf">3.6</span><span class="p">,</span> <span class="mf">4.6</span><span class="p">]))</span><span class="o">.</span><span class="n">all</span><span class="p">())</span>
    
    <span class="n">splitter</span> <span class="o">=</span> <span class="n">SkSplitGenerator</span> <span class="p">(</span><span class="n">KFold</span> <span class="p">(</span><span class="n">n_splits</span><span class="o">=</span><span class="mi">5</span><span class="p">),</span> <span class="n">label_col</span><span class="o">=</span><span class="s1">&#39;label&#39;</span><span class="p">,</span> <span class="n">split_col</span><span class="o">=</span><span class="s1">&#39;split&#39;</span><span class="p">)</span>
    <span class="n">cv</span> <span class="o">=</span> <span class="n">CrossValidator</span> <span class="p">(</span><span class="n">classifier</span><span class="p">,</span> <span class="n">splitter</span><span class="o">=</span><span class="n">splitter</span><span class="p">,</span> <span class="n">score_method</span><span class="o">=</span><span class="s1">&#39;history&#39;</span><span class="p">,</span> <span class="n">select_epoch</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">cv</span><span class="o">.</span><span class="n">fit_apply</span> <span class="p">(</span><span class="n">df</span><span class="p">)</span>

    <span class="k">assert</span> <span class="n">result</span><span class="o">==</span><span class="p">{</span><span class="s1">&#39;last_score&#39;</span><span class="p">:</span> <span class="mf">4.6</span><span class="p">,</span> <span class="s1">&#39;argmax_score&#39;</span><span class="p">:</span> <span class="mi">7</span><span class="p">,</span> <span class="s1">&#39;argmin_score&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;max_score&#39;</span><span class="p">:</span> <span class="mf">4.6</span><span class="p">,</span> <span class="s1">&#39;min_score&#39;</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">}</span>

    <span class="c1"># ************************************************</span>
    <span class="c1"># ************************************************</span>
    <span class="n">path_results</span> <span class="o">=</span> <span class="s1">&#39;test_cross_validator_3&#39;</span>
    <span class="n">splitter</span> <span class="o">=</span> <span class="n">SkSplitGenerator</span> <span class="p">(</span><span class="n">KFold</span> <span class="p">(</span><span class="n">n_splits</span><span class="o">=</span><span class="mi">5</span><span class="p">),</span> <span class="n">label_col</span><span class="o">=</span><span class="s1">&#39;label&#39;</span><span class="p">,</span> <span class="n">split_col</span><span class="o">=</span><span class="s1">&#39;split&#39;</span><span class="p">)</span>
    <span class="n">cv</span> <span class="o">=</span> <span class="n">CrossValidator</span> <span class="p">(</span><span class="n">classifier</span><span class="p">,</span> <span class="n">splitter</span><span class="o">=</span><span class="n">splitter</span><span class="p">,</span> <span class="n">score_method</span><span class="o">=</span><span class="s1">&#39;history&#39;</span><span class="p">,</span> <span class="n">select_epoch</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                         <span class="n">path_results</span><span class="o">=</span><span class="n">path_results</span><span class="p">)</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">cv</span><span class="o">.</span><span class="n">fit_apply</span> <span class="p">(</span><span class="n">df</span><span class="p">)</span>

    <span class="k">assert</span> <span class="n">result</span><span class="o">==</span><span class="p">{</span><span class="s1">&#39;last_score&#39;</span><span class="p">:</span> <span class="mf">4.6</span><span class="p">,</span> <span class="s1">&#39;argmax_score&#39;</span><span class="p">:</span> <span class="mi">7</span><span class="p">,</span> <span class="s1">&#39;argmin_score&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;max_score&#39;</span><span class="p">:</span> <span class="mf">4.6</span><span class="p">,</span> <span class="s1">&#39;min_score&#39;</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">}</span>
    
    <span class="n">result</span> <span class="o">=</span> <span class="n">joblib</span><span class="o">.</span><span class="n">load</span> <span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">path_results</span><span class="si">}</span><span class="s1">/whole/cross_validation_final_metrics.pk&#39;</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">result</span><span class="o">==</span><span class="p">{</span><span class="s1">&#39;last_score&#39;</span><span class="p">:</span> <span class="mf">4.6</span><span class="p">,</span> <span class="s1">&#39;argmax_score&#39;</span><span class="p">:</span> <span class="mi">7</span><span class="p">,</span> <span class="s1">&#39;argmin_score&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;max_score&#39;</span><span class="p">:</span> <span class="mf">4.6</span><span class="p">,</span> <span class="s1">&#39;min_score&#39;</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">}</span>

    <span class="n">result</span> <span class="o">=</span> <span class="n">joblib</span><span class="o">.</span><span class="n">load</span> <span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">path_results</span><span class="si">}</span><span class="s1">/whole/cross_validation_metrics.pk&#39;</span><span class="p">)</span>
    <span class="k">assert</span> <span class="nb">list</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span><span class="o">==</span><span class="p">[</span><span class="s1">&#39;score&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;score&#39;</span><span class="p">]</span><span class="o">==</span><span class="p">[</span><span class="mf">3.6</span><span class="p">,</span> <span class="mf">2.6</span><span class="p">,</span> <span class="mf">1.2</span><span class="p">,</span> <span class="mf">1.</span> <span class="p">,</span> <span class="mf">1.2</span><span class="p">,</span> <span class="mf">2.2</span><span class="p">,</span> <span class="mf">3.6</span><span class="p">,</span> <span class="mf">4.6</span><span class="p">])</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
    
    <span class="k">assert</span> <span class="nb">sorted</span> <span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">path_results</span><span class="si">}</span><span class="s1">/whole&#39;</span><span class="p">))</span><span class="o">==</span><span class="p">[</span><span class="s1">&#39;cross_validation_final_metrics.pk&#39;</span><span class="p">,</span>
                                                     <span class="s1">&#39;cross_validation_metrics.pk&#39;</span><span class="p">,</span>
                                                     <span class="s1">&#39;cross_validator_result.pk&#39;</span><span class="p">,</span>
                                                     <span class="s1">&#39;pipeline_0_result.pk&#39;</span><span class="p">,</span>
                                                     <span class="s1">&#39;pipeline_1_result.pk&#39;</span><span class="p">,</span>
                                                     <span class="s1">&#39;pipeline_2_result.pk&#39;</span><span class="p">,</span>
                                                     <span class="s1">&#39;pipeline_3_result.pk&#39;</span><span class="p">,</span>
                                                     <span class="s1">&#39;pipeline_4_result.pk&#39;</span><span class="p">]</span>
    
    <span class="n">remove_previous_results</span> <span class="p">(</span><span class="n">path_results</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">tst</span><span class="o">.</span><span class="n">run</span> <span class="p">(</span><span class="n">test_cross_validator_1</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="s1">&#39;dummy&#39;</span><span class="p">)</span>
<span class="n">tst</span><span class="o">.</span><span class="n">run</span> <span class="p">(</span><span class="n">test_cross_validator_2</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="s1">&#39;dummy&#39;</span><span class="p">)</span>
<span class="n">tst</span><span class="o">.</span><span class="n">run</span> <span class="p">(</span><span class="n">test_cross_validator_3</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="s1">&#39;dummy&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>running test_cross_validator_1
running test_cross_validator_2
running test_cross_validator_3
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

</div>


