---

title: Block utilities


keywords: fastai
sidebar: home_sidebar

summary: "Block utilities"
description: "Block utilities"
nb_path: "nbs/core/utils.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: nbs/core/utils.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">pytest</span> 
<span class="kn">from</span> <span class="nn">dsblocks.core.components</span> <span class="kn">import</span> <span class="n">Component</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Functions-for-loading-and-saving">Functions for loading and saving<a class="anchor-link" href="#Functions-for-loading-and-saving"> </a></h2>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="save_csv" class="doc_header"><code>save_csv</code><a href="https://github.com/Jaume-JCI/ds-blocks/tree/main/dsblocks/core/utils.py#L36" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>save_csv</code>(<strong><code>df</code></strong>, <strong><code>path</code></strong>, <strong>**<code>kwargs</code></strong>)</p>
</blockquote>

<pre><code>Save DataFrame `df` to csv file indicated in `path`.

Convenience function that uses the same signature
as joblib.dump, which is needed by `DataIO`.</code></pre>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="save_parquet" class="doc_header"><code>save_parquet</code><a href="https://github.com/Jaume-JCI/ds-blocks/tree/main/dsblocks/core/utils.py#L46" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>save_parquet</code>(<strong><code>df</code></strong>, <strong><code>path</code></strong>, <strong>**<code>kwargs</code></strong>)</p>
</blockquote>

<pre><code>Save DataFrame `df` to parquet file indicated in `path`.

Convenience function that uses the same signature
as joblib.dump, which is needed by `DataIO`.</code></pre>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="save_multi_index_parquet" class="doc_header"><code>save_multi_index_parquet</code><a href="https://github.com/Jaume-JCI/ds-blocks/tree/main/dsblocks/core/utils.py#L56" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>save_multi_index_parquet</code>(<strong><code>df</code></strong>, <strong><code>path</code></strong>, <strong>**<code>kwargs</code></strong>)</p>
</blockquote>

<pre><code>Save DataFrame `df` to multi-index parquet file indicated in `path`.

Convenience function that uses the same signature
as joblib.dump, which is needed by `DataIO`.</code></pre>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="save_keras_model" class="doc_header"><code>save_keras_model</code><a href="https://github.com/Jaume-JCI/ds-blocks/tree/main/dsblocks/core/utils.py#L67" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>save_keras_model</code>(<strong><code>model</code></strong>, <strong><code>path</code></strong>, <strong>**<code>kwargs</code></strong>)</p>
</blockquote>

<pre><code>Save keras `model` to file indicated in `path`.

Convenience function that uses the same signature
as joblib.dump, which is needed by `DataIO`.</code></pre>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="save_csv_gz" class="doc_header"><code>save_csv_gz</code><a href="https://github.com/Jaume-JCI/ds-blocks/tree/main/dsblocks/core/utils.py#L77" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>save_csv_gz</code>(<strong><code>df</code></strong>, <strong><code>path</code></strong>, <strong>**<code>kwargs</code></strong>)</p>
</blockquote>

<pre><code>Save DataFrame `df` to csv.gz file indicated in `path`.

Convenience function that uses the same signature
as joblib.dump, which is needed by `DataIO`.</code></pre>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="read_csv" class="doc_header"><code>read_csv</code><a href="https://github.com/Jaume-JCI/ds-blocks/tree/main/dsblocks/core/utils.py#L87" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>read_csv</code>(<strong><code>path</code></strong>, <strong>**<code>kwargs</code></strong>)</p>
</blockquote>

<pre><code>Read DataFrame from csv file indicated in `path`.

Convenience function that uses the same signature
as joblib.load, which is needed by `DataIO`.</code></pre>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="read_csv_gz" class="doc_header"><code>read_csv_gz</code><a href="https://github.com/Jaume-JCI/ds-blocks/tree/main/dsblocks/core/utils.py#L97" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>read_csv_gz</code>(<strong><code>path</code></strong>, <strong>**<code>kwargs</code></strong>)</p>
</blockquote>

<pre><code>Read DataFrame from csv.gz file indicated in `path`.

Convenience function that uses the same signature
as joblib.load, which is needed by `DataIO`.</code></pre>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="load_keras_model" class="doc_header"><code>load_keras_model</code><a href="https://github.com/Jaume-JCI/ds-blocks/tree/main/dsblocks/core/utils.py#L107" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>load_keras_model</code>(<strong><code>path</code></strong>, <strong>**<code>kwargs</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Mapping-type-to-loading-/-saving-function">Mapping type to loading / saving function<a class="anchor-link" href="#Mapping-type-to-loading-/-saving-function"> </a></h2>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="DataIO-class">DataIO class<a class="anchor-link" href="#DataIO-class"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="DataIO">DataIO<a class="anchor-link" href="#DataIO"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="DataIO" class="doc_header"><code>class</code> <code>DataIO</code><a href="https://github.com/Jaume-JCI/ds-blocks/tree/main/dsblocks/core/utils.py#L136" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>DataIO</code>(<strong><code>component</code></strong>=<em><code>None</code></em>, <strong>**<code>kwargs</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="get_path_result_file,-get_path_model_file">get_path_result_file, get_path_model_file<a class="anchor-link" href="#get_path_result_file,-get_path_model_file"> </a></h4>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="DummyComponent" class="doc_header"><code>class</code> <code>DummyComponent</code><a href="https://github.com/Jaume-JCI/ds-blocks/tree/main/dsblocks/tests/core/test_utils.py#L36" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>DummyComponent</code>(<strong>**<code>kwargs</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="test_data_io_folder" class="doc_header"><code>test_data_io_folder</code><a href="https://github.com/Jaume-JCI/ds-blocks/tree/main/dsblocks/tests/core/test_utils.py#L44" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>test_data_io_folder</code>()</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1">#@pytest.mark.my_mark</span>
<span class="k">class</span> <span class="nc">DummyComponent</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;my_component&#39;</span>
    <span class="k">def</span> <span class="nf">obtain_config_params</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">kwargs</span>

<span class="n">dummy_component</span> <span class="o">=</span> <span class="n">DummyComponent</span> <span class="p">()</span>

<span class="k">def</span> <span class="nf">test_data_io_folder</span> <span class="p">():</span>
    <span class="n">d</span> <span class="o">=</span> <span class="n">DataIO</span> <span class="p">(</span><span class="n">component</span><span class="o">=</span><span class="n">dummy_component</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">d</span><span class="o">.</span><span class="n">folder</span><span class="o">==</span><span class="s1">&#39;&#39;</span>

    <span class="k">assert</span> <span class="n">d</span><span class="o">.</span><span class="n">get_path_result_file</span> <span class="p">()</span> <span class="ow">is</span> <span class="kc">None</span> 
    <span class="k">assert</span> <span class="n">d</span><span class="o">.</span><span class="n">get_path_model_file</span> <span class="p">()</span> <span class="ow">is</span> <span class="kc">None</span> 

    <span class="n">d</span> <span class="o">=</span> <span class="n">DataIO</span> <span class="p">(</span><span class="n">component</span><span class="o">=</span><span class="n">dummy_component</span><span class="p">,</span> 
            <span class="n">path_results</span> <span class="o">=</span><span class="s1">&#39;/path/to/results&#39;</span><span class="p">,</span>
            <span class="n">path_models</span><span class="o">=</span><span class="s1">&#39;/other_path/example&#39;</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">d</span><span class="o">.</span><span class="n">get_path_result_file</span> <span class="p">()</span> <span class="o">==</span> <span class="n">Path</span><span class="p">(</span><span class="s1">&#39;/path/to/results/whole/my_component_result.pk&#39;</span><span class="p">)</span>

    <span class="k">assert</span> <span class="n">d</span><span class="o">.</span><span class="n">get_path_model_file</span> <span class="p">()</span> <span class="o">==</span> <span class="n">Path</span><span class="p">(</span><span class="s1">&#39;/other_path/example/models/my_component_estimator.pk&#39;</span><span class="p">)</span>

    <span class="n">d</span><span class="o">.</span><span class="n">folder</span> <span class="o">=</span> <span class="s1">&#39;my_folder&#39;</span>
    <span class="k">assert</span> <span class="n">d</span><span class="o">.</span><span class="n">get_path_result_file</span> <span class="p">()</span> <span class="o">==</span> <span class="n">Path</span><span class="p">(</span><span class="s1">&#39;/path/to/results/my_folder/whole/my_component_result.pk&#39;</span><span class="p">)</span>

    <span class="k">assert</span> <span class="n">d</span><span class="o">.</span><span class="n">get_path_model_file</span> <span class="p">()</span> <span class="o">==</span> <span class="n">Path</span><span class="p">(</span><span class="s1">&#39;/other_path/example/my_folder/models/my_component_estimator.pk&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">tst</span><span class="o">.</span><span class="n">run</span> <span class="p">(</span><span class="n">test_data_io_folder</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="s1">&#39;dummy&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>running test_data_io_folder
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="folder-chaining">folder chaining<a class="anchor-link" href="#folder-chaining"> </a></h4>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="test_data_io_chaining" class="doc_header"><code>test_data_io_chaining</code><a href="https://github.com/Jaume-JCI/ds-blocks/tree/main/dsblocks/tests/core/test_utils.py#L65" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>test_data_io_chaining</code>()</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1">#@pytest.mark.my_mark</span>
<span class="k">def</span> <span class="nf">test_data_io_chaining</span> <span class="p">():</span>
    <span class="n">d</span> <span class="o">=</span> <span class="n">DataIO</span> <span class="p">(</span><span class="n">component</span><span class="o">=</span><span class="n">dummy_component</span><span class="p">)</span>
    <span class="n">d</span><span class="o">.</span><span class="n">chain_folders</span> <span class="p">(</span><span class="s1">&#39;first&#39;</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">d</span><span class="o">.</span><span class="n">folder</span><span class="o">==</span><span class="s1">&#39;first&#39;</span>
    <span class="n">d</span><span class="o">.</span><span class="n">chain_folders</span> <span class="p">(</span><span class="s1">&#39;second&#39;</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">d</span><span class="o">.</span><span class="n">folder</span><span class="o">==</span><span class="s1">&#39;second/first&#39;</span>
    <span class="n">d</span><span class="o">.</span><span class="n">chain_folders</span> <span class="p">(</span><span class="s1">&#39;third&#39;</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">d</span><span class="o">.</span><span class="n">folder</span><span class="o">==</span><span class="s1">&#39;third/second/first&#39;</span>

    <span class="n">d</span><span class="o">.</span><span class="n">folder</span>

    <span class="n">d</span><span class="o">.</span><span class="n">chain_folders</span> <span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">d</span><span class="o">.</span><span class="n">folder</span><span class="o">==</span><span class="s1">&#39;third/second/first&#39;</span>

    <span class="n">d</span> <span class="o">=</span> <span class="n">DataIO</span> <span class="p">(</span><span class="n">component</span><span class="o">=</span><span class="n">dummy_component</span><span class="p">)</span>
    <span class="n">d</span><span class="o">.</span><span class="n">chain_folders</span> <span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">d</span><span class="o">.</span><span class="n">folder</span><span class="o">==</span><span class="s1">&#39;&#39;</span>

    <span class="n">d</span> <span class="o">=</span> <span class="n">DataIO</span> <span class="p">(</span><span class="n">component</span><span class="o">=</span><span class="n">dummy_component</span><span class="p">,</span> <span class="n">folder</span><span class="o">=</span><span class="s1">&#39;new&#39;</span><span class="p">)</span>
    <span class="n">d</span><span class="o">.</span><span class="n">chain_folders</span> <span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">d</span><span class="o">.</span><span class="n">folder</span><span class="o">==</span><span class="s1">&#39;new&#39;</span>
    <span class="n">d</span><span class="o">.</span><span class="n">chain_folders</span> <span class="p">(</span><span class="s1">&#39;other&#39;</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">d</span><span class="o">.</span><span class="n">folder</span><span class="o">==</span><span class="s1">&#39;other/new&#39;</span>

    <span class="n">d</span> <span class="o">=</span> <span class="n">DataIO</span> <span class="p">(</span><span class="n">component</span><span class="o">=</span><span class="n">dummy_component</span><span class="p">,</span> <span class="n">folder</span><span class="o">=</span><span class="s1">&#39;new&#39;</span><span class="p">,</span>
                <span class="n">path_results</span> <span class="o">=</span><span class="s1">&#39;/path/to/results&#39;</span><span class="p">,</span>
                <span class="n">path_models</span><span class="o">=</span><span class="s1">&#39;/other_path/example&#39;</span><span class="p">)</span>
    <span class="n">d</span><span class="o">.</span><span class="n">chain_folders</span> <span class="p">(</span><span class="s1">&#39;other&#39;</span><span class="p">)</span>

    <span class="k">assert</span> <span class="n">d</span><span class="o">.</span><span class="n">get_path_result_file</span> <span class="p">()</span> <span class="o">==</span> <span class="n">Path</span><span class="p">(</span><span class="s1">&#39;/path/to/results/other/new/whole/my_component_result.pk&#39;</span><span class="p">)</span>

    <span class="k">assert</span> <span class="n">d</span><span class="o">.</span><span class="n">get_path_model_file</span> <span class="p">()</span> <span class="o">==</span> <span class="n">Path</span><span class="p">(</span><span class="s1">&#39;/other_path/example/other/new/models/my_component_estimator.pk&#39;</span><span class="p">)</span>
    
    <span class="n">d</span> <span class="o">=</span> <span class="n">DataIO</span> <span class="p">(</span><span class="n">component</span><span class="o">=</span><span class="n">dummy_component</span><span class="p">,</span> <span class="n">folder</span><span class="o">=</span><span class="s1">&#39;__class__&#39;</span><span class="p">,</span>
                <span class="n">path_results</span> <span class="o">=</span><span class="s1">&#39;/path/to/results&#39;</span><span class="p">,</span>
                <span class="n">path_models</span><span class="o">=</span><span class="s1">&#39;/other_path/example&#39;</span><span class="p">)</span>
    <span class="n">d</span><span class="o">.</span><span class="n">chain_folders</span> <span class="p">(</span><span class="s1">&#39;other&#39;</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">d</span><span class="o">.</span><span class="n">folder</span> <span class="o">==</span> <span class="s1">&#39;other/my_component&#39;</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">tst</span><span class="o">.</span><span class="n">run</span> <span class="p">(</span><span class="n">test_data_io_chaining</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="s1">&#39;dummy&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>running test_data_io_chaining
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Subclasses-of-DataIO">Subclasses of DataIO<a class="anchor-link" href="#Subclasses-of-DataIO"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="PandasIO">PandasIO<a class="anchor-link" href="#PandasIO"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="PandasIO" class="doc_header"><code>class</code> <code>PandasIO</code><a href="https://github.com/Jaume-JCI/ds-blocks/tree/main/dsblocks/core/utils.py#L528" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>PandasIO</code>(<strong><code>result_file_extension</code></strong>=<em><code>'.parquet'</code></em>, <strong><code>result_load_func</code></strong>=<em><code>read_parquet</code></em>, <strong><code>result_save_func</code></strong>=<em><code>save_multi_index_parquet</code></em>, <strong>**<code>kwargs</code></strong>) :: <a href="/utils.html#DataIO"><code>DataIO</code></a></p>
</blockquote>

<pre><code>Saves results in parquet format by default.

Results are supposed to be in Pandas DataFrame format.</code></pre>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="PickleIO">PickleIO<a class="anchor-link" href="#PickleIO"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="PickleIO" class="doc_header"><code>class</code> <code>PickleIO</code><a href="https://github.com/Jaume-JCI/ds-blocks/tree/main/dsblocks/core/utils.py#L546" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>PickleIO</code>(<strong><code>fitting_file_extension</code></strong>=<em><code>'.pk'</code></em>, <strong><code>fitting_load_func</code></strong>=<em><code>load</code></em>, <strong><code>fitting_save_func</code></strong>=<em><code>dump</code></em>, <strong><code>result_file_extension</code></strong>=<em><code>'.pk'</code></em>, <strong><code>result_load_func</code></strong>=<em><code>load</code></em>, <strong><code>result_save_func</code></strong>=<em><code>dump</code></em>, <strong>**<code>kwargs</code></strong>) :: <a href="/utils.html#DataIO"><code>DataIO</code></a></p>
</blockquote>

<pre><code>DataIO that uses pickle format for saving / loading the estimator.

It does not restrict the format for saving / loading the result of
the transformation.</code></pre>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="NoSaverIO">NoSaverIO<a class="anchor-link" href="#NoSaverIO"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="NoSaverIO" class="doc_header"><code>class</code> <code>NoSaverIO</code><a href="https://github.com/Jaume-JCI/ds-blocks/tree/main/dsblocks/core/utils.py#L576" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>NoSaverIO</code>(<strong><code>load</code></strong>=<em><code>False</code></em>, <strong><code>save</code></strong>=<em><code>False</code></em>, <strong><code>force_load</code></strong>=<em><code>False</code></em>, <strong><code>force_save</code></strong>=<em><code>False</code></em>, <strong>**<code>kwargs</code></strong>) :: <a href="/utils.html#DataIO"><code>DataIO</code></a></p>
</blockquote>

<pre><code>DataIO that does not load or save anything.</code></pre>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Factory">Factory<a class="anchor-link" href="#Factory"> </a></h2>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="data_io_factory" class="doc_header"><code>data_io_factory</code><a href="https://github.com/Jaume-JCI/ds-blocks/tree/main/dsblocks/core/utils.py#L589" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>data_io_factory</code>(<strong><code>data_io</code></strong>, <strong><code>component</code></strong>=<em><code>None</code></em>, <strong>**<code>kwargs</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Example-/-test">Example / test<a class="anchor-link" href="#Example-/-test"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="test_data_io_factory" class="doc_header"><code>test_data_io_factory</code><a href="https://github.com/Jaume-JCI/ds-blocks/tree/main/dsblocks/tests/core/test_utils.py#L106" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>test_data_io_factory</code>()</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1">#@pytest.mark.reference_fails</span>
<span class="k">def</span> <span class="nf">test_data_io_factory</span> <span class="p">():</span>
    <span class="n">data_io</span> <span class="o">=</span> <span class="n">data_io_factory</span> <span class="p">(</span><span class="s1">&#39;NoSaverIO&#39;</span><span class="p">,</span> <span class="n">force_save</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">save</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">assert</span> <span class="nb">type</span><span class="p">(</span><span class="n">data_io</span><span class="p">)</span> <span class="ow">is</span> <span class="n">NoSaverIO</span>
    <span class="k">assert</span> <span class="n">data_io</span><span class="o">.</span><span class="n">save_flag</span> <span class="ow">is</span> <span class="kc">False</span>

    <span class="n">data_io</span> <span class="o">=</span> <span class="n">data_io_factory</span> <span class="p">(</span><span class="s1">&#39;NoSaverIO&#39;</span><span class="p">,</span> <span class="n">force_save</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">save</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">assert</span> <span class="nb">type</span><span class="p">(</span><span class="n">data_io</span><span class="p">)</span> <span class="ow">is</span> <span class="n">NoSaverIO</span>
    <span class="k">assert</span> <span class="n">data_io</span><span class="o">.</span><span class="n">save_flag</span> <span class="ow">is</span> <span class="kc">True</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">tst</span><span class="o">.</span><span class="n">run</span> <span class="p">(</span><span class="n">test_data_io_factory</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="s1">&#39;dummy&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="ModelPlotter">ModelPlotter<a class="anchor-link" href="#ModelPlotter"> </a></h2>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="ModelPlotter" class="doc_header"><code>class</code> <code>ModelPlotter</code><a href="https://github.com/Jaume-JCI/ds-blocks/tree/main/dsblocks/core/utils.py#L605" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>ModelPlotter</code>(<strong><code>component</code></strong>=<em><code>None</code></em>, <strong><code>diagram_node_name</code></strong>=<em><code>None</code></em>, <strong><code>diagram_edge_name</code></strong>=<em><code>''</code></em>, <strong><code>diagram_module_path</code></strong>=<em><code>''</code></em>, <strong>**<code>kwargs</code></strong>)</p>
</blockquote>

<pre><code>Helper class that provides information about the component used for plotting the pipeline diagram.</code></pre>
<table>
<thead><tr>
<th></th>
<th>Type</th>
<th>Default</th>
<th>Details</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong><code>component</code></strong></td>
<td></td>
<td><code>None</code></td>
<td><em>No Content</em></td>
</tr>
<tr>
<td><strong><code>diagram_node_name</code></strong></td>
<td></td>
<td><code>None</code></td>
<td>diagram options</td>
</tr>
<tr>
<td><strong><code>diagram_edge_name</code></strong></td>
<td><code>str</code></td>
<td><code>""</code></td>
<td><em>No Content</em></td>
</tr>
<tr>
<td><strong><code>diagram_module_path</code></strong></td>
<td><code>str</code></td>
<td><code>""</code></td>
<td><em>No Content</em></td>
</tr>
<tr>
<td><strong><code>kwargs</code></strong></td>
<td></td>
<td></td>
<td><em>No Content</em></td>
</tr>
</tbody>
</table>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Profiler">Profiler<a class="anchor-link" href="#Profiler"> </a></h2>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="Profiler" class="doc_header"><code>class</code> <code>Profiler</code><a href="https://github.com/Jaume-JCI/ds-blocks/tree/main/dsblocks/core/utils.py#L649" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>Profiler</code>(<strong><code>component</code></strong>, <strong><code>do_profiling</code></strong>=<em><code>True</code></em>, <strong>**<code>kwargs</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Example-/-test">Example / test<a class="anchor-link" href="#Example-/-test"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="test_profiler" class="doc_header"><code>test_profiler</code><a href="https://github.com/Jaume-JCI/ds-blocks/tree/main/dsblocks/tests/core/test_utils.py#L117" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>test_profiler</code>()</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1">#@pytest.mark.reference_fails</span>
<span class="k">def</span> <span class="nf">test_profiler</span> <span class="p">():</span>
    <span class="k">class</span> <span class="nc">A</span><span class="p">():</span>
        <span class="k">def</span> <span class="fm">__init__</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;comp_a&#39;</span><span class="p">,</span> <span class="n">time</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">hierarchy_level</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">time</span> <span class="o">=</span> <span class="n">time</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">hierarchy_level</span> <span class="o">=</span> <span class="n">hierarchy_level</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">profiler</span> <span class="o">=</span> <span class="n">Profiler</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">def</span> <span class="nf">apply</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">split</span><span class="o">=</span><span class="s1">&#39;test&#39;</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;apply&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">profiler</span><span class="o">.</span><span class="n">start_timer</span> <span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">profiler</span><span class="o">.</span><span class="n">start_no_overhead_timer</span> <span class="p">()</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">profiler</span><span class="o">.</span><span class="n">finish_no_overhead_timer</span> <span class="p">(</span><span class="n">method</span><span class="p">,</span> <span class="n">split</span><span class="p">)</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="o">/</span><span class="mi">10</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">profiler</span><span class="o">.</span><span class="n">finish_timer</span> <span class="p">(</span><span class="n">method</span><span class="p">,</span> <span class="n">split</span><span class="p">)</span>
        <span class="k">def</span> <span class="nf">fit</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">split</span><span class="o">=</span><span class="s1">&#39;training&#39;</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;fit&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">profiler</span><span class="o">.</span><span class="n">start_timer</span> <span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">profiler</span><span class="o">.</span><span class="n">start_no_overhead_timer</span> <span class="p">()</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="o">*</span><span class="mi">2</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">profiler</span><span class="o">.</span><span class="n">finish_no_overhead_timer</span> <span class="p">(</span><span class="n">method</span><span class="p">,</span> <span class="n">split</span><span class="p">)</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="o">/</span><span class="mi">10</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">profiler</span><span class="o">.</span><span class="n">finish_timer</span> <span class="p">(</span><span class="n">method</span><span class="p">,</span> <span class="n">split</span><span class="p">)</span>

    <span class="n">a</span> <span class="o">=</span> <span class="n">A</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;comp_a&#39;</span><span class="p">,</span> <span class="n">time</span><span class="o">=</span><span class="mf">0.25</span><span class="p">)</span>
    <span class="n">a</span><span class="o">.</span><span class="n">fit</span> <span class="p">()</span>
    <span class="n">a</span><span class="o">.</span><span class="n">apply</span> <span class="p">()</span>
    <span class="n">display</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">profiler</span><span class="o">.</span><span class="n">times</span><span class="p">[</span><span class="s1">&#39;sum&#39;</span><span class="p">])</span>

    <span class="c1">#assert np.floor(a.profiler.times.sum.loc[&#39;fit&#39;,&#39;training&#39;]*10)==5 and np.floor(a.profiler.times.sum.loc[&#39;apply&#39;,&#39;test&#39;]*100)==28</span>
    <span class="k">assert</span> <span class="n">a</span><span class="o">.</span><span class="n">profiler</span><span class="o">.</span><span class="n">times</span><span class="o">.</span><span class="n">number</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;fit&#39;</span><span class="p">,</span><span class="s1">&#39;training&#39;</span><span class="p">]</span><span class="o">==</span><span class="mf">1.0</span> <span class="ow">and</span> <span class="n">a</span><span class="o">.</span><span class="n">profiler</span><span class="o">.</span><span class="n">times</span><span class="o">.</span><span class="n">number</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;apply&#39;</span><span class="p">,</span><span class="s1">&#39;test&#39;</span><span class="p">]</span><span class="o">==</span><span class="mf">1.0</span>

    <span class="n">a</span><span class="o">.</span><span class="n">apply</span> <span class="p">()</span>

    <span class="c1">#assert np.floor(a.profiler.times.sum.loc[&#39;fit&#39;,&#39;training&#39;]*10)==5 and np.floor(a.profiler.times.sum.loc[&#39;apply&#39;,&#39;test&#39;]*100)==55</span>
    <span class="k">assert</span> <span class="n">a</span><span class="o">.</span><span class="n">profiler</span><span class="o">.</span><span class="n">times</span><span class="o">.</span><span class="n">number</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;fit&#39;</span><span class="p">,</span><span class="s1">&#39;training&#39;</span><span class="p">]</span><span class="o">==</span><span class="mf">1.0</span> <span class="ow">and</span> <span class="n">a</span><span class="o">.</span><span class="n">profiler</span><span class="o">.</span><span class="n">times</span><span class="o">.</span><span class="n">number</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;apply&#39;</span><span class="p">,</span><span class="s1">&#39;test&#39;</span><span class="p">]</span><span class="o">==</span><span class="mf">2.0</span>
    <span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">profiler</span><span class="o">.</span><span class="n">times</span><span class="o">.</span><span class="n">number</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;fit&#39;</span><span class="p">,</span><span class="s1">&#39;test&#39;</span><span class="p">])</span> <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">profiler</span><span class="o">.</span><span class="n">times</span><span class="o">.</span><span class="n">number</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;apply&#39;</span><span class="p">,</span><span class="s1">&#39;training&#39;</span><span class="p">])</span>

    <span class="n">df</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">profiler</span><span class="o">.</span><span class="n">retrieve_times</span><span class="p">(</span><span class="n">is_leaf</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="c1">#assert float(np.floor(df.avg.loc[:,(&#39;test&#39;,&#39;apply&#39;)]*100))==27</span>

    <span class="c1">#assert float(np.floor(df.sum.loc[:,(&#39;test&#39;,&#39;apply&#39;)]*100))==55</span>

    <span class="k">assert</span> <span class="p">((</span><span class="n">df</span><span class="o">.</span><span class="n">max</span> <span class="o">&gt;=</span> <span class="n">df</span><span class="o">.</span><span class="n">min</span><span class="p">)</span> <span class="o">|</span> <span class="n">df</span><span class="o">.</span><span class="n">max</span><span class="o">.</span><span class="n">isna</span><span class="p">())</span><span class="o">.</span><span class="n">all</span><span class="p">()</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>

    <span class="k">assert</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">max</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,(</span><span class="s1">&#39;test&#39;</span><span class="p">,</span><span class="s1">&#39;apply&#39;</span><span class="p">)]</span> <span class="o">&gt;</span> <span class="n">df</span><span class="o">.</span><span class="n">min</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,(</span><span class="s1">&#39;test&#39;</span><span class="p">,</span><span class="s1">&#39;apply&#39;</span><span class="p">)])</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>

    <span class="n">b</span> <span class="o">=</span> <span class="n">A</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;comp_b&#39;</span><span class="p">,</span> <span class="n">time</span><span class="o">=</span><span class="mf">0.30</span><span class="p">)</span>
    <span class="n">b</span><span class="o">.</span><span class="n">apply</span> <span class="p">(</span><span class="n">split</span><span class="o">=</span><span class="s1">&#39;validation&#39;</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;fit_apply&#39;</span><span class="p">)</span>
    <span class="n">b</span><span class="o">.</span><span class="n">fit</span> <span class="p">()</span>

    <span class="n">df</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">profiler</span><span class="o">.</span><span class="n">retrieve_times</span><span class="p">(</span><span class="n">is_leaf</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">df2</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="n">profiler</span><span class="o">.</span><span class="n">retrieve_times</span><span class="p">(</span><span class="n">is_leaf</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">dfd</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="n">profiler</span><span class="o">.</span><span class="n">combine_times</span> <span class="p">([</span><span class="n">df</span><span class="p">,</span> <span class="n">df2</span><span class="p">])</span>
    <span class="n">display</span><span class="p">(</span><span class="n">dfd</span><span class="o">.</span><span class="n">avg</span><span class="p">)</span>

    <span class="k">assert</span> <span class="n">dfd</span><span class="o">.</span><span class="n">avg</span><span class="o">.</span><span class="n">shape</span><span class="o">==</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">8</span><span class="p">)</span>
    <span class="k">assert</span> <span class="p">(</span><span class="n">dfd</span><span class="o">.</span><span class="n">avg</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">get_level_values</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">==</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
    <span class="k">assert</span> <span class="p">(</span><span class="n">dfd</span><span class="o">.</span><span class="n">avg</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">get_level_values</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">==</span><span class="p">[</span><span class="s1">&#39;comp_a&#39;</span><span class="p">,</span> <span class="s1">&#39;comp_b&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">tst</span><span class="o">.</span><span class="n">run</span> <span class="p">(</span><span class="n">test_profiler</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="s1">&#39;dummy&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Comparator">Comparator<a class="anchor-link" href="#Comparator"> </a></h2>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="Comparator" class="doc_header"><code>class</code> <code>Comparator</code><a href="https://github.com/Jaume-JCI/ds-blocks/tree/main/dsblocks/core/utils.py#L758" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>Comparator</code>(<strong><code>component</code></strong>=<em><code>None</code></em>, <strong><code>data_io</code></strong>=<em><code>None</code></em>, <strong><code>name</code></strong>=<em><code>'comparator'</code></em>, <strong>**<code>kwargs</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Example-/-test">Example / test<a class="anchor-link" href="#Example-/-test"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="MyTransformComparator" class="doc_header"><code>class</code> <code>MyTransformComparator</code><a href="https://github.com/Jaume-JCI/ds-blocks/tree/main/dsblocks/tests/core/test_utils.py#L178" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>MyTransformComparator</code>(<strong><code>noise</code></strong>=<em><code>1e-10</code></em>, <strong><code>different</code></strong>=<em><code>False</code></em>, <strong>**<code>kwargs</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="test_comparator" class="doc_header"><code>test_comparator</code><a href="https://github.com/Jaume-JCI/ds-blocks/tree/main/dsblocks/tests/core/test_utils.py#L202" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>test_comparator</code>()</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1">#@pytest.mark.reference_fails</span>
<span class="k">class</span> <span class="nc">MyTransformComparator</span> <span class="p">():</span>
    <span class="k">def</span> <span class="fm">__init__</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">noise</span><span class="o">=</span><span class="mf">1e-10</span><span class="p">,</span> <span class="n">different</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">noise</span> <span class="o">=</span> <span class="n">noise</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">different</span> <span class="o">=</span> <span class="n">different</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;mine&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data_io</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">_generate_noise</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">noise</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">()</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">noise</span>
            <span class="k">if</span> <span class="n">noise</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">noise</span><span class="o">/</span><span class="mi">10</span><span class="p">:</span>
                <span class="k">break</span>
        <span class="k">return</span> <span class="n">noise</span>

    <span class="k">def</span> <span class="fm">__call__</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span> <span class="p">([[</span><span class="mf">1.0</span><span class="p">,</span><span class="mf">2.0</span><span class="p">],[</span><span class="mf">3.0</span><span class="p">,</span><span class="mf">4.0</span><span class="p">]],</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">,</span><span class="s1">&#39;b&#39;</span><span class="p">])</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_generate_noise</span> <span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">different</span><span class="p">:</span>
            <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">+</span><span class="mi">10</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mf">10.0</span><span class="p">,</span><span class="mf">20.0</span><span class="p">],[</span><span class="mf">30.0</span><span class="p">,</span><span class="mf">40.0</span><span class="p">]])</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_generate_noise</span> <span class="p">()</span>
        <span class="n">result</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">sequence</span><span class="o">=</span><span class="p">[[</span><span class="mf">1.0</span><span class="p">,</span><span class="mf">2.0</span><span class="p">],</span> <span class="n">x</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="nb">dict</span><span class="p">(</span><span class="n">vector</span><span class="o">=</span><span class="n">x</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">df</span><span class="p">)],</span>
                      <span class="n">array</span><span class="o">=</span><span class="n">x</span><span class="o">+</span><span class="mi">10</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">result</span>
        
<span class="k">def</span> <span class="nf">test_comparator</span> <span class="p">():</span>
    <span class="n">tr</span> <span class="o">=</span> <span class="n">MyTransformComparator</span> <span class="p">()</span>
    <span class="n">tr2</span><span class="o">=</span> <span class="n">MyTransformComparator</span> <span class="p">()</span>
    <span class="n">comp</span> <span class="o">=</span> <span class="n">Comparator</span> <span class="p">(</span><span class="n">tr</span><span class="p">)</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">comp</span><span class="o">.</span><span class="n">compare</span> <span class="p">(</span><span class="n">tr</span><span class="p">(),</span> <span class="n">tr2</span><span class="p">())</span>
    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span>

    <span class="n">tr2</span><span class="o">=</span> <span class="n">MyTransformComparator</span> <span class="p">(</span><span class="n">different</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">comp</span><span class="o">.</span><span class="n">compare</span> <span class="p">(</span><span class="n">tr</span><span class="p">(),</span> <span class="n">tr2</span><span class="p">())</span>
    <span class="nb">print</span> <span class="p">(</span><span class="n">result</span><span class="p">)</span>
    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span>

    <span class="n">tr2</span><span class="o">=</span> <span class="n">MyTransformComparator</span> <span class="p">(</span><span class="n">noise</span><span class="o">=</span><span class="mf">1e-10</span><span class="p">)</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">comp</span><span class="o">.</span><span class="n">compare</span> <span class="p">(</span><span class="n">tr</span><span class="p">(),</span> <span class="n">tr2</span><span class="p">())</span>
    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span>

    <span class="n">tr2</span><span class="o">=</span> <span class="n">MyTransformComparator</span> <span class="p">(</span><span class="n">noise</span><span class="o">=</span><span class="mf">1e-1</span><span class="p">)</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">comp</span><span class="o">.</span><span class="n">compare</span> <span class="p">(</span><span class="n">tr</span><span class="p">(),</span> <span class="n">tr2</span><span class="p">())</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">tst</span><span class="o">.</span><span class="n">run</span> <span class="p">(</span><span class="n">test_comparator</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="s1">&#39;dummy&#39;</span><span class="p">,</span> <span class="n">debug</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="test_comparator2" class="doc_header"><code>test_comparator2</code><a href="https://github.com/Jaume-JCI/ds-blocks/tree/main/dsblocks/tests/core/test_utils.py#L225" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>test_comparator2</code>()</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1">#@pytest.mark.reference_fails</span>
<span class="k">def</span> <span class="nf">test_comparator2</span> <span class="p">():</span>
    <span class="n">comp</span> <span class="o">=</span> <span class="n">Comparator</span> <span class="p">()</span>
    <span class="n">X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">])</span>
    <span class="n">Y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">])</span>
    <span class="n">comp</span><span class="o">.</span><span class="n">assert_equal</span> <span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">)</span>
    
    <span class="c1">#os.makedirs (&#39;test_comparator2&#39;)</span>
    <span class="c1">#joblib.dump (X, &#39;test_comparator2/res1.pk&#39;)</span>
    <span class="c1">#joblib.dump (Y, &#39;test_comparator2/res1.pk&#39;)</span>
    <span class="n">comp</span><span class="o">.</span><span class="n">assert_equal</span> <span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">data_io</span><span class="o">=</span><span class="s1">&#39;PickleIO&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;res&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">tst</span><span class="o">.</span><span class="n">run</span> <span class="p">(</span><span class="n">test_comparator2</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="s1">&#39;dummy&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="camel_to_snake">camel_to_snake<a class="anchor-link" href="#camel_to_snake"> </a></h2>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="camel_to_snake" class="doc_header"><code>camel_to_snake</code><a href="https://github.com/Jaume-JCI/ds-blocks/tree/main/dsblocks/core/utils.py#L872" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>camel_to_snake</code>(<strong><code>name</code></strong>)</p>
</blockquote>

<pre><code>Convert CamelCase to snake_case.

Used for converting classes names to file names where
the corresponding computation is stored:
    https://stackoverflow.com/questions/1175208/elegant-python-function-to-convert-camelcase-to-snake-case</code></pre>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="snake_to_camel" class="doc_header"><code>snake_to_camel</code><a href="https://github.com/Jaume-JCI/ds-blocks/tree/main/dsblocks/core/utils.py#L883" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>snake_to_camel</code>(<strong><code>name</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

</div>


