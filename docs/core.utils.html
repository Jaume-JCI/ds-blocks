---

title: Block utilities


keywords: fastai
sidebar: home_sidebar

summary: "Block utilities"
description: "Block utilities"
nb_path: "nbs/core.utils.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: nbs/core.utils.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Functions-for-loading-and-saving">Functions for loading and saving<a class="anchor-link" href="#Functions-for-loading-and-saving"> </a></h2>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="save_csv" class="doc_header"><code>save_csv</code><a href="https://github.com/Jaume-JCI/block_types/blob/main/block_types/core/utils.py#L34" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>save_csv</code>(<strong><code>df</code></strong>, <strong><code>path</code></strong>, <strong>**<code>kwargs</code></strong>)</p>
</blockquote>

<pre><code>Save DataFrame `df` to csv file indicated in `path`.

Convenience function that uses the same signature
as joblib.dump, which is needed by `DataIO`.</code></pre>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="save_parquet" class="doc_header"><code>save_parquet</code><a href="https://github.com/Jaume-JCI/block_types/blob/main/block_types/core/utils.py#L44" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>save_parquet</code>(<strong><code>df</code></strong>, <strong><code>path</code></strong>, <strong>**<code>kwargs</code></strong>)</p>
</blockquote>

<pre><code>Save DataFrame `df` to parquet file indicated in `path`.

Convenience function that uses the same signature
as joblib.dump, which is needed by `DataIO`.</code></pre>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="save_multi_index_parquet" class="doc_header"><code>save_multi_index_parquet</code><a href="https://github.com/Jaume-JCI/block_types/blob/main/block_types/core/utils.py#L54" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>save_multi_index_parquet</code>(<strong><code>df</code></strong>, <strong><code>path</code></strong>, <strong>**<code>kwargs</code></strong>)</p>
</blockquote>

<pre><code>Save DataFrame `df` to multi-index parquet file indicated in `path`.

Convenience function that uses the same signature
as joblib.dump, which is needed by `DataIO`.</code></pre>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="save_keras_model" class="doc_header"><code>save_keras_model</code><a href="https://github.com/Jaume-JCI/block_types/blob/main/block_types/core/utils.py#L65" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>save_keras_model</code>(<strong><code>model</code></strong>, <strong><code>path</code></strong>, <strong>**<code>kwargs</code></strong>)</p>
</blockquote>

<pre><code>Save keras `model` to file indicated in `path`.

Convenience function that uses the same signature
as joblib.dump, which is needed by `DataIO`.</code></pre>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="save_csv_gz" class="doc_header"><code>save_csv_gz</code><a href="https://github.com/Jaume-JCI/block_types/blob/main/block_types/core/utils.py#L75" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>save_csv_gz</code>(<strong><code>df</code></strong>, <strong><code>path</code></strong>, <strong>**<code>kwargs</code></strong>)</p>
</blockquote>

<pre><code>Save DataFrame `df` to csv.gz file indicated in `path`.

Convenience function that uses the same signature
as joblib.dump, which is needed by `DataIO`.</code></pre>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="read_csv" class="doc_header"><code>read_csv</code><a href="https://github.com/Jaume-JCI/block_types/blob/main/block_types/core/utils.py#L85" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>read_csv</code>(<strong><code>path</code></strong>, <strong>**<code>kwargs</code></strong>)</p>
</blockquote>

<pre><code>Read DataFrame from csv file indicated in `path`.

Convenience function that uses the same signature
as joblib.load, which is needed by `DataIO`.</code></pre>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="read_csv_gz" class="doc_header"><code>read_csv_gz</code><a href="https://github.com/Jaume-JCI/block_types/blob/main/block_types/core/utils.py#L95" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>read_csv_gz</code>(<strong><code>path</code></strong>, <strong>**<code>kwargs</code></strong>)</p>
</blockquote>

<pre><code>Read DataFrame from csv.gz file indicated in `path`.

Convenience function that uses the same signature
as joblib.load, which is needed by `DataIO`.</code></pre>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="load_keras_model" class="doc_header"><code>load_keras_model</code><a href="https://github.com/Jaume-JCI/block_types/blob/main/block_types/core/utils.py#L105" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>load_keras_model</code>(<strong><code>path</code></strong>, <strong>**<code>kwargs</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Mapping-type-to-loading-/-saving-function">Mapping type to loading / saving function<a class="anchor-link" href="#Mapping-type-to-loading-/-saving-function"> </a></h2>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="DataIO-class">DataIO class<a class="anchor-link" href="#DataIO-class"> </a></h2>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="DataIO" class="doc_header"><code>class</code> <code>DataIO</code><a href="https://github.com/Jaume-JCI/block_types/blob/main/block_types/core/utils.py#L134" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>DataIO</code>(<strong><code>component</code></strong>=<em><code>None</code></em>, <strong>**<code>kwargs</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Subclasses-of-DataIO">Subclasses of DataIO<a class="anchor-link" href="#Subclasses-of-DataIO"> </a></h2>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="PandasIO" class="doc_header"><code>class</code> <code>PandasIO</code><a href="https://github.com/Jaume-JCI/block_types/blob/main/block_types/core/utils.py#L442" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>PandasIO</code>(<strong><code>result_file_extension</code></strong>=<em><code>'.parquet'</code></em>, <strong><code>result_load_func</code></strong>=<em><code>read_parquet</code></em>, <strong><code>result_save_func</code></strong>=<em><code>save_multi_index_parquet</code></em>, <strong>**<code>kwargs</code></strong>) :: <a href="/core.utils.html#DataIO"><code>DataIO</code></a></p>
</blockquote>

<pre><code>Saves results in parquet format by default.

Results are supposed to be in Pandas DataFrame format.</code></pre>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="PickleIO" class="doc_header"><code>class</code> <code>PickleIO</code><a href="https://github.com/Jaume-JCI/block_types/blob/main/block_types/core/utils.py#L460" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>PickleIO</code>(<strong><code>fitting_file_extension</code></strong>=<em><code>'.pk'</code></em>, <strong><code>fitting_load_func</code></strong>=<em><code>load</code></em>, <strong><code>fitting_save_func</code></strong>=<em><code>dump</code></em>, <strong><code>result_file_extension</code></strong>=<em><code>'.pk'</code></em>, <strong><code>result_load_func</code></strong>=<em><code>load</code></em>, <strong><code>result_save_func</code></strong>=<em><code>dump</code></em>, <strong>**<code>kwargs</code></strong>) :: <a href="/core.utils.html#DataIO"><code>DataIO</code></a></p>
</blockquote>

<pre><code>DataIO that uses pickle format for saving / loading the estimator.

It does not restrict the format for saving / loading the result of
the transformation.</code></pre>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="NoSaverIO" class="doc_header"><code>class</code> <code>NoSaverIO</code><a href="https://github.com/Jaume-JCI/block_types/blob/main/block_types/core/utils.py#L490" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>NoSaverIO</code>(<strong><code>load</code></strong>=<em><code>False</code></em>, <strong><code>save</code></strong>=<em><code>False</code></em>, <strong>**<code>kwargs</code></strong>) :: <a href="/core.utils.html#DataIO"><code>DataIO</code></a></p>
</blockquote>

<pre><code>DataIO that does not load or save anything.</code></pre>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Helper-class-for-showing-model-diagram-and-summary">Helper class for showing model diagram and summary<a class="anchor-link" href="#Helper-class-for-showing-model-diagram-and-summary"> </a></h2>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="ModelPlotter" class="doc_header"><code>class</code> <code>ModelPlotter</code><a href="https://github.com/Jaume-JCI/block_types/blob/main/block_types/core/utils.py#L502" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>ModelPlotter</code>(<strong><code>component</code></strong>=<em><code>None</code></em>, <strong><code>diagram_node_name</code></strong>=<em><code>None</code></em>, <strong><code>diagram_edge_name</code></strong>=<em><code>''</code></em>, <strong><code>diagram_module_path</code></strong>=<em><code>''</code></em>, <strong>**<code>kwargs</code></strong>)</p>
</blockquote>

<pre><code>Helper class that provides information about the component used for plotting the pipeline diagram.</code></pre>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Profiler">Profiler<a class="anchor-link" href="#Profiler"> </a></h2>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="Profiler" class="doc_header"><code>class</code> <code>Profiler</code><a href="https://github.com/Jaume-JCI/block_types/blob/main/block_types/core/utils.py#L550" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>Profiler</code>(<strong><code>component</code></strong>, <strong><code>do_profiling</code></strong>=<em><code>True</code></em>, <strong>**<code>kwargs</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">class</span> <span class="nc">A</span><span class="p">():</span>
    <span class="k">def</span> <span class="fm">__init__</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;comp_a&#39;</span><span class="p">,</span> <span class="n">time</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">hierarchy_level</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">time</span> <span class="o">=</span> <span class="n">time</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hierarchy_level</span> <span class="o">=</span> <span class="n">hierarchy_level</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">profiler</span> <span class="o">=</span> <span class="n">Profiler</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">apply</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">split</span><span class="o">=</span><span class="s1">&#39;test&#39;</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;apply&#39;</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">profiler</span><span class="o">.</span><span class="n">start_timer</span> <span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">profiler</span><span class="o">.</span><span class="n">start_no_overhead_timer</span> <span class="p">()</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">profiler</span><span class="o">.</span><span class="n">finish_no_overhead_timer</span> <span class="p">(</span><span class="n">method</span><span class="p">,</span> <span class="n">split</span><span class="p">)</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="o">/</span><span class="mi">10</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">profiler</span><span class="o">.</span><span class="n">finish_timer</span> <span class="p">(</span><span class="n">method</span><span class="p">,</span> <span class="n">split</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">fit</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">split</span><span class="o">=</span><span class="s1">&#39;training&#39;</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;fit&#39;</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">profiler</span><span class="o">.</span><span class="n">start_timer</span> <span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">profiler</span><span class="o">.</span><span class="n">start_no_overhead_timer</span> <span class="p">()</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="o">*</span><span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">profiler</span><span class="o">.</span><span class="n">finish_no_overhead_timer</span> <span class="p">(</span><span class="n">method</span><span class="p">,</span> <span class="n">split</span><span class="p">)</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="o">/</span><span class="mi">10</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">profiler</span><span class="o">.</span><span class="n">finish_timer</span> <span class="p">(</span><span class="n">method</span><span class="p">,</span> <span class="n">split</span><span class="p">)</span>

<span class="n">a</span> <span class="o">=</span> <span class="n">A</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;comp_a&#39;</span><span class="p">,</span> <span class="n">time</span><span class="o">=</span><span class="mf">0.25</span><span class="p">)</span>
<span class="n">a</span><span class="o">.</span><span class="n">fit</span> <span class="p">()</span>
<span class="n">a</span><span class="o">.</span><span class="n">apply</span> <span class="p">()</span>
<span class="n">display</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">profiler</span><span class="o">.</span><span class="n">times</span><span class="p">[</span><span class="s1">&#39;sum&#39;</span><span class="p">])</span>

<span class="c1">#assert np.floor(a.profiler.times.sum.loc[&#39;fit&#39;,&#39;training&#39;]*10)==5 and np.floor(a.profiler.times.sum.loc[&#39;apply&#39;,&#39;test&#39;]*100)==28</span>
<span class="k">assert</span> <span class="n">a</span><span class="o">.</span><span class="n">profiler</span><span class="o">.</span><span class="n">times</span><span class="o">.</span><span class="n">number</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;fit&#39;</span><span class="p">,</span><span class="s1">&#39;training&#39;</span><span class="p">]</span><span class="o">==</span><span class="mf">1.0</span> <span class="ow">and</span> <span class="n">a</span><span class="o">.</span><span class="n">profiler</span><span class="o">.</span><span class="n">times</span><span class="o">.</span><span class="n">number</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;apply&#39;</span><span class="p">,</span><span class="s1">&#39;test&#39;</span><span class="p">]</span><span class="o">==</span><span class="mf">1.0</span>

<span class="n">a</span><span class="o">.</span><span class="n">apply</span> <span class="p">()</span>

<span class="c1">#assert np.floor(a.profiler.times.sum.loc[&#39;fit&#39;,&#39;training&#39;]*10)==5 and np.floor(a.profiler.times.sum.loc[&#39;apply&#39;,&#39;test&#39;]*100)==55</span>
<span class="k">assert</span> <span class="n">a</span><span class="o">.</span><span class="n">profiler</span><span class="o">.</span><span class="n">times</span><span class="o">.</span><span class="n">number</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;fit&#39;</span><span class="p">,</span><span class="s1">&#39;training&#39;</span><span class="p">]</span><span class="o">==</span><span class="mf">1.0</span> <span class="ow">and</span> <span class="n">a</span><span class="o">.</span><span class="n">profiler</span><span class="o">.</span><span class="n">times</span><span class="o">.</span><span class="n">number</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;apply&#39;</span><span class="p">,</span><span class="s1">&#39;test&#39;</span><span class="p">]</span><span class="o">==</span><span class="mf">2.0</span>
<span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">profiler</span><span class="o">.</span><span class="n">times</span><span class="o">.</span><span class="n">number</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;fit&#39;</span><span class="p">,</span><span class="s1">&#39;test&#39;</span><span class="p">])</span> <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">profiler</span><span class="o">.</span><span class="n">times</span><span class="o">.</span><span class="n">number</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;apply&#39;</span><span class="p">,</span><span class="s1">&#39;training&#39;</span><span class="p">])</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea ">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>training</th>
      <th>test</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>fit</th>
      <td>0.53014</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>apply</th>
      <td>NaN</td>
      <td>0.280298</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">profiler</span><span class="o">.</span><span class="n">retrieve_times</span><span class="p">(</span><span class="n">is_leaf</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1">#assert float(np.floor(df.avg.loc[:,(&#39;test&#39;,&#39;apply&#39;)]*100))==27</span>

<span class="c1">#assert float(np.floor(df.sum.loc[:,(&#39;test&#39;,&#39;apply&#39;)]*100))==55</span>

<span class="k">assert</span> <span class="p">((</span><span class="n">df</span><span class="o">.</span><span class="n">max</span> <span class="o">&gt;=</span> <span class="n">df</span><span class="o">.</span><span class="n">min</span><span class="p">)</span> <span class="o">|</span> <span class="n">df</span><span class="o">.</span><span class="n">max</span><span class="o">.</span><span class="n">isna</span><span class="p">())</span><span class="o">.</span><span class="n">all</span><span class="p">()</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>

<span class="k">assert</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">max</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,(</span><span class="s1">&#39;test&#39;</span><span class="p">,</span><span class="s1">&#39;apply&#39;</span><span class="p">)]</span> <span class="o">&gt;</span> <span class="n">df</span><span class="o">.</span><span class="n">min</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,(</span><span class="s1">&#39;test&#39;</span><span class="p">,</span><span class="s1">&#39;apply&#39;</span><span class="p">)])</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">b</span> <span class="o">=</span> <span class="n">A</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;comp_b&#39;</span><span class="p">,</span> <span class="n">time</span><span class="o">=</span><span class="mf">0.30</span><span class="p">)</span>
<span class="n">b</span><span class="o">.</span><span class="n">apply</span> <span class="p">(</span><span class="n">split</span><span class="o">=</span><span class="s1">&#39;validation&#39;</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;fit_apply&#39;</span><span class="p">)</span>
<span class="n">b</span><span class="o">.</span><span class="n">fit</span> <span class="p">()</span>

<span class="n">df</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">profiler</span><span class="o">.</span><span class="n">retrieve_times</span><span class="p">(</span><span class="n">is_leaf</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">df2</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="n">profiler</span><span class="o">.</span><span class="n">retrieve_times</span><span class="p">(</span><span class="n">is_leaf</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">dfd</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="n">profiler</span><span class="o">.</span><span class="n">combine_times</span> <span class="p">([</span><span class="n">df</span><span class="p">,</span> <span class="n">df2</span><span class="p">])</span>
<span class="n">display</span><span class="p">(</span><span class="n">dfd</span><span class="o">.</span><span class="n">avg</span><span class="p">)</span>

<span class="k">assert</span> <span class="n">dfd</span><span class="o">.</span><span class="n">avg</span><span class="o">.</span><span class="n">shape</span><span class="o">==</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">8</span><span class="p">)</span>
<span class="k">assert</span> <span class="p">(</span><span class="n">dfd</span><span class="o">.</span><span class="n">avg</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">get_level_values</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">==</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
<span class="k">assert</span> <span class="p">(</span><span class="n">dfd</span><span class="o">.</span><span class="n">avg</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">get_level_values</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">==</span><span class="p">[</span><span class="s1">&#39;comp_a&#39;</span><span class="p">,</span> <span class="s1">&#39;comp_b&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea ">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead tr th {
        text-align: left;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr>
      <th></th>
      <th></th>
      <th>leaf</th>
      <th colspan="2" halign="left">test</th>
      <th colspan="3" halign="left">training</th>
      <th colspan="2" halign="left">validation</th>
    </tr>
    <tr>
      <th></th>
      <th></th>
      <th></th>
      <th>apply</th>
      <th>fit</th>
      <th>apply</th>
      <th>fit</th>
      <th>fit_apply</th>
      <th>fit</th>
      <th>fit_apply</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th rowspan="2" valign="top">0</th>
      <th>comp_a</th>
      <td>True</td>
      <td>0.278665</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>0.530140</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>comp_b</th>
      <td>True</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>0.635775</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>0.334765</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Comparator">Comparator<a class="anchor-link" href="#Comparator"> </a></h2>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="Comparator" class="doc_header"><code>class</code> <code>Comparator</code><a href="https://github.com/Jaume-JCI/block_types/blob/main/block_types/core/utils.py#L632" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>Comparator</code>(<strong><code>component</code></strong>, <strong>**<code>kwargs</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">class</span> <span class="nc">MyTransform</span> <span class="p">():</span>
    <span class="k">def</span> <span class="fm">__init__</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">noise</span><span class="o">=</span><span class="mf">1e-10</span><span class="p">,</span> <span class="n">different</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">noise</span> <span class="o">=</span> <span class="n">noise</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">different</span> <span class="o">=</span> <span class="n">different</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;mine&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data_io</span> <span class="o">=</span> <span class="kc">None</span>
        
    <span class="k">def</span> <span class="nf">_generate_noise</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">noise</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">()</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">noise</span>
            <span class="k">if</span> <span class="n">noise</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">noise</span><span class="o">/</span><span class="mi">10</span><span class="p">:</span>
                <span class="k">break</span>
        <span class="k">return</span> <span class="n">noise</span>
        
    <span class="k">def</span> <span class="fm">__call__</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span> <span class="p">([[</span><span class="mf">1.0</span><span class="p">,</span><span class="mf">2.0</span><span class="p">],[</span><span class="mf">3.0</span><span class="p">,</span><span class="mf">4.0</span><span class="p">]],</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">,</span><span class="s1">&#39;b&#39;</span><span class="p">])</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_generate_noise</span> <span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">different</span><span class="p">:</span>
            <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">+</span><span class="mi">10</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mf">10.0</span><span class="p">,</span><span class="mf">20.0</span><span class="p">],[</span><span class="mf">30.0</span><span class="p">,</span><span class="mf">40.0</span><span class="p">]])</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_generate_noise</span> <span class="p">()</span>
        <span class="n">result</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">sequence</span><span class="o">=</span><span class="p">[[</span><span class="mf">1.0</span><span class="p">,</span><span class="mf">2.0</span><span class="p">],</span> <span class="n">x</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="nb">dict</span><span class="p">(</span><span class="n">vector</span><span class="o">=</span><span class="n">x</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">df</span><span class="p">)],</span>
                      <span class="n">array</span><span class="o">=</span><span class="n">x</span><span class="o">+</span><span class="mi">10</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">result</span>
    
<span class="n">tr</span> <span class="o">=</span> <span class="n">MyTransform</span> <span class="p">()</span>
<span class="n">tr2</span><span class="o">=</span> <span class="n">MyTransform</span> <span class="p">()</span>
<span class="n">comp</span> <span class="o">=</span> <span class="n">Comparator</span> <span class="p">(</span><span class="n">tr</span><span class="p">)</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">comp</span><span class="o">.</span><span class="n">compare</span> <span class="p">(</span><span class="n">tr</span><span class="p">(),</span> <span class="n">tr2</span><span class="p">())</span>
<span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">tr2</span><span class="o">=</span> <span class="n">MyTransform</span> <span class="p">(</span><span class="n">different</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">comp</span><span class="o">.</span><span class="n">compare</span> <span class="p">(</span><span class="n">tr</span><span class="p">(),</span> <span class="n">tr2</span><span class="p">())</span>
<span class="nb">print</span> <span class="p">(</span><span class="n">result</span><span class="p">)</span>
<span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">tr2</span><span class="o">=</span> <span class="n">MyTransform</span> <span class="p">(</span><span class="n">noise</span><span class="o">=</span><span class="mf">1e-10</span><span class="p">)</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">comp</span><span class="o">.</span><span class="n">compare</span> <span class="p">(</span><span class="n">tr</span><span class="p">(),</span> <span class="n">tr2</span><span class="p">())</span>
<span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">tr2</span><span class="o">=</span> <span class="n">MyTransform</span> <span class="p">(</span><span class="n">noise</span><span class="o">=</span><span class="mf">1e-1</span><span class="p">)</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">comp</span><span class="o">.</span><span class="n">compare</span> <span class="p">(</span><span class="n">tr</span><span class="p">(),</span> <span class="n">tr2</span><span class="p">())</span>
<span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
<span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="camel_to_snake">camel_to_snake<a class="anchor-link" href="#camel_to_snake"> </a></h2>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="camel_to_snake" class="doc_header"><code>camel_to_snake</code><a href="https://github.com/Jaume-JCI/block_types/blob/main/block_types/core/utils.py#L729" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>camel_to_snake</code>(<strong><code>name</code></strong>)</p>
</blockquote>

<pre><code>Convert CamelCase to snake_case.

Used for converting classes names to file names where
the corresponding computation is stored:
    https://stackoverflow.com/questions/1175208/elegant-python-function-to-convert-camelcase-to-snake-case</code></pre>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

</div>
 

