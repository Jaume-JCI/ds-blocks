---

title: Compose components


keywords: fastai
sidebar: home_sidebar

summary: "Classes and utilities for composed components"
description: "Classes and utilities for composed components"
nb_path: "nbs/core.compose.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: nbs/core.compose.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="MultiComponent">MultiComponent<a class="anchor-link" href="#MultiComponent"> </a></h2>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="MultiComponent" class="doc_header"><code>class</code> <code>MultiComponent</code><a href="https://github.com/Jaume-JCI/block_types/blob/main/block_types/core/compose.py#L24" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>MultiComponent</code>(<strong><code>separate_labels</code></strong>=<em><code>False</code></em>, <strong>**<code>kwargs</code></strong>) :: <a href="/core.block_types.html#SamplingComponent"><code>SamplingComponent</code></a></p>
</blockquote>

<pre><code>Component containing a list of components inside.

The list must contain at least one component.

See `Pipeline` class.</code></pre>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Usage-examples-/-tests">Usage examples / tests<a class="anchor-link" href="#Usage-examples-/-tests"> </a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="Loading-/-saving-all-results">Loading / saving all results<a class="anchor-link" href="#Loading-/-saving-all-results"> </a></h4>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">FunctionTransformer</span>
<span class="kn">from</span> <span class="nn">block_types.core.utils</span> <span class="kn">import</span> <span class="n">PickleIO</span>
<span class="kn">from</span> <span class="nn">block_types.utils.utils</span> <span class="kn">import</span> <span class="n">remove_previous_results</span>

<span class="n">path_results</span> <span class="o">=</span> <span class="s1">&#39;multi_component_loading_saving&#39;</span>
<span class="n">remove_previous_results</span> <span class="p">(</span><span class="n">path_results</span><span class="o">=</span><span class="n">path_results</span><span class="p">)</span>

<span class="c1"># 1. by setting components as attributes:</span>
<span class="k">class</span> <span class="nc">NewComposition</span><span class="p">(</span><span class="n">MultiComponent</span><span class="p">):</span>
    
    <span class="k">def</span> <span class="fm">__init__</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">data_io</span> <span class="o">=</span> <span class="n">PickleIO</span> <span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">data_io</span><span class="o">=</span><span class="n">data_io</span><span class="p">,</span>
                         <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">tr1</span> <span class="o">=</span> <span class="n">Component</span><span class="p">(</span><span class="n">FunctionTransformer</span> <span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">*</span><span class="mi">3</span><span class="p">),</span>
                             <span class="n">data_io</span><span class="o">=</span><span class="n">data_io</span><span class="p">,</span>
                             <span class="n">name</span><span class="o">=</span><span class="s1">&#39;tr1&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tr2</span> <span class="o">=</span> <span class="n">Component</span><span class="p">(</span><span class="n">FunctionTransformer</span> <span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">*</span><span class="mi">2</span><span class="p">),</span>
                             <span class="n">data_io</span><span class="o">=</span><span class="n">data_io</span><span class="p">,</span>
                             <span class="n">name</span><span class="o">=</span><span class="s1">&#39;tr2&#39;</span><span class="p">)</span>
        
    <span class="k">def</span> <span class="nf">_apply</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">tr1</span> <span class="p">(</span><span class="n">X</span><span class="p">)</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">tr2</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>

<span class="n">X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">])</span>
    
<span class="n">composition1</span> <span class="o">=</span> <span class="n">NewComposition</span> <span class="p">(</span><span class="n">path_results</span><span class="o">=</span><span class="n">path_results</span><span class="p">)</span>
<span class="n">result1</span> <span class="o">=</span> <span class="n">composition1</span> <span class="p">(</span><span class="n">X</span><span class="p">)</span>

<span class="n">composition2</span> <span class="o">=</span> <span class="n">NewComposition</span> <span class="p">(</span><span class="n">path_results</span><span class="o">=</span><span class="n">path_results</span><span class="p">)</span>
<span class="n">result2</span> <span class="o">=</span> <span class="n">composition2</span><span class="o">.</span><span class="n">data_io</span><span class="o">.</span><span class="n">load_result</span><span class="p">()</span>
<span class="k">assert</span> <span class="p">(</span><span class="n">result1</span><span class="o">==</span><span class="n">result2</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>

<span class="n">resut_tr1_2</span> <span class="o">=</span> <span class="n">composition2</span><span class="o">.</span><span class="n">tr1</span><span class="o">.</span><span class="n">data_io</span><span class="o">.</span><span class="n">load_result</span><span class="p">()</span>
<span class="n">resut_tr2_2</span> <span class="o">=</span> <span class="n">composition2</span><span class="o">.</span><span class="n">tr2</span><span class="o">.</span><span class="n">data_io</span><span class="o">.</span><span class="n">load_result</span><span class="p">()</span>
<span class="k">assert</span> <span class="p">(</span><span class="n">resut_tr1_2</span><span class="o">==</span><span class="n">composition1</span><span class="o">.</span><span class="n">tr1</span><span class="p">(</span><span class="n">X</span><span class="p">))</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
<span class="k">assert</span> <span class="p">(</span><span class="n">resut_tr2_2</span><span class="o">==</span><span class="n">composition1</span><span class="o">.</span><span class="n">tr2</span><span class="p">(</span><span class="n">X</span><span class="p">))</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>

<span class="k">assert</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">listdir</span> <span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">path_results</span><span class="si">}</span><span class="s1">/whole&#39;</span><span class="p">))</span><span class="o">==</span><span class="p">[</span><span class="s1">&#39;new_composition_result.pk&#39;</span><span class="p">,</span> <span class="s1">&#39;tr1_result.pk&#39;</span><span class="p">,</span> <span class="s1">&#39;tr2_result.pk&#39;</span><span class="p">]</span>

<span class="n">composition1</span><span class="o">.</span><span class="n">set_split</span> <span class="p">(</span><span class="s1">&#39;validation&#39;</span><span class="p">)</span>
<span class="n">result1b</span> <span class="o">=</span> <span class="n">composition1</span> <span class="p">(</span><span class="n">X</span><span class="p">)</span>
<span class="k">assert</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">listdir</span> <span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">path_results</span><span class="si">}</span><span class="s1">/validation&#39;</span><span class="p">))</span><span class="o">==</span><span class="p">[</span><span class="s1">&#39;new_composition_result.pk&#39;</span><span class="p">,</span> <span class="s1">&#39;tr1_result.pk&#39;</span><span class="p">,</span> <span class="s1">&#39;tr2_result.pk&#39;</span><span class="p">]</span>

<span class="n">remove_previous_results</span> <span class="p">(</span><span class="n">path_results</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">path_results</span><span class="si">}</span><span class="s1">/whole&#39;</span><span class="p">)</span>

<span class="n">resut_tr1_2</span> <span class="o">=</span> <span class="n">composition2</span><span class="o">.</span><span class="n">tr1</span><span class="o">.</span><span class="n">data_io</span><span class="o">.</span><span class="n">load_result</span><span class="p">(</span><span class="n">split</span><span class="o">=</span><span class="s1">&#39;validation&#39;</span><span class="p">)</span>
<span class="n">resut_tr2_2</span> <span class="o">=</span> <span class="n">composition2</span><span class="o">.</span><span class="n">tr2</span><span class="o">.</span><span class="n">data_io</span><span class="o">.</span><span class="n">load_result</span><span class="p">()</span>

<span class="k">assert</span> <span class="p">(</span><span class="n">resut_tr1_2</span><span class="o">==</span><span class="n">composition1</span><span class="o">.</span><span class="n">tr1</span><span class="p">(</span><span class="n">X</span><span class="p">))</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
<span class="k">assert</span> <span class="n">resut_tr2_2</span> <span class="ow">is</span> <span class="kc">None</span>

<span class="n">composition2</span><span class="o">.</span><span class="n">set_split</span><span class="p">(</span><span class="s1">&#39;validation&#39;</span><span class="p">)</span>
<span class="n">resut_tr1_2</span> <span class="o">=</span> <span class="n">composition2</span><span class="o">.</span><span class="n">tr1</span><span class="o">.</span><span class="n">data_io</span><span class="o">.</span><span class="n">load_result</span><span class="p">()</span>
<span class="n">resut_tr2_2</span> <span class="o">=</span> <span class="n">composition2</span><span class="o">.</span><span class="n">tr2</span><span class="o">.</span><span class="n">data_io</span><span class="o">.</span><span class="n">load_result</span><span class="p">()</span>

<span class="k">assert</span> <span class="p">(</span><span class="n">resut_tr1_2</span><span class="o">==</span><span class="n">composition1</span><span class="o">.</span><span class="n">tr1</span><span class="p">(</span><span class="n">X</span><span class="p">))</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
<span class="k">assert</span> <span class="p">(</span><span class="n">resut_tr2_2</span><span class="o">==</span><span class="n">composition1</span><span class="o">.</span><span class="n">tr2</span><span class="p">(</span><span class="n">X</span><span class="p">))</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>

<span class="n">remove_previous_results</span> <span class="p">(</span><span class="n">path_results</span><span class="o">=</span><span class="n">path_results</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="Getting-descendants">Getting descendants<a class="anchor-link" href="#Getting-descendants"> </a></h4>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">class</span> <span class="nc">Intermediate</span> <span class="p">(</span><span class="n">MultiComponent</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span> <span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">first</span> <span class="o">=</span> <span class="n">Component</span> <span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;first_component&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">second</span> <span class="o">=</span> <span class="n">Component</span> <span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;second_component&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">Higher</span> <span class="p">(</span><span class="n">MultiComponent</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span> <span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">first</span> <span class="o">=</span> <span class="n">Intermediate</span> <span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;first_intermediate&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">second</span> <span class="o">=</span> <span class="n">Intermediate</span> <span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;second_intermediate&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gather_descendants</span><span class="p">(</span><span class="n">nick_name</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="n">higher</span> <span class="o">=</span> <span class="n">Higher</span><span class="p">()</span>

<span class="k">assert</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">higher</span><span class="o">.</span><span class="n">obj</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span><span class="o">==</span><span class="p">[</span><span class="s1">&#39;first_component&#39;</span><span class="p">,</span> <span class="s1">&#39;first_intermediate&#39;</span><span class="p">,</span> <span class="s1">&#39;second_component&#39;</span><span class="p">,</span> <span class="s1">&#39;second_intermediate&#39;</span><span class="p">]</span>

<span class="c1"># check types</span>
<span class="n">types</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">type</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">higher</span><span class="o">.</span><span class="n">obj</span><span class="o">.</span><span class="n">items</span><span class="p">()))</span>
<span class="k">assert</span> <span class="nb">list</span><span class="p">(</span><span class="n">types</span><span class="p">)</span><span class="o">==</span><span class="p">[</span><span class="nb">list</span><span class="p">,</span> <span class="n">Intermediate</span><span class="p">,</span> <span class="nb">list</span><span class="p">,</span> <span class="n">Intermediate</span><span class="p">]</span>

<span class="n">sorted_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">higher</span><span class="o">.</span><span class="n">obj</span><span class="o">.</span><span class="n">items</span><span class="p">()))</span>
<span class="n">types</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="nb">type</span><span class="p">,</span> <span class="n">sorted_list</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
<span class="k">assert</span> <span class="nb">list</span><span class="p">(</span><span class="n">types</span><span class="p">)</span><span class="o">==</span><span class="p">[</span><span class="n">Component</span><span class="p">,</span><span class="n">Component</span><span class="p">]</span>

<span class="n">sorted_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">higher</span><span class="o">.</span><span class="n">obj</span><span class="o">.</span><span class="n">items</span><span class="p">()))</span>
<span class="n">types</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="nb">type</span><span class="p">,</span> <span class="n">sorted_list</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
<span class="k">assert</span> <span class="nb">list</span><span class="p">(</span><span class="n">types</span><span class="p">)</span><span class="o">==</span><span class="p">[</span><span class="n">Component</span><span class="p">,</span><span class="n">Component</span><span class="p">]</span>

<span class="n">sorted_keys</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">higher</span><span class="o">.</span><span class="n">cls</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>
<span class="k">assert</span> <span class="n">sorted_keys</span> <span class="o">==</span> <span class="p">[</span><span class="s1">&#39;Component&#39;</span><span class="p">,</span> <span class="s1">&#39;Intermediate&#39;</span><span class="p">]</span>

<span class="k">assert</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">type</span><span class="p">,</span><span class="n">higher</span><span class="o">.</span><span class="n">cls</span><span class="p">[</span><span class="n">sorted_keys</span><span class="p">[</span><span class="mi">0</span><span class="p">]]))</span><span class="o">==</span><span class="p">[</span><span class="n">Component</span><span class="p">,</span> <span class="n">Component</span><span class="p">,</span> <span class="n">Component</span><span class="p">,</span> <span class="n">Component</span><span class="p">]</span>

<span class="k">assert</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">type</span><span class="p">,</span><span class="n">higher</span><span class="o">.</span><span class="n">cls</span><span class="p">[</span><span class="n">sorted_keys</span><span class="p">[</span><span class="mi">1</span><span class="p">]]))</span><span class="o">==</span><span class="p">[</span><span class="n">Intermediate</span><span class="p">,</span> <span class="n">Intermediate</span><span class="p">]</span>


<span class="c1"># ***********************</span>
<span class="c1"># recursive behaviour: higher.first</span>
<span class="n">intermediate</span> <span class="o">=</span> <span class="n">higher</span><span class="o">.</span><span class="n">first</span>
<span class="k">assert</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">intermediate</span><span class="o">.</span><span class="n">obj</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span><span class="o">==</span><span class="p">[</span><span class="s1">&#39;first_component&#39;</span><span class="p">,</span> <span class="s1">&#39;second_component&#39;</span><span class="p">]</span>

<span class="c1"># check types</span>
<span class="n">types</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">type</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">intermediate</span><span class="o">.</span><span class="n">obj</span><span class="o">.</span><span class="n">items</span><span class="p">()))</span>
<span class="k">assert</span> <span class="nb">list</span><span class="p">(</span><span class="n">types</span><span class="p">)</span><span class="o">==</span><span class="p">[</span><span class="n">Component</span><span class="p">,</span> <span class="n">Component</span><span class="p">]</span>

<span class="n">sorted_keys</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">intermediate</span><span class="o">.</span><span class="n">cls</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>
<span class="k">assert</span> <span class="n">sorted_keys</span><span class="o">==</span><span class="p">[</span><span class="s1">&#39;Component&#39;</span><span class="p">]</span>

<span class="k">assert</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">type</span><span class="p">,</span><span class="n">intermediate</span><span class="o">.</span><span class="n">cls</span><span class="p">[</span><span class="n">sorted_keys</span><span class="p">[</span><span class="mi">0</span><span class="p">]]))</span><span class="o">==</span><span class="p">[</span><span class="n">Component</span><span class="p">,</span><span class="n">Component</span><span class="p">]</span>

<span class="c1"># **********************************************</span>
<span class="c1"># recursive behaviour: higher.second</span>
<span class="c1"># **********************************************</span>
<span class="n">intermediate</span> <span class="o">=</span> <span class="n">higher</span><span class="o">.</span><span class="n">second</span>
<span class="k">assert</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">intermediate</span><span class="o">.</span><span class="n">obj</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span><span class="o">==</span><span class="p">[</span><span class="s1">&#39;first_component&#39;</span><span class="p">,</span> <span class="s1">&#39;second_component&#39;</span><span class="p">]</span>

<span class="c1"># check types</span>
<span class="n">types</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">type</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">intermediate</span><span class="o">.</span><span class="n">obj</span><span class="o">.</span><span class="n">items</span><span class="p">()))</span>
<span class="k">assert</span> <span class="nb">list</span><span class="p">(</span><span class="n">types</span><span class="p">)</span><span class="o">==</span><span class="p">[</span><span class="n">Component</span><span class="p">,</span> <span class="n">Component</span><span class="p">]</span>

<span class="n">sorted_keys</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">intermediate</span><span class="o">.</span><span class="n">cls</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>
<span class="k">assert</span> <span class="n">sorted_keys</span><span class="o">==</span><span class="p">[</span><span class="s1">&#39;Component&#39;</span><span class="p">]</span>

<span class="k">assert</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">type</span><span class="p">,</span><span class="n">intermediate</span><span class="o">.</span><span class="n">cls</span><span class="p">[</span><span class="n">sorted_keys</span><span class="p">[</span><span class="mi">0</span><span class="p">]]))</span><span class="o">==</span><span class="p">[</span><span class="n">Component</span><span class="p">,</span><span class="n">Component</span><span class="p">]</span>

<span class="k">assert</span> <span class="n">higher</span><span class="o">.</span><span class="n">hierarchy_level</span><span class="o">==</span><span class="mi">0</span> <span class="ow">and</span> <span class="n">higher</span><span class="o">.</span><span class="n">obj</span><span class="o">.</span><span class="n">second_intermediate</span><span class="o">.</span><span class="n">hierarchy_level</span><span class="o">==</span><span class="mi">1</span> <span class="ow">and</span> <span class="n">higher</span><span class="o">.</span><span class="n">obj</span><span class="o">.</span><span class="n">second_component</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">hierarchy_level</span><span class="o">==</span><span class="mi">2</span>

<span class="c1"># **********************************************</span>
<span class="c1"># full hierarchical paths</span>
<span class="c1"># **********************************************</span>
<span class="k">assert</span> <span class="nb">list</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">higher</span><span class="o">.</span><span class="n">full_cls</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span><span class="o">==</span><span class="p">[</span><span class="s1">&#39;Component&#39;</span><span class="p">,</span> <span class="s1">&#39;Intermediate&#39;</span><span class="p">]</span>
<span class="k">assert</span> <span class="n">higher</span><span class="o">.</span><span class="n">full_cls</span><span class="p">[</span><span class="s1">&#39;Intermediate&#39;</span><span class="p">]</span><span class="o">==</span><span class="p">[</span><span class="s1">&#39;higher.first_intermediate&#39;</span><span class="p">,</span> <span class="s1">&#39;higher.second_intermediate&#39;</span><span class="p">]</span>
<span class="k">assert</span> <span class="n">higher</span><span class="o">.</span><span class="n">full_cls</span><span class="p">[</span><span class="s1">&#39;Component&#39;</span><span class="p">]</span><span class="o">==</span><span class="p">[</span><span class="s1">&#39;higher.first_intermediate.first_component&#39;</span><span class="p">,</span>
  <span class="s1">&#39;higher.first_intermediate.second_component&#39;</span><span class="p">,</span>
  <span class="s1">&#39;higher.second_intermediate.first_component&#39;</span><span class="p">,</span>
  <span class="s1">&#39;higher.second_intermediate.second_component&#39;</span><span class="p">]</span>

<span class="k">assert</span> <span class="n">higher</span><span class="o">.</span><span class="n">first</span><span class="o">.</span><span class="n">full_cls</span><span class="p">[</span><span class="s1">&#39;Component&#39;</span><span class="p">]</span><span class="o">==</span><span class="p">[</span><span class="s1">&#39;higher.first_intermediate.first_component&#39;</span><span class="p">,</span>
  <span class="s1">&#39;higher.first_intermediate.second_component&#39;</span><span class="p">]</span>

<span class="k">assert</span> <span class="nb">list</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">higher</span><span class="o">.</span><span class="n">full_obj</span><span class="p">))</span><span class="o">==</span><span class="p">[</span><span class="s1">&#39;first_component&#39;</span><span class="p">,</span> <span class="s1">&#39;first_intermediate&#39;</span><span class="p">,</span> <span class="s1">&#39;second_component&#39;</span><span class="p">,</span> <span class="s1">&#39;second_intermediate&#39;</span><span class="p">]</span>

<span class="k">assert</span> <span class="n">higher</span><span class="o">.</span><span class="n">full_obj</span><span class="p">[</span><span class="s1">&#39;first_intermediate&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;higher.first_intermediate&#39;</span>

<span class="k">assert</span> <span class="n">higher</span><span class="o">.</span><span class="n">full_obj</span><span class="p">[</span><span class="s1">&#39;first_component&#39;</span><span class="p">]</span><span class="o">==</span><span class="p">[</span><span class="s1">&#39;higher.first_intermediate.first_component&#39;</span><span class="p">,</span>
  <span class="s1">&#39;higher.second_intermediate.first_component&#39;</span><span class="p">]</span>

<span class="k">assert</span> <span class="n">higher</span><span class="o">.</span><span class="n">full_obj</span><span class="p">[</span><span class="s1">&#39;second_component&#39;</span><span class="p">]</span><span class="o">==</span><span class="p">[</span><span class="s1">&#39;higher.first_intermediate.second_component&#39;</span><span class="p">,</span>
  <span class="s1">&#39;higher.second_intermediate.second_component&#39;</span><span class="p">]</span>

<span class="k">assert</span> <span class="n">higher</span><span class="o">.</span><span class="n">full_obj</span><span class="p">[</span><span class="s1">&#39;second_intermediate&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;higher.second_intermediate&#39;</span>

<span class="k">assert</span> <span class="nb">list</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">higher</span><span class="o">.</span><span class="n">second</span><span class="o">.</span><span class="n">full_obj</span><span class="p">))</span><span class="o">==</span><span class="p">[</span><span class="s1">&#39;first_component&#39;</span><span class="p">,</span> <span class="s1">&#39;second_component&#39;</span><span class="p">]</span>

<span class="k">assert</span> <span class="n">higher</span><span class="o">.</span><span class="n">second</span><span class="o">.</span><span class="n">full_obj</span><span class="p">[</span><span class="s1">&#39;first_component&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;higher.second_intermediate.first_component&#39;</span>

<span class="k">assert</span> <span class="n">higher</span><span class="o">.</span><span class="n">second</span><span class="o">.</span><span class="n">full_obj</span><span class="p">[</span><span class="s1">&#39;second_component&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;higher.second_intermediate.second_component&#39;</span>

<span class="k">assert</span> <span class="n">higher</span><span class="o">.</span><span class="n">hierarchy_path</span><span class="o">==</span><span class="s1">&#39;higher&#39;</span>

<span class="k">assert</span> <span class="n">higher</span><span class="o">.</span><span class="n">first</span><span class="o">.</span><span class="n">hierarchy_path</span><span class="o">==</span><span class="s1">&#39;higher.first_intermediate&#39;</span>

<span class="c1"># with nick_names</span>
<span class="n">higher</span><span class="o">.</span><span class="n">clear_descendants</span><span class="p">()</span>
<span class="n">higher</span><span class="o">.</span><span class="n">gather_descendants</span><span class="p">(</span><span class="n">nick_name</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="k">assert</span> <span class="n">higher</span><span class="o">.</span><span class="n">full_cls</span><span class="p">[</span><span class="s1">&#39;Component&#39;</span><span class="p">]</span><span class="o">==</span><span class="p">[</span><span class="s1">&#39;higher.first.first&#39;</span><span class="p">,</span>
 <span class="s1">&#39;higher.first.second&#39;</span><span class="p">,</span>
 <span class="s1">&#39;higher.second.first&#39;</span><span class="p">,</span>
 <span class="s1">&#39;higher.second.second&#39;</span><span class="p">]</span>

<span class="k">assert</span> <span class="n">higher</span><span class="o">.</span><span class="n">full_obj</span><span class="p">[</span><span class="s1">&#39;first_intermediate&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;higher.first&#39;</span>
<span class="k">assert</span> <span class="n">higher</span><span class="o">.</span><span class="n">full_obj</span><span class="p">[</span><span class="s1">&#39;first_component&#39;</span><span class="p">]</span><span class="o">==</span><span class="p">[</span><span class="s1">&#39;higher.first.first&#39;</span><span class="p">,</span> <span class="s1">&#39;higher.second.first&#39;</span><span class="p">]</span>
<span class="k">assert</span> <span class="n">higher</span><span class="o">.</span><span class="n">full_obj</span><span class="p">[</span><span class="s1">&#39;second_component&#39;</span><span class="p">]</span><span class="o">==</span><span class="p">[</span><span class="s1">&#39;higher.first.second&#39;</span><span class="p">,</span> <span class="s1">&#39;higher.second.second&#39;</span><span class="p">]</span>
<span class="k">assert</span> <span class="n">higher</span><span class="o">.</span><span class="n">full_obj</span><span class="p">[</span><span class="s1">&#39;second_intermediate&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;higher.second&#39;</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># second example</span>
<span class="c1"># **********************************************</span>
<span class="k">class</span> <span class="nc">Intermediate</span> <span class="p">(</span><span class="n">MultiComponent</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span> <span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">first</span> <span class="o">=</span> <span class="n">Component</span> <span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s1">_first_component&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">second</span> <span class="o">=</span> <span class="n">Component</span> <span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s1">_second_component&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">Higher</span> <span class="p">(</span><span class="n">MultiComponent</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span> <span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">first</span> <span class="o">=</span> <span class="n">Intermediate</span> <span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;first_intermediate&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">second</span> <span class="o">=</span> <span class="n">Intermediate</span> <span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;second_intermediate&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gather_descendants</span><span class="p">()</span>

<span class="n">higher</span> <span class="o">=</span> <span class="n">Higher</span><span class="p">()</span>

<span class="k">assert</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">higher</span><span class="o">.</span><span class="n">obj</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span><span class="o">==</span><span class="p">[</span><span class="s1">&#39;first_intermediate&#39;</span><span class="p">,</span> <span class="s1">&#39;first_intermediate_first_component&#39;</span><span class="p">,</span> <span class="s1">&#39;first_intermediate_second_component&#39;</span><span class="p">,</span> <span class="s1">&#39;second_intermediate&#39;</span><span class="p">,</span> <span class="s1">&#39;second_intermediate_first_component&#39;</span><span class="p">,</span> <span class="s1">&#39;second_intermediate_second_component&#39;</span><span class="p">]</span>

<span class="c1"># check types</span>
<span class="n">types</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">type</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">higher</span><span class="o">.</span><span class="n">obj</span><span class="o">.</span><span class="n">items</span><span class="p">()))</span>

<span class="k">assert</span> <span class="nb">list</span><span class="p">(</span><span class="n">types</span><span class="p">)</span><span class="o">==</span><span class="p">[</span><span class="n">Intermediate</span><span class="p">,</span> <span class="n">Component</span><span class="p">,</span> <span class="n">Component</span><span class="p">,</span> <span class="n">Intermediate</span><span class="p">,</span> <span class="n">Component</span><span class="p">,</span> <span class="n">Component</span><span class="p">]</span>

<span class="n">sorted_keys</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">higher</span><span class="o">.</span><span class="n">cls</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>
<span class="k">assert</span> <span class="n">sorted_keys</span> <span class="o">==</span> <span class="p">[</span><span class="s1">&#39;Component&#39;</span><span class="p">,</span> <span class="s1">&#39;Intermediate&#39;</span><span class="p">]</span>

<span class="k">assert</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">type</span><span class="p">,</span><span class="n">higher</span><span class="o">.</span><span class="n">cls</span><span class="p">[</span><span class="n">sorted_keys</span><span class="p">[</span><span class="mi">0</span><span class="p">]]))</span><span class="o">==</span><span class="p">[</span><span class="n">Component</span><span class="p">,</span> <span class="n">Component</span><span class="p">,</span> <span class="n">Component</span><span class="p">,</span> <span class="n">Component</span><span class="p">]</span>
<span class="k">assert</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">type</span><span class="p">,</span><span class="n">higher</span><span class="o">.</span><span class="n">cls</span><span class="p">[</span><span class="n">sorted_keys</span><span class="p">[</span><span class="mi">1</span><span class="p">]]))</span><span class="o">==</span><span class="p">[</span><span class="n">Intermediate</span><span class="p">,</span> <span class="n">Intermediate</span><span class="p">]</span>

<span class="c1"># ***********************</span>
<span class="c1"># recursive behaviour: higher.first</span>
<span class="n">intermediate</span> <span class="o">=</span> <span class="n">higher</span><span class="o">.</span><span class="n">first</span>
<span class="k">assert</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">intermediate</span><span class="o">.</span><span class="n">obj</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span><span class="o">==</span><span class="p">[</span><span class="s1">&#39;first_intermediate_first_component&#39;</span><span class="p">,</span> <span class="s1">&#39;first_intermediate_second_component&#39;</span><span class="p">]</span>

<span class="c1"># check types</span>
<span class="n">types</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">type</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">intermediate</span><span class="o">.</span><span class="n">obj</span><span class="o">.</span><span class="n">items</span><span class="p">()))</span>
<span class="k">assert</span> <span class="nb">list</span><span class="p">(</span><span class="n">types</span><span class="p">)</span><span class="o">==</span><span class="p">[</span><span class="n">Component</span><span class="p">,</span> <span class="n">Component</span><span class="p">]</span>

<span class="n">sorted_keys</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">intermediate</span><span class="o">.</span><span class="n">cls</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>
<span class="k">assert</span> <span class="n">sorted_keys</span><span class="o">==</span><span class="p">[</span><span class="s1">&#39;Component&#39;</span><span class="p">]</span>

<span class="k">assert</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">type</span><span class="p">,</span><span class="n">intermediate</span><span class="o">.</span><span class="n">cls</span><span class="p">[</span><span class="n">sorted_keys</span><span class="p">[</span><span class="mi">0</span><span class="p">]]))</span><span class="o">==</span><span class="p">[</span><span class="n">Component</span><span class="p">,</span><span class="n">Component</span><span class="p">]</span>

<span class="c1"># ***********************</span>
<span class="c1"># recursive behaviour: higher.second</span>
<span class="n">intermediate</span> <span class="o">=</span> <span class="n">higher</span><span class="o">.</span><span class="n">second</span>
<span class="k">assert</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">intermediate</span><span class="o">.</span><span class="n">obj</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span><span class="o">==</span><span class="p">[</span><span class="s1">&#39;second_intermediate_first_component&#39;</span><span class="p">,</span> <span class="s1">&#39;second_intermediate_second_component&#39;</span><span class="p">]</span>

<span class="c1"># check types</span>
<span class="n">types</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">type</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">intermediate</span><span class="o">.</span><span class="n">obj</span><span class="o">.</span><span class="n">items</span><span class="p">()))</span>
<span class="k">assert</span> <span class="nb">list</span><span class="p">(</span><span class="n">types</span><span class="p">)</span><span class="o">==</span><span class="p">[</span><span class="n">Component</span><span class="p">,</span> <span class="n">Component</span><span class="p">]</span>

<span class="n">sorted_keys</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">intermediate</span><span class="o">.</span><span class="n">cls</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>
<span class="k">assert</span> <span class="n">sorted_keys</span><span class="o">==</span><span class="p">[</span><span class="s1">&#39;Component&#39;</span><span class="p">]</span>

<span class="k">assert</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">type</span><span class="p">,</span><span class="n">intermediate</span><span class="o">.</span><span class="n">cls</span><span class="p">[</span><span class="n">sorted_keys</span><span class="p">[</span><span class="mi">0</span><span class="p">]]))</span><span class="o">==</span><span class="p">[</span><span class="n">Component</span><span class="p">,</span><span class="n">Component</span><span class="p">]</span>

<span class="k">assert</span> <span class="n">higher</span><span class="o">.</span><span class="n">hierarchy_level</span><span class="o">==</span><span class="mi">0</span> <span class="ow">and</span> <span class="n">higher</span><span class="o">.</span><span class="n">obj</span><span class="o">.</span><span class="n">second_intermediate</span><span class="o">.</span><span class="n">hierarchy_level</span><span class="o">==</span><span class="mi">1</span> <span class="ow">and</span> <span class="n">higher</span><span class="o">.</span><span class="n">obj</span><span class="o">.</span><span class="n">first_intermediate_second_component</span><span class="o">.</span><span class="n">hierarchy_level</span><span class="o">==</span><span class="mi">2</span>

<span class="c1"># **********************************************</span>
<span class="c1"># full hierarchical paths</span>
<span class="c1"># **********************************************</span>
<span class="k">assert</span> <span class="nb">list</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">higher</span><span class="o">.</span><span class="n">full_cls</span><span class="p">))</span><span class="o">==</span><span class="p">[</span><span class="s1">&#39;Component&#39;</span><span class="p">,</span> <span class="s1">&#39;Intermediate&#39;</span><span class="p">]</span>

<span class="k">assert</span> <span class="n">higher</span><span class="o">.</span><span class="n">full_cls</span><span class="p">[</span><span class="s1">&#39;Component&#39;</span><span class="p">]</span><span class="o">==</span><span class="p">[</span><span class="s1">&#39;higher.first_intermediate.first_intermediate_first_component&#39;</span><span class="p">,</span>
  <span class="s1">&#39;higher.first_intermediate.first_intermediate_second_component&#39;</span><span class="p">,</span>
  <span class="s1">&#39;higher.second_intermediate.second_intermediate_first_component&#39;</span><span class="p">,</span>
  <span class="s1">&#39;higher.second_intermediate.second_intermediate_second_component&#39;</span><span class="p">]</span>

<span class="k">assert</span> <span class="n">higher</span><span class="o">.</span><span class="n">full_cls</span><span class="p">[</span><span class="s1">&#39;Intermediate&#39;</span><span class="p">]</span><span class="o">==</span><span class="p">[</span><span class="s1">&#39;higher.first_intermediate&#39;</span><span class="p">,</span> <span class="s1">&#39;higher.second_intermediate&#39;</span><span class="p">]</span>

<span class="k">assert</span> <span class="nb">list</span><span class="p">(</span><span class="n">higher</span><span class="o">.</span><span class="n">first</span><span class="o">.</span><span class="n">full_cls</span><span class="p">)</span><span class="o">==</span><span class="p">[</span><span class="s1">&#39;Component&#39;</span><span class="p">]</span>

<span class="k">assert</span> <span class="n">higher</span><span class="o">.</span><span class="n">first</span><span class="o">.</span><span class="n">full_cls</span><span class="p">[</span><span class="s1">&#39;Component&#39;</span><span class="p">]</span><span class="o">==</span><span class="p">[</span><span class="s1">&#39;higher.first_intermediate.first_intermediate_first_component&#39;</span><span class="p">,</span>
  <span class="s1">&#39;higher.first_intermediate.first_intermediate_second_component&#39;</span><span class="p">]</span>

<span class="k">assert</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">higher</span><span class="o">.</span><span class="n">full_obj</span><span class="p">))</span><span class="o">==</span><span class="p">[</span><span class="s1">&#39;first_intermediate&#39;</span><span class="p">,</span>
 <span class="s1">&#39;first_intermediate_first_component&#39;</span><span class="p">,</span>
 <span class="s1">&#39;first_intermediate_second_component&#39;</span><span class="p">,</span>
 <span class="s1">&#39;second_intermediate&#39;</span><span class="p">,</span>
 <span class="s1">&#39;second_intermediate_first_component&#39;</span><span class="p">,</span>
 <span class="s1">&#39;second_intermediate_second_component&#39;</span><span class="p">]</span>

<span class="k">assert</span> <span class="n">higher</span><span class="o">.</span><span class="n">full_obj</span><span class="p">[</span><span class="s1">&#39;first_intermediate&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;higher.first_intermediate&#39;</span>

<span class="k">assert</span> <span class="n">higher</span><span class="o">.</span><span class="n">full_obj</span><span class="p">[</span><span class="s1">&#39;first_intermediate_first_component&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;higher.first_intermediate.first_intermediate_first_component&#39;</span>

<span class="k">assert</span> <span class="n">higher</span><span class="o">.</span><span class="n">full_obj</span><span class="p">[</span><span class="s1">&#39;first_intermediate_second_component&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;higher.first_intermediate.first_intermediate_second_component&#39;</span>

<span class="k">assert</span> <span class="n">higher</span><span class="o">.</span><span class="n">full_obj</span><span class="p">[</span><span class="s1">&#39;second_intermediate&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;higher.second_intermediate&#39;</span>

<span class="k">assert</span> <span class="n">higher</span><span class="o">.</span><span class="n">full_obj</span><span class="p">[</span><span class="s1">&#39;second_intermediate_first_component&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;higher.second_intermediate.second_intermediate_first_component&#39;</span>

<span class="k">assert</span> <span class="n">higher</span><span class="o">.</span><span class="n">full_obj</span><span class="p">[</span><span class="s1">&#39;second_intermediate_second_component&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;higher.second_intermediate.second_intermediate_second_component&#39;</span>

<span class="k">assert</span> <span class="nb">list</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">higher</span><span class="o">.</span><span class="n">second</span><span class="o">.</span><span class="n">full_obj</span><span class="p">))</span><span class="o">==</span><span class="p">[</span><span class="s1">&#39;second_intermediate_first_component&#39;</span><span class="p">,</span> <span class="s1">&#39;second_intermediate_second_component&#39;</span><span class="p">]</span>

<span class="k">assert</span> <span class="n">higher</span><span class="o">.</span><span class="n">second</span><span class="o">.</span><span class="n">full_obj</span><span class="p">[</span><span class="s1">&#39;second_intermediate_first_component&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;higher.second_intermediate.second_intermediate_first_component&#39;</span>

<span class="k">assert</span> <span class="n">higher</span><span class="o">.</span><span class="n">second</span><span class="o">.</span><span class="n">full_obj</span><span class="p">[</span><span class="s1">&#39;second_intermediate_second_component&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;higher.second_intermediate.second_intermediate_second_component&#39;</span>

<span class="k">assert</span> <span class="n">higher</span><span class="o">.</span><span class="n">hierarchy_path</span><span class="o">==</span><span class="s1">&#39;higher&#39;</span>

<span class="k">assert</span> <span class="n">higher</span><span class="o">.</span><span class="n">first</span><span class="o">.</span><span class="n">hierarchy_path</span><span class="o">==</span><span class="s1">&#39;higher.first_intermediate&#39;</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Pipeline">Pipeline<a class="anchor-link" href="#Pipeline"> </a></h2>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="Pipeline" class="doc_header"><code>class</code> <code>Pipeline</code><a href="https://github.com/Jaume-JCI/block_types/blob/main/block_types/core/compose.py#L294" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>Pipeline</code>(<strong>**<code>kwargs</code></strong>) :: <a href="/core.compose.html#MultiComponent"><code>MultiComponent</code></a></p>
</blockquote>

<pre><code>Pipeline composed of a list of components that run sequentially.

During training, the components of the list are trained one after the other,
where one component is fed the result of transforming the data with the list
of components located before in the pipeline.

The `Pipeline` class is a subclass of `SamplingComponent`, which itself is a
subclass of `Component`. This provides the functionality of `Component`
to any implemented pipeline, such as logging the messages, loading / saving the
results, and convert the data format so that it can work as part of other
pipelines with potentially other data formats.

Being a subclass of `SamplingComponent`, the `transform` method
receives an input data  `X` that contains both data and labels.

Furthermore, the Pipeline constructor sets `separate_labels=False` by default,
which means that the `fit` method also receives an input data `X` that contains
not only data but also labels. This is necessary because some of the components in
the pipeline might be of class `SamplingComponent`, and such components
need the input data `X` to contain labels when calling `transform` (and note that
this method is called when calling `fit` on a pipeline, since we do `fit_transform`
on all the components except for the last one)</code></pre>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Usage-examples-/-tests">Usage examples / tests<a class="anchor-link" href="#Usage-examples-/-tests"> </a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="Tests-for-fit_apply-method">Tests for <code>fit_apply</code> method<a class="anchor-link" href="#Tests-for-fit_apply-method"> </a></h4>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">StandardScaler</span>
<span class="kn">from</span> <span class="nn">sklearn.utils</span> <span class="kn">import</span> <span class="n">Bunch</span>
<span class="kn">from</span> <span class="nn">block_types.core.block_types</span> <span class="kn">import</span> <span class="n">PickleSaverComponent</span>
<span class="kn">from</span> <span class="nn">block_types.utils.utils</span> <span class="kn">import</span> <span class="n">remove_previous_results</span>

<span class="c1"># Transform1: custom Transform</span>
<span class="k">class</span> <span class="nc">Transform1</span> <span class="p">(</span><span class="n">Component</span><span class="p">):</span>
    
    <span class="k">def</span> <span class="fm">__init__</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span> <span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">estimator</span><span class="o">=</span> <span class="n">Bunch</span><span class="p">(</span><span class="nb">sum</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>
        
    <span class="k">def</span> <span class="nf">_fit</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">estimator</span><span class="o">.</span><span class="n">sum</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">_apply</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">x</span><span class="o">*</span><span class="mi">1000</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">estimator</span><span class="o">.</span><span class="n">sum</span>
    
<span class="k">class</span> <span class="nc">Transform2</span> <span class="p">(</span><span class="n">Component</span><span class="p">):</span>
    
    <span class="k">def</span> <span class="fm">__init__</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span> <span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">estimator</span><span class="o">=</span> <span class="n">Bunch</span><span class="p">(</span><span class="n">maxim</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>
        
    <span class="k">def</span> <span class="nf">_fit</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">estimator</span><span class="o">.</span><span class="n">maxim</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">_apply</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">x</span><span class="o">*</span><span class="mi">100</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">estimator</span><span class="o">.</span><span class="n">maxim</span>

<span class="k">class</span> <span class="nc">NewPipeline</span> <span class="p">(</span><span class="n">Pipeline</span><span class="p">):</span>
    
    <span class="k">def</span> <span class="fm">__init__</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span> <span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        
        <span class="c1"># custom transform</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tr1</span> <span class="o">=</span> <span class="n">Transform1</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> 
        
        <span class="c1"># slklearn transform</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tr2</span> <span class="o">=</span> <span class="n">Transform2</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> 

<span class="n">pipeline</span> <span class="o">=</span> <span class="n">NewPipeline</span><span class="p">()</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">])</span>
<span class="n">r1</span> <span class="o">=</span> <span class="n">pipeline</span><span class="o">.</span><span class="n">fit_apply</span> <span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>
<span class="nb">print</span> <span class="p">(</span><span class="n">r1</span><span class="p">)</span>

<span class="n">x1</span> <span class="o">=</span> <span class="n">x</span> <span class="o">*</span> <span class="mi">1000</span> <span class="o">+</span> <span class="nb">sum</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="n">x2</span> <span class="o">=</span> <span class="n">x1</span> <span class="o">*</span> <span class="mi">100</span> <span class="o">+</span> <span class="nb">max</span><span class="p">(</span><span class="n">x1</span><span class="p">)</span>
<span class="k">assert</span> <span class="p">(</span><span class="n">r1</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span><span class="o">==</span><span class="n">x2</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>[[306212]
 [406212]
 [506212]]
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">class</span> <span class="nc">NewMulti</span> <span class="p">(</span><span class="n">MultiComponent</span><span class="p">):</span>
    
    <span class="k">def</span> <span class="fm">__init__</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span> <span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        
        <span class="c1"># custom transform</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tr1</span> <span class="o">=</span> <span class="n">Transform1</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> 
        
        <span class="c1"># slklearn transform</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tr2</span> <span class="o">=</span> <span class="n">Transform2</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> 
        
    <span class="k">def</span> <span class="nf">_fit</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tr1</span><span class="o">.</span><span class="n">fit</span> <span class="p">(</span><span class="n">X</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tr2</span><span class="o">.</span><span class="n">fit</span> <span class="p">(</span><span class="n">X</span><span class="p">)</span>
        
    <span class="k">def</span> <span class="nf">_apply</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">X1</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">tr1</span><span class="o">.</span><span class="n">apply</span> <span class="p">(</span><span class="n">X</span><span class="p">)</span>
        <span class="n">X2</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">tr2</span><span class="o">.</span><span class="n">apply</span> <span class="p">(</span><span class="n">X</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">X1</span><span class="o">+</span><span class="n">X2</span>

<span class="n">new_multi</span> <span class="o">=</span> <span class="n">NewMulti</span><span class="p">()</span>
<span class="n">r2</span> <span class="o">=</span> <span class="n">new_multi</span><span class="o">.</span><span class="n">fit_apply</span> <span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="nb">print</span> <span class="p">(</span><span class="n">r2</span><span class="p">)</span>
<span class="n">x2b</span> <span class="o">=</span> <span class="mi">100</span> <span class="o">*</span> <span class="n">x</span> <span class="o">+</span> <span class="nb">max</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="k">assert</span> <span class="p">(</span><span class="n">r2</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span><span class="o">==</span><span class="p">(</span><span class="n">x1</span> <span class="o">+</span> <span class="n">x2b</span><span class="p">))</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>[3317 4417 5517]
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="Adding-new-components-to-pipeline">Adding new components to pipeline<a class="anchor-link" href="#Adding-new-components-to-pipeline"> </a></h4>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">FunctionTransformer</span>

<span class="c1"># 1. by setting components as attributes:</span>
<span class="k">class</span> <span class="nc">NewPipeline</span><span class="p">(</span><span class="n">Pipeline</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tr1</span> <span class="o">=</span> <span class="n">Component</span><span class="p">(</span><span class="n">FunctionTransformer</span> <span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tr2</span> <span class="o">=</span> <span class="n">Component</span><span class="p">(</span><span class="n">FunctionTransformer</span> <span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">*</span><span class="mi">2</span><span class="p">))</span>
<span class="n">pipeline</span> <span class="o">=</span> <span class="n">NewPipeline</span><span class="p">()</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">pipeline</span><span class="o">.</span><span class="n">transform</span> <span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<span class="nb">print</span> <span class="p">(</span><span class="n">result</span><span class="p">)</span>
<span class="k">assert</span> <span class="n">result</span> <span class="o">==</span> <span class="mi">8</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>8
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">class</span> <span class="nc">NewPipeline</span><span class="p">(</span><span class="n">Pipeline</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">tr1</span> <span class="o">=</span> <span class="n">Component</span><span class="p">(</span><span class="n">FunctionTransformer</span> <span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span>
        <span class="n">tr2</span> <span class="o">=</span> <span class="n">Component</span><span class="p">(</span><span class="n">FunctionTransformer</span> <span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">*</span><span class="mi">2</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_components</span> <span class="p">(</span><span class="n">tr1</span><span class="p">,</span> <span class="n">tr2</span><span class="p">)</span>
        
        <span class="c1"># the following transform is not added to the pipeline component list:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tr3</span> <span class="o">=</span> <span class="n">Component</span><span class="p">(</span><span class="n">FunctionTransformer</span> <span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span>
        
        <span class="c1"># The reason is that once set_components is called, the component list </span>
        <span class="c1"># is frozen and inmutable setting new components by attribute doesn&#39;t </span>
        <span class="c1"># result in adding them to the component list</span>
        
<span class="n">pipeline</span> <span class="o">=</span> <span class="n">NewPipeline</span><span class="p">()</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">pipeline</span><span class="o">.</span><span class="n">transform</span> <span class="p">(</span><span class="mi">3</span><span class="p">)</span>

<span class="k">assert</span> <span class="n">result</span> <span class="o">==</span> <span class="mi">8</span>
<span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">pipeline</span><span class="o">.</span><span class="n">components</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span>
<span class="nb">print</span> <span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">pipeline</span><span class="o">.</span><span class="n">components</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>8 2
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">class</span> <span class="nc">NewPipeline</span><span class="p">(</span><span class="n">Pipeline</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">tr1</span> <span class="o">=</span> <span class="n">Component</span><span class="p">(</span><span class="n">FunctionTransformer</span> <span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span>
        <span class="n">tr2</span> <span class="o">=</span> <span class="n">Component</span><span class="p">(</span><span class="n">FunctionTransformer</span> <span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">*</span><span class="mi">2</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_components</span> <span class="p">(</span><span class="n">tr1</span><span class="p">,</span> <span class="n">tr2</span><span class="p">)</span>
        
        <span class="n">tr3</span> <span class="o">=</span> <span class="n">Component</span><span class="p">(</span><span class="n">FunctionTransformer</span> <span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">+</span><span class="mi">2</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_component</span><span class="p">(</span><span class="n">tr3</span><span class="p">)</span>
        
<span class="n">pipeline</span> <span class="o">=</span> <span class="n">NewPipeline</span><span class="p">()</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">pipeline</span><span class="o">.</span><span class="n">transform</span> <span class="p">(</span><span class="mi">3</span><span class="p">)</span>

<span class="k">assert</span> <span class="n">result</span> <span class="o">==</span> <span class="mi">10</span>
<span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">pipeline</span><span class="o">.</span><span class="n">components</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span>
<span class="nb">print</span> <span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">pipeline</span><span class="o">.</span><span class="n">components</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>10 3
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="Tests-for-load_estimator-method">Tests for <code>load_estimator</code> method<a class="anchor-link" href="#Tests-for-load_estimator-method"> </a></h4>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">StandardScaler</span>
<span class="kn">from</span> <span class="nn">sklearn.utils</span> <span class="kn">import</span> <span class="n">Bunch</span>
<span class="kn">from</span> <span class="nn">block_types.core.block_types</span> <span class="kn">import</span> <span class="n">PickleSaverComponent</span>
<span class="kn">from</span> <span class="nn">block_types.utils.utils</span> <span class="kn">import</span> <span class="n">remove_previous_results</span>

<span class="c1"># Transform1: custom Transform</span>
<span class="k">class</span> <span class="nc">Transform1</span> <span class="p">(</span><span class="n">PickleSaverComponent</span><span class="p">):</span>
    
    <span class="k">def</span> <span class="fm">__init__</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span> <span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">estimator</span><span class="o">=</span> <span class="n">Bunch</span><span class="p">(</span><span class="n">inv_c</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>
        
    <span class="k">def</span> <span class="nf">_fit</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">estimator</span><span class="o">.</span><span class="n">inv_c</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">ravel</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
    
    <span class="k">def</span> <span class="nf">_apply</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">x</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">estimator</span><span class="o">.</span><span class="n">inv_c</span>

<span class="k">class</span> <span class="nc">NewPipeline</span> <span class="p">(</span><span class="n">Pipeline</span><span class="p">):</span>
    
    <span class="k">def</span> <span class="fm">__init__</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span> <span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        
        <span class="c1"># custom transform</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tr1</span> <span class="o">=</span> <span class="n">Transform1</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> 
        
        <span class="c1"># slklearn transform</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tr2</span> <span class="o">=</span> <span class="n">PickleSaverComponent</span><span class="p">(</span><span class="n">StandardScaler</span><span class="p">(),</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        
    <span class="k">def</span> <span class="nf">_fit</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tr1</span><span class="o">.</span><span class="n">fit</span> <span class="p">(</span><span class="n">X</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tr2</span><span class="o">.</span><span class="n">fit</span> <span class="p">(</span><span class="n">X</span><span class="p">)</span>

<span class="c1"># remove any previously stored </span>
<span class="n">path_results</span> <span class="o">=</span> <span class="s1">&#39;pipeline_loading_saving&#39;</span>
<span class="n">remove_previous_results</span> <span class="p">(</span><span class="n">path_results</span><span class="o">=</span><span class="n">path_results</span><span class="p">)</span>

<span class="n">pipeline</span> <span class="o">=</span> <span class="n">NewPipeline</span><span class="p">(</span><span class="n">path_results</span><span class="o">=</span><span class="n">path_results</span><span class="p">,</span> <span class="n">save_test_result</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">pipeline</span><span class="o">.</span><span class="n">fit</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">])</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>
<span class="n">result1</span> <span class="o">=</span> <span class="n">pipeline</span><span class="o">.</span><span class="n">transform</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">300</span><span class="p">,</span><span class="mi">400</span><span class="p">,</span><span class="mi">500</span><span class="p">])</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>
<span class="nb">print</span> <span class="p">(</span><span class="n">pipeline</span><span class="o">.</span><span class="n">tr2</span><span class="o">.</span><span class="n">estimator</span><span class="o">.</span><span class="n">mean_</span><span class="p">)</span>

<span class="k">del</span> <span class="n">pipeline</span> 
<span class="n">pipeline</span> <span class="o">=</span> <span class="n">NewPipeline</span><span class="p">(</span><span class="n">path_results</span><span class="o">=</span><span class="n">path_results</span><span class="p">,</span> <span class="n">save_test_result</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">pipeline</span><span class="o">.</span><span class="n">load_estimator</span> <span class="p">()</span>
<span class="nb">print</span> <span class="p">(</span><span class="n">pipeline</span><span class="o">.</span><span class="n">tr2</span><span class="o">.</span><span class="n">estimator</span><span class="o">.</span><span class="n">mean_</span><span class="p">)</span>
<span class="n">result2</span> <span class="o">=</span> <span class="n">pipeline</span><span class="o">.</span><span class="n">transform</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">300</span><span class="p">,</span><span class="mi">400</span><span class="p">,</span><span class="mi">500</span><span class="p">])</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>

<span class="n">np</span><span class="o">.</span><span class="n">testing</span><span class="o">.</span><span class="n">assert_array_equal</span> <span class="p">(</span><span class="n">result1</span><span class="p">,</span> <span class="n">result2</span><span class="p">)</span>

<span class="c1"># remove stored files resulting from running the current test</span>
<span class="n">remove_previous_results</span> <span class="p">(</span><span class="n">path_results</span><span class="o">=</span><span class="n">path_results</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>[4.]
[4.]
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="make_pipeline-function">make_pipeline function<a class="anchor-link" href="#make_pipeline-function"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="make_pipeline" class="doc_header"><code>make_pipeline</code><a href="https://github.com/Jaume-JCI/block_types/blob/main/block_types/core/compose.py#L361" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>make_pipeline</code>(<strong>*<code>components</code></strong>, <strong>**<code>kwargs</code></strong>)</p>
</blockquote>

<pre><code>Create `Pipeline` object of class `cls`, given `components` list.</code></pre>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">tr1</span> <span class="o">=</span> <span class="n">Component</span><span class="p">(</span><span class="n">FunctionTransformer</span> <span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span>
<span class="n">tr2</span> <span class="o">=</span> <span class="n">Component</span><span class="p">(</span><span class="n">FunctionTransformer</span> <span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">*</span><span class="mi">2</span><span class="p">))</span>
<span class="n">pipeline</span> <span class="o">=</span> <span class="n">make_pipeline</span> <span class="p">(</span><span class="n">tr1</span><span class="p">,</span> <span class="n">tr2</span><span class="p">)</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">pipeline</span><span class="o">.</span><span class="n">transform</span> <span class="p">(</span><span class="mi">3</span><span class="p">)</span>

<span class="nb">print</span> <span class="p">(</span><span class="n">result</span><span class="p">)</span>
<span class="k">assert</span> <span class="n">result</span> <span class="o">==</span> <span class="mi">8</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>8
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="pipeline_factory">pipeline_factory<a class="anchor-link" href="#pipeline_factory"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="pipeline_factory" class="doc_header"><code>pipeline_factory</code><a href="https://github.com/Jaume-JCI/block_types/blob/main/block_types/core/compose.py#L368" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>pipeline_factory</code>(<strong><code>pipeline_class</code></strong>, <strong>**<code>kwargs</code></strong>)</p>
</blockquote>

<pre><code>Creates a pipeline object given its class `pipeline_class`

Parameters
----------
pipeline_class : class or str
    Name of the pipeline class used for creating the object.
    This can be either of type string or class.</code></pre>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="PandasPipeline">PandasPipeline<a class="anchor-link" href="#PandasPipeline"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="PandasPipeline" class="doc_header"><code>class</code> <code>PandasPipeline</code><a href="https://github.com/Jaume-JCI/block_types/blob/main/block_types/core/compose.py#L387" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>PandasPipeline</code>(<strong><code>data_converter</code></strong>=<em><code>None</code></em>, <strong><code>data_io</code></strong>=<em><code>None</code></em>, <strong><code>separate_labels</code></strong>=<em><code>False</code></em>, <strong>**<code>kwargs</code></strong>) :: <a href="/core.compose.html#Pipeline"><code>Pipeline</code></a></p>
</blockquote>

<pre><code>Pipeline that saves results in parquet format, and preserves DataFrame format.

See `Pipeline` class for an explanation of using `separate_labels=False`</code></pre>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="ColumnTransformer">ColumnTransformer<a class="anchor-link" href="#ColumnTransformer"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="ColumnSelector">ColumnSelector<a class="anchor-link" href="#ColumnSelector"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="ColumnSelector" class="doc_header"><code>class</code> <code>ColumnSelector</code><a href="https://github.com/Jaume-JCI/block_types/blob/main/block_types/core/compose.py#L409" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>ColumnSelector</code>(<strong><code>columns</code></strong>=<em><code>[]</code></em>, <strong>**<code>kwargs</code></strong>) :: <a href="/core.block_types.html#Component"><code>Component</code></a></p>
</blockquote>

<pre><code>Base component class used in our Pipeline.</code></pre>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span> <span class="p">({</span><span class="s1">&#39;x1&#39;</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">)),</span>
                    <span class="s1">&#39;x2&#39;</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">10</span><span class="p">)),</span>
                    <span class="s1">&#39;x3&#39;</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="mi">20</span><span class="p">)),</span>
                    <span class="s1">&#39;x4&#39;</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">25</span><span class="p">,</span><span class="mi">30</span><span class="p">))</span>
                   <span class="p">})</span>
<span class="n">dfr</span> <span class="o">=</span> <span class="n">ColumnSelector</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;x2&#39;</span><span class="p">,</span><span class="s1">&#39;x4&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
<span class="k">assert</span> <span class="p">(</span><span class="n">dfr</span><span class="o">==</span><span class="n">df</span><span class="p">[[</span><span class="s1">&#39;x2&#39;</span><span class="p">,</span><span class="s1">&#39;x4&#39;</span><span class="p">]])</span><span class="o">.</span><span class="n">all</span><span class="p">()</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Concat">Concat<a class="anchor-link" href="#Concat"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="Concat" class="doc_header"><code>class</code> <code>Concat</code><a href="https://github.com/Jaume-JCI/block_types/blob/main/block_types/core/compose.py#L420" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>Concat</code>(<strong>**<code>kwargs</code></strong>) :: <a href="/core.block_types.html#Component"><code>Component</code></a></p>
</blockquote>

<pre><code>Base component class used in our Pipeline.</code></pre>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="ColumnTransformer">ColumnTransformer<a class="anchor-link" href="#ColumnTransformer"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="ColumnTransformer" class="doc_header"><code>class</code> <code>ColumnTransformer</code><a href="https://github.com/Jaume-JCI/block_types/blob/main/block_types/core/compose.py#L446" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>ColumnTransformer</code>(<strong>*<code>transformers</code></strong>, <strong>**<code>kwargs</code></strong>) :: <code>_BaseColumnTransformer</code></p>
</blockquote>

<pre><code>Component containing a list of components inside.

The list must contain at least one component.

See `Pipeline` class.</code></pre>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Identity">Identity<a class="anchor-link" href="#Identity"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="Identity" class="doc_header"><code>class</code> <code>Identity</code><a href="https://github.com/Jaume-JCI/block_types/blob/main/block_types/core/compose.py#L452" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>Identity</code>(<strong>**<code>kwargs</code></strong>) :: <a href="/core.block_types.html#Component"><code>Component</code></a></p>
</blockquote>

<pre><code>Base component class used in our Pipeline.</code></pre>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="make_column_transformer">make_column_transformer<a class="anchor-link" href="#make_column_transformer"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="make_column_transformer_pipelines" class="doc_header"><code>make_column_transformer_pipelines</code><a href="https://github.com/Jaume-JCI/block_types/blob/main/block_types/core/compose.py#L460" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>make_column_transformer_pipelines</code>(<strong>*<code>transformers</code></strong>, <strong>**<code>kwargs</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="make_column_transformer" class="doc_header"><code>make_column_transformer</code><a href="https://github.com/Jaume-JCI/block_types/blob/main/block_types/core/compose.py#L474" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>make_column_transformer</code>(<strong>*<code>transformers</code></strong>, <strong>**<code>kwargs</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Tests-/-usage-examples">Tests / usage examples<a class="anchor-link" href="#Tests-/-usage-examples"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">FunctionTransformer</span>

<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span> <span class="p">({</span><span class="s1">&#39;cont1&#39;</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">)),</span>
                    <span class="s1">&#39;cont2&#39;</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">10</span><span class="p">)),</span>
                    <span class="s1">&#39;cont3&#39;</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="mi">20</span><span class="p">)),</span>
                    <span class="s1">&#39;cont4&#39;</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">25</span><span class="p">,</span><span class="mi">30</span><span class="p">)),</span>
                    <span class="s1">&#39;cat_1&#39;</span><span class="p">:</span> <span class="nb">list</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">]),</span>
                    <span class="s1">&#39;cat_2&#39;</span><span class="p">:</span> <span class="nb">list</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>
                    <span class="p">})</span>

<span class="n">tr1</span> <span class="o">=</span> <span class="n">Component</span><span class="p">(</span><span class="n">FunctionTransformer</span> <span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;tr1&#39;</span><span class="p">)</span>
<span class="n">tr2</span> <span class="o">=</span> <span class="n">PandasComponent</span><span class="p">(</span><span class="n">FunctionTransformer</span> <span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">*</span><span class="mi">2</span><span class="p">),</span> <span class="n">transformed_columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;cont2_bis&#39;</span><span class="p">,</span><span class="s1">&#39;cat_1&#39;</span><span class="p">],</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;tr2&#39;</span><span class="p">)</span>

<span class="n">column_transformer</span> <span class="o">=</span> <span class="n">make_column_transformer</span> <span class="p">(</span>
    <span class="p">(</span><span class="n">tr1</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;cont2&#39;</span><span class="p">,</span> <span class="s1">&#39;cont4&#39;</span><span class="p">]),</span>
    <span class="p">(</span><span class="n">tr2</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;cont2&#39;</span><span class="p">,</span> <span class="s1">&#39;cat_1&#39;</span><span class="p">])</span>
<span class="p">)</span>
<span class="n">dfr</span> <span class="o">=</span> <span class="n">column_transformer</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>

<span class="c1"># display and test</span>
<span class="n">display</span><span class="p">(</span><span class="n">dfr</span><span class="p">)</span>
<span class="k">assert</span> <span class="p">(</span><span class="n">dfr</span><span class="p">[[</span><span class="s1">&#39;cont2&#39;</span><span class="p">,</span><span class="s1">&#39;cont4&#39;</span><span class="p">]]</span> <span class="o">==</span> <span class="n">tr1</span><span class="p">(</span><span class="n">df</span><span class="p">[[</span><span class="s1">&#39;cont2&#39;</span><span class="p">,</span><span class="s1">&#39;cont4&#39;</span><span class="p">]]))</span><span class="o">.</span><span class="n">all</span><span class="p">()</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
<span class="k">assert</span> <span class="p">(</span><span class="n">dfr</span><span class="p">[[</span><span class="s1">&#39;cont2_bis&#39;</span><span class="p">,</span><span class="s1">&#39;cat_1&#39;</span><span class="p">]]</span> <span class="o">==</span> <span class="n">tr2</span><span class="p">(</span><span class="n">df</span><span class="p">[[</span><span class="s1">&#39;cont2&#39;</span><span class="p">,</span><span class="s1">&#39;cat_1&#39;</span><span class="p">]]))</span><span class="o">.</span><span class="n">all</span><span class="p">()</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
<span class="k">assert</span> <span class="p">(</span><span class="n">dfr</span><span class="o">.</span><span class="n">columns</span> <span class="o">==</span> <span class="p">[</span><span class="s1">&#39;cont2&#39;</span><span class="p">,</span><span class="s1">&#39;cont4&#39;</span><span class="p">,</span> <span class="s1">&#39;cont2_bis&#39;</span><span class="p">,</span><span class="s1">&#39;cat_1&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea ">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>cont2</th>
      <th>cont4</th>
      <th>cont2_bis</th>
      <th>cat_1</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>6</td>
      <td>26</td>
      <td>10</td>
      <td>2</td>
    </tr>
    <tr>
      <th>1</th>
      <td>7</td>
      <td>27</td>
      <td>12</td>
      <td>4</td>
    </tr>
    <tr>
      <th>2</th>
      <td>8</td>
      <td>28</td>
      <td>14</td>
      <td>6</td>
    </tr>
    <tr>
      <th>3</th>
      <td>9</td>
      <td>29</td>
      <td>16</td>
      <td>4</td>
    </tr>
    <tr>
      <th>4</th>
      <td>10</td>
      <td>30</td>
      <td>18</td>
      <td>2</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">column_transformer</span> <span class="o">=</span> <span class="n">make_column_transformer</span> <span class="p">(</span>
    <span class="p">(</span><span class="n">tr1</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;cont1&#39;</span><span class="p">,</span> <span class="s1">&#39;cont4&#39;</span><span class="p">]),</span>
    <span class="p">(</span><span class="s1">&#39;passthrough&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;cont2&#39;</span><span class="p">,</span> <span class="s1">&#39;cat_1&#39;</span><span class="p">])</span>
<span class="p">)</span>
<span class="n">dfr</span> <span class="o">=</span> <span class="n">column_transformer</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>

<span class="c1"># display and test</span>
<span class="n">display</span><span class="p">(</span><span class="n">dfr</span><span class="p">)</span>
<span class="k">assert</span> <span class="p">(</span><span class="n">dfr</span><span class="p">[[</span><span class="s1">&#39;cont1&#39;</span><span class="p">,</span><span class="s1">&#39;cont4&#39;</span><span class="p">]]</span> <span class="o">==</span> <span class="n">tr1</span><span class="p">(</span><span class="n">df</span><span class="p">[[</span><span class="s1">&#39;cont1&#39;</span><span class="p">,</span><span class="s1">&#39;cont4&#39;</span><span class="p">]]))</span><span class="o">.</span><span class="n">all</span><span class="p">()</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
<span class="k">assert</span> <span class="p">(</span><span class="n">dfr</span><span class="p">[[</span><span class="s1">&#39;cont2&#39;</span><span class="p">,</span><span class="s1">&#39;cat_1&#39;</span><span class="p">]]</span> <span class="o">==</span> <span class="n">df</span><span class="p">[[</span><span class="s1">&#39;cont2&#39;</span><span class="p">,</span><span class="s1">&#39;cat_1&#39;</span><span class="p">]])</span><span class="o">.</span><span class="n">all</span><span class="p">()</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
<span class="k">assert</span> <span class="p">(</span><span class="n">dfr</span><span class="o">.</span><span class="n">columns</span> <span class="o">==</span> <span class="p">[</span><span class="s1">&#39;cont1&#39;</span><span class="p">,</span><span class="s1">&#39;cont4&#39;</span><span class="p">,</span> <span class="s1">&#39;cont2&#39;</span><span class="p">,</span><span class="s1">&#39;cat_1&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea ">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>cont1</th>
      <th>cont4</th>
      <th>cont2</th>
      <th>cat_1</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>26</td>
      <td>5</td>
      <td>1</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2</td>
      <td>27</td>
      <td>6</td>
      <td>2</td>
    </tr>
    <tr>
      <th>2</th>
      <td>3</td>
      <td>28</td>
      <td>7</td>
      <td>3</td>
    </tr>
    <tr>
      <th>3</th>
      <td>4</td>
      <td>29</td>
      <td>8</td>
      <td>2</td>
    </tr>
    <tr>
      <th>4</th>
      <td>5</td>
      <td>30</td>
      <td>9</td>
      <td>1</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">class</span> <span class="nc">SumTimes100</span> <span class="p">(</span><span class="n">Component</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">_fit</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sum</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_apply</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">):</span>
        
        <span class="n">dfr</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span> <span class="p">({</span><span class="s1">&#39;c1_times100&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">sum</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="mi">100</span> <span class="o">+</span> <span class="n">X</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
                             <span class="s1">&#39;c2_times100&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">sum</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="mi">100</span> <span class="o">+</span> <span class="n">X</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
                             <span class="s1">&#39;c2_times1000&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">sum</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="mi">1000</span> <span class="o">+</span> <span class="n">X</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">})</span>
        <span class="k">return</span> <span class="n">dfr</span>
        
<span class="n">tr1</span> <span class="o">=</span> <span class="n">SumTimes100</span> <span class="p">()</span>
<span class="n">tr2</span> <span class="o">=</span> <span class="n">PandasComponent</span><span class="p">(</span><span class="n">FunctionTransformer</span> <span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">*</span><span class="mi">2</span><span class="p">),</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;tr2&#39;</span><span class="p">)</span>

<span class="n">column_transformer</span> <span class="o">=</span> <span class="n">make_column_transformer</span> <span class="p">(</span>
    <span class="p">(</span><span class="n">tr1</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;cont2&#39;</span><span class="p">,</span> <span class="s1">&#39;cont4&#39;</span><span class="p">]),</span>
    <span class="p">(</span><span class="n">tr2</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;cont2&#39;</span><span class="p">,</span> <span class="s1">&#39;cat_1&#39;</span><span class="p">])</span>
<span class="p">)</span>
<span class="n">dfr</span> <span class="o">=</span> <span class="n">column_transformer</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>

<span class="c1"># display &amp; test</span>
<span class="n">display</span><span class="p">(</span><span class="n">dfr</span><span class="p">)</span>
<span class="k">assert</span> <span class="p">(</span><span class="n">dfr</span><span class="o">.</span><span class="n">columns</span> <span class="o">==</span> <span class="p">[</span><span class="s1">&#39;c1_times100&#39;</span><span class="p">,</span><span class="s1">&#39;c2_times100&#39;</span><span class="p">,</span> <span class="s1">&#39;c2_times1000&#39;</span><span class="p">,</span><span class="s1">&#39;cont2&#39;</span><span class="p">,</span> <span class="s1">&#39;cat_1&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
<span class="k">assert</span> <span class="p">(</span><span class="n">dfr</span><span class="p">[</span><span class="s1">&#39;c1_times100&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="nb">sum</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">cont2</span><span class="p">)</span><span class="o">*</span><span class="mi">100</span><span class="o">+</span><span class="n">df</span><span class="o">.</span><span class="n">cont2</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
<span class="k">assert</span> <span class="p">(</span><span class="n">dfr</span><span class="p">[</span><span class="s1">&#39;c2_times100&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="nb">sum</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">cont4</span><span class="p">)</span><span class="o">*</span><span class="mi">100</span><span class="o">+</span><span class="n">df</span><span class="o">.</span><span class="n">cont4</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
<span class="k">assert</span> <span class="p">(</span><span class="n">dfr</span><span class="p">[</span><span class="s1">&#39;c2_times1000&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="nb">sum</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">cont4</span><span class="p">)</span><span class="o">*</span><span class="mi">1000</span><span class="o">+</span><span class="n">df</span><span class="o">.</span><span class="n">cont4</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea ">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>c1_times100</th>
      <th>c2_times100</th>
      <th>c2_times1000</th>
      <th>cont2</th>
      <th>cat_1</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>3505</td>
      <td>13525</td>
      <td>135025</td>
      <td>10</td>
      <td>2</td>
    </tr>
    <tr>
      <th>1</th>
      <td>3506</td>
      <td>13526</td>
      <td>135026</td>
      <td>12</td>
      <td>4</td>
    </tr>
    <tr>
      <th>2</th>
      <td>3507</td>
      <td>13527</td>
      <td>135027</td>
      <td>14</td>
      <td>6</td>
    </tr>
    <tr>
      <th>3</th>
      <td>3508</td>
      <td>13528</td>
      <td>135028</td>
      <td>16</td>
      <td>4</td>
    </tr>
    <tr>
      <th>4</th>
      <td>3509</td>
      <td>13529</td>
      <td>135029</td>
      <td>18</td>
      <td>2</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="MultiSplitComponent">MultiSplitComponent<a class="anchor-link" href="#MultiSplitComponent"> </a></h2>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="MultiSplitComponent" class="doc_header"><code>class</code> <code>MultiSplitComponent</code><a href="https://github.com/Jaume-JCI/block_types/blob/main/block_types/core/compose.py#L496" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>MultiSplitComponent</code>(<strong><code>component</code></strong>=<em><code>None</code></em>, <strong><code>fit_to</code></strong>=<em><code>'training'</code></em>, <strong><code>fit_additional</code></strong>=<em><code>[]</code></em>, <strong><code>apply_to</code></strong>=<em><code>['training', 'validation', 'test']</code></em>, <strong><code>raise_error_if_split_doesnot_exist</code></strong>=<em><code>False</code></em>, <strong><code>raise_warning_if_split_doesnot_exist</code></strong>=<em><code>True</code></em>, <strong>**<code>kwargs</code></strong>) :: <a href="/core.compose.html#MultiComponent"><code>MultiComponent</code></a></p>
</blockquote>

<pre><code>Component containing a list of components inside.

The list must contain at least one component.

See `Pipeline` class.</code></pre>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Tests-/-usage-examples">Tests / usage examples<a class="anchor-link" href="#Tests-/-usage-examples"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">data</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">training</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">])</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span>
            <span class="n">validation</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">10</span><span class="p">,</span><span class="mi">20</span><span class="p">,</span><span class="mi">30</span><span class="p">])</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span>
            <span class="n">test</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">100</span><span class="p">,</span><span class="mi">200</span><span class="p">,</span><span class="mi">300</span><span class="p">])</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
            <span class="p">)</span>

<span class="k">class</span> <span class="nc">Transform1</span> <span class="p">(</span><span class="n">Component</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span> <span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">estimator</span><span class="o">=</span> <span class="n">Bunch</span><span class="p">(</span><span class="nb">sum</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>
        
    <span class="k">def</span> <span class="nf">_fit</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">estimator</span><span class="o">.</span><span class="n">sum</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">_apply</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">x</span><span class="o">*</span><span class="mi">1000</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">estimator</span><span class="o">.</span><span class="n">sum</span>
    
<span class="n">multi_transform1</span> <span class="o">=</span> <span class="n">MultiSplitComponent</span> <span class="p">(</span><span class="n">component</span> <span class="o">=</span> <span class="n">Transform1</span><span class="p">())</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">multi_transform1</span><span class="o">.</span><span class="n">fit_transform</span> <span class="p">(</span><span class="n">data</span><span class="p">)</span>

<span class="k">assert</span> <span class="nb">type</span><span class="p">(</span><span class="n">result</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">dict</span>
<span class="k">assert</span> <span class="n">result</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="o">==</span> <span class="n">data</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
<span class="k">for</span> <span class="n">split</span> <span class="ow">in</span> <span class="n">result</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
    <span class="k">assert</span> <span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="n">split</span><span class="p">]</span><span class="o">==</span><span class="nb">sum</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;training&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">ravel</span><span class="p">())</span><span class="o">+</span><span class="n">data</span><span class="p">[</span><span class="n">split</span><span class="p">]</span><span class="o">*</span><span class="mi">1000</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># we apply the transform to only test</span>
<span class="k">class</span> <span class="nc">Transform2</span> <span class="p">(</span><span class="n">Component</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span> <span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">estimator</span><span class="o">=</span> <span class="n">Bunch</span><span class="p">(</span><span class="n">maxim</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>
        
    <span class="k">def</span> <span class="nf">_fit</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">validation_data</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">test_data</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">estimator</span><span class="o">.</span><span class="n">maxim</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        
        <span class="nb">print</span> <span class="p">(</span><span class="sa">f</span><span class="s1">&#39;validation_data: </span><span class="si">{</span><span class="n">validation_data</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="nb">print</span> <span class="p">(</span><span class="sa">f</span><span class="s1">&#39;test_data: </span><span class="si">{</span><span class="n">test_data</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="nb">dict</span> <span class="p">(</span><span class="n">validation</span><span class="o">=</span><span class="n">validation_data</span><span class="p">,</span>
                          <span class="n">test</span><span class="o">=</span><span class="n">test_data</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">_apply</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">x</span><span class="o">*</span><span class="mi">100</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">estimator</span><span class="o">.</span><span class="n">maxim</span>
        
<span class="n">tr2</span> <span class="o">=</span> <span class="n">Transform2</span><span class="p">()</span>
<span class="n">multi_transform2</span> <span class="o">=</span> <span class="n">MultiSplitComponent</span> <span class="p">(</span><span class="n">component</span><span class="o">=</span><span class="n">tr2</span><span class="p">,</span>
                                        <span class="n">fit_additional</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;validation&#39;</span><span class="p">,</span> <span class="s1">&#39;test&#39;</span><span class="p">])</span>

<span class="c1"># we apply the transform to only test data</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">multi_transform2</span><span class="o">.</span><span class="n">fit_transform</span> <span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">apply_to</span><span class="o">=</span><span class="s1">&#39;test&#39;</span><span class="p">)</span>

<span class="k">assert</span> <span class="nb">type</span><span class="p">(</span><span class="n">result</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">dict</span>
<span class="k">assert</span> <span class="nb">list</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="o">==</span> <span class="p">[</span><span class="s1">&#39;test&#39;</span><span class="p">]</span>
<span class="k">for</span> <span class="n">split</span> <span class="ow">in</span> <span class="n">result</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
    <span class="k">assert</span> <span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="n">split</span><span class="p">]</span><span class="o">==</span><span class="nb">max</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;training&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">ravel</span><span class="p">())</span><span class="o">+</span><span class="n">data</span><span class="p">[</span><span class="n">split</span><span class="p">]</span><span class="o">*</span><span class="mi">100</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>

<span class="k">for</span> <span class="n">split</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;validation&#39;</span><span class="p">,</span> <span class="s1">&#39;test&#39;</span><span class="p">]:</span>
    <span class="k">assert</span> <span class="p">(</span><span class="n">tr2</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">split</span><span class="p">]</span> <span class="o">==</span> <span class="n">data</span><span class="p">[</span><span class="n">split</span><span class="p">])</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>validation_data: [[10]
 [20]
 [30]]
test_data: [[100]
 [200]
 [300]]
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">result</span> <span class="o">=</span> <span class="n">multi_transform1</span><span class="o">.</span><span class="n">fit_transform</span> <span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">multi_transform2</span><span class="o">.</span><span class="n">fit_transform</span> <span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">apply_to</span><span class="o">=</span><span class="s1">&#39;test&#39;</span><span class="p">)</span>

<span class="kn">import</span> <span class="nn">pytest</span> 

<span class="c1">#check that we have no error if split does not exist</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">multi_transform1</span><span class="o">.</span><span class="n">fit_transform</span> <span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">apply_to</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;training&#39;</span><span class="p">,</span> <span class="s1">&#39;validation&#39;</span><span class="p">])</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">multi_transform2</span><span class="o">.</span><span class="n">fit_transform</span> <span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">apply_to</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;test&#39;</span><span class="p">])</span>
<span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span>

<span class="c1">#check that we have an error if we set the flag `raise_error_if_split_doesnot_exist=True`</span>
<span class="n">multi_transform2</span><span class="o">.</span><span class="n">raise_error_if_split_doesnot_exist</span> <span class="o">=</span> <span class="kc">True</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">multi_transform1</span><span class="o">.</span><span class="n">fit_transform</span> <span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">apply_to</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;training&#39;</span><span class="p">,</span> <span class="s1">&#39;validation&#39;</span><span class="p">])</span>
<span class="k">with</span> <span class="n">pytest</span><span class="o">.</span><span class="n">raises</span> <span class="p">(</span><span class="ne">RuntimeError</span><span class="p">):</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">multi_transform2</span><span class="o">.</span><span class="n">fit_transform</span> <span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">apply_to</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;test&#39;</span><span class="p">])</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>validation_data: [[10006]
 [20006]
 [30006]]
test_data: [[100006]
 [200006]
 [300006]]
validation_data: [[10006]
 [20006]
 [30006]]
test_data: None
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>/anaconda/envs/block_types/lib/python3.7/site-packages/ipykernel_launcher.py:42: UserWarning: split test not found in X keys (dict_keys([&#39;training&#39;, &#39;validation&#39;]))
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">block_types.utils.utils</span> <span class="kn">import</span> <span class="n">remove_previous_results</span>
<span class="kn">from</span> <span class="nn">block_types.core.utils</span> <span class="kn">import</span> <span class="n">PickleIO</span>

<span class="n">path_results</span> <span class="o">=</span> <span class="s1">&#39;results_multi_split&#39;</span>

<span class="n">remove_previous_results</span> <span class="p">(</span><span class="n">path_results</span><span class="o">=</span><span class="n">path_results</span><span class="p">)</span>

<span class="n">tr</span> <span class="o">=</span> <span class="n">PickleSaverComponent</span> <span class="p">(</span><span class="n">FunctionTransformer</span> <span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">*</span><span class="mi">2</span><span class="p">),</span>
                <span class="n">name</span><span class="o">=</span><span class="s1">&#39;times2&#39;</span><span class="p">,</span>
                <span class="n">path_results</span><span class="o">=</span><span class="n">path_results</span><span class="p">)</span>

<span class="n">multi_transform</span> <span class="o">=</span> <span class="n">MultiSplitComponent</span> <span class="p">(</span><span class="n">component</span><span class="o">=</span><span class="n">tr</span><span class="p">,</span>
                                       <span class="n">apply_to</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;validation&#39;</span><span class="p">,</span> <span class="s1">&#39;test&#39;</span><span class="p">],</span>
                                       <span class="n">path_results</span> <span class="o">=</span> <span class="n">path_results</span><span class="p">,</span>
                                       <span class="n">data_io</span><span class="o">=</span><span class="n">PickleIO</span> <span class="p">(</span><span class="n">path_results</span> <span class="o">=</span> <span class="n">path_results</span><span class="p">))</span>

<span class="n">result</span> <span class="o">=</span> <span class="n">multi_transform</span> <span class="p">(</span><span class="n">data</span><span class="p">)</span>

<span class="n">multi_transform2</span> <span class="o">=</span> <span class="n">MultiSplitComponent</span> <span class="p">(</span><span class="n">data_io</span><span class="o">=</span><span class="n">PickleIO</span> <span class="p">(</span><span class="n">path_results</span> <span class="o">=</span> <span class="n">path_results</span><span class="p">))</span>

<span class="n">result2</span> <span class="o">=</span> <span class="n">multi_transform2</span><span class="o">.</span><span class="n">data_io</span><span class="o">.</span><span class="n">load_result</span> <span class="p">()</span>

<span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">result</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
    <span class="k">assert</span> <span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">==</span> <span class="n">result2</span><span class="p">[</span><span class="n">k</span><span class="p">])</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>

<span class="k">assert</span> <span class="n">result</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span><span class="o">==</span><span class="n">result2</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>

<span class="k">assert</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">path_results</span><span class="p">))</span><span class="o">==</span><span class="p">[</span><span class="s1">&#39;test&#39;</span><span class="p">,</span> <span class="s1">&#39;validation&#39;</span><span class="p">,</span> <span class="s1">&#39;whole&#39;</span><span class="p">]</span>

<span class="k">assert</span> <span class="p">(</span><span class="n">tr</span><span class="o">.</span><span class="n">data_io</span><span class="o">.</span><span class="n">load_result</span><span class="p">(</span><span class="n">split</span><span class="o">=</span><span class="s1">&#39;test&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="n">result</span><span class="p">[</span><span class="s1">&#39;test&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>

<span class="k">assert</span> <span class="p">(</span><span class="n">tr</span><span class="o">.</span><span class="n">data_io</span><span class="o">.</span><span class="n">load_result</span><span class="p">(</span><span class="n">split</span><span class="o">=</span><span class="s1">&#39;validation&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="n">result</span><span class="p">[</span><span class="s1">&#39;validation&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>

<span class="k">assert</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">path_results</span><span class="si">}</span><span class="s1">/validation&#39;</span><span class="p">)</span><span class="o">==</span><span class="p">[</span><span class="s1">&#39;times2_result.pk&#39;</span><span class="p">]</span>

<span class="k">assert</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">path_results</span><span class="si">}</span><span class="s1">/test&#39;</span><span class="p">)</span><span class="o">==</span><span class="p">[</span><span class="s1">&#39;times2_result.pk&#39;</span><span class="p">]</span>

<span class="k">assert</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">path_results</span><span class="si">}</span><span class="s1">/whole&#39;</span><span class="p">)</span><span class="o">==</span><span class="p">[</span><span class="s1">&#39;multi_split_component_result.pk&#39;</span><span class="p">]</span>

<span class="n">remove_previous_results</span> <span class="p">(</span><span class="n">path_results</span><span class="o">=</span><span class="n">path_results</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

</div>
 

