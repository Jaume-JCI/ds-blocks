---

title: Components


keywords: fastai
sidebar: home_sidebar

summary: "Base components for building DS pipelines."
description: "Base components for building DS pipelines."
nb_path: "nbs/core/components.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: nbs/core/components.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">pytest</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">joblib</span>
<span class="kn">from</span> <span class="nn">sklearn.utils</span> <span class="kn">import</span> <span class="n">Bunch</span>
<span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>

<span class="kn">import</span> <span class="nn">dsblocks.config.bt_defaults</span> <span class="k">as</span> <span class="nn">dflt</span>
<span class="kn">from</span> <span class="nn">dsblocks.utils.utils</span> <span class="kn">import</span> <span class="n">remove_previous_results</span><span class="p">,</span> <span class="n">check_last_part</span>
<span class="kn">from</span> <span class="nn">dsblocks.core.data_conversion</span> <span class="kn">import</span> <span class="n">DataConverter</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Component">Component<a class="anchor-link" href="#Component"> </a></h2>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="Component" class="doc_header"><code>class</code> <code>Component</code><a href="https://github.com/Jaume-JCI/ds-blocks/tree/main/dsblocks/core/components.py#L37" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>Component</code>(<strong><code>estimator</code></strong>=<em><code>None</code></em>, <strong><code>name</code></strong>:<code>Optional</code>[<code>str</code>]=<em><code>None</code></em>, <strong><code>class_name</code></strong>:<code>Optional</code>[<code>str</code>]=<em><code>None</code></em>, <strong><code>suffix</code></strong>:<code>Optional</code>[<code>str</code>]=<em><code>None</code></em>, <strong><code>group</code></strong>:<code>str</code>=<em><code>'group_0'</code></em>, <strong><code>root</code></strong>=<em><code>None</code></em>, <strong><code>overwrite_field</code></strong>:<code>bool</code>=<em><code>False</code></em>, <strong><code>error_if_present</code></strong>:<code>bool</code>=<em><code>False</code></em>, <strong><code>ignore</code></strong>:<code>set</code>=<em><code>set()</code></em>, <strong><code>but</code></strong>:<code>Union</code>[<code>str</code>, <code>list</code>]=<em><code>''</code></em>, <strong><code>data_converter</code></strong>:<code>Optional</code>[<a href="/data_conversion.html#DataConverter"><code>DataConverter</code></a>]=<em><code>None</code></em>, <strong><code>data_io</code></strong>:<code>Optional</code>[<a href="/utils.html#DataIO"><code>DataIO</code></a>]=<em><code>None</code></em>, <strong><code>model_plotter</code></strong>:<code>Optional</code>[<a href="/utils.html#ModelPlotter"><code>ModelPlotter</code></a>]=<em><code>None</code></em>, <strong><code>profiler</code></strong>:<code>Optional</code>[<a href="/utils.html#Profiler"><code>Profiler</code></a>]=<em><code>None</code></em>, <strong><code>comparator</code></strong>:<code>Optional</code>[<a href="/utils.html#Comparator"><code>Comparator</code></a>]=<em><code>None</code></em>, <strong><code>apply</code></strong>=<em><code>None</code></em>, <strong><code>direct_apply</code></strong>:<code>bool</code>=<em><code>False</code></em>, <strong><code>direct_fit</code></strong>:<code>bool</code>=<em><code>False</code></em>, <strong><code>direct_fit_apply</code></strong>:<code>bool</code>=<em><code>False</code></em>, <strong><code>error_if_apply</code></strong>:<code>bool</code>=<em><code>False</code></em>, <strong><code>error_if_fit</code></strong>:<code>bool</code>=<em><code>False</code></em>, <strong><code>error_if_fit_apply</code></strong>:<code>bool</code>=<em><code>False</code></em>, <strong><code>logger</code></strong>=<em><code>None</code></em>, <strong><code>verbose</code></strong>:<code>int</code>=<em><code>None</code></em>, <strong><code>name_logger</code></strong>:<code>str</code>=<em><code>'log'</code></em>, <strong><code>mode_logger</code></strong>:<code>str</code>=<em><code>'w'</code></em>, <strong>**<code>kwargs</code></strong>)</p>
</blockquote>

<pre><code>Base component class used in our Pipeline.</code></pre>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Configuring-component-with-global-and-specific-parameters">Configuring component with global and specific parameters<a class="anchor-link" href="#Configuring-component-with-global-and-specific-parameters"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="test_component_config" class="doc_header"><code>test_component_config</code><a href="https://github.com/Jaume-JCI/ds-blocks/tree/main/dsblocks/tests/core/test_components.py#L41" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>test_component_config</code>()</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1">#@pytest.mark.reference_fails</span>
<span class="k">def</span> <span class="nf">test_component_config</span> <span class="p">():</span>
    
    <span class="c1"># **********************************************************************</span>
    <span class="c1"># test obtain_config_params method</span>
    <span class="c1"># **********************************************************************</span>
    <span class="n">tr</span> <span class="o">=</span> <span class="n">Component</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;sky&#39;</span><span class="p">)</span>
    <span class="n">config</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">first</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                  <span class="n">second</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
                  <span class="n">third</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
                  <span class="n">sky</span><span class="o">=</span><span class="nb">dict</span> <span class="p">(</span><span class="n">second</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
                 <span class="p">)</span>
    <span class="n">config_r</span> <span class="o">=</span> <span class="n">tr</span><span class="o">.</span><span class="n">obtain_config_params</span> <span class="p">(</span><span class="o">**</span><span class="n">config</span><span class="p">)</span>
    <span class="n">logger</span> <span class="o">=</span> <span class="n">set_logger</span> <span class="p">(</span><span class="n">dflt</span><span class="o">.</span><span class="n">name_logger</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">dflt</span><span class="o">.</span><span class="n">verbose</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">config_r</span><span class="o">==</span><span class="p">{</span><span class="s1">&#39;first&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;second&#39;</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span> <span class="s1">&#39;third&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;sky&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;second&#39;</span><span class="p">:</span> <span class="mi">4</span><span class="p">},</span> <span class="s1">&#39;verbose&#39;</span><span class="p">:</span> <span class="n">dflt</span><span class="o">.</span><span class="n">verbose</span><span class="p">,</span> <span class="s1">&#39;logger&#39;</span><span class="p">:</span> <span class="n">logger</span><span class="p">}</span>
    <span class="k">assert</span> <span class="n">config</span> <span class="o">==</span> <span class="p">{</span><span class="s1">&#39;first&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;second&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;third&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;sky&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;second&#39;</span><span class="p">:</span> <span class="mi">4</span><span class="p">}}</span>

    <span class="c1"># **********************************************************************</span>
    <span class="c1"># test that component saves results when using global </span>
    <span class="c1"># parameter save=True</span>
    <span class="c1"># **********************************************************************</span>
    <span class="k">class</span> <span class="nc">MyTransform</span> <span class="p">(</span><span class="n">Component</span><span class="p">):</span>
        <span class="k">def</span> <span class="fm">__init__</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
            <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span> <span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">create_estimator</span> <span class="p">()</span>

        <span class="k">def</span> <span class="nf">_fit</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">estimator</span><span class="o">.</span><span class="n">mu</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
        <span class="k">def</span> <span class="nf">_transform</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">X</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">estimator</span><span class="o">.</span><span class="n">mu</span>

    <span class="n">path_results</span> <span class="o">=</span> <span class="s1">&#39;testing_configuration&#39;</span>
    <span class="n">tr</span> <span class="o">=</span> <span class="n">MyTransform</span> <span class="p">(</span><span class="n">path_results</span><span class="o">=</span><span class="n">path_results</span><span class="p">,</span>
                      <span class="n">save</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>

    <span class="n">X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">],[</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">]])</span>
    <span class="n">tr</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>

    <span class="kn">import</span> <span class="nn">os</span>
    <span class="n">l</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">path_results</span><span class="p">))</span>
    <span class="k">assert</span> <span class="n">l</span><span class="o">==</span><span class="p">[</span><span class="s1">&#39;models&#39;</span><span class="p">,</span><span class="s1">&#39;whole&#39;</span><span class="p">],</span> <span class="sa">f</span><span class="s1">&#39;found: </span><span class="si">{</span><span class="n">l</span><span class="si">}</span><span class="s1">&#39;</span>

    <span class="c1"># **********************************************************************</span>
    <span class="c1"># test that component does not save results when we </span>
    <span class="c1"># use component-specific parameter MyTransform = dict(save=False)</span>
    <span class="c1"># **********************************************************************</span>
    <span class="kn">from</span> <span class="nn">dsblocks.utils.utils</span> <span class="kn">import</span> <span class="n">remove_previous_results</span>
    <span class="n">remove_previous_results</span> <span class="p">(</span><span class="n">path_results</span><span class="p">)</span>

    <span class="n">tr</span> <span class="o">=</span> <span class="n">MyTransform</span> <span class="p">(</span><span class="n">data_io</span> <span class="o">=</span> <span class="n">SklearnIO</span><span class="p">(</span>
                                  <span class="n">path_results</span><span class="o">=</span><span class="s1">&#39;testing_configuration&#39;</span><span class="p">,</span>
                                  <span class="n">save</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
                                  <span class="n">MyTransform</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">save</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                                <span class="p">)</span>
                     <span class="p">)</span>
    <span class="n">tr</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
    <span class="kn">import</span> <span class="nn">pytest</span>
    <span class="k">with</span> <span class="n">pytest</span><span class="o">.</span><span class="n">raises</span><span class="p">(</span><span class="ne">FileNotFoundError</span><span class="p">):</span>
        <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">path_results</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">tst</span><span class="o">.</span><span class="n">run</span> <span class="p">(</span><span class="n">test_component_config</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="s1">&#39;dummy&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>running test_component_config
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Recursively-storing-attrs-across-class-hierarchy">Recursively storing attrs across class hierarchy<a class="anchor-link" href="#Recursively-storing-attrs-across-class-hierarchy"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="test_component_store_attrs" class="doc_header"><code>test_component_store_attrs</code><a href="https://github.com/Jaume-JCI/ds-blocks/tree/main/dsblocks/tests/core/test_components.py#L102" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>test_component_store_attrs</code>()</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1">#@pytest.mark.reference_fails</span>
<span class="k">def</span> <span class="nf">test_component_store_attrs</span> <span class="p">():</span>
    <span class="c1"># recursively storing __init__ attrs across hiearchy of classes</span>
    <span class="k">class</span> <span class="nc">Intermediate</span> <span class="p">(</span><span class="n">Component</span><span class="p">):</span>
        <span class="k">def</span> <span class="fm">__init__</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
            <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span> <span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">class</span> <span class="nc">Final</span> <span class="p">(</span><span class="n">Intermediate</span><span class="p">):</span>
        <span class="k">def</span> <span class="fm">__init__</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">z</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">h</span><span class="o">=</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">5</span><span class="p">],</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
            <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span> <span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="n">o</span> <span class="o">=</span> <span class="n">Final</span> <span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mi">9</span><span class="p">,</span> <span class="n">h</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">4</span><span class="p">])</span>
    <span class="k">assert</span> <span class="n">o</span><span class="o">.</span><span class="n">x</span><span class="o">==</span><span class="mi">9</span> <span class="ow">and</span> <span class="n">o</span><span class="o">.</span><span class="n">y</span><span class="o">==</span><span class="mi">4</span> <span class="ow">and</span> <span class="n">o</span><span class="o">.</span><span class="n">z</span><span class="o">==</span><span class="mi">6</span> <span class="ow">and</span> <span class="n">o</span><span class="o">.</span><span class="n">h</span><span class="o">==</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">4</span><span class="p">]</span>

    <span class="n">o</span> <span class="o">=</span> <span class="n">Final</span> <span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="mi">7</span><span class="p">,</span> <span class="n">z</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">h</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">4</span><span class="p">],</span> <span class="n">Final</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;h&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">9</span><span class="p">,</span><span class="mi">11</span><span class="p">,</span><span class="mi">10</span><span class="p">]})</span>
    <span class="k">assert</span> <span class="n">o</span><span class="o">.</span><span class="n">x</span><span class="o">==</span><span class="mi">3</span> <span class="ow">and</span> <span class="n">o</span><span class="o">.</span><span class="n">y</span><span class="o">==</span><span class="mi">7</span> <span class="ow">and</span> <span class="n">o</span><span class="o">.</span><span class="n">z</span><span class="o">==</span><span class="mi">10</span> <span class="ow">and</span> <span class="n">o</span><span class="o">.</span><span class="n">h</span><span class="o">==</span><span class="p">[</span><span class="mi">9</span><span class="p">,</span><span class="mi">11</span><span class="p">,</span><span class="mi">10</span><span class="p">]</span>

    <span class="c1"># only attributes specific of Final are replaced.</span>
    <span class="c1"># trying to replace attributes specific of Intermediate </span>
    <span class="c1"># does not work</span>
    <span class="n">o</span> <span class="o">=</span> <span class="n">Final</span> <span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="mi">7</span><span class="p">,</span> <span class="n">z</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">h</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">4</span><span class="p">],</span> <span class="n">Intermediate</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;y&#39;</span><span class="p">:</span> <span class="mi">12</span><span class="p">})</span>
    <span class="k">assert</span> <span class="n">o</span><span class="o">.</span><span class="n">x</span><span class="o">==</span><span class="mi">3</span> <span class="ow">and</span> <span class="n">o</span><span class="o">.</span><span class="n">y</span><span class="o">==</span><span class="mi">7</span> <span class="ow">and</span> <span class="n">o</span><span class="o">.</span><span class="n">z</span><span class="o">==</span><span class="mi">10</span> <span class="ow">and</span> <span class="n">o</span><span class="o">.</span><span class="n">h</span><span class="o">==</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">4</span><span class="p">]</span>

    <span class="k">class</span> <span class="nc">Intermediate</span> <span class="p">(</span><span class="n">Component</span><span class="p">):</span>
        <span class="k">def</span> <span class="fm">__init__</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
            <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span> <span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">class</span> <span class="nc">Final</span> <span class="p">(</span><span class="n">Intermediate</span><span class="p">):</span>
        <span class="k">def</span> <span class="fm">__init__</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">z</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">h</span><span class="o">=</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">5</span><span class="p">],</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
            <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span> <span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="n">o</span> <span class="o">=</span> <span class="n">Final</span> <span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mi">9</span><span class="p">,</span> <span class="n">h</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">4</span><span class="p">],</span> <span class="n">group</span><span class="o">=</span><span class="s1">&#39;group_1&#39;</span><span class="p">,</span> <span class="n">group_1</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;y&#39;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span> <span class="s1">&#39;z&#39;</span><span class="p">:</span><span class="mi">60</span><span class="p">})</span>
    <span class="k">assert</span> <span class="n">o</span><span class="o">.</span><span class="n">x</span><span class="o">==</span><span class="mi">9</span> <span class="ow">and</span> <span class="n">o</span><span class="o">.</span><span class="n">y</span><span class="o">==</span><span class="mi">10</span> <span class="ow">and</span> <span class="n">o</span><span class="o">.</span><span class="n">z</span><span class="o">==</span><span class="mi">60</span> <span class="ow">and</span> <span class="n">o</span><span class="o">.</span><span class="n">h</span><span class="o">==</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">4</span><span class="p">]</span>
    
    
     <span class="c1"># *******************</span>
    <span class="c1"># test using same field in B4 and in A3, but</span>
    <span class="c1"># B4 passes that value to A3 in super(),</span>
    <span class="c1"># after modifying it</span>
    <span class="c1"># *****************</span>
    <span class="k">class</span> <span class="nc">A</span> <span class="p">(</span><span class="n">Component</span><span class="p">):</span>
        <span class="k">def</span> <span class="fm">__init__</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">path_results</span><span class="o">=</span><span class="s1">&#39;test_recursive&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
            <span class="n">path_results</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">path_results</span><span class="si">}</span><span class="s1">/another&#39;</span>
            <span class="nb">super</span> <span class="p">()</span><span class="o">.</span><span class="fm">__init__</span> <span class="p">(</span><span class="n">path_results</span><span class="o">=</span><span class="n">path_results</span><span class="p">,</span> <span class="n">error_if_present</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> 
                               <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    
    <span class="k">class</span> <span class="nc">B</span> <span class="p">(</span><span class="n">A</span><span class="p">):</span>
        <span class="k">def</span> <span class="fm">__init__</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">x</span><span class="o">*</span><span class="mi">2</span>
            <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span> <span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ab</span> <span class="o">=</span> <span class="n">A</span> <span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="n">b</span> <span class="o">=</span> <span class="n">B</span> <span class="p">()</span>
    <span class="k">assert</span> <span class="n">b</span><span class="o">.</span><span class="n">x</span><span class="o">==</span><span class="mi">60</span> <span class="ow">and</span> <span class="n">b</span><span class="o">.</span><span class="n">ab</span><span class="o">.</span><span class="n">x</span><span class="o">==</span><span class="mi">3</span> <span class="ow">and</span> <span class="n">b</span><span class="o">.</span><span class="n">y</span><span class="o">==</span><span class="mi">10</span> <span class="ow">and</span> <span class="n">b</span><span class="o">.</span><span class="n">path_results</span><span class="o">==</span><span class="n">Path</span><span class="p">(</span><span class="s1">&#39;test_recursive/another&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">resolve</span><span class="p">()</span>
    
    <span class="n">b</span> <span class="o">=</span> <span class="n">B</span> <span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">path_results</span><span class="o">=</span><span class="s1">&#39;new_path&#39;</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">b</span><span class="o">.</span><span class="n">x</span><span class="o">==</span><span class="mi">12</span> <span class="ow">and</span> <span class="n">b</span><span class="o">.</span><span class="n">ab</span><span class="o">.</span><span class="n">x</span><span class="o">==</span><span class="mi">3</span> <span class="ow">and</span> <span class="n">b</span><span class="o">.</span><span class="n">y</span><span class="o">==</span><span class="mi">10</span> <span class="ow">and</span> <span class="n">b</span><span class="o">.</span><span class="n">path_results</span><span class="o">==</span><span class="n">Path</span><span class="p">(</span><span class="s1">&#39;new_path/another&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">resolve</span><span class="p">()</span>
    
    <span class="c1"># *******************</span>
    <span class="c1"># test using same field in C and in A, but</span>
    <span class="c1"># the field is modified in a parent B</span>
    <span class="c1"># *****************</span>
    <span class="k">class</span> <span class="nc">C</span><span class="p">(</span><span class="n">B</span><span class="p">):</span>
        <span class="k">def</span> <span class="fm">__init__</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="mi">40</span><span class="p">,</span> <span class="n">z</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
            <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span> <span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">b</span> <span class="o">=</span> <span class="n">B</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            
    <span class="k">with</span> <span class="n">pytest</span><span class="o">.</span><span class="n">raises</span> <span class="p">(</span><span class="ne">RuntimeError</span><span class="p">):</span>
        <span class="n">c</span> <span class="o">=</span> <span class="n">C</span><span class="p">()</span>
        
    <span class="n">c</span> <span class="o">=</span> <span class="n">C</span><span class="p">(</span><span class="n">ignore</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;x&#39;</span><span class="p">})</span>
    <span class="k">assert</span> <span class="n">c</span><span class="o">.</span><span class="n">x</span><span class="o">==</span><span class="mi">80</span> <span class="ow">and</span> <span class="n">c</span><span class="o">.</span><span class="n">y</span><span class="o">==</span><span class="mi">10</span> <span class="ow">and</span> <span class="n">c</span><span class="o">.</span><span class="n">z</span><span class="o">==</span><span class="mi">100</span> <span class="ow">and</span> <span class="n">c</span><span class="o">.</span><span class="n">b</span><span class="o">.</span><span class="n">x</span><span class="o">==</span><span class="mi">60</span> <span class="ow">and</span> <span class="n">c</span><span class="o">.</span><span class="n">b</span><span class="o">.</span><span class="n">y</span><span class="o">==</span><span class="mi">10</span>
    
    <span class="n">c</span> <span class="o">=</span> <span class="n">C</span> <span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mi">9</span><span class="p">,</span> <span class="n">ignore</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;x&#39;</span><span class="p">})</span>
    <span class="k">assert</span> <span class="n">c</span><span class="o">.</span><span class="n">x</span><span class="o">==</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">c</span><span class="o">.</span><span class="n">y</span><span class="o">==</span><span class="mi">10</span> <span class="ow">and</span> <span class="n">c</span><span class="o">.</span><span class="n">z</span><span class="o">==</span><span class="mi">100</span> <span class="ow">and</span> <span class="n">c</span><span class="o">.</span><span class="n">b</span><span class="o">.</span><span class="n">x</span><span class="o">==</span><span class="mi">60</span> <span class="ow">and</span> <span class="n">c</span><span class="o">.</span><span class="n">b</span><span class="o">.</span><span class="n">y</span><span class="o">==</span><span class="mi">10</span>
    
    <span class="k">assert</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="s1">&#39;ignore&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">tst</span><span class="o">.</span><span class="n">run</span> <span class="p">(</span><span class="n">test_component_store_attrs</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="s1">&#39;dummy&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>running test_component_store_attrs
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Transform-method-called-with-different-aliases">Transform method called with different aliases<a class="anchor-link" href="#Transform-method-called-with-different-aliases"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="test_component_aliases" class="doc_header"><code>test_component_aliases</code><a href="https://github.com/Jaume-JCI/ds-blocks/tree/main/dsblocks/tests/core/test_components.py#L181" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>test_component_aliases</code>()</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1">#@pytest.mark.reference_fails</span>
<span class="k">def</span> <span class="nf">test_component_aliases</span> <span class="p">():</span>

    <span class="c1"># test that we can implement _transform and use all the aliases </span>
    <span class="c1"># (transform, predict, apply,  __call__)</span>
    <span class="k">class</span> <span class="nc">MyTransform</span> <span class="p">(</span><span class="n">Component</span><span class="p">):</span>
        <span class="k">def</span> <span class="nf">_transform</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">x</span><span class="o">*</span><span class="mi">2</span>

    <span class="n">my_transform</span> <span class="o">=</span> <span class="n">MyTransform</span><span class="p">()</span>
    <span class="k">assert</span> <span class="n">my_transform</span><span class="o">.</span><span class="n">transform</span> <span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="o">==</span> <span class="mi">6</span>
    <span class="k">assert</span> <span class="n">my_transform</span><span class="o">.</span><span class="n">predict</span> <span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="o">==</span> <span class="mi">6</span>
    <span class="k">assert</span> <span class="n">my_transform</span><span class="o">.</span><span class="n">apply</span> <span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="o">==</span> <span class="mi">6</span>
    <span class="k">assert</span> <span class="n">my_transform</span> <span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="o">==</span> <span class="mi">6</span>

    <span class="c1"># test that we can implement _apply and use all the aliases </span>
    <span class="c1"># (transform, predict, apply and __call__)</span>
    <span class="k">class</span> <span class="nc">MyTransform2</span> <span class="p">(</span><span class="n">Component</span><span class="p">):</span>
        <span class="k">def</span> <span class="nf">_apply</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">x</span><span class="o">*</span><span class="mi">2</span>

    <span class="n">my_transform2</span> <span class="o">=</span> <span class="n">MyTransform2</span><span class="p">()</span>
    <span class="k">assert</span> <span class="n">my_transform2</span><span class="o">.</span><span class="n">transform</span> <span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="o">==</span> <span class="mi">6</span>
    <span class="k">assert</span> <span class="n">my_transform2</span><span class="o">.</span><span class="n">predict</span> <span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="o">==</span> <span class="mi">6</span>
    <span class="k">assert</span> <span class="n">my_transform2</span><span class="o">.</span><span class="n">apply</span> <span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="o">==</span> <span class="mi">6</span>
    <span class="k">assert</span> <span class="n">my_transform2</span> <span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="o">==</span> <span class="mi">6</span>

    <span class="c1"># test that we can implement _predict and use all the aliases </span>
    <span class="c1"># (transform, predict, apply and __call__)</span>
    <span class="k">class</span> <span class="nc">MyTransform3</span> <span class="p">(</span><span class="n">Component</span><span class="p">):</span>
        <span class="k">def</span> <span class="nf">_predict</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">x</span><span class="o">*</span><span class="mi">2</span>

    <span class="n">my_transform3</span> <span class="o">=</span> <span class="n">MyTransform3</span><span class="p">()</span>
    <span class="k">assert</span> <span class="n">my_transform3</span><span class="o">.</span><span class="n">transform</span> <span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="o">==</span> <span class="mi">6</span>
    <span class="k">assert</span> <span class="n">my_transform3</span><span class="o">.</span><span class="n">predict</span> <span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="o">==</span> <span class="mi">6</span>
    <span class="k">assert</span> <span class="n">my_transform3</span><span class="o">.</span><span class="n">apply</span> <span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="o">==</span> <span class="mi">6</span>
    <span class="k">assert</span> <span class="n">my_transform3</span> <span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="o">==</span> <span class="mi">6</span>

    <span class="c1"># test that an exception is raised if neither _tranform nor _apply are defined</span>
    <span class="k">class</span> <span class="nc">MyTransform4</span> <span class="p">(</span><span class="n">Component</span><span class="p">):</span>
        <span class="k">def</span> <span class="nf">_wrong_method</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">x</span><span class="o">*</span><span class="mi">2</span>

    <span class="n">my_transform4</span> <span class="o">=</span> <span class="n">MyTransform4</span> <span class="p">()</span>

    <span class="kn">import</span> <span class="nn">pytest</span>
    <span class="k">with</span> <span class="n">pytest</span><span class="o">.</span><span class="n">raises</span> <span class="p">(</span><span class="ne">AssertionError</span><span class="p">):</span>
        <span class="n">my_transform4</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>


    <span class="c1"># test that an exception is raised if more than one alias is implemented</span>
    <span class="k">class</span> <span class="nc">MyTransform5</span> <span class="p">(</span><span class="n">Component</span><span class="p">):</span>
        <span class="k">def</span> <span class="nf">_predict</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">x</span><span class="o">*</span><span class="mi">2</span>
        <span class="k">def</span> <span class="nf">_apply</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">x</span><span class="o">*</span><span class="mi">2</span>

    <span class="kn">import</span> <span class="nn">pytest</span>
    <span class="k">with</span> <span class="n">pytest</span><span class="o">.</span><span class="n">raises</span><span class="p">(</span><span class="ne">AttributeError</span><span class="p">):</span>
        <span class="n">my_transform5</span> <span class="o">=</span> <span class="n">MyTransform5</span> <span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">tst</span><span class="o">.</span><span class="n">run</span> <span class="p">(</span><span class="n">test_component_aliases</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="s1">&#39;dummy&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>running test_component_aliases
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Calling-predict-is-handy-when-the-result-is-a-single-array-of-predictions">Calling <code>predict</code> is handy when the result is a single array of predictions<a class="anchor-link" href="#Calling-predict-is-handy-when-the-result-is-a-single-array-of-predictions"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="test_component_predict" class="doc_header"><code>test_component_predict</code><a href="https://github.com/Jaume-JCI/ds-blocks/tree/main/dsblocks/tests/core/test_components.py#L244" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>test_component_predict</code>()</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1">#@pytest.mark.reference_fails</span>
<span class="k">def</span> <span class="nf">test_component_predict</span> <span class="p">():</span>
<span class="c1"># TODO: remove this cell</span>

    <span class="k">class</span> <span class="nc">MyTransform</span> <span class="p">(</span><span class="n">Component</span><span class="p">):</span>
        <span class="k">def</span> <span class="fm">__init__</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
            <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span> <span class="p">(</span>
                <span class="n">data_converter</span><span class="o">=</span><span class="n">PandasConverter</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">),</span>
                <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">_predict</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">]</span><span class="o">+</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;b&#39;</span><span class="p">]</span>

    <span class="n">my_transform</span> <span class="o">=</span> <span class="n">MyTransform</span><span class="p">()</span>

    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span> <span class="p">({</span><span class="s1">&#39;a&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span><span class="mi">20</span><span class="p">,</span><span class="mi">30</span><span class="p">],</span><span class="s1">&#39;b&#39;</span><span class="p">:[</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">]})</span>

    <span class="n">pd</span><span class="o">.</span><span class="n">testing</span><span class="o">.</span><span class="n">assert_frame_equal</span><span class="p">(</span><span class="n">my_transform</span><span class="o">.</span><span class="n">transform</span> <span class="p">(</span><span class="n">df</span><span class="p">),</span> 
                                  <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span> <span class="p">({</span><span class="mi">0</span><span class="p">:</span> <span class="p">[</span><span class="mi">14</span><span class="p">,</span><span class="mi">25</span><span class="p">,</span><span class="mi">36</span><span class="p">]})</span>
                                 <span class="p">)</span>

    <span class="k">if</span> <span class="kc">False</span><span class="p">:</span>
        <span class="n">pd</span><span class="o">.</span><span class="n">testing</span><span class="o">.</span><span class="n">assert_frame_equal</span><span class="p">(</span><span class="n">my_transform</span><span class="o">.</span><span class="n">predict</span> <span class="p">(</span><span class="n">df</span><span class="p">),</span> 
                                      <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span> <span class="p">({</span><span class="mi">0</span><span class="p">:</span> <span class="p">[</span><span class="mi">14</span><span class="p">,</span><span class="mi">25</span><span class="p">,</span><span class="mi">36</span><span class="p">]})</span>
                                     <span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">tst</span><span class="o">.</span><span class="n">run</span> <span class="p">(</span><span class="n">test_component_predict</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="s1">&#39;dummy&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>running test_component_predict
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="The-transform-method-and-its-aliases-can-be-called-with-multiple-inputs">The <code>transform</code> method and its aliases can be called with multiple inputs<a class="anchor-link" href="#The-transform-method-and-its-aliases-can-be-called-with-multiple-inputs"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="test_component_multiple_inputs" class="doc_header"><code>test_component_multiple_inputs</code><a href="https://github.com/Jaume-JCI/ds-blocks/tree/main/dsblocks/tests/core/test_components.py#L270" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>test_component_multiple_inputs</code>()</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">test_component_multiple_inputs</span> <span class="p">():</span>
    <span class="c1"># test that we can apply tranform to multiple data items</span>
    <span class="kn">from</span> <span class="nn">dsblocks.utils.dummies</span> <span class="kn">import</span> <span class="n">SumXY</span>
    
    <span class="n">my_transform</span> <span class="o">=</span> <span class="n">SumXY</span> <span class="p">()</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">my_transform</span><span class="o">.</span><span class="n">transform</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
    <span class="nb">print</span> <span class="p">(</span><span class="n">result</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">result</span><span class="o">==</span><span class="mi">7</span>

    <span class="c1"># test that we can apply tranform to single data items</span>
    <span class="k">class</span> <span class="nc">MyTransform2</span> <span class="p">(</span><span class="n">Component</span><span class="p">):</span>
        <span class="k">def</span> <span class="nf">_apply</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">x</span><span class="o">*</span><span class="mi">2</span>

    <span class="n">my_transform2</span> <span class="o">=</span> <span class="n">MyTransform2</span> <span class="p">()</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">my_transform2</span><span class="o">.</span><span class="n">transform</span> <span class="p">(</span><span class="mi">3</span><span class="p">)</span>
    <span class="nb">print</span> <span class="p">(</span><span class="n">result</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">result</span><span class="o">==</span><span class="mi">6</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">tst</span><span class="o">.</span><span class="n">run</span> <span class="p">(</span><span class="n">test_component_multiple_inputs</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="s1">&#39;dummy&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>running test_component_multiple_inputs
7
6
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="fit_apply()-and-its-aliases-fit_transform(),-fit_predict()"><code>fit_apply()</code> and its aliases <code>fit_transform(), fit_predict()</code><a class="anchor-link" href="#fit_apply()-and-its-aliases-fit_transform(),-fit_predict()"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="TransformWithFitApply" class="doc_header"><code>class</code> <code>TransformWithFitApply</code><a href="https://github.com/Jaume-JCI/ds-blocks/tree/main/dsblocks/tests/core/test_components.py#L291" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>TransformWithFitApply</code>(<strong>**<code>kwargs</code></strong>) :: <a href="/components.html#Component"><code>Component</code></a></p>
</blockquote>

<pre><code>Base component class used in our Pipeline.</code></pre>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="TransformWithoutFitApply" class="doc_header"><code>class</code> <code>TransformWithoutFitApply</code><a href="https://github.com/Jaume-JCI/ds-blocks/tree/main/dsblocks/tests/core/test_components.py#L303" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>TransformWithoutFitApply</code>(<strong>**<code>kwargs</code></strong>) :: <a href="/components.html#Component"><code>Component</code></a></p>
</blockquote>

<pre><code>Base component class used in our Pipeline.</code></pre>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="test_component_fit_apply" class="doc_header"><code>test_component_fit_apply</code><a href="https://github.com/Jaume-JCI/ds-blocks/tree/main/dsblocks/tests/core/test_components.py#L312" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>test_component_fit_apply</code>()</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># example with _fit_apply implemented</span>
<span class="k">class</span> <span class="nc">TransformWithFitApply</span> <span class="p">(</span><span class="n">Component</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span> <span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_fit</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sum</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_apply</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">X</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">sum</span>
    <span class="k">def</span> <span class="nf">_fit_apply</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sum</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">*</span><span class="mi">10</span>
        <span class="k">return</span> <span class="n">X</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">sum</span>

    <span class="c1"># example without _fit_apply implemented</span>
<span class="k">class</span> <span class="nc">TransformWithoutFitApply</span> <span class="p">(</span><span class="n">Component</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span> <span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_fit</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sum</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_apply</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">X</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">sum</span>
        
<span class="c1">#@pytest.mark.reference_fails</span>
<span class="k">def</span> <span class="nf">test_component_fit_apply</span> <span class="p">():</span>

    <span class="n">tr1</span> <span class="o">=</span> <span class="n">TransformWithFitApply</span> <span class="p">()</span>
    <span class="n">X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span> <span class="p">([</span><span class="mi">100</span><span class="p">,</span> <span class="mi">90</span><span class="p">,</span> <span class="mi">10</span><span class="p">])</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">tr1</span><span class="o">.</span><span class="n">fit_apply</span> <span class="p">(</span><span class="n">X</span><span class="p">)</span>
    <span class="k">assert</span> <span class="p">(</span><span class="n">result</span><span class="o">==</span><span class="p">(</span><span class="n">X</span><span class="o">+</span><span class="mi">2000</span><span class="p">))</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>

    <span class="c1"># same result obtained by aliases</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">tr1</span><span class="o">.</span><span class="n">fit_transform</span> <span class="p">(</span><span class="n">X</span><span class="p">)</span>
    <span class="k">assert</span> <span class="p">(</span><span class="n">result</span><span class="o">==</span><span class="p">(</span><span class="n">X</span><span class="o">+</span><span class="mi">2000</span><span class="p">))</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
    
    <span class="c1"># different result if we apply fit and apply separately</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">tr1</span><span class="o">.</span><span class="n">fit</span> <span class="p">(</span><span class="n">X</span><span class="p">)</span><span class="o">.</span><span class="n">transform</span> <span class="p">(</span><span class="n">X</span><span class="p">)</span>
    <span class="k">assert</span> <span class="p">(</span><span class="n">result</span><span class="o">==</span><span class="p">(</span><span class="n">X</span><span class="o">+</span><span class="mi">200</span><span class="p">))</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>

    <span class="c1"># transform without fit_apply</span>
    <span class="n">tr2</span> <span class="o">=</span> <span class="n">TransformWithoutFitApply</span> <span class="p">()</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">tr2</span><span class="o">.</span><span class="n">fit_apply</span> <span class="p">(</span><span class="n">X</span><span class="p">)</span>
    <span class="k">assert</span> <span class="p">(</span><span class="n">result</span><span class="o">==</span><span class="p">(</span><span class="n">X</span><span class="o">+</span><span class="mi">200</span><span class="p">))</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>

    <span class="c1"># same result obtained by aliases</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">tr2</span><span class="o">.</span><span class="n">fit_transform</span> <span class="p">(</span><span class="n">X</span><span class="p">)</span>
    <span class="k">assert</span> <span class="p">(</span><span class="n">result</span><span class="o">==</span><span class="p">(</span><span class="n">X</span><span class="o">+</span><span class="mi">200</span><span class="p">))</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">tst</span><span class="o">.</span><span class="n">run</span> <span class="p">(</span><span class="n">test_component_fit_apply</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="s1">&#39;dummy&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>running test_component_fit_apply
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="fit_apply()-with-DataConverters-that-transform-inplace"><code>fit_apply()</code> with DataConverters that transform inplace<a class="anchor-link" href="#fit_apply()-with-DataConverters-that-transform-inplace"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="MyDataConverter" class="doc_header"><code>class</code> <code>MyDataConverter</code><a href="https://github.com/Jaume-JCI/ds-blocks/tree/main/dsblocks/tests/core/test_components.py#L338" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>MyDataConverter</code>(<strong>**<code>kwargs</code></strong>) :: <a href="/data_conversion.html#DataConverter"><code>DataConverter</code></a></p>
</blockquote>

<pre><code>Convert input and output data format.

This class allows to convert the format of the data before fitting
and before transforming, and revert the changes back after performing
these operations. This allows to decouple the implementation of a
particular component from the remaining components in the pipeline,
making it more reusable across different pipelines.</code></pre>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="TransformWithFitApplyDC" class="doc_header"><code>class</code> <code>TransformWithFitApplyDC</code><a href="https://github.com/Jaume-JCI/ds-blocks/tree/main/dsblocks/tests/core/test_components.py#L365" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>TransformWithFitApplyDC</code>(<strong>**<code>kwargs</code></strong>) :: <a href="/components.html#Component"><code>Component</code></a></p>
</blockquote>

<pre><code>Base component class used in our Pipeline.</code></pre>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># example with _fit_apply implemented</span>
<span class="k">class</span> <span class="nc">MyDataConverter</span> <span class="p">(</span><span class="n">DataConverter</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span> <span class="p">()</span><span class="o">.</span><span class="fm">__init__</span> <span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">convert_before_fitting</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">X</span><span class="p">):</span>
        <span class="n">X</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">X</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">X</span><span class="p">)</span><span class="o">==</span><span class="mi">2</span> <span class="k">else</span> <span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">orig</span> <span class="o">=</span> <span class="n">X</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">X</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">return</span> <span class="n">X</span><span class="p">,</span> <span class="n">y</span>
    <span class="k">def</span> <span class="nf">convert_after_fitting</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">X</span><span class="p">):</span>
        <span class="n">X</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">X</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">X</span><span class="p">)</span><span class="o">==</span><span class="mi">2</span> <span class="k">else</span> <span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">X</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">tuple</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">X</span><span class="p">)</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span> <span class="n">X</span> <span class="o">=</span> <span class="n">X</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">X</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">orig</span>
        <span class="k">return</span> <span class="n">X</span>
    <span class="k">def</span> <span class="nf">convert_before_transforming</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">orig2</span> <span class="o">=</span> <span class="n">X</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">X</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">return</span> <span class="n">X</span>
    <span class="k">def</span> <span class="nf">convert_after_transforming</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">X</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">orig2</span>
        <span class="k">return</span> <span class="n">X</span>
    <span class="k">def</span> <span class="nf">convert_before_fit_apply</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">X</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">convert_before_fitting</span> <span class="p">(</span><span class="o">*</span><span class="n">X</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">inplace</span><span class="p">:</span>
            <span class="n">X2</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">X</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">X</span><span class="p">)</span><span class="o">==</span><span class="mi">2</span> <span class="k">else</span> <span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="kc">None</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">X</span> <span class="o">=</span> <span class="n">X2</span> <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">X2</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">tuple</span> <span class="k">else</span> <span class="p">(</span><span class="n">X2</span><span class="p">,)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">convert_before_transforming</span> <span class="p">(</span><span class="o">*</span><span class="n">X</span><span class="p">)</span>
        
<span class="k">class</span> <span class="nc">TransformWithFitApplyDC</span> <span class="p">(</span><span class="n">Component</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span> <span class="p">(</span><span class="n">data_converter</span><span class="o">=</span><span class="n">MyDataConverter</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_fit</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sum</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_apply</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">X</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">sum</span>
    <span class="k">def</span> <span class="nf">_fit_apply</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sum</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">X</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">sum</span>

<span class="c1">#@pytest.mark.reference_fails</span>
<span class="k">if</span> <span class="kc">False</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">test_fit_apply_inplace</span> <span class="p">():</span>
        <span class="n">tr1</span> <span class="o">=</span> <span class="n">TransformWithFitApplyDC</span> <span class="p">()</span>
        <span class="n">X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span> <span class="p">([</span><span class="mi">100</span><span class="p">,</span> <span class="mi">90</span><span class="p">,</span> <span class="mi">10</span><span class="p">])</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">tr1</span><span class="o">.</span><span class="n">fit_apply</span> <span class="p">(</span><span class="n">X</span><span class="p">)</span>
        <span class="k">assert</span> <span class="p">(</span><span class="n">result</span><span class="o">==</span><span class="p">[</span><span class="mi">100</span><span class="p">,</span>  <span class="mi">90</span><span class="p">,</span> <span class="mi">110</span><span class="p">])</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
        <span class="k">assert</span> <span class="p">(</span><span class="n">X</span><span class="o">==</span><span class="p">[</span><span class="mi">100</span><span class="p">,</span>  <span class="mi">90</span><span class="p">,</span>  <span class="mi">10</span><span class="p">])</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>

        <span class="n">tr1</span> <span class="o">=</span> <span class="n">TransformWithFitApplyDC</span> <span class="p">(</span><span class="n">inplace</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span> <span class="p">([</span><span class="mi">100</span><span class="p">,</span> <span class="mi">90</span><span class="p">,</span> <span class="mi">10</span><span class="p">])</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">tr1</span><span class="o">.</span><span class="n">fit_apply</span> <span class="p">(</span><span class="n">X</span><span class="p">)</span>
        <span class="k">assert</span> <span class="p">(</span><span class="n">result</span><span class="o">==</span><span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">90</span><span class="p">,</span> <span class="mi">20</span><span class="p">])</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
        <span class="k">assert</span> <span class="p">(</span><span class="n">X</span><span class="o">==</span><span class="p">[</span> <span class="mi">0</span><span class="p">,</span>  <span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">])</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span> 
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><code>_fit_apply()</code> is called when implemented, otherwise <code>fit().apply()</code> is called</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%</span><span class="k">debug</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>ERROR:root:No traceback has been produced, nothing to debug.
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Getting-validation_data-and-test_data">Getting validation_data and test_data<a class="anchor-link" href="#Getting-validation_data-and-test_data"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="test_component_validation_test" class="doc_header"><code>test_component_validation_test</code><a href="https://github.com/Jaume-JCI/ds-blocks/tree/main/dsblocks/tests/core/test_components.py#L393" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>test_component_validation_test</code>()</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1">#@pytest.mark.reference_fails</span>
<span class="k">def</span> <span class="nf">test_component_validation_test</span> <span class="p">():</span>
    <span class="k">class</span> <span class="nc">Transform1</span> <span class="p">(</span><span class="n">Component</span><span class="p">):</span>
        <span class="k">def</span> <span class="fm">__init__</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
            <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span> <span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">def</span> <span class="nf">_fit</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">validation_data</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">test_data</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sum</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

            <span class="nb">print</span> <span class="p">(</span><span class="sa">f</span><span class="s1">&#39;validation_data: </span><span class="si">{</span><span class="n">validation_data</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="nb">print</span> <span class="p">(</span><span class="sa">f</span><span class="s1">&#39;test_data: </span><span class="si">{</span><span class="n">test_data</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">validation_data</span> <span class="o">=</span> <span class="n">validation_data</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">test_data</span> <span class="o">=</span> <span class="n">test_data</span>

        <span class="k">def</span> <span class="nf">_apply</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">X</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">sum</span>

    <span class="n">tr1</span> <span class="o">=</span> <span class="n">Transform1</span> <span class="p">()</span>
    <span class="n">X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span> <span class="p">([</span><span class="mi">100</span><span class="p">,</span> <span class="mi">90</span><span class="p">,</span> <span class="mi">10</span><span class="p">])</span>

    <span class="c1"># case 1: validation_data and test_data are not tuples</span>
    <span class="n">validation_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span> <span class="p">([</span><span class="mi">100</span><span class="p">,</span> <span class="mi">90</span><span class="p">,</span> <span class="mi">10</span><span class="p">])</span><span class="o">*</span><span class="mi">10</span>
    <span class="n">test_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span> <span class="p">([</span><span class="mi">100</span><span class="p">,</span> <span class="mi">90</span><span class="p">,</span> <span class="mi">10</span><span class="p">])</span><span class="o">*</span><span class="mi">100</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">tr1</span><span class="o">.</span><span class="n">fit_apply</span> <span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">validation_data</span><span class="o">=</span><span class="n">validation_data</span><span class="p">,</span> <span class="n">test_data</span><span class="o">=</span><span class="n">test_data</span><span class="p">)</span>
    <span class="k">assert</span> <span class="p">(</span><span class="n">tr1</span><span class="o">.</span><span class="n">validation_data</span><span class="o">==</span><span class="n">validation_data</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
    <span class="k">assert</span> <span class="p">(</span><span class="n">tr1</span><span class="o">.</span><span class="n">test_data</span><span class="o">==</span><span class="n">test_data</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>

    <span class="c1"># case 2: validation_data is a tuple, and test_data is not given</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">tr1</span><span class="o">.</span><span class="n">fit_apply</span> <span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">validation_data</span><span class="o">=</span><span class="p">(</span><span class="n">validation_data</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>
    <span class="k">assert</span> <span class="p">(</span><span class="n">tr1</span><span class="o">.</span><span class="n">validation_data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">==</span><span class="n">validation_data</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
    <span class="k">assert</span> <span class="n">tr1</span><span class="o">.</span><span class="n">validation_data</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">==</span><span class="mi">1</span>
    <span class="k">assert</span> <span class="n">tr1</span><span class="o">.</span><span class="n">test_data</span> <span class="ow">is</span> <span class="kc">None</span>

    <span class="c1"># case 3: validation_data is a tuple with more than 2 elements, exception is raised</span>
    <span class="kn">import</span> <span class="nn">pytest</span>
    <span class="k">with</span> <span class="n">pytest</span><span class="o">.</span><span class="n">raises</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">):</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">tr1</span><span class="o">.</span><span class="n">fit_apply</span> <span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">validation_data</span><span class="o">=</span><span class="p">(</span><span class="n">validation_data</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">tst</span><span class="o">.</span><span class="n">run</span> <span class="p">(</span><span class="n">test_component_validation_test</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="s1">&#39;dummy&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>running test_component_validation_test
validation_data: [1000  900  100]
test_data: [10000  9000  1000]
validation_data: (array([1000,  900,  100]), 1)
test_data: None
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="saving-/-loading">saving / loading<a class="anchor-link" href="#saving-/-loading"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="TransformWithoutFitApply2" class="doc_header"><code>class</code> <code>TransformWithoutFitApply2</code><a href="https://github.com/Jaume-JCI/ds-blocks/tree/main/dsblocks/tests/core/test_components.py#L433" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>TransformWithoutFitApply2</code>(<strong><code>error_if_fit_func</code></strong>=<em><code>False</code></em>, <strong><code>error_if_apply_func</code></strong>=<em><code>False</code></em>, <strong>**<code>kwargs</code></strong>) :: <a href="/components.html#Component"><code>Component</code></a></p>
</blockquote>

<pre><code>Base component class used in our Pipeline.</code></pre>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="TransformWithFitApply2" class="doc_header"><code>class</code> <code>TransformWithFitApply2</code><a href="https://github.com/Jaume-JCI/ds-blocks/tree/main/dsblocks/tests/core/test_components.py#L449" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>TransformWithFitApply2</code>(<strong><code>error_if_fit_func</code></strong>=<em><code>False</code></em>, <strong><code>error_if_apply_func</code></strong>=<em><code>False</code></em>, <strong><code>error_if_fit_apply_func</code></strong>=<em><code>False</code></em>, <strong>**<code>kwargs</code></strong>) :: <a href="/components.html#Component"><code>Component</code></a></p>
</blockquote>

<pre><code>Base component class used in our Pipeline.</code></pre>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="component_save_data" class="doc_header"><code>component_save_data</code><a href="https://github.com/Jaume-JCI/ds-blocks/tree/main/dsblocks/tests/core/test_components.py#L469" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>component_save_data</code>()</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="test_component_save_load" class="doc_header"><code>test_component_save_load</code><a href="https://github.com/Jaume-JCI/ds-blocks/tree/main/dsblocks/tests/core/test_components.py#L474" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>test_component_save_load</code>(<strong><code>component_save_data</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># example with _fit_apply implemented</span>
<span class="k">class</span> <span class="nc">TransformWithoutFitApply2</span> <span class="p">(</span><span class="n">Component</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">error_if_fit_func</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">error_if_apply_func</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>  <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span> <span class="p">(</span><span class="n">data_io</span><span class="o">=</span><span class="s1">&#39;SklearnIO&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">estimator</span> <span class="o">=</span> <span class="n">Bunch</span><span class="p">(</span><span class="nb">sum</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_fit</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">error_if_fit_func</span><span class="p">:</span> <span class="k">raise</span> <span class="ne">RuntimeError</span> <span class="p">(</span><span class="s1">&#39;fit should not run&#39;</span><span class="p">)</span>
        <span class="nb">print</span> <span class="p">(</span><span class="s1">&#39;running _fit&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">estimator</span><span class="o">.</span><span class="n">sum</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_apply</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">error_if_apply_func</span><span class="p">:</span> <span class="k">raise</span> <span class="ne">RuntimeError</span> <span class="p">(</span><span class="s1">&#39;apply should not run&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">estimator</span><span class="o">.</span><span class="n">sum</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="k">raise</span> <span class="ne">RuntimeError</span> <span class="p">(</span><span class="s1">&#39;fit should be called before apply&#39;</span><span class="p">)</span>
        <span class="nb">print</span> <span class="p">(</span><span class="s1">&#39;running _apply&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">X</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">estimator</span><span class="o">.</span><span class="n">sum</span>

<span class="n">Transform1</span> <span class="o">=</span> <span class="n">TransformWithoutFitApply2</span>

<span class="k">class</span> <span class="nc">TransformWithFitApply2</span> <span class="p">(</span><span class="n">Component</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">error_if_fit_func</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">error_if_apply_func</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">error_if_fit_apply_func</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> 
                  <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span> <span class="p">(</span><span class="n">data_io</span><span class="o">=</span><span class="s1">&#39;SklearnIO&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">estimator</span> <span class="o">=</span> <span class="n">Bunch</span><span class="p">(</span><span class="nb">sum</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_fit</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">error_if_fit_func</span><span class="p">:</span> <span class="k">raise</span> <span class="ne">RuntimeError</span> <span class="p">(</span><span class="s1">&#39;fit should not run&#39;</span><span class="p">)</span>
        <span class="nb">print</span> <span class="p">(</span><span class="s1">&#39;running _fit&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">estimator</span><span class="o">.</span><span class="n">sum</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_apply</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">error_if_apply_func</span><span class="p">:</span> <span class="k">raise</span> <span class="ne">RuntimeError</span> <span class="p">(</span><span class="s1">&#39;apply should not run&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">estimator</span><span class="o">.</span><span class="n">sum</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="k">raise</span> <span class="ne">RuntimeError</span> <span class="p">(</span><span class="s1">&#39;fit should be called before apply&#39;</span><span class="p">)</span>
        <span class="nb">print</span> <span class="p">(</span><span class="s1">&#39;running _apply&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">X</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">estimator</span><span class="o">.</span><span class="n">sum</span>
    <span class="k">def</span> <span class="nf">_fit_apply</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">error_if_fit_apply_func</span><span class="p">:</span> <span class="k">raise</span> <span class="ne">RuntimeError</span> <span class="p">(</span><span class="s1">&#39;fit_apply should not run&#39;</span><span class="p">)</span>
        <span class="nb">print</span> <span class="p">(</span><span class="s1">&#39;running _fit_apply&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">estimator</span><span class="o">.</span><span class="n">sum</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">X</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">estimator</span><span class="o">.</span><span class="n">sum</span>

<span class="k">def</span> <span class="nf">component_save_data</span> <span class="p">():</span>
    <span class="n">X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span> <span class="p">([</span><span class="mi">100</span><span class="p">,</span> <span class="mi">90</span><span class="p">,</span> <span class="mi">10</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">X</span>
        
<span class="c1">#@pytest.mark.reference_fails</span>
<span class="k">def</span> <span class="nf">test_component_save_load</span> <span class="p">(</span><span class="n">component_save_data</span><span class="p">):</span>
    
    <span class="n">X</span> <span class="o">=</span> <span class="n">component_save_data</span>

    <span class="n">path_results</span> <span class="o">=</span> <span class="s1">&#39;component_loading_saving&#39;</span>
    <span class="n">remove_previous_results</span> <span class="p">(</span><span class="n">path_results</span><span class="o">=</span><span class="n">path_results</span><span class="p">)</span>

    <span class="n">tr1</span> <span class="o">=</span> <span class="n">Transform1</span> <span class="p">(</span><span class="n">path_results</span><span class="o">=</span><span class="n">path_results</span><span class="p">)</span>
    <span class="n">tr1</span><span class="o">.</span><span class="n">fit</span> <span class="p">(</span><span class="n">X</span><span class="p">)</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">tr1</span><span class="o">.</span><span class="n">apply</span> <span class="p">(</span><span class="n">X</span><span class="p">)</span>

    <span class="n">tr2</span> <span class="o">=</span> <span class="n">Transform1</span> <span class="p">(</span><span class="n">path_results</span><span class="o">=</span><span class="n">path_results</span><span class="p">)</span>
    <span class="n">tr2</span><span class="o">.</span><span class="n">load_estimator</span><span class="p">()</span>
    <span class="k">assert</span> <span class="n">tr2</span><span class="o">.</span><span class="n">estimator</span><span class="o">.</span><span class="n">sum</span> <span class="o">==</span> <span class="n">tr1</span><span class="o">.</span><span class="n">estimator</span><span class="o">.</span><span class="n">sum</span>

    <span class="n">result2</span> <span class="o">=</span> <span class="n">tr2</span><span class="o">.</span><span class="n">data_io</span><span class="o">.</span><span class="n">load_result</span> <span class="p">()</span>
    <span class="k">assert</span> <span class="p">(</span><span class="n">result2</span> <span class="o">==</span> <span class="nb">sum</span><span class="p">(</span><span class="n">X</span><span class="p">)</span><span class="o">+</span><span class="n">X</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>

    <span class="kn">import</span> <span class="nn">os</span>

    <span class="k">assert</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span> <span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">path_results</span><span class="si">}</span><span class="s1">/whole&#39;</span><span class="p">)</span><span class="o">==</span><span class="p">[</span><span class="s1">&#39;transform_without_fit_apply2_result.pk&#39;</span><span class="p">]</span>
    <span class="k">assert</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span> <span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">path_results</span><span class="si">}</span><span class="s1">/models&#39;</span><span class="p">)</span><span class="o">==</span><span class="p">[</span><span class="s1">&#39;transform_without_fit_apply2_estimator.pk&#39;</span><span class="p">]</span>

    <span class="n">result_b</span> <span class="o">=</span> <span class="n">tr1</span><span class="o">.</span><span class="n">apply</span> <span class="p">(</span><span class="n">X</span><span class="o">*</span><span class="mi">2</span><span class="p">,</span> <span class="n">split</span><span class="o">=</span><span class="s1">&#39;test&#39;</span><span class="p">)</span>
    <span class="n">result2b</span> <span class="o">=</span> <span class="n">tr2</span><span class="o">.</span><span class="n">data_io</span><span class="o">.</span><span class="n">load_result</span> <span class="p">(</span><span class="n">split</span><span class="o">=</span><span class="s1">&#39;test&#39;</span><span class="p">)</span>
    <span class="k">assert</span> <span class="p">(</span><span class="n">result_b</span><span class="o">==</span><span class="n">result2b</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
    <span class="k">assert</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span> <span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">path_results</span><span class="si">}</span><span class="s1">/test&#39;</span><span class="p">)</span><span class="o">==</span><span class="p">[</span><span class="s1">&#39;transform_without_fit_apply2_result.pk&#39;</span><span class="p">]</span>

    <span class="n">result2b</span> <span class="o">=</span> <span class="n">tr2</span><span class="o">.</span><span class="n">data_io</span><span class="o">.</span><span class="n">load_result</span> <span class="p">()</span>
    <span class="k">assert</span> <span class="p">(</span><span class="n">result_b</span><span class="o">!=</span><span class="n">result2b</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>

    <span class="n">remove_previous_results</span> <span class="p">(</span><span class="n">path_results</span><span class="o">=</span><span class="n">path_results</span><span class="p">)</span>


    <span class="c1"># Test that no saving is done if save=False</span>
    <span class="n">tr1</span> <span class="o">=</span> <span class="n">Transform1</span> <span class="p">(</span><span class="n">path_results</span><span class="o">=</span><span class="n">path_results</span><span class="p">,</span> <span class="n">save</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">tr1</span><span class="o">.</span><span class="n">fit</span> <span class="p">(</span><span class="n">X</span><span class="p">)</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">tr1</span><span class="o">.</span><span class="n">apply</span> <span class="p">(</span><span class="n">X</span><span class="p">)</span>
    <span class="k">assert</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">path_results</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">tst</span><span class="o">.</span><span class="n">run</span> <span class="p">(</span><span class="n">test_component_save_load</span><span class="p">,</span> <span class="n">component_save_data</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="s1">&#39;dummy&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>running test_component_save_load
running _fit
running _apply
running _apply
running _fit
running _apply
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="running-fit-/-apply-depending-on-whether-estimator-/-result-exists">running fit / apply depending on whether estimator / result exists<a class="anchor-link" href="#running-fit-/-apply-depending-on-whether-estimator-/-result-exists"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="test_component_run_depend_on_existence" class="doc_header"><code>test_component_run_depend_on_existence</code><a href="https://github.com/Jaume-JCI/ds-blocks/tree/main/dsblocks/tests/core/test_components.py#L517" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>test_component_run_depend_on_existence</code>()</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1">#@pytest.mark.reference_fails</span>
<span class="k">def</span> <span class="nf">test_component_run_depend_on_existence</span> <span class="p">():</span>

    <span class="n">path_results</span> <span class="o">=</span> <span class="s1">&#39;component_run_existence&#39;</span>
    <span class="n">remove_previous_results</span> <span class="p">(</span><span class="n">path_results</span><span class="o">=</span><span class="n">path_results</span><span class="p">)</span>

    <span class="n">tr1</span> <span class="o">=</span> <span class="n">TransformWithFitApply2</span> <span class="p">(</span><span class="n">path_results</span><span class="o">=</span><span class="n">path_results</span><span class="p">,</span> <span class="n">error_if_fit_func</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">error_if_apply_func</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span> <span class="p">([</span><span class="mi">100</span><span class="p">,</span> <span class="mi">90</span><span class="p">,</span> <span class="mi">10</span><span class="p">])</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">tr1</span><span class="o">.</span><span class="n">fit_apply</span> <span class="p">(</span><span class="n">X</span><span class="p">)</span>
    <span class="k">assert</span> <span class="p">(</span><span class="n">result</span><span class="o">==</span><span class="p">(</span><span class="n">X</span><span class="o">+</span><span class="mi">200</span><span class="p">))</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>

    <span class="k">assert</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">path_results</span><span class="si">}</span><span class="s1">/models&#39;</span><span class="p">)</span><span class="o">==</span><span class="p">[</span><span class="s1">&#39;transform_with_fit_apply2_estimator.pk&#39;</span><span class="p">]</span>

    <span class="k">assert</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">path_results</span><span class="si">}</span><span class="s1">/whole&#39;</span><span class="p">)</span><span class="o">==</span><span class="p">[</span><span class="s1">&#39;transform_with_fit_apply2_result.pk&#39;</span><span class="p">]</span>

    <span class="n">tr1</span> <span class="o">=</span> <span class="n">TransformWithFitApply2</span> <span class="p">(</span><span class="n">path_results</span><span class="o">=</span><span class="n">path_results</span><span class="p">,</span> <span class="n">error_if_fit_func</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">error_if_apply_func</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                  <span class="n">error_if_fit_func_apply</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">result2</span> <span class="o">=</span> <span class="n">tr1</span><span class="o">.</span><span class="n">fit_apply</span> <span class="p">(</span><span class="n">X</span><span class="p">)</span>
    <span class="k">assert</span> <span class="p">(</span><span class="n">result2</span><span class="o">==</span><span class="p">(</span><span class="n">X</span><span class="o">+</span><span class="mi">200</span><span class="p">))</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>

    <span class="k">assert</span> <span class="n">tr1</span><span class="o">.</span><span class="n">estimator</span><span class="o">==</span><span class="p">{</span><span class="s1">&#39;sum&#39;</span><span class="p">:</span> <span class="mi">200</span><span class="p">}</span>

    <span class="n">tr2</span> <span class="o">=</span> <span class="n">TransformWithFitApply2</span> <span class="p">(</span><span class="n">path_results</span><span class="o">=</span><span class="n">path_results</span><span class="p">,</span> <span class="n">error_if_fit_func</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">error_if_apply_func</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                  <span class="n">error_if_fit_apply_func</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">result3</span> <span class="o">=</span> <span class="n">tr2</span><span class="o">.</span><span class="n">apply</span> <span class="p">(</span><span class="n">X</span><span class="p">)</span>

    <span class="k">assert</span> <span class="p">(</span><span class="n">result3</span><span class="o">==</span><span class="p">(</span><span class="n">X</span><span class="o">+</span><span class="mi">200</span><span class="p">))</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
    <span class="k">assert</span> <span class="n">tr2</span><span class="o">.</span><span class="n">estimator</span><span class="o">==</span><span class="p">{</span><span class="s1">&#39;sum&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">}</span>

    <span class="n">os</span><span class="o">.</span><span class="n">remove</span> <span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">path_results</span><span class="si">}</span><span class="s1">/models/transform_with_fit_apply2_estimator.pk&#39;</span><span class="p">)</span>

    <span class="k">with</span> <span class="n">pytest</span><span class="o">.</span><span class="n">raises</span> <span class="p">(</span><span class="ne">RuntimeError</span><span class="p">):</span>
        <span class="n">result3</span> <span class="o">=</span> <span class="n">tr2</span><span class="o">.</span><span class="n">fit_apply</span> <span class="p">(</span><span class="n">X</span><span class="p">)</span>

    <span class="n">tr2</span><span class="o">.</span><span class="n">error_if_fit_apply_func</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">result4</span> <span class="o">=</span> <span class="n">tr2</span><span class="o">.</span><span class="n">fit_apply</span> <span class="p">(</span><span class="n">X</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">tr2</span><span class="o">.</span><span class="n">estimator</span><span class="o">==</span><span class="p">{</span><span class="s1">&#39;sum&#39;</span><span class="p">:</span> <span class="mi">200</span><span class="p">}</span>
    <span class="k">assert</span> <span class="p">(</span><span class="n">result4</span><span class="o">==</span><span class="p">(</span><span class="n">X</span><span class="o">+</span><span class="mi">200</span><span class="p">))</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>

    <span class="n">os</span><span class="o">.</span><span class="n">remove</span> <span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">path_results</span><span class="si">}</span><span class="s1">/whole/transform_with_fit_apply2_result.pk&#39;</span><span class="p">)</span>

    <span class="n">tr3</span> <span class="o">=</span> <span class="n">TransformWithFitApply2</span> <span class="p">(</span><span class="n">path_results</span><span class="o">=</span><span class="n">path_results</span><span class="p">,</span> <span class="n">error_if_fit_func</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">error_if_apply_func</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                  <span class="n">error_if_fit_apply_func</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">with</span> <span class="n">pytest</span><span class="o">.</span><span class="n">raises</span> <span class="p">(</span><span class="ne">RuntimeError</span><span class="p">):</span>
        <span class="n">_</span> <span class="o">=</span> <span class="n">tr3</span><span class="o">.</span><span class="n">apply</span> <span class="p">(</span><span class="n">X</span><span class="p">)</span>
    <span class="k">with</span> <span class="n">pytest</span><span class="o">.</span><span class="n">raises</span> <span class="p">(</span><span class="ne">RuntimeError</span><span class="p">):</span>
        <span class="n">_</span> <span class="o">=</span> <span class="n">tr3</span><span class="o">.</span><span class="n">fit_apply</span> <span class="p">(</span><span class="n">X</span><span class="p">)</span>
    <span class="n">tr3</span><span class="o">.</span><span class="n">error_if_fit_apply_func</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">result5</span> <span class="o">=</span> <span class="n">tr3</span><span class="o">.</span><span class="n">fit_apply</span> <span class="p">(</span><span class="n">X</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">tr3</span><span class="o">.</span><span class="n">estimator</span><span class="o">==</span><span class="p">{</span><span class="s1">&#39;sum&#39;</span><span class="p">:</span> <span class="mi">200</span><span class="p">}</span>
    <span class="k">assert</span> <span class="p">(</span><span class="n">result5</span><span class="o">==</span><span class="p">(</span><span class="n">X</span><span class="o">+</span><span class="mi">200</span><span class="p">))</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>

    <span class="k">assert</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span> <span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">path_results</span><span class="si">}</span><span class="s1">/whole&#39;</span><span class="p">)</span><span class="o">==</span><span class="p">[</span><span class="s1">&#39;transform_with_fit_apply2_result.pk&#39;</span><span class="p">]</span>
    <span class="k">assert</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span> <span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">path_results</span><span class="si">}</span><span class="s1">/models&#39;</span><span class="p">)</span><span class="o">==</span><span class="p">[</span><span class="s1">&#39;transform_with_fit_apply2_estimator.pk&#39;</span><span class="p">]</span>

    <span class="n">remove_previous_results</span> <span class="p">(</span><span class="n">path_results</span><span class="p">)</span>

    <span class="n">tr4</span> <span class="o">=</span> <span class="n">TransformWithFitApply2</span> <span class="p">(</span><span class="n">path_results</span><span class="o">=</span><span class="n">path_results</span><span class="p">,</span> <span class="n">error_if_fit_func</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">error_if_apply_func</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                  <span class="n">error_if_fit_apply_func</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">result6</span> <span class="o">=</span> <span class="n">tr4</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">)</span><span class="o">.</span><span class="n">apply</span> <span class="p">(</span><span class="n">X</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">tr4</span><span class="o">.</span><span class="n">estimator</span><span class="o">==</span><span class="p">{</span><span class="s1">&#39;sum&#39;</span><span class="p">:</span> <span class="mi">200</span><span class="p">}</span>
    <span class="k">assert</span> <span class="p">(</span><span class="n">result6</span><span class="o">==</span><span class="p">(</span><span class="n">X</span><span class="o">+</span><span class="mi">200</span><span class="p">))</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
    <span class="k">assert</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span> <span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">path_results</span><span class="si">}</span><span class="s1">/whole&#39;</span><span class="p">)</span><span class="o">==</span><span class="p">[</span><span class="s1">&#39;transform_with_fit_apply2_result.pk&#39;</span><span class="p">]</span>
    <span class="k">assert</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span> <span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">path_results</span><span class="si">}</span><span class="s1">/models&#39;</span><span class="p">)</span><span class="o">==</span><span class="p">[</span><span class="s1">&#39;transform_with_fit_apply2_estimator.pk&#39;</span><span class="p">]</span>

    <span class="n">remove_previous_results</span> <span class="p">(</span><span class="n">path_results</span><span class="p">)</span>

    <span class="n">tr5</span> <span class="o">=</span> <span class="n">TransformWithoutFitApply2</span> <span class="p">(</span><span class="n">path_results</span><span class="o">=</span><span class="n">path_results</span><span class="p">,</span> <span class="n">error_if_fit_func</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">error_if_apply_func</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">result7</span> <span class="o">=</span> <span class="n">tr5</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">)</span><span class="o">.</span><span class="n">apply</span> <span class="p">(</span><span class="n">X</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">tr5</span><span class="o">.</span><span class="n">estimator</span><span class="o">==</span><span class="p">{</span><span class="s1">&#39;sum&#39;</span><span class="p">:</span> <span class="mi">200</span><span class="p">}</span>
    <span class="k">assert</span> <span class="p">(</span><span class="n">result7</span><span class="o">==</span><span class="p">(</span><span class="n">X</span><span class="o">+</span><span class="mi">200</span><span class="p">))</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
    <span class="k">assert</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span> <span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">path_results</span><span class="si">}</span><span class="s1">/whole&#39;</span><span class="p">)</span><span class="o">==</span><span class="p">[</span><span class="s1">&#39;transform_without_fit_apply2_result.pk&#39;</span><span class="p">]</span>
    <span class="k">assert</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span> <span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">path_results</span><span class="si">}</span><span class="s1">/models&#39;</span><span class="p">)</span><span class="o">==</span><span class="p">[</span><span class="s1">&#39;transform_without_fit_apply2_estimator.pk&#39;</span><span class="p">]</span>

    <span class="n">remove_previous_results</span> <span class="p">(</span><span class="n">path_results</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">tst</span><span class="o">.</span><span class="n">run</span> <span class="p">(</span><span class="n">test_component_run_depend_on_existence</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="s1">&#39;dummy&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>running test_component_run_depend_on_existence
running _fit_apply
running _fit_apply
running _fit_apply
running _fit
running _apply
running _fit
running _apply
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Logger">Logger<a class="anchor-link" href="#Logger"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="test_component_logger" class="doc_header"><code>test_component_logger</code><a href="https://github.com/Jaume-JCI/ds-blocks/tree/main/dsblocks/tests/core/test_components.py#L594" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>test_component_logger</code>(<strong><code>component_save_data</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1">#@pytest.mark.reference_fails</span>
<span class="k">def</span> <span class="nf">test_component_logger</span> <span class="p">(</span><span class="n">component_save_data</span><span class="p">):</span>
    
    <span class="n">X</span> <span class="o">=</span> <span class="n">component_save_data</span>
    
    <span class="n">tr1</span> <span class="o">=</span> <span class="n">Transform1</span> <span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">tr1</span><span class="o">.</span><span class="n">fit</span> <span class="p">(</span><span class="n">X</span><span class="p">)</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">tr1</span><span class="o">.</span><span class="n">apply</span> <span class="p">(</span><span class="n">X</span><span class="p">)</span>

    <span class="n">tr1</span> <span class="o">=</span> <span class="n">Transform1</span> <span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">tr1</span><span class="o">.</span><span class="n">fit</span> <span class="p">(</span><span class="n">X</span><span class="p">)</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">tr1</span><span class="o">.</span><span class="n">apply</span> <span class="p">(</span><span class="n">X</span><span class="p">)</span>

    <span class="n">tr1</span> <span class="o">=</span> <span class="n">Transform1</span> <span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">tr1</span><span class="o">.</span><span class="n">fit</span> <span class="p">(</span><span class="n">X</span><span class="p">)</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">tr1</span><span class="o">.</span><span class="n">apply</span> <span class="p">(</span><span class="n">X</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">tst</span><span class="o">.</span><span class="n">run</span> <span class="p">(</span><span class="n">test_component_logger</span><span class="p">,</span> <span class="n">component_save_data</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="s1">&#39;dummy&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>running test_component_logger
running _fit
running _apply
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>fitting transform_without_fit_apply2 (using whole data)
fitting transform_without_fit_apply2 (using whole data)
applying transform_without_fit_apply2 (on whole data)
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>running _fit
running _apply
running _fit
running _apply
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Passing-data_converter-and-data_io">Passing data_converter and data_io<a class="anchor-link" href="#Passing-data_converter-and-data_io"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="test_component_data_converter" class="doc_header"><code>test_component_data_converter</code><a href="https://github.com/Jaume-JCI/ds-blocks/tree/main/dsblocks/tests/core/test_components.py#L612" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>test_component_data_converter</code>()</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1">#@pytest.mark.reference_fails</span>
<span class="k">def</span> <span class="nf">test_component_data_converter</span> <span class="p">():</span>
    <span class="k">class</span> <span class="nc">MyTransform</span> <span class="p">(</span><span class="n">Component</span><span class="p">):</span>
        <span class="k">def</span> <span class="fm">__init__</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
            <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span> <span class="p">(</span><span class="n">data_converter</span><span class="o">=</span><span class="s1">&#39;PandasConverter&#39;</span><span class="p">,</span>
                              <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">def</span> <span class="nf">_apply</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">x</span><span class="o">*</span><span class="mi">2</span>

    <span class="n">my_transform</span> <span class="o">=</span> <span class="n">MyTransform</span> <span class="p">(</span><span class="n">separate_labels</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">my_transform</span><span class="o">.</span><span class="n">data_converter</span><span class="o">.</span><span class="n">separate_labels</span> <span class="ow">is</span> <span class="kc">False</span>
    <span class="k">assert</span> <span class="nb">type</span><span class="p">(</span><span class="n">my_transform</span><span class="o">.</span><span class="n">data_converter</span><span class="p">)</span> <span class="ow">is</span> <span class="n">PandasConverter</span>

    <span class="c1"># example where data-converter uses class-specific parameters</span>
    <span class="n">config</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">separate_labels</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">MyTransform</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">separate_labels</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
    <span class="n">my_transform</span> <span class="o">=</span> <span class="n">MyTransform</span> <span class="p">(</span><span class="o">**</span><span class="n">config</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">my_transform</span><span class="o">.</span><span class="n">data_converter</span><span class="o">.</span><span class="n">separate_labels</span> <span class="ow">is</span> <span class="kc">True</span>
    <span class="k">assert</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;separate_labels&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">False</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">tst</span><span class="o">.</span><span class="n">run</span> <span class="p">(</span><span class="n">test_component_data_converter</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="s1">&#39;dummy&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>running test_component_data_converter
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="test_component_data_io" class="doc_header"><code>test_component_data_io</code><a href="https://github.com/Jaume-JCI/ds-blocks/tree/main/dsblocks/tests/core/test_components.py#L633" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>test_component_data_io</code>()</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># exports tests.core.test_components</span>
<span class="c1">#@pytest.mark.reference_fails</span>
<span class="k">def</span> <span class="nf">test_component_data_io</span> <span class="p">():</span>
    <span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
    <span class="kn">from</span> <span class="nn">dsblocks.utils.utils</span> <span class="kn">import</span> <span class="n">remove_previous_results</span>

    <span class="n">path_results</span> <span class="o">=</span> <span class="s1">&#39;test_data_io&#39;</span>
    <span class="n">remove_previous_results</span> <span class="p">(</span><span class="n">path_results</span><span class="o">=</span><span class="n">path_results</span><span class="p">)</span>

    <span class="k">class</span> <span class="nc">MyTransform</span> <span class="p">(</span><span class="n">Component</span><span class="p">):</span>
        <span class="k">def</span> <span class="fm">__init__</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
            <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span> <span class="p">(</span><span class="n">result_io</span><span class="o">=</span><span class="s1">&#39;pandas&#39;</span><span class="p">,</span>
                              <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">def</span> <span class="nf">_fit</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">estimator</span> <span class="o">=</span> <span class="n">Bunch</span><span class="p">(</span><span class="nb">sum</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">_apply</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span> <span class="p">([[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">],[</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">]],</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">,</span><span class="s1">&#39;b&#39;</span><span class="p">])</span>

    <span class="n">my_transform</span> <span class="o">=</span> <span class="n">MyTransform</span> <span class="p">(</span><span class="n">path_results</span><span class="o">=</span><span class="s1">&#39;do_not_use&#39;</span><span class="p">,</span> <span class="n">MyTransform</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">path_results</span><span class="o">=</span><span class="n">path_results</span><span class="p">))</span>
    <span class="n">my_transform</span><span class="o">.</span><span class="n">fit</span> <span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span> <span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">path_results</span><span class="si">}</span><span class="s1">/models&#39;</span><span class="p">)</span><span class="o">==</span><span class="p">[</span><span class="s1">&#39;my_transform_estimator.pk&#39;</span><span class="p">]</span>

    <span class="n">df1</span> <span class="o">=</span> <span class="n">my_transform</span><span class="o">.</span><span class="n">apply</span> <span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span> <span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">path_results</span><span class="si">}</span><span class="s1">/whole&#39;</span><span class="p">)</span><span class="o">==</span><span class="p">[</span><span class="s1">&#39;my_transform_result.parquet&#39;</span><span class="p">]</span>

    <span class="k">assert</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span> <span class="p">(</span><span class="s1">&#39;do_not_use&#39;</span><span class="p">)</span>

    <span class="k">del</span> <span class="n">my_transform</span>
    <span class="n">my_transform</span> <span class="o">=</span> <span class="n">MyTransform</span> <span class="p">(</span><span class="n">path_results</span><span class="o">=</span><span class="s1">&#39;do_not_use&#39;</span><span class="p">,</span> <span class="n">MyTransform</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">path_results</span><span class="o">=</span><span class="n">path_results</span><span class="p">))</span>
    <span class="c1">#assert my_transform.estimator is None</span>
    <span class="n">my_transform</span><span class="o">.</span><span class="n">load_estimator</span><span class="p">()</span>
    <span class="k">assert</span> <span class="n">my_transform</span><span class="o">.</span><span class="n">estimator</span> <span class="o">==</span> <span class="n">Bunch</span><span class="p">(</span><span class="nb">sum</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>

    <span class="n">df2</span> <span class="o">=</span> <span class="n">my_transform</span><span class="o">.</span><span class="n">load_result</span> <span class="p">()</span>
    <span class="n">pd</span><span class="o">.</span><span class="n">testing</span><span class="o">.</span><span class="n">assert_frame_equal</span> <span class="p">(</span><span class="n">df1</span><span class="p">,</span> <span class="n">df2</span><span class="p">)</span>

    <span class="n">remove_previous_results</span> <span class="p">(</span><span class="n">path_results</span><span class="o">=</span><span class="n">path_results</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">tst</span><span class="o">.</span><span class="n">run</span> <span class="p">(</span><span class="n">test_component_data_io</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="s1">&#39;dummy&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>running test_component_data_io
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="assert_equal">assert_equal<a class="anchor-link" href="#assert_equal"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="test_component_equal" class="doc_header"><code>test_component_equal</code><a href="https://github.com/Jaume-JCI/ds-blocks/tree/main/dsblocks/tests/core/test_components.py#L672" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>test_component_equal</code>()</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1">#@pytest.mark.reference_fails</span>
<span class="k">def</span> <span class="nf">test_component_equal</span> <span class="p">():</span>
    <span class="n">path_results</span> <span class="o">=</span> <span class="s1">&#39;assert_equal&#39;</span>
    <span class="n">remove_previous_results</span> <span class="p">(</span><span class="n">path_results</span><span class="o">=</span><span class="n">path_results</span><span class="p">)</span>

    <span class="k">class</span> <span class="nc">MyTransform</span> <span class="p">(</span><span class="n">Component</span><span class="p">):</span>
        <span class="k">def</span> <span class="fm">__init__</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">noise</span><span class="o">=</span><span class="mf">1e-10</span><span class="p">,</span> <span class="n">different</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
            <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span> <span class="p">(</span><span class="n">result_io</span><span class="o">=</span><span class="s1">&#39;pandas&#39;</span><span class="p">,</span>
                              <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">def</span> <span class="nf">_fit</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">estimator</span> <span class="o">=</span> <span class="n">Bunch</span><span class="p">(</span><span class="nb">sum</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">_generate_noise</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
                <span class="n">noise</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">()</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">noise</span>
                <span class="k">if</span> <span class="n">noise</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">noise</span><span class="o">/</span><span class="mi">10</span><span class="p">:</span>
                    <span class="k">break</span>
            <span class="k">return</span> <span class="n">noise</span>

        <span class="k">def</span> <span class="nf">_apply</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
            <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span> <span class="p">([[</span><span class="mf">1.0</span><span class="p">,</span><span class="mf">2.0</span><span class="p">],[</span><span class="mf">3.0</span><span class="p">,</span><span class="mf">4.0</span><span class="p">]],</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">,</span><span class="s1">&#39;b&#39;</span><span class="p">])</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_generate_noise</span> <span class="p">()</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">different</span><span class="p">:</span>
                <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">+</span><span class="mi">10</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mf">10.0</span><span class="p">,</span><span class="mf">20.0</span><span class="p">],[</span><span class="mf">30.0</span><span class="p">,</span><span class="mf">40.0</span><span class="p">]])</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_generate_noise</span> <span class="p">()</span>
            <span class="n">result</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">sequence</span><span class="o">=</span><span class="p">[[</span><span class="mf">1.0</span><span class="p">,</span><span class="mf">2.0</span><span class="p">],</span> <span class="n">x</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="nb">dict</span><span class="p">(</span><span class="n">vector</span><span class="o">=</span><span class="n">x</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">df</span><span class="p">)],</span>
                          <span class="n">array</span><span class="o">=</span><span class="n">x</span><span class="o">+</span><span class="mi">10</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">result</span>

    <span class="n">tr</span> <span class="o">=</span> <span class="n">MyTransform</span> <span class="p">()</span>
    <span class="n">tr2</span><span class="o">=</span> <span class="n">MyTransform</span> <span class="p">()</span>
    <span class="n">tr</span><span class="o">.</span><span class="n">assert_equal</span> <span class="p">(</span><span class="n">tr</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">tr2</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">significant_digits</span><span class="o">=</span><span class="mi">7</span><span class="p">)</span>

    <span class="kn">import</span> <span class="nn">pytest</span>
    <span class="k">with</span> <span class="n">pytest</span><span class="o">.</span><span class="n">raises</span> <span class="p">(</span><span class="ne">AssertionError</span><span class="p">):</span>
        <span class="n">tr</span> <span class="o">=</span> <span class="n">MyTransform</span> <span class="p">(</span><span class="n">noise</span><span class="o">=</span><span class="mf">1e-3</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">tr2</span><span class="o">=</span> <span class="n">MyTransform</span> <span class="p">(</span><span class="n">noise</span><span class="o">=</span><span class="mf">1e-3</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">tr</span><span class="o">.</span><span class="n">assert_equal</span> <span class="p">(</span><span class="n">tr</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">tr2</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">significant_digits</span><span class="o">=</span><span class="mi">7</span><span class="p">)</span>

    <span class="k">with</span> <span class="n">pytest</span><span class="o">.</span><span class="n">raises</span> <span class="p">(</span><span class="ne">AssertionError</span><span class="p">):</span>
        <span class="n">tr</span> <span class="o">=</span> <span class="n">MyTransform</span> <span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">different</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">tr2</span><span class="o">=</span> <span class="n">MyTransform</span> <span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">tr</span><span class="o">.</span><span class="n">assert_equal</span> <span class="p">(</span><span class="n">tr</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">tr2</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>

    <span class="n">result</span> <span class="o">=</span> <span class="n">tr</span><span class="o">.</span><span class="n">assert_equal</span> <span class="p">(</span><span class="n">tr</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">tr2</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">raise_error</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">result</span> <span class="ow">is</span> <span class="kc">False</span>
    <span class="n">remove_previous_results</span> <span class="p">(</span><span class="n">path_results</span><span class="o">=</span><span class="n">path_results</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">tst</span><span class="o">.</span><span class="n">run</span> <span class="p">(</span><span class="n">test_component_equal</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="s1">&#39;dummy&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>running test_component_equal
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>comparing results for my_transform
comparing results for my_transform
comparing results for my_transform
Component my_transform =&gt; results are different: [sequence] [2] [data] DataFrame.iloc[:, 0] (column name=&#34;a&#34;) are different

DataFrame.iloc[:, 0] (column name=&#34;a&#34;) values are different (100.0 %)
[index]: [0, 1]
[left]:  [11.000000000089063, 13.000000000089063]
[right]: [1.0000000000291787, 3.000000000029179]
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="set_paths">set_paths<a class="anchor-link" href="#set_paths"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="test_set_paths" class="doc_header"><code>test_set_paths</code><a href="https://github.com/Jaume-JCI/ds-blocks/tree/main/dsblocks/tests/core/test_components.py#L720" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>test_set_paths</code>()</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1">#@pytest.mark.reference_fails</span>
<span class="k">def</span> <span class="nf">test_set_paths</span> <span class="p">():</span>
    <span class="k">def</span> <span class="nf">assert_paths</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">path_results</span><span class="p">,</span> <span class="n">path_models</span><span class="p">):</span>
        <span class="n">base</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">x</span><span class="o">.</span><span class="n">path_results</span><span class="o">==</span><span class="n">Path</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">base</span><span class="si">}</span><span class="s1">/</span><span class="si">{</span><span class="n">path_results</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">x</span><span class="o">.</span><span class="n">data_io</span><span class="o">.</span><span class="n">path_results</span><span class="o">==</span><span class="n">Path</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">base</span><span class="si">}</span><span class="s1">/</span><span class="si">{</span><span class="n">path_results</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">x</span><span class="o">.</span><span class="n">path_models</span><span class="o">==</span><span class="n">Path</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">base</span><span class="si">}</span><span class="s1">/</span><span class="si">{</span><span class="n">path_models</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">x</span><span class="o">.</span><span class="n">data_io</span><span class="o">.</span><span class="n">path_models</span><span class="o">==</span><span class="n">Path</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">base</span><span class="si">}</span><span class="s1">/</span><span class="si">{</span><span class="n">path_models</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

    <span class="n">path_results</span> <span class="o">=</span> <span class="s1">&#39;test_set_paths_1&#39;</span>
    <span class="n">path_models</span> <span class="o">=</span> <span class="s1">&#39;test_set_paths_1&#39;</span>
    <span class="n">tr</span> <span class="o">=</span> <span class="n">Component</span> <span class="p">(</span><span class="n">path_results</span><span class="o">=</span><span class="n">path_results</span><span class="p">)</span>
    <span class="n">assert_paths</span> <span class="p">(</span><span class="n">tr</span><span class="p">,</span> <span class="n">path_results</span><span class="p">,</span> <span class="n">path_models</span><span class="p">)</span>
    <span class="n">path_results</span> <span class="o">=</span> <span class="s1">&#39;test_set_paths_2&#39;</span>
    <span class="n">tr</span><span class="o">.</span><span class="n">data_io</span><span class="o">.</span><span class="n">set_path_results</span> <span class="p">(</span><span class="n">path_results</span><span class="p">)</span>
    <span class="n">assert_paths</span> <span class="p">(</span><span class="n">tr</span><span class="p">,</span> <span class="n">path_results</span><span class="p">,</span> <span class="n">path_models</span><span class="p">)</span>
    <span class="n">path_models</span><span class="o">=</span><span class="s1">&#39;test_set_paths_models_1&#39;</span>
    <span class="n">tr</span><span class="o">.</span><span class="n">data_io</span><span class="o">.</span><span class="n">set_path_models</span> <span class="p">(</span><span class="n">path_models</span><span class="p">)</span>
    <span class="n">assert_paths</span> <span class="p">(</span><span class="n">tr</span><span class="p">,</span> <span class="n">path_results</span><span class="p">,</span> <span class="n">path_models</span><span class="p">)</span>

    <span class="n">path_results</span> <span class="o">=</span> <span class="s1">&#39;test_set_paths_a&#39;</span>
    <span class="n">path_models</span> <span class="o">=</span> <span class="s1">&#39;test_set_paths_models_a&#39;</span>
    <span class="n">tr</span> <span class="o">=</span> <span class="n">Component</span> <span class="p">(</span><span class="n">path_results</span><span class="o">=</span><span class="n">path_results</span><span class="p">,</span> <span class="n">path_models</span><span class="o">=</span><span class="n">path_models</span><span class="p">)</span>
    <span class="n">assert_paths</span> <span class="p">(</span><span class="n">tr</span><span class="p">,</span> <span class="n">path_results</span><span class="p">,</span> <span class="n">path_models</span><span class="p">)</span>

    <span class="n">path_results</span> <span class="o">=</span> <span class="s1">&#39;test_set_paths_b&#39;</span>
    <span class="n">tr</span><span class="o">.</span><span class="n">data_io</span><span class="o">.</span><span class="n">set_path_results</span> <span class="p">(</span><span class="n">path_results</span><span class="p">)</span>
    <span class="n">assert_paths</span> <span class="p">(</span><span class="n">tr</span><span class="p">,</span> <span class="n">path_results</span><span class="p">,</span> <span class="n">path_models</span><span class="p">)</span>

    <span class="n">path_models</span> <span class="o">=</span> <span class="s1">&#39;test_set_paths_models_b&#39;</span>
    <span class="n">tr</span><span class="o">.</span><span class="n">data_io</span><span class="o">.</span><span class="n">set_path_models</span> <span class="p">(</span><span class="n">path_models</span><span class="p">)</span>
    <span class="n">assert_paths</span> <span class="p">(</span><span class="n">tr</span><span class="p">,</span> <span class="n">path_results</span><span class="p">,</span> <span class="n">path_models</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">tst</span><span class="o">.</span><span class="n">run</span> <span class="p">(</span><span class="n">test_set_paths</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="s1">&#39;dummy&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>running test_set_paths
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="determine-fit-function">determine fit function<a class="anchor-link" href="#determine-fit-function"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="TransformWithoutFit" class="doc_header"><code>class</code> <code>TransformWithoutFit</code><a href="https://github.com/Jaume-JCI/ds-blocks/tree/main/dsblocks/tests/core/test_components.py#L755" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>TransformWithoutFit</code>(<strong><code>factor</code></strong>=<em><code>2</code></em>, <strong>**<code>kwargs</code></strong>) :: <a href="/components.html#Component"><code>Component</code></a></p>
</blockquote>

<pre><code>Base component class used in our Pipeline.</code></pre>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="TransformWithFitApplyOnly" class="doc_header"><code>class</code> <code>TransformWithFitApplyOnly</code><a href="https://github.com/Jaume-JCI/ds-blocks/tree/main/dsblocks/tests/core/test_components.py#L761" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>TransformWithFitApplyOnly</code>(<strong>**<code>kwargs</code></strong>) :: <a href="/components.html#Component"><code>Component</code></a></p>
</blockquote>

<pre><code>Base component class used in our Pipeline.</code></pre>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="test_determine_fit_function" class="doc_header"><code>test_determine_fit_function</code><a href="https://github.com/Jaume-JCI/ds-blocks/tree/main/dsblocks/tests/core/test_components.py#L770" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>test_determine_fit_function</code>()</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="test_use_fit_from_loaded_estimator" class="doc_header"><code>test_use_fit_from_loaded_estimator</code><a href="https://github.com/Jaume-JCI/ds-blocks/tree/main/dsblocks/tests/core/test_components.py#L808" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>test_use_fit_from_loaded_estimator</code>()</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">dsblocks.utils.dummies</span> <span class="kn">import</span> <span class="n">DummyEstimator</span>

<span class="k">class</span> <span class="nc">TransformWithoutFit</span> <span class="p">(</span><span class="n">Component</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">factor</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span> <span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_apply</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">X</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">factor</span>
    
<span class="k">class</span> <span class="nc">TransformWithFitApplyOnly</span> <span class="p">(</span><span class="n">Component</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span> <span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_apply</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">X</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">sum</span>
    <span class="k">def</span> <span class="nf">_fit_apply</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sum</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">*</span><span class="mi">10</span>
        <span class="k">return</span> <span class="n">X</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">sum</span>
    
<span class="k">def</span> <span class="nf">test_determine_fit_function</span> <span class="p">():</span>
    <span class="c1"># example when there is _fit implemented</span>
    <span class="n">component</span> <span class="o">=</span> <span class="n">TransformWithoutFitApply</span> <span class="p">()</span>
    <span class="n">X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span> <span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">])</span>
    <span class="n">component</span><span class="o">.</span><span class="n">fit</span> <span class="p">(</span><span class="n">X</span><span class="p">)</span>
    <span class="n">X2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span> <span class="p">([</span><span class="mi">10</span><span class="p">,</span><span class="mi">20</span><span class="p">,</span><span class="mi">30</span><span class="p">])</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">component</span> <span class="p">(</span><span class="n">X2</span><span class="p">)</span>
    <span class="k">assert</span> <span class="p">(</span><span class="n">r</span> <span class="o">==</span> <span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">+</span> <span class="n">X2</span><span class="p">))</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
    <span class="k">assert</span> <span class="n">component</span><span class="o">.</span><span class="n">is_model</span>

    <span class="c1"># example when there is estimator</span>
    <span class="n">component</span> <span class="o">=</span> <span class="n">Component</span> <span class="p">(</span><span class="n">DummyEstimator</span> <span class="p">(</span><span class="mi">2</span><span class="p">))</span>
    <span class="n">X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span> <span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">])</span>
    <span class="n">component</span><span class="o">.</span><span class="n">fit</span> <span class="p">(</span><span class="n">X</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">component</span><span class="o">.</span><span class="n">estimator</span><span class="o">.</span><span class="n">sum</span> <span class="o">==</span> <span class="mi">6</span>
    <span class="n">X2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span> <span class="p">([</span><span class="mi">10</span><span class="p">,</span><span class="mi">20</span><span class="p">,</span><span class="mi">30</span><span class="p">])</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">component</span> <span class="p">(</span><span class="n">X2</span><span class="p">)</span>
    <span class="k">assert</span> <span class="p">(</span><span class="n">r</span> <span class="o">==</span> <span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">+</span> <span class="n">X2</span><span class="o">*</span><span class="mi">2</span><span class="p">))</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
    <span class="k">assert</span> <span class="n">component</span><span class="o">.</span><span class="n">is_model</span>

    <span class="c1"># example when there is no _fit implemented, and there is no estimator</span>
    <span class="n">component</span> <span class="o">=</span> <span class="n">TransformWithoutFit</span> <span class="p">()</span>
    <span class="n">X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span> <span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">])</span>
    <span class="n">component</span><span class="o">.</span><span class="n">fit</span> <span class="p">(</span><span class="n">X</span><span class="p">)</span>
    <span class="n">X2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span> <span class="p">([</span><span class="mi">10</span><span class="p">,</span><span class="mi">20</span><span class="p">,</span><span class="mi">30</span><span class="p">])</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">component</span> <span class="p">(</span><span class="n">X2</span><span class="p">)</span>
    <span class="k">assert</span> <span class="p">(</span><span class="n">r</span> <span class="o">==</span> <span class="p">(</span><span class="n">X2</span><span class="o">*</span><span class="mi">2</span><span class="p">))</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
    <span class="k">assert</span> <span class="ow">not</span> <span class="n">component</span><span class="o">.</span><span class="n">is_model</span>
    <span class="k">assert</span> <span class="n">component</span><span class="o">.</span><span class="n">_fit</span> <span class="o">==</span> <span class="n">component</span><span class="o">.</span><span class="n">_fit_</span>

    <span class="c1"># example when there is only fit_apply implemented</span>
    <span class="n">component</span> <span class="o">=</span> <span class="n">TransformWithFitApplyOnly</span> <span class="p">()</span>
    <span class="n">X2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span> <span class="p">([</span><span class="mi">10</span><span class="p">,</span><span class="mi">20</span><span class="p">,</span><span class="mi">30</span><span class="p">])</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">component</span><span class="o">.</span><span class="n">fit_apply</span> <span class="p">(</span><span class="n">X2</span><span class="p">)</span>
    <span class="k">assert</span> <span class="p">(</span><span class="n">r</span> <span class="o">==</span> <span class="p">(</span><span class="n">X2</span> <span class="o">+</span> <span class="n">X2</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">*</span><span class="mi">10</span><span class="p">))</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
    <span class="k">assert</span> <span class="n">component</span><span class="o">.</span><span class="n">is_model</span>
    <span class="k">assert</span> <span class="n">component</span><span class="o">.</span><span class="n">_fit</span> <span class="o">==</span> <span class="n">component</span><span class="o">.</span><span class="n">_fit_</span>
    
<span class="k">def</span> <span class="nf">test_use_fit_from_loaded_estimator</span> <span class="p">():</span>
    <span class="n">path_models</span> <span class="o">=</span> <span class="s1">&#39;test_use_fit_from_loaded_estimator&#39;</span>
    <span class="n">component</span> <span class="o">=</span> <span class="n">Component</span> <span class="p">(</span><span class="n">DummyEstimator</span> <span class="p">(</span><span class="mi">2</span><span class="p">),</span> <span class="n">path_models</span><span class="o">=</span><span class="n">path_models</span><span class="p">)</span>
    <span class="n">X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span> <span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">])</span>
    <span class="n">component</span><span class="o">.</span><span class="n">fit</span> <span class="p">(</span><span class="n">X</span><span class="p">)</span>
    <span class="k">assert</span> <span class="p">(</span><span class="n">Path</span> <span class="p">(</span><span class="n">path_models</span><span class="p">)</span> <span class="o">/</span> <span class="s1">&#39;models&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">exists</span><span class="p">()</span>
    <span class="k">del</span> <span class="n">component</span>
    
    <span class="n">estimator1</span> <span class="o">=</span> <span class="n">DummyEstimator</span> <span class="p">(</span><span class="mi">2</span><span class="p">)</span>
    <span class="nb">print</span> <span class="p">(</span><span class="n">estimator1</span><span class="p">)</span>
    <span class="n">component</span> <span class="o">=</span> <span class="n">Component</span> <span class="p">(</span><span class="n">estimator1</span><span class="p">,</span> <span class="n">path_models</span><span class="o">=</span><span class="n">path_models</span><span class="p">)</span>
    <span class="nb">print</span> <span class="p">(</span><span class="s1">&#39;before loading&#39;</span><span class="p">)</span>
    <span class="nb">print</span> <span class="p">(</span><span class="n">component</span><span class="o">.</span><span class="n">estimator</span><span class="p">)</span>
    <span class="nb">print</span> <span class="p">(</span><span class="n">component</span><span class="o">.</span><span class="n">_fit</span><span class="p">)</span>
    <span class="nb">print</span> <span class="p">(</span><span class="n">component</span><span class="o">.</span><span class="n">result_func</span><span class="p">)</span>
    
    <span class="n">component</span><span class="o">.</span><span class="n">load_estimator</span> <span class="p">()</span>
    <span class="nb">print</span> <span class="p">(</span><span class="s1">&#39;after loading&#39;</span><span class="p">)</span>
    <span class="nb">print</span> <span class="p">(</span><span class="n">component</span><span class="o">.</span><span class="n">estimator</span><span class="p">)</span>
    <span class="nb">print</span> <span class="p">(</span><span class="n">component</span><span class="o">.</span><span class="n">_fit</span><span class="p">)</span>
    <span class="nb">print</span> <span class="p">(</span><span class="n">component</span><span class="o">.</span><span class="n">result_func</span><span class="p">)</span>
    
    <span class="k">assert</span> <span class="n">component</span><span class="o">.</span><span class="n">estimator</span><span class="o">.</span><span class="n">sum</span> <span class="o">==</span> <span class="mi">6</span>
    <span class="k">assert</span> <span class="n">component</span><span class="o">.</span><span class="n">is_model</span>
    
    <span class="n">X2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span> <span class="p">([</span><span class="mi">10</span><span class="p">,</span><span class="mi">20</span><span class="p">,</span><span class="mi">30</span><span class="p">])</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">component</span> <span class="p">(</span><span class="n">X2</span><span class="p">)</span>
    <span class="k">assert</span> <span class="p">(</span><span class="n">r</span> <span class="o">==</span> <span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">+</span> <span class="n">X2</span><span class="o">*</span><span class="mi">2</span><span class="p">))</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
    
    <span class="n">remove_previous_results</span> <span class="p">(</span><span class="n">path_models</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">tst</span><span class="o">.</span><span class="n">run</span> <span class="p">(</span><span class="n">test_determine_fit_function</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="s1">&#39;dummy&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>running test_determine_fit_function
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">tst</span><span class="o">.</span><span class="n">run</span> <span class="p">(</span><span class="n">test_use_fit_from_loaded_estimator</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="s1">&#39;dummy&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>running test_use_fit_from_loaded_estimator
&lt;dsblocks.utils.dummies.DummyEstimator object at 0x7f280a1ea050&gt;
before loading
&lt;dsblocks.utils.dummies.DummyEstimator object at 0x7f280a1ea050&gt;
&lt;bound method DummyEstimator.fit of &lt;dsblocks.utils.dummies.DummyEstimator object at 0x7f280a1ea050&gt;&gt;
&lt;bound method DummyEstimator.transform of &lt;dsblocks.utils.dummies.DummyEstimator object at 0x7f280a1ea050&gt;&gt;
after loading
&lt;dsblocks.utils.dummies.DummyEstimator object at 0x7f280a1d99d0&gt;
&lt;bound method DummyEstimator.fit of &lt;dsblocks.utils.dummies.DummyEstimator object at 0x7f280a1d99d0&gt;&gt;
&lt;bound method DummyEstimator.transform of &lt;dsblocks.utils.dummies.DummyEstimator object at 0x7f280a1d99d0&gt;&gt;
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Use-direct-methods">Use direct methods<a class="anchor-link" href="#Use-direct-methods"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="test_direct_methods" class="doc_header"><code>test_direct_methods</code><a href="https://github.com/Jaume-JCI/ds-blocks/tree/main/dsblocks/tests/core/test_components.py#L841" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>test_direct_methods</code>()</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">dsblocks.utils.dummies</span> <span class="kn">import</span> <span class="n">Multiply10direct</span><span class="p">,</span> <span class="n">Max10direct</span>
<span class="k">def</span> <span class="nf">test_direct_methods</span> <span class="p">():</span>
    <span class="c1"># input</span>
    <span class="n">X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span> <span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">])</span>
    
    <span class="c1"># example where we do not use direct methods</span>
    <span class="n">component</span> <span class="o">=</span> <span class="n">Max10direct</span> <span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">component</span><span class="o">.</span><span class="n">fit</span> <span class="p">(</span><span class="n">X</span><span class="p">)</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">component</span> <span class="p">(</span><span class="n">X</span><span class="p">)</span>
    <span class="k">assert</span> <span class="p">(</span><span class="n">r</span><span class="o">==</span><span class="n">X</span><span class="o">*</span><span class="mi">10</span><span class="o">+</span><span class="n">X</span><span class="o">.</span><span class="n">max</span><span class="p">())</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
    
    <span class="n">component</span> <span class="o">=</span> <span class="n">Max10direct</span> <span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">error_if_apply</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">component</span><span class="o">.</span><span class="n">fit</span> <span class="p">(</span><span class="n">X</span><span class="p">)</span>
    <span class="k">with</span> <span class="n">pytest</span><span class="o">.</span><span class="n">raises</span> <span class="p">(</span><span class="ne">RuntimeError</span><span class="p">):</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">component</span> <span class="p">(</span><span class="n">X</span><span class="p">)</span>
    <span class="c1">#assert component.fitted</span>
    <span class="c1">#assert component.applied</span>
    
    <span class="c1"># example where we use direct methods</span>
    <span class="n">component</span> <span class="o">=</span> <span class="n">Max10direct</span> <span class="p">(</span><span class="n">direct_apply</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">error_if_apply</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">component</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span> <span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="s2">&quot;-&quot;</span><span class="o">*</span><span class="mi">100</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">component</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span> <span class="p">(</span><span class="sa">f</span><span class="s1">&#39;direct_apply=</span><span class="si">{</span><span class="n">component</span><span class="o">.</span><span class="n">direct_apply</span><span class="si">}</span><span class="s1">, direct_fit=</span><span class="si">{</span><span class="n">component</span><span class="o">.</span><span class="n">direct_fit</span><span class="si">}</span><span class="s1">, direct_fit_apply=</span><span class="si">{</span><span class="n">component</span><span class="o">.</span><span class="n">direct_fit_apply</span><span class="si">}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">component</span><span class="o">.</span><span class="n">fit</span> <span class="p">(</span><span class="n">X</span><span class="p">)</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">component</span> <span class="p">(</span><span class="n">X</span><span class="p">)</span>
    <span class="k">assert</span> <span class="p">(</span><span class="n">r</span><span class="o">==</span><span class="n">X</span><span class="o">*</span><span class="mi">10</span><span class="o">+</span><span class="n">X</span><span class="o">.</span><span class="n">max</span><span class="p">())</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
    <span class="c1">#assert component.fitted</span>
    <span class="c1">#assert not component.applied</span>
    
    <span class="n">component</span> <span class="o">=</span> <span class="n">Max10direct</span> <span class="p">(</span><span class="n">direct_fit</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">error_if_fit</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">component</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span> <span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="s2">&quot;-&quot;</span><span class="o">*</span><span class="mi">100</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">component</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span> <span class="p">(</span><span class="sa">f</span><span class="s1">&#39;direct_apply=</span><span class="si">{</span><span class="n">component</span><span class="o">.</span><span class="n">direct_apply</span><span class="si">}</span><span class="s1">, direct_fit=</span><span class="si">{</span><span class="n">component</span><span class="o">.</span><span class="n">direct_fit</span><span class="si">}</span><span class="s1">, direct_fit_apply=</span><span class="si">{</span><span class="n">component</span><span class="o">.</span><span class="n">direct_fit_apply</span><span class="si">}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">component</span><span class="o">.</span><span class="n">fit</span> <span class="p">(</span><span class="n">X</span><span class="p">)</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">component</span><span class="o">.</span><span class="n">apply</span> <span class="p">(</span><span class="n">X</span><span class="p">)</span>
    <span class="k">assert</span> <span class="p">(</span><span class="n">r</span><span class="o">==</span><span class="n">X</span><span class="o">*</span><span class="mi">10</span><span class="o">+</span><span class="n">X</span><span class="o">.</span><span class="n">max</span><span class="p">())</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
    <span class="c1">#assert not component.fitted</span>
    <span class="c1">#assert component.applied</span>
    
    <span class="n">component</span> <span class="o">=</span> <span class="n">Max10direct</span> <span class="p">(</span><span class="n">direct_apply</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">direct_fit</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">error_if_apply</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> 
                             <span class="n">error_if_fit</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">component</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span> <span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="s2">&quot;-&quot;</span><span class="o">*</span><span class="mi">100</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">component</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span> <span class="p">(</span><span class="sa">f</span><span class="s1">&#39;direct_apply=</span><span class="si">{</span><span class="n">component</span><span class="o">.</span><span class="n">direct_apply</span><span class="si">}</span><span class="s1">, direct_fit=</span><span class="si">{</span><span class="n">component</span><span class="o">.</span><span class="n">direct_fit</span><span class="si">}</span><span class="s1">, direct_fit_apply=</span><span class="si">{</span><span class="n">component</span><span class="o">.</span><span class="n">direct_fit_apply</span><span class="si">}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">component</span><span class="o">.</span><span class="n">fit</span> <span class="p">(</span><span class="n">X</span><span class="p">)</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">component</span><span class="o">.</span><span class="n">transform</span> <span class="p">(</span><span class="n">X</span><span class="p">)</span>
    <span class="k">assert</span> <span class="p">(</span><span class="n">r</span><span class="o">==</span><span class="n">X</span><span class="o">*</span><span class="mi">10</span><span class="o">+</span><span class="n">X</span><span class="o">.</span><span class="n">max</span><span class="p">())</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
    <span class="c1">#assert not component.fitted</span>
    <span class="c1">#assert not component.applied</span>
        
    <span class="c1"># example when there is no _fit implemented and we call fit_apply</span>
    <span class="n">component</span> <span class="o">=</span> <span class="n">Multiply10direct</span> <span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">error_if_fit</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">component</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span> <span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="s2">&quot;-&quot;</span><span class="o">*</span><span class="mi">100</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">component</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span> <span class="p">(</span><span class="sa">f</span><span class="s1">&#39;direct_apply=</span><span class="si">{</span><span class="n">component</span><span class="o">.</span><span class="n">direct_apply</span><span class="si">}</span><span class="s1">, direct_fit=</span><span class="si">{</span><span class="n">component</span><span class="o">.</span><span class="n">direct_fit</span><span class="si">}</span><span class="s1">, direct_fit_apply=</span><span class="si">{</span><span class="n">component</span><span class="o">.</span><span class="n">direct_fit_apply</span><span class="si">}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">component</span><span class="o">.</span><span class="n">fit_apply</span> <span class="p">(</span><span class="n">X</span><span class="p">)</span>
    <span class="k">assert</span> <span class="p">(</span><span class="n">r</span><span class="o">==</span><span class="n">X</span><span class="o">*</span><span class="mi">10</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
    <span class="c1">#assert not component.is_model</span>
    <span class="k">assert</span> <span class="n">component</span><span class="o">.</span><span class="n">fit</span> <span class="o">==</span> <span class="n">component</span><span class="o">.</span><span class="n">_fit_</span>
    <span class="c1">#assert component.fit_apply == component.apply</span>
    <span class="n">r2</span> <span class="o">=</span> <span class="n">component</span><span class="o">.</span><span class="n">fit</span> <span class="p">(</span><span class="n">X</span><span class="p">)</span><span class="o">.</span><span class="n">apply</span> <span class="p">(</span><span class="n">X</span><span class="p">)</span>
    <span class="k">assert</span> <span class="p">(</span><span class="n">r</span><span class="o">==</span><span class="n">X</span><span class="o">*</span><span class="mi">10</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>

    <span class="c1"># example when there is no _fit implemented and we want a direct apply call</span>
    <span class="n">component</span> <span class="o">=</span> <span class="n">Multiply10direct</span> <span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">direct_apply</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">error_if_apply</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">error_if_fit</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">component</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span> <span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="s2">&quot;-&quot;</span><span class="o">*</span><span class="mi">100</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">component</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span> <span class="p">(</span><span class="sa">f</span><span class="s1">&#39;direct_apply=</span><span class="si">{</span><span class="n">component</span><span class="o">.</span><span class="n">direct_apply</span><span class="si">}</span><span class="s1">, direct_fit=</span><span class="si">{</span><span class="n">component</span><span class="o">.</span><span class="n">direct_fit</span><span class="si">}</span><span class="s1">, direct_fit_apply=</span><span class="si">{</span><span class="n">component</span><span class="o">.</span><span class="n">direct_fit_apply</span><span class="si">}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">component</span><span class="o">.</span><span class="n">fit_apply</span> <span class="p">(</span><span class="n">X</span><span class="p">)</span>
    <span class="k">assert</span> <span class="p">(</span><span class="n">r</span><span class="o">==</span><span class="n">X</span><span class="o">*</span><span class="mi">10</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
    <span class="k">assert</span> <span class="ow">not</span> <span class="n">component</span><span class="o">.</span><span class="n">is_model</span>
    <span class="k">assert</span> <span class="n">component</span><span class="o">.</span><span class="n">fit</span> <span class="o">==</span> <span class="n">component</span><span class="o">.</span><span class="n">_fit_</span>
    <span class="c1">#assert component.fit_apply == component._apply</span>
    <span class="c1">#assert component.fit_transform == component._apply</span>
    <span class="c1">#assert not component.applied</span>
    <span class="n">r2</span> <span class="o">=</span> <span class="n">component</span><span class="o">.</span><span class="n">fit</span> <span class="p">(</span><span class="n">X</span><span class="p">)</span><span class="o">.</span><span class="n">apply</span> <span class="p">(</span><span class="n">X</span><span class="p">)</span>
    <span class="k">assert</span> <span class="p">(</span><span class="n">r</span><span class="o">==</span><span class="n">X</span><span class="o">*</span><span class="mi">10</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
    <span class="c1">#assert not component.applied</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">tst</span><span class="o">.</span><span class="n">run</span> <span class="p">(</span><span class="n">test_direct_methods</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="s1">&#39;dummy&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>fitting max10direct (using whole data)
applying max10direct (on whole data)
fitting max10direct (using whole data)
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>running test_direct_methods
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>----------------------------------------------------------------------------------------------------
direct_apply=True, direct_fit=False, direct_fit_apply=False

fitting max10direct (using whole data)
----------------------------------------------------------------------------------------------------
direct_apply=False, direct_fit=True, direct_fit_apply=False

applying max10direct (on whole data)
----------------------------------------------------------------------------------------------------
direct_apply=True, direct_fit=True, direct_fit_apply=False

----------------------------------------------------------------------------------------------------
direct_apply=False, direct_fit=False, direct_fit_apply=False

applying multiply10direct (on whole data)
applying multiply10direct (on whole data)
----------------------------------------------------------------------------------------------------
direct_apply=True, direct_fit=False, direct_fit_apply=False

</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Pass-apply-function-by-parameter">Pass apply function by parameter<a class="anchor-link" href="#Pass-apply-function-by-parameter"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="test_pass_apply" class="doc_header"><code>test_pass_apply</code><a href="https://github.com/Jaume-JCI/ds-blocks/tree/main/dsblocks/tests/core/test_components.py#L915" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>test_pass_apply</code>()</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">test_pass_apply</span> <span class="p">():</span>
    <span class="n">component</span> <span class="o">=</span> <span class="n">Component</span> <span class="p">(</span><span class="n">apply</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">*</span><span class="mi">10</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">direct_apply</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">error_if_apply</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span> <span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">])</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">component</span> <span class="p">(</span><span class="n">X</span><span class="p">)</span>
    <span class="k">assert</span> <span class="p">(</span><span class="n">r</span><span class="o">==</span><span class="n">X</span><span class="o">*</span><span class="mi">10</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">tst</span><span class="o">.</span><span class="n">run</span> <span class="p">(</span><span class="n">test_pass_apply</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="s1">&#39;dummy&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>running test_pass_apply
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Get-DataIO-specific-parameters">Get DataIO specific parameters<a class="anchor-link" href="#Get-DataIO-specific-parameters"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="test_get_specific_data_io_parameters_for_component" class="doc_header"><code>test_get_specific_data_io_parameters_for_component</code><a href="https://github.com/Jaume-JCI/ds-blocks/tree/main/dsblocks/tests/core/test_components.py#L922" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>test_get_specific_data_io_parameters_for_component</code>()</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">test_get_specific_data_io_parameters_for_component</span> <span class="p">():</span>
    <span class="n">component</span> <span class="o">=</span> <span class="n">Component</span> <span class="p">(</span><span class="n">tag</span><span class="o">=</span><span class="s1">&#39;data&#39;</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">par</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">],</span> <span class="n">path_results</span><span class="o">=</span><span class="s1">&#39;hello&#39;</span><span class="p">,</span> <span class="n">path_results_data</span><span class="o">=</span><span class="s1">&#39;world&#39;</span><span class="p">,</span> 
                           <span class="n">other</span><span class="o">=</span><span class="s1">&#39;yes&#39;</span><span class="p">,</span> <span class="n">load_result_data</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">save_model_data</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">check_last_part</span><span class="p">(</span><span class="n">component</span><span class="o">.</span><span class="n">path_results</span><span class="p">,</span> <span class="s1">&#39;world&#39;</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">component</span><span class="o">.</span><span class="n">data_io</span><span class="o">.</span><span class="n">load_result_flag</span> <span class="o">==</span> <span class="kc">False</span>
    <span class="k">assert</span> <span class="n">component</span><span class="o">.</span><span class="n">data_io</span><span class="o">.</span><span class="n">save_model_flag</span> <span class="o">==</span> <span class="kc">True</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">tst</span><span class="o">.</span><span class="n">run</span> <span class="p">(</span><span class="n">test_get_specific_data_io_parameters_for_component</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="s1">&#39;dummy&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>running test_get_specific_data_io_parameters_for_component
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="get_specific_data_io_parameters">get_specific_data_io_parameters<a class="anchor-link" href="#get_specific_data_io_parameters"> </a></h4>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="test_get_specific_data_io_parameters" class="doc_header"><code>test_get_specific_data_io_parameters</code><a href="https://github.com/Jaume-JCI/ds-blocks/tree/main/dsblocks/tests/core/test_utils.py#L27" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>test_get_specific_data_io_parameters</code>()</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">test_get_specific_data_io_parameters</span> <span class="p">():</span>
    <span class="n">component</span> <span class="o">=</span> <span class="n">Component</span> <span class="p">()</span>
    <span class="n">config</span> <span class="o">=</span> <span class="n">component</span><span class="o">.</span><span class="n">get_specific_data_io_parameters</span> <span class="p">(</span>
        <span class="s1">&#39;data&#39;</span><span class="p">,</span> <span class="o">**</span><span class="nb">dict</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">par</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">],</span> <span class="n">path_results</span><span class="o">=</span><span class="s1">&#39;hello&#39;</span><span class="p">,</span> <span class="n">path_results_data</span><span class="o">=</span><span class="s1">&#39;world&#39;</span><span class="p">,</span> <span class="n">other</span><span class="o">=</span><span class="s1">&#39;yes&#39;</span><span class="p">,</span> 
                       <span class="n">load_result_data</span> <span class="o">=</span> <span class="kc">True</span><span class="p">))</span>
    <span class="k">assert</span> <span class="n">config</span> <span class="o">==</span> <span class="nb">dict</span> <span class="p">(</span><span class="n">path_results</span><span class="o">=</span><span class="s1">&#39;world&#39;</span><span class="p">,</span> <span class="n">load_result</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">tst</span><span class="o">.</span><span class="n">run</span> <span class="p">(</span><span class="n">test_get_specific_data_io_parameters</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="s1">&#39;dummy&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>running test_get_specific_data_io_parameters
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="StandardConverter">StandardConverter<a class="anchor-link" href="#StandardConverter"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="test_standard_converter_in_component" class="doc_header"><code>test_standard_converter_in_component</code><a href="https://github.com/Jaume-JCI/ds-blocks/tree/main/dsblocks/tests/core/test_components.py#L932" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>test_standard_converter_in_component</code>()</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">dsblocks.utils.dummies</span> <span class="kn">import</span> <span class="n">Min10direct</span><span class="p">,</span> <span class="n">SumXY</span>

<span class="k">def</span> <span class="nf">test_standard_converter_in_component</span> <span class="p">():</span>
    <span class="n">component</span> <span class="o">=</span> <span class="n">Min10direct</span> <span class="p">(</span><span class="n">data_converter</span><span class="o">=</span><span class="s1">&#39;StandardConverter&#39;</span><span class="p">)</span>
    
    <span class="n">X</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>

    <span class="n">Xr</span> <span class="o">=</span> <span class="n">component</span><span class="o">.</span><span class="n">fit_apply</span> <span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
    <span class="k">assert</span> <span class="p">(</span><span class="n">Xr</span><span class="o">==</span><span class="n">X</span><span class="o">*</span><span class="mi">10</span><span class="o">+</span><span class="n">X</span><span class="o">.</span><span class="n">min</span><span class="p">())</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
    
    <span class="n">Xr</span><span class="p">,</span> <span class="n">yr</span> <span class="o">=</span> <span class="n">component</span><span class="o">.</span><span class="n">fit_apply</span> <span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">sequential_fit_apply</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">assert</span> <span class="p">(</span><span class="n">Xr</span><span class="o">==</span><span class="n">X</span><span class="o">*</span><span class="mi">10</span><span class="o">+</span><span class="n">X</span><span class="o">.</span><span class="n">min</span><span class="p">())</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
    <span class="k">assert</span> <span class="p">(</span><span class="n">yr</span><span class="o">==</span><span class="n">y</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
    
    <span class="n">component</span> <span class="o">=</span> <span class="n">SumXY</span> <span class="p">(</span><span class="n">data_converter</span><span class="o">=</span><span class="s1">&#39;StandardConverter&#39;</span><span class="p">)</span>
        
    <span class="n">Xr</span> <span class="o">=</span> <span class="n">component</span><span class="o">.</span><span class="n">fit_apply</span> <span class="p">((</span><span class="n">X</span><span class="p">,</span><span class="n">X</span><span class="o">*</span><span class="mi">2</span><span class="p">),</span> <span class="n">y</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
    <span class="k">assert</span> <span class="p">(</span><span class="n">Xr</span><span class="o">==</span><span class="n">X</span><span class="o">+</span><span class="n">X</span><span class="o">*</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
    
    <span class="n">Xr</span> <span class="o">=</span> <span class="n">component</span><span class="o">.</span><span class="n">fit_apply</span> <span class="p">((</span><span class="n">X</span><span class="p">,</span><span class="n">X</span><span class="o">*</span><span class="mi">2</span><span class="p">),</span> <span class="n">y</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">sequential_fit_apply</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">assert</span> <span class="p">(</span><span class="n">Xr</span><span class="o">==</span><span class="n">X</span><span class="o">+</span><span class="n">X</span><span class="o">*</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
    
    <span class="c1">#Xr, yr = component.fit_apply ((X,X*2), y, sequential_fit_apply=True)</span>
    <span class="n">Xr</span><span class="p">,</span> <span class="n">yr</span> <span class="o">=</span> <span class="n">component</span><span class="o">.</span><span class="n">fit_apply</span> <span class="p">((</span><span class="n">X</span><span class="p">,</span><span class="n">X</span><span class="o">*</span><span class="mi">2</span><span class="p">),</span> <span class="n">y</span><span class="p">,</span> <span class="n">sequential_fit_apply</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">assert</span> <span class="p">(</span><span class="n">Xr</span><span class="o">==</span><span class="n">X</span><span class="o">+</span><span class="n">X</span><span class="o">*</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
    <span class="k">assert</span> <span class="p">(</span><span class="n">yr</span><span class="o">==</span><span class="n">y</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">tst</span><span class="o">.</span><span class="n">run</span> <span class="p">(</span><span class="n">test_standard_converter_in_component</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="s1">&#39;dummy&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>running test_standard_converter_in_component
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="set_suffix">set_suffix<a class="anchor-link" href="#set_suffix"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="test_set_suffix" class="doc_header"><code>test_set_suffix</code><a href="https://github.com/Jaume-JCI/ds-blocks/tree/main/dsblocks/tests/core/test_components.py#L958" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>test_set_suffix</code>()</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">test_set_suffix</span> <span class="p">():</span>
    <span class="n">component</span> <span class="o">=</span> <span class="n">Component</span> <span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;my_component&#39;</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">component</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;my_component&#39;</span>
    <span class="n">component</span><span class="o">.</span><span class="n">set_suffix</span> <span class="p">(</span><span class="s1">&#39;first&#39;</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">component</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;my_component_first&#39;</span>
    <span class="n">component</span><span class="o">.</span><span class="n">set_suffix</span> <span class="p">(</span><span class="s1">&#39;second&#39;</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">component</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;my_component_second&#39;</span>
    <span class="n">component</span><span class="o">.</span><span class="n">set_suffix</span> <span class="p">(</span><span class="s1">&#39;third&#39;</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">component</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;my_component_third&#39;</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">tst</span><span class="o">.</span><span class="n">run</span> <span class="p">(</span><span class="n">test_set_suffix</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="s1">&#39;dummy&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>running test_set_suffix
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="SamplingComponent">SamplingComponent<a class="anchor-link" href="#SamplingComponent"> </a></h2>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="SamplingComponent" class="doc_header"><code>class</code> <code>SamplingComponent</code><a href="https://github.com/Jaume-JCI/ds-blocks/tree/main/dsblocks/core/components.py#L640" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>SamplingComponent</code>(<strong><code>estimator</code></strong>=<em><code>None</code></em>, <strong><code>transform_uses_labels</code></strong>=<em><code>True</code></em>, <strong>**<code>kwargs</code></strong>) :: <a href="/components.html#Component"><code>Component</code></a></p>
</blockquote>

<pre><code>Component that makes use of labels in transform method.

When calling the transform method, one of the columns of the received data
is assumed to contain the ground-truth labels. This allows the transform
method to modify the number of observations, changing the number of rows in
the data and in the labels. See `PandasConverter` class in
`dsblocks.core.data_conversion`.</code></pre>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Usage-example">Usage example<a class="anchor-link" href="#Usage-example"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="test_sampling_component" class="doc_header"><code>test_sampling_component</code><a href="https://github.com/Jaume-JCI/ds-blocks/tree/main/dsblocks/tests/core/test_components.py#L970" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>test_sampling_component</code>()</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1">#@pytest.mark.reference_fails</span>
<span class="k">def</span> <span class="nf">test_sampling_component</span> <span class="p">():</span>
    <span class="n">c</span> <span class="o">=</span> <span class="n">SamplingComponent</span> <span class="p">(</span><span class="n">data_converter</span><span class="o">=</span><span class="s1">&#39;DataConverter&#39;</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">c</span><span class="o">.</span><span class="n">transform_uses_labels</span>
    <span class="k">assert</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">data_converter</span><span class="p">,</span><span class="s1">&#39;transform_uses_labels&#39;</span><span class="p">)</span>
    <span class="n">c</span> <span class="o">=</span> <span class="n">SamplingComponent</span> <span class="p">(</span><span class="n">data_converter</span><span class="o">=</span><span class="s1">&#39;PandasConverter&#39;</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">c</span><span class="o">.</span><span class="n">data_converter</span><span class="o">.</span><span class="n">transform_uses_labels</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">tst</span><span class="o">.</span><span class="n">run</span> <span class="p">(</span><span class="n">test_sampling_component</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="s1">&#39;dummy&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="SklearnComponent">SklearnComponent<a class="anchor-link" href="#SklearnComponent"> </a></h2>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="SklearnComponent" class="doc_header"><code>class</code> <code>SklearnComponent</code><a href="https://github.com/Jaume-JCI/ds-blocks/tree/main/dsblocks/core/components.py#L657" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>SklearnComponent</code>(<strong><code>estimator</code></strong>=<em><code>None</code></em>, <strong><code>data_io</code></strong>=<em><code>'SklearnIO'</code></em>, <strong><code>transform_uses_labels</code></strong>=<em><code>False</code></em>, <strong>**<code>kwargs</code></strong>) :: <a href="/components.html#Component"><code>Component</code></a></p>
</blockquote>

<pre><code>Component that saves estimator parameters in pickle format.

Convenience subclass used when the results can be saved in
pickle format. See `SklearnIO` class in `core.utils`.</code></pre>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Usage-example">Usage example<a class="anchor-link" href="#Usage-example"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="test_sklearn_component" class="doc_header"><code>test_sklearn_component</code><a href="https://github.com/Jaume-JCI/ds-blocks/tree/main/dsblocks/tests/core/test_components.py#L979" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>test_sklearn_component</code>()</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1">#@pytest.mark.reference_fails</span>
<span class="k">def</span> <span class="nf">test_sklearn_component</span> <span class="p">():</span>
    <span class="n">c</span> <span class="o">=</span> <span class="n">SklearnComponent</span> <span class="p">()</span>
    <span class="k">assert</span> <span class="n">c</span><span class="o">.</span><span class="n">data_io</span><span class="o">.</span><span class="n">fitting_load_func</span><span class="o">==</span><span class="n">joblib</span><span class="o">.</span><span class="n">load</span>
    <span class="k">assert</span> <span class="n">c</span><span class="o">.</span><span class="n">data_io</span><span class="o">.</span><span class="n">result_save_func</span><span class="o">==</span><span class="n">joblib</span><span class="o">.</span><span class="n">dump</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">tst</span><span class="o">.</span><span class="n">run</span> <span class="p">(</span><span class="n">test_sklearn_component</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="s1">&#39;dummy&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="NoSaverComponent">NoSaverComponent<a class="anchor-link" href="#NoSaverComponent"> </a></h2>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="NoSaverComponent" class="doc_header"><code>class</code> <code>NoSaverComponent</code><a href="https://github.com/Jaume-JCI/ds-blocks/tree/main/dsblocks/core/components.py#L674" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>NoSaverComponent</code>(<strong><code>estimator</code></strong>=<em><code>None</code></em>, <strong><code>data_io</code></strong>=<em><code>'NoSaverIO'</code></em>, <strong>**<code>kwargs</code></strong>) :: <a href="/components.html#Component"><code>Component</code></a></p>
</blockquote>

<pre><code>Component that does not save any data.</code></pre>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Usage-example">Usage example<a class="anchor-link" href="#Usage-example"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="test_no_saver_component" class="doc_header"><code>test_no_saver_component</code><a href="https://github.com/Jaume-JCI/ds-blocks/tree/main/dsblocks/tests/core/test_components.py#L986" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>test_no_saver_component</code>()</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1">#@pytest.mark.reference_fails</span>
<span class="k">def</span> <span class="nf">test_no_saver_component</span> <span class="p">():</span>
    <span class="n">c</span> <span class="o">=</span> <span class="n">NoSaverComponent</span> <span class="p">()</span>
    <span class="k">assert</span> <span class="n">c</span><span class="o">.</span><span class="n">data_io</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;NoSaverIO&#39;</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">tst</span><span class="o">.</span><span class="n">run</span> <span class="p">(</span><span class="n">test_no_saver_component</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="s1">&#39;dummy&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="OneClassSklearnComponent">OneClassSklearnComponent<a class="anchor-link" href="#OneClassSklearnComponent"> </a></h2>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="OneClassSklearnComponent" class="doc_header"><code>class</code> <code>OneClassSklearnComponent</code><a href="https://github.com/Jaume-JCI/ds-blocks/tree/main/dsblocks/core/components.py#L681" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>OneClassSklearnComponent</code>(<strong><code>estimator</code></strong>=<em><code>None</code></em>, <strong>**<code>kwargs</code></strong>) :: <a href="/components.html#SklearnComponent"><code>SklearnComponent</code></a></p>
</blockquote>

<pre><code>Component that uses only normal data (labelled with 0) for fitting parameters.</code></pre>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Usage-example">Usage example<a class="anchor-link" href="#Usage-example"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="get_data_for_one_class" class="doc_header"><code>get_data_for_one_class</code><a href="https://github.com/Jaume-JCI/ds-blocks/tree/main/dsblocks/tests/core/test_components.py#L993" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>get_data_for_one_class</code>()</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="test_one_class_sklearn_component" class="doc_header"><code>test_one_class_sklearn_component</code><a href="https://github.com/Jaume-JCI/ds-blocks/tree/main/dsblocks/tests/core/test_components.py#L998" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>test_one_class_sklearn_component</code>()</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1">#@pytest.mark.reference_fails</span>

<span class="k">def</span> <span class="nf">get_data_for_one_class</span> <span class="p">():</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">r_</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span> <span class="p">((</span><span class="mi">5</span><span class="p">,</span><span class="mi">2</span><span class="p">)),</span> <span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="mi">5</span><span class="p">,</span><span class="mi">2</span><span class="p">))]</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">r_</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span> <span class="p">((</span><span class="mi">5</span><span class="p">,)),</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">5</span><span class="p">,))]</span>
    <span class="k">return</span> <span class="n">data</span><span class="p">,</span> <span class="n">y</span>

<span class="k">def</span> <span class="nf">test_one_class_sklearn_component</span> <span class="p">():</span>
    <span class="n">path_results</span> <span class="o">=</span> <span class="s1">&#39;one_class_sklearn_component&#39;</span>
    <span class="n">remove_previous_results</span> <span class="p">(</span><span class="n">path_results</span><span class="o">=</span><span class="n">path_results</span><span class="p">)</span>
    
    <span class="n">data</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">get_data_for_one_class</span> <span class="p">()</span>
    <span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">MinMaxScaler</span>
    <span class="n">result1</span> <span class="o">=</span> <span class="n">OneClassSklearnComponent</span> <span class="p">(</span><span class="n">MinMaxScaler</span><span class="p">())</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="n">y</span><span class="p">)</span><span class="o">.</span><span class="n">transform</span> <span class="p">(</span><span class="n">data</span><span class="p">)</span>
    <span class="n">result2</span> <span class="o">=</span> <span class="n">MinMaxScaler</span><span class="p">()</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">y</span><span class="o">==</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">transform</span> <span class="p">(</span><span class="n">data</span><span class="p">)</span>
    <span class="k">assert</span> <span class="p">(</span><span class="n">result1</span><span class="o">==</span><span class="n">result2</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
    
    <span class="n">remove_previous_results</span> <span class="p">(</span><span class="n">path_results</span><span class="o">=</span><span class="n">path_results</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">tst</span><span class="o">.</span><span class="n">run</span> <span class="p">(</span><span class="n">test_one_class_sklearn_component</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="s1">&#39;dummy&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="PandasComponent">PandasComponent<a class="anchor-link" href="#PandasComponent"> </a></h2>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="PandasComponent" class="doc_header"><code>class</code> <code>PandasComponent</code><a href="https://github.com/Jaume-JCI/ds-blocks/tree/main/dsblocks/core/components.py#L694" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>PandasComponent</code>(<strong><code>estimator</code></strong>=<em><code>None</code></em>, <strong><code>data_converter</code></strong>=<em><code>'PandasConverter'</code></em>, <strong><code>data_io</code></strong>=<em><code>'PandasIO'</code></em>, <strong>**<code>kwargs</code></strong>) :: <a href="/components.html#Component"><code>Component</code></a></p>
</blockquote>

<pre><code>Component that preserves the DataFrame format for incoming data and results.

This component also writes results in parquet format, by default.
See `PandasConverter` in `core.data_conversion` for details on the data
conversion performed.</code></pre>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Usage-example">Usage example<a class="anchor-link" href="#Usage-example"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="test_pandas_component" class="doc_header"><code>test_pandas_component</code><a href="https://github.com/Jaume-JCI/ds-blocks/tree/main/dsblocks/tests/core/test_components.py#L1012" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>test_pandas_component</code>()</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1">#@pytest.mark.reference_fails</span>
<span class="k">def</span> <span class="nf">test_pandas_component</span> <span class="p">():</span>
    <span class="n">c</span> <span class="o">=</span> <span class="n">PandasComponent</span> <span class="p">()</span>
    <span class="k">assert</span> <span class="n">c</span><span class="o">.</span><span class="n">data_converter</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;PandasConverter&#39;</span>
    <span class="k">assert</span> <span class="n">c</span><span class="o">.</span><span class="n">data_io</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;PandasIO&#39;</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">tst</span><span class="o">.</span><span class="n">run</span> <span class="p">(</span><span class="n">test_pandas_component</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="s1">&#39;dummy&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

</div>


